// Copyright 2024, University of Colorado Boulder
/**
 * "Group Sort Interaction" overview:
 * Model type for the "group sort" interaction. This interaction behaves as such:
 * - Alt input treats the entire group as a single entity. Instead of using scenery focus control, it is handled internally.
 * - Focusing on the group highlights a "selected" group item. The interaction starts in "selection" state.
 * - Interaction keys change the "selection" (focus) of a group item. Focus highlight around the selected item is solid.
 * - The selected item is grabbable (see note below).
 * - Space/enter are used to "grab" the selection, turning the interaction state to "sorting" state. Pressing again
 *   toggles back to "selection" state. In sorting state, the focus highlight is dashed.
 * - Interaction keys in "sorting" state sort the group item, which changes the value of that group item.
 *
 * NOTE: "focus" in this interaction is called "selection" as to not overload the term. This is because the
 * "focused" group item is stored and changed even when it doesn't have browser focus on it. See selectedGroupItemProperty.
 *
 * Class Overview:
 * This class holds model information about the state of the group sort interaction. This includes specifics about
 * whether the interaction is in "selection" or "sorting" state. Also about if portions of the interaction have
 * "successfully" occurred such that hint cues don't need to be displayed anymore.
 *
 * A note about mouse input:
 * All group sort instances thus far have been accompanied by mouse/touch input as well. Though this goes beyond the
 * scope of group sort to implement, there are mouse-specific Properties here in the model that help sync group
 * sort state/cueing with the visual cueing too. Please follow instructions below to make sure those are used
 * appropriately.
 *
 * A note about using with scenes:
 * In general, there is just one instance of this per model, and not per scene. This is because if someone can
 * successfully grab and sort in one scene, then that learned understanding about the interaction should transfer to
 * the next scene.
 *
 * A note about PhET-iO:
 * Properties that handle visual cue states are not PhET-iO instrumented, because they are considered transient.
 * See showMouseCueProperty for the extent of PhET-iO customization.
 *
 * Implementation steps (these steps apply to the model and view):
 * - use with GroupSortInteractionView
 * - reset selectedGroupItemProperty with a sim-specific heuristic when the underlying model needs to update the best
 *   first selection. (Also see GroupSortInteractionView.getGroupItemToSelect for a hook to apply this on group focus).
 * - the grab/release cue is created for you, and can be repositioned by accessing from your GroupSortInteractionView instance.
 * - Handle your own keyboard and mouse "sort indicator cue node" (see registerUpdateSortCueNode())
 * - use setMouseSortedGroupItem( true ) on mouse/touch sorting interactions to make sure that the mouse sort cue visibility is correct.
 * - mouseSortCueVisibleProperty should be set by client, using mouseSortCueShouldBeVisible() in addition to any sim-specific logic required.
 * - It is best to use one model per screen and one view per scene.
 * - use GroupSortInteractionView.groupSortGroupFocusHighlightPath.shape to set the group highlight dynamically
 * - use positionSortCueNodeEmitter to update the position of the sort cue for the keyboard interaction.
 * - use enabledProperty to control if sorting is enabled. Note that focus and selection are always available (for keyboard tab order consistency)
 * - Note that if GroupSelectModel is PhET-iO instrumented, ItemModel must be a PhetioObject.
 *
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Marla Schulz (PhET Interactive Simulations)
 */ import BooleanProperty from '../../../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../../../axon/js/DerivedProperty.js';
import EnabledComponent from '../../../../../axon/js/EnabledComponent.js';
import Property from '../../../../../axon/js/Property.js';
import optionize from '../../../../../phet-core/js/optionize.js';
import PhetioObject from '../../../../../tandem/js/PhetioObject.js';
import phetioStateSetEmitter from '../../../../../tandem/js/phetioStateSetEmitter.js';
import Tandem from '../../../../../tandem/js/Tandem.js';
import IOType from '../../../../../tandem/js/types/IOType.js';
import NullableIO from '../../../../../tandem/js/types/NullableIO.js';
import ReferenceIO from '../../../../../tandem/js/types/ReferenceIO.js';
import sceneryPhet from '../../../sceneryPhet.js';
let GroupSelectModel = class GroupSelectModel extends EnabledComponent {
    // Wrap this in a function to make sure that hasMouseSortedGroupItemProperty is never read or listened to. Instead,
    // listen to hasGroupItemBeenSortedProperty (like to set the mouseSortCueVisibleProperty).
    setMouseSortedGroupItem(sortedByMouse) {
        this.hasMouseSortedGroupItemProperty.value = sortedByMouse;
    }
    // Given the knowledge that GroupSelectModel has, should the mouse sort cue be visible? This most often
    // isn't the complete boolean, since there will be sim-specific knowledge that contributes to the final visibility
    // of the Node.
    mouseSortCueShouldBeVisible() {
        return this.showMouseCueProperty.value && !this.hasGroupItemBeenSortedProperty.value && !this.isKeyboardFocusedProperty.value && this.enabled;
    }
    /**
   * Reset the interaction without changing the cueing logic. This is best called during a data "erase" and also when
   * switching between scenes.
   */ resetInteractionState() {
        // isGroupItemKeyboardGrabbedProperty needs to be reset before the selectedGroupItemProperty, because a
        // selectedGroupItemProperty listener is relying on an accurate isGroupItemKeyboardGrabbedProperty.value
        // to fire an assertion.
        this.isGroupItemKeyboardGrabbedProperty.reset();
        this.selectedGroupItemProperty.reset();
        this.isKeyboardFocusedProperty.reset();
    }
    reset() {
        this.resetInteractionState();
        // Don't reset showMouseCueProperty because it is set only by PhET-iO, and should persist
        this.hasMouseSortedGroupItemProperty.reset();
        this.hasKeyboardGrabbedGroupItemProperty.reset();
        this.hasKeyboardSelectedGroupItemProperty.reset();
        this.hasKeyboardSortedGroupItemProperty.reset();
        this.mouseSortCueVisibleProperty.reset();
        // If a PhET-iO client has set showMouseCueProperty to false, then the mouseSortCueVisibleProperty
        // needs to respect that.
        this.mouseSortCueVisibleProperty.value = this.mouseSortCueShouldBeVisible();
    }
    // Clear the selection state for the interaction (setting to null)
    clearSelection() {
        this.selectedGroupItemProperty.value = null;
    }
    // Register your closure responsible for updating the sort-indicator node. This should be called with a callback that
    // updates mouseSortCueVisibleProperty and maybe does other things. You will likely need to call this update function
    // for sim specific usages as well.
    registerUpdateSortCueNode(updateSortIndicatorNode) {
        this.showMouseCueProperty.link(updateSortIndicatorNode);
        this.enabledProperty.link(updateSortIndicatorNode);
        this.selectedGroupItemProperty.link(updateSortIndicatorNode);
        this.hasGroupItemBeenSortedProperty.link(updateSortIndicatorNode);
        this.isKeyboardFocusedProperty.link(updateSortIndicatorNode);
        phetioStateSetEmitter.addListener(updateSortIndicatorNode);
        this.disposeEmitter.addListener(()=>{
            phetioStateSetEmitter.removeListener(updateSortIndicatorNode);
            this.isKeyboardFocusedProperty.unlink(updateSortIndicatorNode);
            this.hasGroupItemBeenSortedProperty.unlink(updateSortIndicatorNode);
            this.mouseSortCueVisibleProperty.unlink(updateSortIndicatorNode);
            this.enabledProperty.unlink(updateSortIndicatorNode);
            this.showMouseCueProperty.unlink(updateSortIndicatorNode);
            this.selectedGroupItemProperty.unlink(updateSortIndicatorNode);
        });
    }
    // Interrupt the group sort interaction
    interrupt() {
        this.isKeyboardFocusedProperty.value = false;
        this.isGroupItemKeyboardGrabbedProperty.value = false;
    }
    dispose() {
        this.selectedGroupItemProperty.dispose();
        this.isGroupItemKeyboardGrabbedProperty.dispose();
        this.grabReleaseCueVisibleProperty.dispose();
        this.keyboardSortCueVisibleProperty.dispose();
        this.isKeyboardFocusedProperty.dispose();
        this.showMouseCueProperty.dispose();
        this.hasKeyboardGrabbedGroupItemProperty.dispose();
        this.hasKeyboardSortedGroupItemProperty.dispose();
        this.hasKeyboardSelectedGroupItemProperty.dispose();
        this.mouseSortCueVisibleProperty.dispose();
        this.hasGroupItemBeenSortedProperty.dispose();
        super.dispose();
    }
    constructor(providedOptions){
        const options = optionize()({
            tandem: Tandem.REQUIRED,
            phetioEnabledPropertyInstrumented: false,
            initialMouseSortCueVisible: false
        }, providedOptions);
        super(options), // Whether a group item is being grabbed via keyboard interaction. When true, the focus highlight will display as
        // dashed instead of solid.
        this.isGroupItemKeyboardGrabbedProperty = new BooleanProperty(false), // Whether the keyboard is currently focused on a sim component
        this.isKeyboardFocusedProperty = new BooleanProperty(false), // Properties that switch to true when the specified action has occurred once.
        this.hasKeyboardGrabbedGroupItemProperty = new BooleanProperty(false), // Whether a group item has been sorted with keyboard input.
        this.hasKeyboardSortedGroupItemProperty = new BooleanProperty(false), // Whether the user has changed the selected group item with the keyboard controls. Note, this will not be true until
        // the selection changes from the default upon focus.
        this.hasKeyboardSelectedGroupItemProperty = new BooleanProperty(false), // Whether a group item has been sorted with mouse/touch (non keyboard) input. This is set to true from outside
        // input (not from keyboard/group sort input), but is important for cue showing.
        this.hasMouseSortedGroupItemProperty = new BooleanProperty(false);
        this.getGroupItemValue = options.getGroupItemValue;
        this.selectedGroupItemProperty = new Property(null, {
            isValidValue: (x)=>!!x || x === null,
            tandem: options.tandem.createTandem('selectedGroupItemProperty'),
            phetioValueType: NullableIO(ReferenceIO(IOType.ObjectIO)),
            phetioReadOnly: true,
            phetioDocumentation: 'For PhET-iO internal use only. Tracks the current selection for the interaction. Null means there is no selection.'
        });
        assert && this.selectedGroupItemProperty.lazyLink((selectedGroupItem, oldSelectedGroupItem)=>{
            if (this.isGroupItemKeyboardGrabbedProperty.value && selectedGroupItem && oldSelectedGroupItem) {
                assert && assert(this.getGroupItemValue(selectedGroupItem) === this.getGroupItemValue(oldSelectedGroupItem), 'should not change both the selection and the value when sorting');
            }
            // If we are PhET-iO instrumented, so should the selection.
            if (Tandem.VALIDATION && selectedGroupItem && options.tandem.supplied) {
                assert && assert(selectedGroupItem instanceof PhetioObject && selectedGroupItem.isPhetioInstrumented(), 'instrumented GroupSortInteractionModels require its group items to be instrumented.');
            }
        });
        this.mouseSortCueVisibleProperty = new Property(options.initialMouseSortCueVisible);
        this.showMouseCueProperty = new BooleanProperty(true, {
            tandem: options.tandem.createTandem('showMouseCueProperty'),
            phetioDocumentation: 'This controls if the visual cue Node for mouse/touch sorting is displayed. Set to false ' + 'to hide the cue. A value of true does not mean the cue is visible, but instead that it can ' + 'be shown when appropriate'
        });
        this.hasGroupItemBeenSortedProperty = new DerivedProperty([
            this.hasMouseSortedGroupItemProperty,
            this.hasKeyboardSortedGroupItemProperty
        ], (hasMouseSortedGroupItem, hasKeyboardSortedGroupItem)=>{
            return hasMouseSortedGroupItem || hasKeyboardSortedGroupItem;
        });
        this.grabReleaseCueVisibleProperty = new DerivedProperty([
            this.selectedGroupItemProperty,
            this.hasKeyboardGrabbedGroupItemProperty,
            this.isKeyboardFocusedProperty,
            this.enabledProperty
        ], (selectedGroupItem, hasGrabbedGroupItem, hasKeyboardFocus, enabled)=>{
            return selectedGroupItem !== null && !hasGrabbedGroupItem && hasKeyboardFocus && enabled;
        });
        this.keyboardSortCueVisibleProperty = new DerivedProperty([
            this.selectedGroupItemProperty,
            this.isGroupItemKeyboardGrabbedProperty,
            this.isKeyboardFocusedProperty,
            this.hasKeyboardSortedGroupItemProperty
        ], (selectedGroupItem, isGroupItemKeyboardGrabbed, isKeyboardFocused, hasKeyboardSortedGroupItem)=>selectedGroupItem !== null && isGroupItemKeyboardGrabbed && isKeyboardFocused && !hasKeyboardSortedGroupItem);
    }
};
export { GroupSelectModel as default };
sceneryPhet.register('GroupSelectModel', GroupSelectModel);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9hY2Nlc3NpYmlsaXR5L2dyb3VwLXNvcnQvbW9kZWwvR3JvdXBTZWxlY3RNb2RlbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbi8qKlxuICogXCJHcm91cCBTb3J0IEludGVyYWN0aW9uXCIgb3ZlcnZpZXc6XG4gKiBNb2RlbCB0eXBlIGZvciB0aGUgXCJncm91cCBzb3J0XCIgaW50ZXJhY3Rpb24uIFRoaXMgaW50ZXJhY3Rpb24gYmVoYXZlcyBhcyBzdWNoOlxuICogLSBBbHQgaW5wdXQgdHJlYXRzIHRoZSBlbnRpcmUgZ3JvdXAgYXMgYSBzaW5nbGUgZW50aXR5LiBJbnN0ZWFkIG9mIHVzaW5nIHNjZW5lcnkgZm9jdXMgY29udHJvbCwgaXQgaXMgaGFuZGxlZCBpbnRlcm5hbGx5LlxuICogLSBGb2N1c2luZyBvbiB0aGUgZ3JvdXAgaGlnaGxpZ2h0cyBhIFwic2VsZWN0ZWRcIiBncm91cCBpdGVtLiBUaGUgaW50ZXJhY3Rpb24gc3RhcnRzIGluIFwic2VsZWN0aW9uXCIgc3RhdGUuXG4gKiAtIEludGVyYWN0aW9uIGtleXMgY2hhbmdlIHRoZSBcInNlbGVjdGlvblwiIChmb2N1cykgb2YgYSBncm91cCBpdGVtLiBGb2N1cyBoaWdobGlnaHQgYXJvdW5kIHRoZSBzZWxlY3RlZCBpdGVtIGlzIHNvbGlkLlxuICogLSBUaGUgc2VsZWN0ZWQgaXRlbSBpcyBncmFiYmFibGUgKHNlZSBub3RlIGJlbG93KS5cbiAqIC0gU3BhY2UvZW50ZXIgYXJlIHVzZWQgdG8gXCJncmFiXCIgdGhlIHNlbGVjdGlvbiwgdHVybmluZyB0aGUgaW50ZXJhY3Rpb24gc3RhdGUgdG8gXCJzb3J0aW5nXCIgc3RhdGUuIFByZXNzaW5nIGFnYWluXG4gKiAgIHRvZ2dsZXMgYmFjayB0byBcInNlbGVjdGlvblwiIHN0YXRlLiBJbiBzb3J0aW5nIHN0YXRlLCB0aGUgZm9jdXMgaGlnaGxpZ2h0IGlzIGRhc2hlZC5cbiAqIC0gSW50ZXJhY3Rpb24ga2V5cyBpbiBcInNvcnRpbmdcIiBzdGF0ZSBzb3J0IHRoZSBncm91cCBpdGVtLCB3aGljaCBjaGFuZ2VzIHRoZSB2YWx1ZSBvZiB0aGF0IGdyb3VwIGl0ZW0uXG4gKlxuICogTk9URTogXCJmb2N1c1wiIGluIHRoaXMgaW50ZXJhY3Rpb24gaXMgY2FsbGVkIFwic2VsZWN0aW9uXCIgYXMgdG8gbm90IG92ZXJsb2FkIHRoZSB0ZXJtLiBUaGlzIGlzIGJlY2F1c2UgdGhlXG4gKiBcImZvY3VzZWRcIiBncm91cCBpdGVtIGlzIHN0b3JlZCBhbmQgY2hhbmdlZCBldmVuIHdoZW4gaXQgZG9lc24ndCBoYXZlIGJyb3dzZXIgZm9jdXMgb24gaXQuIFNlZSBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LlxuICpcbiAqIENsYXNzIE92ZXJ2aWV3OlxuICogVGhpcyBjbGFzcyBob2xkcyBtb2RlbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc3RhdGUgb2YgdGhlIGdyb3VwIHNvcnQgaW50ZXJhY3Rpb24uIFRoaXMgaW5jbHVkZXMgc3BlY2lmaWNzIGFib3V0XG4gKiB3aGV0aGVyIHRoZSBpbnRlcmFjdGlvbiBpcyBpbiBcInNlbGVjdGlvblwiIG9yIFwic29ydGluZ1wiIHN0YXRlLiBBbHNvIGFib3V0IGlmIHBvcnRpb25zIG9mIHRoZSBpbnRlcmFjdGlvbiBoYXZlXG4gKiBcInN1Y2Nlc3NmdWxseVwiIG9jY3VycmVkIHN1Y2ggdGhhdCBoaW50IGN1ZXMgZG9uJ3QgbmVlZCB0byBiZSBkaXNwbGF5ZWQgYW55bW9yZS5cbiAqXG4gKiBBIG5vdGUgYWJvdXQgbW91c2UgaW5wdXQ6XG4gKiBBbGwgZ3JvdXAgc29ydCBpbnN0YW5jZXMgdGh1cyBmYXIgaGF2ZSBiZWVuIGFjY29tcGFuaWVkIGJ5IG1vdXNlL3RvdWNoIGlucHV0IGFzIHdlbGwuIFRob3VnaCB0aGlzIGdvZXMgYmV5b25kIHRoZVxuICogc2NvcGUgb2YgZ3JvdXAgc29ydCB0byBpbXBsZW1lbnQsIHRoZXJlIGFyZSBtb3VzZS1zcGVjaWZpYyBQcm9wZXJ0aWVzIGhlcmUgaW4gdGhlIG1vZGVsIHRoYXQgaGVscCBzeW5jIGdyb3VwXG4gKiBzb3J0IHN0YXRlL2N1ZWluZyB3aXRoIHRoZSB2aXN1YWwgY3VlaW5nIHRvby4gUGxlYXNlIGZvbGxvdyBpbnN0cnVjdGlvbnMgYmVsb3cgdG8gbWFrZSBzdXJlIHRob3NlIGFyZSB1c2VkXG4gKiBhcHByb3ByaWF0ZWx5LlxuICpcbiAqIEEgbm90ZSBhYm91dCB1c2luZyB3aXRoIHNjZW5lczpcbiAqIEluIGdlbmVyYWwsIHRoZXJlIGlzIGp1c3Qgb25lIGluc3RhbmNlIG9mIHRoaXMgcGVyIG1vZGVsLCBhbmQgbm90IHBlciBzY2VuZS4gVGhpcyBpcyBiZWNhdXNlIGlmIHNvbWVvbmUgY2FuXG4gKiBzdWNjZXNzZnVsbHkgZ3JhYiBhbmQgc29ydCBpbiBvbmUgc2NlbmUsIHRoZW4gdGhhdCBsZWFybmVkIHVuZGVyc3RhbmRpbmcgYWJvdXQgdGhlIGludGVyYWN0aW9uIHNob3VsZCB0cmFuc2ZlciB0b1xuICogdGhlIG5leHQgc2NlbmUuXG4gKlxuICogQSBub3RlIGFib3V0IFBoRVQtaU86XG4gKiBQcm9wZXJ0aWVzIHRoYXQgaGFuZGxlIHZpc3VhbCBjdWUgc3RhdGVzIGFyZSBub3QgUGhFVC1pTyBpbnN0cnVtZW50ZWQsIGJlY2F1c2UgdGhleSBhcmUgY29uc2lkZXJlZCB0cmFuc2llbnQuXG4gKiBTZWUgc2hvd01vdXNlQ3VlUHJvcGVydHkgZm9yIHRoZSBleHRlbnQgb2YgUGhFVC1pTyBjdXN0b21pemF0aW9uLlxuICpcbiAqIEltcGxlbWVudGF0aW9uIHN0ZXBzICh0aGVzZSBzdGVwcyBhcHBseSB0byB0aGUgbW9kZWwgYW5kIHZpZXcpOlxuICogLSB1c2Ugd2l0aCBHcm91cFNvcnRJbnRlcmFjdGlvblZpZXdcbiAqIC0gcmVzZXQgc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSB3aXRoIGEgc2ltLXNwZWNpZmljIGhldXJpc3RpYyB3aGVuIHRoZSB1bmRlcmx5aW5nIG1vZGVsIG5lZWRzIHRvIHVwZGF0ZSB0aGUgYmVzdFxuICogICBmaXJzdCBzZWxlY3Rpb24uIChBbHNvIHNlZSBHcm91cFNvcnRJbnRlcmFjdGlvblZpZXcuZ2V0R3JvdXBJdGVtVG9TZWxlY3QgZm9yIGEgaG9vayB0byBhcHBseSB0aGlzIG9uIGdyb3VwIGZvY3VzKS5cbiAqIC0gdGhlIGdyYWIvcmVsZWFzZSBjdWUgaXMgY3JlYXRlZCBmb3IgeW91LCBhbmQgY2FuIGJlIHJlcG9zaXRpb25lZCBieSBhY2Nlc3NpbmcgZnJvbSB5b3VyIEdyb3VwU29ydEludGVyYWN0aW9uVmlldyBpbnN0YW5jZS5cbiAqIC0gSGFuZGxlIHlvdXIgb3duIGtleWJvYXJkIGFuZCBtb3VzZSBcInNvcnQgaW5kaWNhdG9yIGN1ZSBub2RlXCIgKHNlZSByZWdpc3RlclVwZGF0ZVNvcnRDdWVOb2RlKCkpXG4gKiAtIHVzZSBzZXRNb3VzZVNvcnRlZEdyb3VwSXRlbSggdHJ1ZSApIG9uIG1vdXNlL3RvdWNoIHNvcnRpbmcgaW50ZXJhY3Rpb25zIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBtb3VzZSBzb3J0IGN1ZSB2aXNpYmlsaXR5IGlzIGNvcnJlY3QuXG4gKiAtIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eSBzaG91bGQgYmUgc2V0IGJ5IGNsaWVudCwgdXNpbmcgbW91c2VTb3J0Q3VlU2hvdWxkQmVWaXNpYmxlKCkgaW4gYWRkaXRpb24gdG8gYW55IHNpbS1zcGVjaWZpYyBsb2dpYyByZXF1aXJlZC5cbiAqIC0gSXQgaXMgYmVzdCB0byB1c2Ugb25lIG1vZGVsIHBlciBzY3JlZW4gYW5kIG9uZSB2aWV3IHBlciBzY2VuZS5cbiAqIC0gdXNlIEdyb3VwU29ydEludGVyYWN0aW9uVmlldy5ncm91cFNvcnRHcm91cEZvY3VzSGlnaGxpZ2h0UGF0aC5zaGFwZSB0byBzZXQgdGhlIGdyb3VwIGhpZ2hsaWdodCBkeW5hbWljYWxseVxuICogLSB1c2UgcG9zaXRpb25Tb3J0Q3VlTm9kZUVtaXR0ZXIgdG8gdXBkYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgc29ydCBjdWUgZm9yIHRoZSBrZXlib2FyZCBpbnRlcmFjdGlvbi5cbiAqIC0gdXNlIGVuYWJsZWRQcm9wZXJ0eSB0byBjb250cm9sIGlmIHNvcnRpbmcgaXMgZW5hYmxlZC4gTm90ZSB0aGF0IGZvY3VzIGFuZCBzZWxlY3Rpb24gYXJlIGFsd2F5cyBhdmFpbGFibGUgKGZvciBrZXlib2FyZCB0YWIgb3JkZXIgY29uc2lzdGVuY3kpXG4gKiAtIE5vdGUgdGhhdCBpZiBHcm91cFNlbGVjdE1vZGVsIGlzIFBoRVQtaU8gaW5zdHJ1bWVudGVkLCBJdGVtTW9kZWwgbXVzdCBiZSBhIFBoZXRpb09iamVjdC5cbiAqXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKiBAYXV0aG9yIE1hcmxhIFNjaHVseiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqL1xuXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xuaW1wb3J0IEVuYWJsZWRDb21wb25lbnQsIHsgRW5hYmxlZENvbXBvbmVudE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL0VuYWJsZWRDb21wb25lbnQuanMnO1xuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi8uLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgb3B0aW9uaXplIGZyb20gJy4uLy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xuaW1wb3J0IFBoZXRpb09iamVjdCwgeyBQaGV0aW9PYmplY3RPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL1BoZXRpb09iamVjdC5qcyc7XG5pbXBvcnQgcGhldGlvU3RhdGVTZXRFbWl0dGVyIGZyb20gJy4uLy4uLy4uLy4uLy4uL3RhbmRlbS9qcy9waGV0aW9TdGF0ZVNldEVtaXR0ZXIuanMnO1xuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi8uLi8uLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcbmltcG9ydCBJT1R5cGUgZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL0lPVHlwZS5qcyc7XG5pbXBvcnQgTnVsbGFibGVJTyBmcm9tICcuLi8uLi8uLi8uLi8uLi90YW5kZW0vanMvdHlwZXMvTnVsbGFibGVJTy5qcyc7XG5pbXBvcnQgUmVmZXJlbmNlSU8gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdGFuZGVtL2pzL3R5cGVzL1JlZmVyZW5jZUlPLmpzJztcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5UGhldC5qcyc7XG5cbnR5cGUgU2VsZk9wdGlvbnM8SXRlbU1vZGVsPiA9IHtcblxuICAvLyBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgXCJ2YWx1ZVwiIGZvciBhIGdyb3VwIGl0ZW0gc2V0IHRvIGl0LiBUaGUgdmFsdWUgaXMgd2hlcmUgdGhlIGl0ZW0gc2hvdWxkIGJlIHNvcnRlZC5cbiAgLy8gTnVsbCBtZWFucyB0aGF0IGl0IGlzbid0IHBhcnQgb2YgdGhpcyBpbnRlcmFjdGlvbiAoZGlmZmVyZW50IHNjZW5lL25vdCBhY3RpdmUvZXRjKS5cbiAgZ2V0R3JvdXBJdGVtVmFsdWU6ICggaXRlbU1vZGVsOiBJdGVtTW9kZWwgKSA9PiBudW1iZXIgfCBudWxsO1xuXG4gIC8vIERlZmluZSB0aGUgc3RhcnR1cCB2YWx1ZSBvZiB0aGUgbW91c2VTb3J0Q3VlLiBGYWxzZSBieSBkZWZhdWx0LlxuICBpbml0aWFsTW91c2VTb3J0Q3VlVmlzaWJsZT86IGJvb2xlYW47XG59ICYgUGljazxQaGV0aW9PYmplY3RPcHRpb25zLCAndGFuZGVtJz47XG5cbnR5cGUgUGFyZW50T3B0aW9ucyA9IEVuYWJsZWRDb21wb25lbnRPcHRpb25zO1xuXG5leHBvcnQgdHlwZSBHcm91cFNlbGVjdE1vZGVsT3B0aW9uczxJdGVtTW9kZWw+ID0gU2VsZk9wdGlvbnM8SXRlbU1vZGVsPiAmIFBhcmVudE9wdGlvbnM7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdyb3VwU2VsZWN0TW9kZWw8SXRlbU1vZGVsPiBleHRlbmRzIEVuYWJsZWRDb21wb25lbnQge1xuXG4gIC8vIFRoZSBncm91cCBpdGVtIHRoYXQgaXMgdGhlIHNlbGVjdGVkL2ZvY3VzZWQvc29ydGVkLiBJZiBudWxsLCB0aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gc29ydCAobm8gaXRlbXM/KSwgYW5kIHRoZVxuICAvLyBpbnRlcmFjdGlvbiB3aWxsIG5vLW9wLiBGZWVsIGZyZWUgdG8gZHluYW1pY2FsbHkgY2hhbmdlIHRoaXMgdmFsdWUgdG8gdXBkYXRlIHRoZSByZWFsdGltZSBzZWxlY3Rpb24gb2YgdGhlXG4gIC8vIGdyb3VwIHNvcnQgaW50ZXJhY3Rpb24uXG4gIHB1YmxpYyByZWFkb25seSBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5OiBQcm9wZXJ0eTxJdGVtTW9kZWwgfCBudWxsPjtcblxuICAvLyBXaGV0aGVyIGEgZ3JvdXAgaXRlbSBpcyBiZWluZyBncmFiYmVkIHZpYSBrZXlib2FyZCBpbnRlcmFjdGlvbi4gV2hlbiB0cnVlLCB0aGUgZm9jdXMgaGlnaGxpZ2h0IHdpbGwgZGlzcGxheSBhc1xuICAvLyBkYXNoZWQgaW5zdGVhZCBvZiBzb2xpZC5cbiAgcHVibGljIHJlYWRvbmx5IGlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCBmYWxzZSApO1xuXG4gIC8vIFdoZXRoZXIgdGhlICdQcmVzcyBTUEFDRSB0byBHcmFiIG9yIFJlbGVhc2UnIGRpYWxvZyBpcyBzaG93aW5nXG4gIHB1YmxpYyByZWFkb25seSBncmFiUmVsZWFzZUN1ZVZpc2libGVQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgLy8gV2hldGhlciB0aGUga2V5Ym9hcmQgc29ydCBpY29uIGN1ZSBpcyBzaG93aW5nXG4gIHB1YmxpYyByZWFkb25seSBrZXlib2FyZFNvcnRDdWVWaXNpYmxlUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xuXG4gIC8vIFdoZXRoZXIgdGhlIGtleWJvYXJkIGlzIGN1cnJlbnRseSBmb2N1c2VkIG9uIGEgc2ltIGNvbXBvbmVudFxuICBwdWJsaWMgcmVhZG9ubHkgaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XG5cbiAgLy8gUHJvcGVydGllcyB0aGF0IHN3aXRjaCB0byB0cnVlIHdoZW4gdGhlIHNwZWNpZmllZCBhY3Rpb24gaGFzIG9jY3VycmVkIG9uY2UuXG4gIHB1YmxpYyByZWFkb25seSBoYXNLZXlib2FyZEdyYWJiZWRHcm91cEl0ZW1Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XG5cbiAgLy8gV2hldGhlciBhIGdyb3VwIGl0ZW0gaGFzIGJlZW4gc29ydGVkIHdpdGgga2V5Ym9hcmQgaW5wdXQuXG4gIHB1YmxpYyByZWFkb25seSBoYXNLZXlib2FyZFNvcnRlZEdyb3VwSXRlbVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcblxuICAvLyBXaGV0aGVyIHRoZSB1c2VyIGhhcyBjaGFuZ2VkIHRoZSBzZWxlY3RlZCBncm91cCBpdGVtIHdpdGggdGhlIGtleWJvYXJkIGNvbnRyb2xzLiBOb3RlLCB0aGlzIHdpbGwgbm90IGJlIHRydWUgdW50aWxcbiAgLy8gdGhlIHNlbGVjdGlvbiBjaGFuZ2VzIGZyb20gdGhlIGRlZmF1bHQgdXBvbiBmb2N1cy5cbiAgcHVibGljIHJlYWRvbmx5IGhhc0tleWJvYXJkU2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoIGZhbHNlICk7XG5cbiAgLy8gV2hldGhlciB0aGUgbW91c2UvdG91Y2ggc29ydCBpY29uIGN1ZSBpcyBjdXJyZW50bHkgc2hvd2luZyBvbiB0aGUgZ3JvdXAgaXRlbSBhcmVhLlxuICAvLyBDbGllbnQgc2hvdWxkIHNldCB0aGlzIFByb3BlcnR5IGFzIHdlbGwgYXMgdXNlIGl0IGZvciB0aGVpciBtb3VzZSBzb3J0IGN1ZSBub2RlLlxuICAvLyBDbGllbnQgc2hvdWxkIG1hbnVhbGx5IHJlZ2lzdGVyIGNhbGxiYWNrcyB0byB1cGRhdGUgdGhlIHZpc3VhbCBjdWUgd2l0aCByZWdpc3RlclVwZGF0ZVNvcnRDdWVOb2RlKCkuXG4gIHB1YmxpYyByZWFkb25seSBtb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+O1xuXG4gIC8vIEEgUGhFVC1pTyBzcGVjaWZpYyBQcm9wZXJ0eSBmb3Igb3B0aW5nIG91dCBvZiBzaG93aW5nIHRoZSB2aXN1YWwgbW91c2UgY3VlLiBUaGlzIGlzIG5vdCByZXNldCwgYW5kIGlzIHVzZWQgdG9cbiAgLy8gY2FsY3VsYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBtb3VzZSBjdWUuIElmIHRydWUsIGl0IGRvZXNuJ3QgbWVhbiB0aGF0IHRoZSBjdWUgaXMgdmlzaWJsZSwgYnV0IHRoYXQgaXQgaXMgcG9zc2libGVcbiAgLy8gdG8gc2hvdyB0aGUgY3VlIHdoZW4gYXBwcm9wcmlhdGUuIFNldCB0byBmYWxzZSB0byBvcHQgb3V0IG9mIGN1ZSB2aXNpYmlsaXR5LlxuICBwcml2YXRlIHJlYWRvbmx5IHNob3dNb3VzZUN1ZVByb3BlcnR5OiBUUHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgLy8gV2hldGhlciBhIGdyb3VwIGl0ZW0gaGFzIGJlZW4gc29ydGVkIHdpdGggbW91c2UvdG91Y2ggKG5vbiBrZXlib2FyZCkgaW5wdXQuIFRoaXMgaXMgc2V0IHRvIHRydWUgZnJvbSBvdXRzaWRlXG4gIC8vIGlucHV0IChub3QgZnJvbSBrZXlib2FyZC9ncm91cCBzb3J0IGlucHV0KSwgYnV0IGlzIGltcG9ydGFudCBmb3IgY3VlIHNob3dpbmcuXG4gIHB1YmxpYyByZWFkb25seSBoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcblxuICAvLyBXaGV0aGVyIGFueSBncm91cCBpdGVtIGhhcyB5ZXQgYmVlbiBzb3J0ZWQgdG8gYSBuZXcgdmFsdWUsIGV2ZW4gaWYgbm90IGJ5IHRoZSBcImdyb3VwIHNvcnRcIiBpbnRlcmFjdGlvbi4gVGhpc1xuICAvLyBQcm9wZXJ0eSBzaG91bGQgYmUgdXNlZCB0byBjb250cm9sIHRoZSBtb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkuIFRoZSBtb3VzZSBzb3J0IGN1ZSBkb2VzIG5vdCBuZWVkIHRvIGJlIHNob3duXG4gIC8vIGlmIGEga2V5Ym9hcmQgc29ydCBoYXMgb2NjdXJyZWQgKGJlY2F1c2Ugbm93IHRoZSB1c2VyIGtub3dzIHRoYXQgdGhlIGdyb3VwIGl0ZW1zIGFyZSBzb3J0YWJsZSkuXG4gIHB1YmxpYyByZWFkb25seSBoYXNHcm91cEl0ZW1CZWVuU29ydGVkUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PGJvb2xlYW4+O1xuXG4gIHB1YmxpYyByZWFkb25seSBnZXRHcm91cEl0ZW1WYWx1ZTogKCBpdGVtTW9kZWw6IEl0ZW1Nb2RlbCApID0+IG51bWJlciB8IG51bGw7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBHcm91cFNlbGVjdE1vZGVsT3B0aW9uczxJdGVtTW9kZWw+ICkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8R3JvdXBTZWxlY3RNb2RlbE9wdGlvbnM8SXRlbU1vZGVsPiwgU2VsZk9wdGlvbnM8SXRlbU1vZGVsPiwgUGFyZW50T3B0aW9ucz4oKSgge1xuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXG4gICAgICBwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IGZhbHNlLFxuICAgICAgaW5pdGlhbE1vdXNlU29ydEN1ZVZpc2libGU6IGZhbHNlXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XG5cbiAgICBzdXBlciggb3B0aW9ucyApO1xuXG4gICAgdGhpcy5nZXRHcm91cEl0ZW1WYWx1ZSA9IG9wdGlvbnMuZ2V0R3JvdXBJdGVtVmFsdWU7XG5cbiAgICB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkgPSBuZXcgUHJvcGVydHk8SXRlbU1vZGVsIHwgbnVsbD4oIG51bGwsIHtcbiAgICAgIGlzVmFsaWRWYWx1ZTogeCA9PiAhIXggfHwgeCA9PT0gbnVsbCxcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0uY3JlYXRlVGFuZGVtKCAnc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eScgKSxcbiAgICAgIHBoZXRpb1ZhbHVlVHlwZTogTnVsbGFibGVJTyggUmVmZXJlbmNlSU8oIElPVHlwZS5PYmplY3RJTyApICksXG4gICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZSxcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdGb3IgUGhFVC1pTyBpbnRlcm5hbCB1c2Ugb25seS4gVHJhY2tzIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBmb3IgdGhlIGludGVyYWN0aW9uLiBOdWxsIG1lYW5zIHRoZXJlIGlzIG5vIHNlbGVjdGlvbi4nXG4gICAgfSApO1xuXG4gICAgYXNzZXJ0ICYmIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5sYXp5TGluayggKCBzZWxlY3RlZEdyb3VwSXRlbSwgb2xkU2VsZWN0ZWRHcm91cEl0ZW0gKSA9PiB7XG4gICAgICBpZiAoIHRoaXMuaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eS52YWx1ZSAmJiBzZWxlY3RlZEdyb3VwSXRlbSAmJiBvbGRTZWxlY3RlZEdyb3VwSXRlbSApIHtcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggdGhpcy5nZXRHcm91cEl0ZW1WYWx1ZSggc2VsZWN0ZWRHcm91cEl0ZW0gKSA9PT0gdGhpcy5nZXRHcm91cEl0ZW1WYWx1ZSggb2xkU2VsZWN0ZWRHcm91cEl0ZW0gKSxcbiAgICAgICAgICAnc2hvdWxkIG5vdCBjaGFuZ2UgYm90aCB0aGUgc2VsZWN0aW9uIGFuZCB0aGUgdmFsdWUgd2hlbiBzb3J0aW5nJyApO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB3ZSBhcmUgUGhFVC1pTyBpbnN0cnVtZW50ZWQsIHNvIHNob3VsZCB0aGUgc2VsZWN0aW9uLlxuICAgICAgaWYgKCBUYW5kZW0uVkFMSURBVElPTiAmJiBzZWxlY3RlZEdyb3VwSXRlbSAmJiBvcHRpb25zLnRhbmRlbS5zdXBwbGllZCApIHtcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggc2VsZWN0ZWRHcm91cEl0ZW0gaW5zdGFuY2VvZiBQaGV0aW9PYmplY3QgJiYgc2VsZWN0ZWRHcm91cEl0ZW0uaXNQaGV0aW9JbnN0cnVtZW50ZWQoKSxcbiAgICAgICAgICAnaW5zdHJ1bWVudGVkIEdyb3VwU29ydEludGVyYWN0aW9uTW9kZWxzIHJlcXVpcmUgaXRzIGdyb3VwIGl0ZW1zIHRvIGJlIGluc3RydW1lbnRlZC4nICk7XG4gICAgICB9XG4gICAgfSApO1xuXG4gICAgdGhpcy5tb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkgPSBuZXcgUHJvcGVydHkoIG9wdGlvbnMuaW5pdGlhbE1vdXNlU29ydEN1ZVZpc2libGUgKTtcblxuICAgIHRoaXMuc2hvd01vdXNlQ3VlUHJvcGVydHkgPSBuZXcgQm9vbGVhblByb3BlcnR5KCB0cnVlLCB7XG4gICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Nob3dNb3VzZUN1ZVByb3BlcnR5JyApLFxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1RoaXMgY29udHJvbHMgaWYgdGhlIHZpc3VhbCBjdWUgTm9kZSBmb3IgbW91c2UvdG91Y2ggc29ydGluZyBpcyBkaXNwbGF5ZWQuIFNldCB0byBmYWxzZSAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICd0byBoaWRlIHRoZSBjdWUuIEEgdmFsdWUgb2YgdHJ1ZSBkb2VzIG5vdCBtZWFuIHRoZSBjdWUgaXMgdmlzaWJsZSwgYnV0IGluc3RlYWQgdGhhdCBpdCBjYW4gJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnYmUgc2hvd24gd2hlbiBhcHByb3ByaWF0ZSdcbiAgICB9ICk7XG5cbiAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcbiAgICAgIHRoaXMuaGFzTW91c2VTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSxcbiAgICAgIHRoaXMuaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eVxuICAgIF0sICggaGFzTW91c2VTb3J0ZWRHcm91cEl0ZW0sIGhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtICkgPT4ge1xuICAgICAgcmV0dXJuIGhhc01vdXNlU29ydGVkR3JvdXBJdGVtIHx8IGhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtO1xuICAgIH0gKTtcblxuICAgIHRoaXMuZ3JhYlJlbGVhc2VDdWVWaXNpYmxlUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KCBbXG4gICAgICB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHksXG4gICAgICB0aGlzLmhhc0tleWJvYXJkR3JhYmJlZEdyb3VwSXRlbVByb3BlcnR5LFxuICAgICAgdGhpcy5pc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5LFxuICAgICAgdGhpcy5lbmFibGVkUHJvcGVydHlcbiAgICBdLCAoIHNlbGVjdGVkR3JvdXBJdGVtLCBoYXNHcmFiYmVkR3JvdXBJdGVtLCBoYXNLZXlib2FyZEZvY3VzLCBlbmFibGVkICkgPT4ge1xuICAgICAgcmV0dXJuIHNlbGVjdGVkR3JvdXBJdGVtICE9PSBudWxsICYmICFoYXNHcmFiYmVkR3JvdXBJdGVtICYmIGhhc0tleWJvYXJkRm9jdXMgJiYgZW5hYmxlZDtcbiAgICB9ICk7XG5cbiAgICB0aGlzLmtleWJvYXJkU29ydEN1ZVZpc2libGVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcbiAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSxcbiAgICAgIHRoaXMuaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eSxcbiAgICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eSxcbiAgICAgIHRoaXMuaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eVxuICAgIF0sICggc2VsZWN0ZWRHcm91cEl0ZW0sIGlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkLCBpc0tleWJvYXJkRm9jdXNlZCwgaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW0gKSA9PlxuICAgICAgc2VsZWN0ZWRHcm91cEl0ZW0gIT09IG51bGwgJiYgaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWQgJiYgaXNLZXlib2FyZEZvY3VzZWQgJiYgIWhhc0tleWJvYXJkU29ydGVkR3JvdXBJdGVtICk7XG4gIH1cblxuICAvLyBXcmFwIHRoaXMgaW4gYSBmdW5jdGlvbiB0byBtYWtlIHN1cmUgdGhhdCBoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5IGlzIG5ldmVyIHJlYWQgb3IgbGlzdGVuZWQgdG8uIEluc3RlYWQsXG4gIC8vIGxpc3RlbiB0byBoYXNHcm91cEl0ZW1CZWVuU29ydGVkUHJvcGVydHkgKGxpa2UgdG8gc2V0IHRoZSBtb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkpLlxuICBwdWJsaWMgc2V0TW91c2VTb3J0ZWRHcm91cEl0ZW0oIHNvcnRlZEJ5TW91c2U6IGJvb2xlYW4gKTogdm9pZCB7XG4gICAgdGhpcy5oYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5LnZhbHVlID0gc29ydGVkQnlNb3VzZTtcbiAgfVxuXG4gIC8vIEdpdmVuIHRoZSBrbm93bGVkZ2UgdGhhdCBHcm91cFNlbGVjdE1vZGVsIGhhcywgc2hvdWxkIHRoZSBtb3VzZSBzb3J0IGN1ZSBiZSB2aXNpYmxlPyBUaGlzIG1vc3Qgb2Z0ZW5cbiAgLy8gaXNuJ3QgdGhlIGNvbXBsZXRlIGJvb2xlYW4sIHNpbmNlIHRoZXJlIHdpbGwgYmUgc2ltLXNwZWNpZmljIGtub3dsZWRnZSB0aGF0IGNvbnRyaWJ1dGVzIHRvIHRoZSBmaW5hbCB2aXNpYmlsaXR5XG4gIC8vIG9mIHRoZSBOb2RlLlxuICBwdWJsaWMgbW91c2VTb3J0Q3VlU2hvdWxkQmVWaXNpYmxlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5LnZhbHVlICYmXG4gICAgICAgICAgICF0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS52YWx1ZSAmJlxuICAgICAgICAgICAhdGhpcy5pc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5LnZhbHVlICYmXG4gICAgICAgICAgIHRoaXMuZW5hYmxlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgaW50ZXJhY3Rpb24gd2l0aG91dCBjaGFuZ2luZyB0aGUgY3VlaW5nIGxvZ2ljLiBUaGlzIGlzIGJlc3QgY2FsbGVkIGR1cmluZyBhIGRhdGEgXCJlcmFzZVwiIGFuZCBhbHNvIHdoZW5cbiAgICogc3dpdGNoaW5nIGJldHdlZW4gc2NlbmVzLlxuICAgKi9cbiAgcHVibGljIHJlc2V0SW50ZXJhY3Rpb25TdGF0ZSgpOiB2b2lkIHtcblxuICAgIC8vIGlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkUHJvcGVydHkgbmVlZHMgdG8gYmUgcmVzZXQgYmVmb3JlIHRoZSBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5LCBiZWNhdXNlIGFcbiAgICAvLyBzZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5IGxpc3RlbmVyIGlzIHJlbHlpbmcgb24gYW4gYWNjdXJhdGUgaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eS52YWx1ZVxuICAgIC8vIHRvIGZpcmUgYW4gYXNzZXJ0aW9uLlxuICAgIHRoaXMuaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eS5yZXNldCgpO1xuICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xuICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eS5yZXNldCgpO1xuICB9XG5cbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMucmVzZXRJbnRlcmFjdGlvblN0YXRlKCk7XG5cbiAgICAvLyBEb24ndCByZXNldCBzaG93TW91c2VDdWVQcm9wZXJ0eSBiZWNhdXNlIGl0IGlzIHNldCBvbmx5IGJ5IFBoRVQtaU8sIGFuZCBzaG91bGQgcGVyc2lzdFxuICAgIHRoaXMuaGFzTW91c2VTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xuICAgIHRoaXMuaGFzS2V5Ym9hcmRHcmFiYmVkR3JvdXBJdGVtUHJvcGVydHkucmVzZXQoKTtcbiAgICB0aGlzLmhhc0tleWJvYXJkU2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xuICAgIHRoaXMuaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5yZXNldCgpO1xuICAgIHRoaXMubW91c2VTb3J0Q3VlVmlzaWJsZVByb3BlcnR5LnJlc2V0KCk7XG5cbiAgICAvLyBJZiBhIFBoRVQtaU8gY2xpZW50IGhhcyBzZXQgc2hvd01vdXNlQ3VlUHJvcGVydHkgdG8gZmFsc2UsIHRoZW4gdGhlIG1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eVxuICAgIC8vIG5lZWRzIHRvIHJlc3BlY3QgdGhhdC5cbiAgICB0aGlzLm1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eS52YWx1ZSA9IHRoaXMubW91c2VTb3J0Q3VlU2hvdWxkQmVWaXNpYmxlKCk7XG4gIH1cblxuICAvLyBDbGVhciB0aGUgc2VsZWN0aW9uIHN0YXRlIGZvciB0aGUgaW50ZXJhY3Rpb24gKHNldHRpbmcgdG8gbnVsbClcbiAgcHVibGljIGNsZWFyU2VsZWN0aW9uKCk6IHZvaWQge1xuICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS52YWx1ZSA9IG51bGw7XG4gIH1cblxuICAvLyBSZWdpc3RlciB5b3VyIGNsb3N1cmUgcmVzcG9uc2libGUgZm9yIHVwZGF0aW5nIHRoZSBzb3J0LWluZGljYXRvciBub2RlLiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgd2l0aCBhIGNhbGxiYWNrIHRoYXRcbiAgLy8gdXBkYXRlcyBtb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkgYW5kIG1heWJlIGRvZXMgb3RoZXIgdGhpbmdzLiBZb3Ugd2lsbCBsaWtlbHkgbmVlZCB0byBjYWxsIHRoaXMgdXBkYXRlIGZ1bmN0aW9uXG4gIC8vIGZvciBzaW0gc3BlY2lmaWMgdXNhZ2VzIGFzIHdlbGwuXG4gIHB1YmxpYyByZWdpc3RlclVwZGF0ZVNvcnRDdWVOb2RlKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZTogKCkgPT4gdm9pZCApOiB2b2lkIHtcbiAgICB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5LmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgdGhpcy5lbmFibGVkUHJvcGVydHkubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcbiAgICB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcbiAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xuICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eS5saW5rKCB1cGRhdGVTb3J0SW5kaWNhdG9yTm9kZSApO1xuICAgIHBoZXRpb1N0YXRlU2V0RW1pdHRlci5hZGRMaXN0ZW5lciggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcblxuICAgIHRoaXMuZGlzcG9zZUVtaXR0ZXIuYWRkTGlzdGVuZXIoICgpID0+IHtcbiAgICAgIHBoZXRpb1N0YXRlU2V0RW1pdHRlci5yZW1vdmVMaXN0ZW5lciggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcbiAgICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgICB0aGlzLmhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgICB0aGlzLm1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgICB0aGlzLmVuYWJsZWRQcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgICB0aGlzLnNob3dNb3VzZUN1ZVByb3BlcnR5LnVubGluayggdXBkYXRlU29ydEluZGljYXRvck5vZGUgKTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS51bmxpbmsoIHVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlICk7XG4gICAgfSApO1xuICB9XG5cbiAgLy8gSW50ZXJydXB0IHRoZSBncm91cCBzb3J0IGludGVyYWN0aW9uXG4gIHB1YmxpYyBpbnRlcnJ1cHQoKTogdm9pZCB7XG4gICAgdGhpcy5pc0tleWJvYXJkRm9jdXNlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XG4gICAgdGhpcy5pc0dyb3VwSXRlbUtleWJvYXJkR3JhYmJlZFByb3BlcnR5LnZhbHVlID0gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdGVkR3JvdXBJdGVtUHJvcGVydHkuZGlzcG9zZSgpO1xuICAgIHRoaXMuaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5ncmFiUmVsZWFzZUN1ZVZpc2libGVQcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5rZXlib2FyZFNvcnRDdWVWaXNpYmxlUHJvcGVydHkuZGlzcG9zZSgpO1xuICAgIHRoaXMuaXNLZXlib2FyZEZvY3VzZWRQcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5zaG93TW91c2VDdWVQcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5oYXNLZXlib2FyZEdyYWJiZWRHcm91cEl0ZW1Qcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5oYXNLZXlib2FyZFNvcnRlZEdyb3VwSXRlbVByb3BlcnR5LmRpc3Bvc2UoKTtcbiAgICB0aGlzLmhhc0tleWJvYXJkU2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eS5kaXNwb3NlKCk7XG4gICAgdGhpcy5tb3VzZVNvcnRDdWVWaXNpYmxlUHJvcGVydHkuZGlzcG9zZSgpO1xuICAgIHRoaXMuaGFzR3JvdXBJdGVtQmVlblNvcnRlZFByb3BlcnR5LmRpc3Bvc2UoKTtcbiAgICBzdXBlci5kaXNwb3NlKCk7XG4gIH1cbn1cblxuc2NlbmVyeVBoZXQucmVnaXN0ZXIoICdHcm91cFNlbGVjdE1vZGVsJywgR3JvdXBTZWxlY3RNb2RlbCApOyJdLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbmFibGVkQ29tcG9uZW50IiwiUHJvcGVydHkiLCJvcHRpb25pemUiLCJQaGV0aW9PYmplY3QiLCJwaGV0aW9TdGF0ZVNldEVtaXR0ZXIiLCJUYW5kZW0iLCJJT1R5cGUiLCJOdWxsYWJsZUlPIiwiUmVmZXJlbmNlSU8iLCJzY2VuZXJ5UGhldCIsIkdyb3VwU2VsZWN0TW9kZWwiLCJzZXRNb3VzZVNvcnRlZEdyb3VwSXRlbSIsInNvcnRlZEJ5TW91c2UiLCJoYXNNb3VzZVNvcnRlZEdyb3VwSXRlbVByb3BlcnR5IiwidmFsdWUiLCJtb3VzZVNvcnRDdWVTaG91bGRCZVZpc2libGUiLCJzaG93TW91c2VDdWVQcm9wZXJ0eSIsImhhc0dyb3VwSXRlbUJlZW5Tb3J0ZWRQcm9wZXJ0eSIsImlzS2V5Ym9hcmRGb2N1c2VkUHJvcGVydHkiLCJlbmFibGVkIiwicmVzZXRJbnRlcmFjdGlvblN0YXRlIiwiaXNHcm91cEl0ZW1LZXlib2FyZEdyYWJiZWRQcm9wZXJ0eSIsInJlc2V0Iiwic2VsZWN0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSIsImhhc0tleWJvYXJkR3JhYmJlZEdyb3VwSXRlbVByb3BlcnR5IiwiaGFzS2V5Ym9hcmRTZWxlY3RlZEdyb3VwSXRlbVByb3BlcnR5IiwiaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW1Qcm9wZXJ0eSIsIm1vdXNlU29ydEN1ZVZpc2libGVQcm9wZXJ0eSIsImNsZWFyU2VsZWN0aW9uIiwicmVnaXN0ZXJVcGRhdGVTb3J0Q3VlTm9kZSIsInVwZGF0ZVNvcnRJbmRpY2F0b3JOb2RlIiwibGluayIsImVuYWJsZWRQcm9wZXJ0eSIsImFkZExpc3RlbmVyIiwiZGlzcG9zZUVtaXR0ZXIiLCJyZW1vdmVMaXN0ZW5lciIsInVubGluayIsImludGVycnVwdCIsImRpc3Bvc2UiLCJncmFiUmVsZWFzZUN1ZVZpc2libGVQcm9wZXJ0eSIsImtleWJvYXJkU29ydEN1ZVZpc2libGVQcm9wZXJ0eSIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsImluaXRpYWxNb3VzZVNvcnRDdWVWaXNpYmxlIiwiZ2V0R3JvdXBJdGVtVmFsdWUiLCJpc1ZhbGlkVmFsdWUiLCJ4IiwiY3JlYXRlVGFuZGVtIiwicGhldGlvVmFsdWVUeXBlIiwiT2JqZWN0SU8iLCJwaGV0aW9SZWFkT25seSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJhc3NlcnQiLCJsYXp5TGluayIsInNlbGVjdGVkR3JvdXBJdGVtIiwib2xkU2VsZWN0ZWRHcm91cEl0ZW0iLCJWQUxJREFUSU9OIiwic3VwcGxpZWQiLCJpc1BoZXRpb0luc3RydW1lbnRlZCIsImhhc01vdXNlU29ydGVkR3JvdXBJdGVtIiwiaGFzS2V5Ym9hcmRTb3J0ZWRHcm91cEl0ZW0iLCJoYXNHcmFiYmVkR3JvdXBJdGVtIiwiaGFzS2V5Ym9hcmRGb2N1cyIsImlzR3JvdXBJdGVtS2V5Ym9hcmRHcmFiYmVkIiwiaXNLZXlib2FyZEZvY3VzZWQiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsaURBQWlEO0FBRWpEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQWtEQyxHQUVELE9BQU9BLHFCQUFxQiw0Q0FBNEM7QUFDeEUsT0FBT0MscUJBQXFCLDRDQUE0QztBQUN4RSxPQUFPQyxzQkFBbUQsNkNBQTZDO0FBQ3ZHLE9BQU9DLGNBQWMscUNBQXFDO0FBRzFELE9BQU9DLGVBQWUsMkNBQTJDO0FBQ2pFLE9BQU9DLGtCQUEyQywyQ0FBMkM7QUFDN0YsT0FBT0MsMkJBQTJCLG9EQUFvRDtBQUN0RixPQUFPQyxZQUFZLHFDQUFxQztBQUN4RCxPQUFPQyxZQUFZLDJDQUEyQztBQUM5RCxPQUFPQyxnQkFBZ0IsK0NBQStDO0FBQ3RFLE9BQU9DLGlCQUFpQixnREFBZ0Q7QUFDeEUsT0FBT0MsaUJBQWlCLDBCQUEwQjtBQWdCbkMsSUFBQSxBQUFNQyxtQkFBTixNQUFNQSx5QkFBb0NWO0lBcUh2RCxtSEFBbUg7SUFDbkgsMEZBQTBGO0lBQ25GVyx3QkFBeUJDLGFBQXNCLEVBQVM7UUFDN0QsSUFBSSxDQUFDQywrQkFBK0IsQ0FBQ0MsS0FBSyxHQUFHRjtJQUMvQztJQUVBLHVHQUF1RztJQUN2RyxrSEFBa0g7SUFDbEgsZUFBZTtJQUNSRyw4QkFBdUM7UUFDNUMsT0FBTyxJQUFJLENBQUNDLG9CQUFvQixDQUFDRixLQUFLLElBQy9CLENBQUMsSUFBSSxDQUFDRyw4QkFBOEIsQ0FBQ0gsS0FBSyxJQUMxQyxDQUFDLElBQUksQ0FBQ0kseUJBQXlCLENBQUNKLEtBQUssSUFDckMsSUFB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