// Copyright 2018-2024, University of Colorado Boulder
/**
 * TimeControlNode provides a UI for controlling time.  It includes a play/pause button, step-forward button,
 * optional step-backward button, and optional radio buttons for time speed. Various layouts are supported via options.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */ import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { Node, SceneryConstants } from '../../scenery/js/imports.js';
import Panel from '../../sun/js/Panel.js';
import Tandem from '../../tandem/js/Tandem.js';
import PlayPauseStepButtonGroup from './buttons/PlayPauseStepButtonGroup.js';
import sceneryPhet from './sceneryPhet.js';
import SceneryPhetStrings from './SceneryPhetStrings.js';
import TimeSpeed from './TimeSpeed.js';
import TimeSpeedRadioButtonGroup from './TimeSpeedRadioButtonGroup.js';
// default speeds for SpeedRadioButtonGroup
const DEFAULT_TIME_SPEEDS = [
    TimeSpeed.NORMAL,
    TimeSpeed.SLOW
];
let TimeControlNode = class TimeControlNode extends Node {
    /**
   * Translate this node so that the center of the PlayPauseButton is at the specified point in the parent
   * coordinate frame for the TimeControlNode.
   */ setPlayPauseButtonCenter(center) {
        const distanceToCenter = this.localToParentPoint(this.getPlayPauseButtonCenter()).minus(this.center);
        this.center = center.minus(distanceToCenter);
    }
    /**
   * Get the center of the PlayPauseButton, in the local coordinate frame of the TimeControlNode. Useful if the
   * TimeControlNode needs to be positioned relative to the PlayPauseButtons.
   */ getPlayPauseButtonCenter() {
        return this.playPauseStepButtons.getPlayPauseButtonCenter();
    }
    /**
   * Set the spacing between the SpeedRadioButtonGroup and the PlayPauseStepButtons. Spacing is from horizontal
   * edge to edge for each Node. This will move the SpeedRadioButtonGroup relative to the edge of the
   * PlayPauseStepButtons. No-op if there is no SpeedRadioButtonGroup for this TimeControlNode.
   */ setButtonGroupXSpacing(spacing) {
        this.buttonGroupXSpacing = spacing;
        if (this.speedRadioButtonGroupParent) {
            if (this.speedRadioButtonGroupOnLeft) {
                this.speedRadioButtonGroupParent.right = this.playPauseStepButtons.left - this.buttonGroupXSpacing;
            } else {
                this.speedRadioButtonGroupParent.left = this.playPauseStepButtons.right + this.buttonGroupXSpacing;
            }
        }
    }
    getButtonGroupXSpacing() {
        return this.buttonGroupXSpacing;
    }
    dispose() {
        this.disposeTimeControlNode();
        super.dispose();
    }
    constructor(isPlayingProperty, providedOptions){
        var _window_phet_chipper_queryParameters, _window_phet_chipper, _window_phet;
        const options = optionize()({
            // TimeControlNodeOptions
            timeSpeedProperty: null,
            timeSpeeds: DEFAULT_TIME_SPEEDS,
            speedRadioButtonGroupOnLeft: false,
            buttonGroupXSpacing: 40,
            wrapSpeedRadioButtonGroupInPanel: false,
            speedRadioButtonGroupPanelOptions: {
                xMargin: 8,
                yMargin: 6
            },
            // NodeOptions
            disabledOpacity: SceneryConstants.DISABLED_OPACITY,
            // phet-io
            tandem: Tandem.REQUIRED,
            tandemNameSuffix: 'TimeControlNode',
            visiblePropertyOptions: {
                phetioFeatured: true
            },
            phetioEnabledPropertyInstrumented: true,
            // pdom
            tagName: 'div',
            labelTagName: 'h3',
            labelContent: SceneryPhetStrings.a11y.timeControlNode.labelStringProperty
        }, providedOptions);
        super();
        const children = [];
        this.playPauseStepButtons = new PlayPauseStepButtonGroup(isPlayingProperty, combineOptions({
            tandem: options.tandem.createTandem('playPauseStepButtonGroup')
        }, options.playPauseStepButtonOptions));
        children.push(this.playPauseStepButtons);
        this.speedRadioButtonGroup = null;
        this.speedRadioButtonGroupParent = null;
        if (options.timeSpeedProperty !== null) {
            this.speedRadioButtonGroup = new TimeSpeedRadioButtonGroup(options.timeSpeedProperty, options.timeSpeeds, combineOptions({
                tandem: options.tandem.createTandem('speedRadioButtonGroup')
            }, options.speedRadioButtonGroupOptions));
            if (options.wrapSpeedRadioButtonGroupInPanel) {
                this.speedRadioButtonGroupParent = new Panel(this.speedRadioButtonGroup, options.speedRadioButtonGroupPanelOptions);
            } else {
                this.speedRadioButtonGroupParent = new Node({
                    children: [
                        this.speedRadioButtonGroup
                    ]
                });
            }
            if (options.speedRadioButtonGroupOnLeft) {
                children.unshift(this.speedRadioButtonGroupParent);
            } else {
                children.push(this.speedRadioButtonGroupParent);
            }
            this.speedRadioButtonGroupParent.centerY = this.playPauseStepButtons.centerY;
        }
        options.children = children;
        this.speedRadioButtonGroupOnLeft = options.speedRadioButtonGroupOnLeft;
        this.buttonGroupXSpacing = options.buttonGroupXSpacing;
        this.setButtonGroupXSpacing(this.buttonGroupXSpacing);
        this.disposeTimeControlNode = ()=>{
            this.playPauseStepButtons.dispose();
            this.speedRadioButtonGroup && this.speedRadioButtonGroup.dispose();
        };
        // mutate with options after spacing and layout is complete so other layout options apply correctly to the
        // whole TimeControlNode
        this.mutate(options);
        // support for binder documentation, stripped out in builds and only runs when ?binder is specified
        assert && ((_window_phet = window.phet) == null ? void 0 : (_window_phet_chipper = _window_phet.chipper) == null ? void 0 : (_window_phet_chipper_queryParameters = _window_phet_chipper.queryParameters) == null ? void 0 : _window_phet_chipper_queryParameters.binder) && InstanceRegistry.registerDataURL('scenery-phet', 'TimeControlNode', this);
    }
};
export { TimeControlNode as default };
sceneryPhet.register('TimeControlNode', TimeControlNode);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9UaW1lQ29udHJvbE5vZGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbi8qKlxuICogVGltZUNvbnRyb2xOb2RlIHByb3ZpZGVzIGEgVUkgZm9yIGNvbnRyb2xsaW5nIHRpbWUuICBJdCBpbmNsdWRlcyBhIHBsYXkvcGF1c2UgYnV0dG9uLCBzdGVwLWZvcndhcmQgYnV0dG9uLFxuICogb3B0aW9uYWwgc3RlcC1iYWNrd2FyZCBidXR0b24sIGFuZCBvcHRpb25hbCByYWRpbyBidXR0b25zIGZvciB0aW1lIHNwZWVkLiBWYXJpb3VzIGxheW91dHMgYXJlIHN1cHBvcnRlZCB2aWEgb3B0aW9ucy5cbiAqXG4gKiBAYXV0aG9yIERlbnplbGwgQmFybmV0dCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gPGpvbmF0aGFuLm9sc29uQGNvbG9yYWRvLmVkdT5cbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqL1xuXG5pbXBvcnQgRW51bWVyYXRpb25Qcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL0VudW1lcmF0aW9uUHJvcGVydHkuanMnO1xuaW1wb3J0IFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvUHJvcGVydHkuanMnO1xuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi4vLi4vZG90L2pzL1ZlY3RvcjIuanMnO1xuaW1wb3J0IEluc3RhbmNlUmVnaXN0cnkgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL2RvY3VtZW50YXRpb24vSW5zdGFuY2VSZWdpc3RyeS5qcyc7XG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XG5pbXBvcnQgeyBOb2RlLCBOb2RlT3B0aW9ucywgU2NlbmVyeUNvbnN0YW50cyB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgUGFuZWwsIHsgUGFuZWxPcHRpb25zIH0gZnJvbSAnLi4vLi4vc3VuL2pzL1BhbmVsLmpzJztcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XG5pbXBvcnQgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwLCB7IFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cE9wdGlvbnMgfSBmcm9tICcuL2J1dHRvbnMvUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwLmpzJztcbmltcG9ydCBzY2VuZXJ5UGhldCBmcm9tICcuL3NjZW5lcnlQaGV0LmpzJztcbmltcG9ydCBTY2VuZXJ5UGhldFN0cmluZ3MgZnJvbSAnLi9TY2VuZXJ5UGhldFN0cmluZ3MuanMnO1xuaW1wb3J0IFRpbWVTcGVlZCBmcm9tICcuL1RpbWVTcGVlZC5qcyc7XG5pbXBvcnQgVGltZVNwZWVkUmFkaW9CdXR0b25Hcm91cCwgeyBUaW1lU3BlZWRSYWRpb0J1dHRvbkdyb3VwT3B0aW9ucyB9IGZyb20gJy4vVGltZVNwZWVkUmFkaW9CdXR0b25Hcm91cC5qcyc7XG5cbi8vIGRlZmF1bHQgc3BlZWRzIGZvciBTcGVlZFJhZGlvQnV0dG9uR3JvdXBcbmNvbnN0IERFRkFVTFRfVElNRV9TUEVFRFMgPSBbIFRpbWVTcGVlZC5OT1JNQUwsIFRpbWVTcGVlZC5TTE9XIF07XG5cbnR5cGUgU2VsZk9wdGlvbnMgPSB7XG5cbiAgLy8gUGxheSBzcGVlZCBQcm9wZXJ0eSBmb3IgdGhlIHJhZGlvIGJ1dHRvbiBncm91cC4gSWYgbnVsbCwgbm8gcmFkaW8gYnV0dG9ucyBpbmNsdWRlZCBpbiB0aGlzIGNvbnRyb2wuXG4gIHRpbWVTcGVlZFByb3BlcnR5PzogRW51bWVyYXRpb25Qcm9wZXJ0eTxUaW1lU3BlZWQ+IHwgbnVsbDtcblxuICAvLyBTcGVlZHMgc3VwcG9ydGVkIGJ5IHRoaXMgVGltZUNvbnRyb2xOb2RlLiBWZXJ0aWNhbCByYWRpbyBidXR0b25zIGFyZSBjcmVhdGVkIGZvciBlYWNoIGluIHRoZSBvcmRlciBwcm92aWRlZC5cbiAgdGltZVNwZWVkcz86IFRpbWVTcGVlZFtdO1xuXG4gIC8vIHRydWUgPSBzcGVlZCByYWRpbyBidXR0b25zIHRvIGxlZnQgb2YgcHVzaCBidXR0b25zXG4gIC8vIGZhbHNlID0gc3BlZWQgcmFkaW8gYnV0dG9ucyB0byByaWdodCBvZiBwdXNoIGJ1dHRvbnNcbiAgc3BlZWRSYWRpb0J1dHRvbkdyb3VwT25MZWZ0PzogYm9vbGVhbjtcblxuICAvLyBob3Jpem9udGFsIHNwYWNlIGJldHdlZW4gUGxheVBhdXNlU3RlcEJ1dHRvbnMgYW5kIFNwZWVkUmFkaW9CdXR0b25Hcm91cCwgaWYgU3BlZWRSYWRpb0J1dHRvbkdyb3VwIGlzIGluY2x1ZGVkXG4gIGJ1dHRvbkdyb3VwWFNwYWNpbmc/OiBudW1iZXI7XG5cbiAgLy8gb3B0aW9ucyBwYXNzZWQgYWxvbmcgdG8gdGhlIFBsYXlQYXVzZVN0ZXBCdXR0b25zLCBzZWUgdGhlIGlubmVyIGNsYXNzIGZvciBkZWZhdWx0c1xuICBwbGF5UGF1c2VTdGVwQnV0dG9uT3B0aW9ucz86IFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cE9wdGlvbnM7XG5cbiAgLy8gb3B0aW9ucyBwYXNzZWQgYWxvbmcgdG8gdGhlIFNwZWVkUmFkaW9CdXR0b25Hcm91cCwgaWYgaW5jbHVkZWRcbiAgc3BlZWRSYWRpb0J1dHRvbkdyb3VwT3B0aW9ucz86IFN0cmljdE9taXQ8VGltZVNwZWVkUmFkaW9CdXR0b25Hcm91cE9wdGlvbnMsICd0YW5kZW0nPjtcblxuICAvLyBpZiB0cnVlLCB0aGUgU3BlZWRSYWRpb0J1dHRvbkdyb3VwIHdpbGwgYmUgd3JhcHBlZCBpbiBhIFBhbmVsXG4gIHdyYXBTcGVlZFJhZGlvQnV0dG9uR3JvdXBJblBhbmVsPzogYm9vbGVhbjtcblxuICAvLyBvcHRpb25zIHBhc3NlZCB0byB0aGUgcGFuZWwgd3JhcHBpbmcgU3BlZWRSYWRpb0J1dHRvbkdyb3VwLCBpZiBTcGVlZFJhZGlvQnV0dG9uR3JvdXAgaW5jbHVkZWQgQU5EIHdlIGFyZSB3cmFwcGluZ1xuICAvLyB0aGVtIGluIGEgcGFuZWxcbiAgc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFuZWxPcHRpb25zPzogUGFuZWxPcHRpb25zO1xufTtcblxuZXhwb3J0IHR5cGUgVGltZUNvbnRyb2xOb2RlT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxOb2RlT3B0aW9ucywgJ2NoaWxkcmVuJz47XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRpbWVDb250cm9sTm9kZSBleHRlbmRzIE5vZGUge1xuXG4gIC8vIHB1c2ggYnV0dG9uIGZvciBwbGF5L3BhdXNlIGFuZCAob3B0aW9uYWxseSkgc3RlcCBmb3J3YXJkLCBzdGVwIGJhY2tcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHBsYXlQYXVzZVN0ZXBCdXR0b25zOiBQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXA7XG5cbiAgLy8gcmFkaW8gYnV0dG9ucyBmcm9tIGNvbnRyb2xsaW5nIHNwZWVkXG4gIHByaXZhdGUgcmVhZG9ubHkgc3BlZWRSYWRpb0J1dHRvbkdyb3VwOiBUaW1lU3BlZWRSYWRpb0J1dHRvbkdyb3VwIHwgbnVsbDtcblxuICAvLyBwYXJlbnQgZm9yIHNwZWVkUmFkaW9CdXR0b25Hcm91cCwgb3B0aW9uYWxseSBhIFBhbmVsXG4gIHByb3RlY3RlZCByZWFkb25seSBzcGVlZFJhZGlvQnV0dG9uR3JvdXBQYXJlbnQ6IE5vZGUgfCBQYW5lbCB8IG51bGw7XG5cbiAgLy8gd2hldGhlciB0aGUgcmFkaW8gYnV0dG9ucyBhcmUgdG8gdGhlIGxlZnQgb3IgcmlnaHQgb2YgdGhlIHB1c2ggYnV0dG9uc1xuICBwcml2YXRlIHJlYWRvbmx5IHNwZWVkUmFkaW9CdXR0b25Hcm91cE9uTGVmdDogYm9vbGVhbjtcblxuICAvLyBob3Jpem9udGFsIHNwYWNpbmcgYmV0d2VlbiBwdXNoIGJ1dHRvbnMgYW5kIHJhZGlvIGJ1dHRvbnNcbiAgcHJpdmF0ZSBidXR0b25Hcm91cFhTcGFjaW5nOiBudW1iZXI7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlVGltZUNvbnRyb2xOb2RlOiAoKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaXNQbGF5aW5nUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LCBwcm92aWRlZE9wdGlvbnM/OiBUaW1lQ29udHJvbE5vZGVPcHRpb25zICkge1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxUaW1lQ29udHJvbE5vZGVPcHRpb25zLFxuICAgICAgU3RyaWN0T21pdDxTZWxmT3B0aW9ucywgJ3BsYXlQYXVzZVN0ZXBCdXR0b25PcHRpb25zJyB8ICdzcGVlZFJhZGlvQnV0dG9uR3JvdXBPcHRpb25zJz4sIE5vZGVPcHRpb25zPigpKCB7XG5cbiAgICAgIC8vIFRpbWVDb250cm9sTm9kZU9wdGlvbnNcbiAgICAgIHRpbWVTcGVlZFByb3BlcnR5OiBudWxsLFxuICAgICAgdGltZVNwZWVkczogREVGQVVMVF9USU1FX1NQRUVEUyxcbiAgICAgIHNwZWVkUmFkaW9CdXR0b25Hcm91cE9uTGVmdDogZmFsc2UsXG4gICAgICBidXR0b25Hcm91cFhTcGFjaW5nOiA0MCxcbiAgICAgIHdyYXBTcGVlZFJhZGlvQnV0dG9uR3JvdXBJblBhbmVsOiBmYWxzZSxcbiAgICAgIHNwZWVkUmFkaW9CdXR0b25Hcm91cFBhbmVsT3B0aW9uczoge1xuICAgICAgICB4TWFyZ2luOiA4LFxuICAgICAgICB5TWFyZ2luOiA2XG4gICAgICB9LFxuXG4gICAgICAvLyBOb2RlT3B0aW9uc1xuICAgICAgZGlzYWJsZWRPcGFjaXR5OiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFksXG5cbiAgICAgIC8vIHBoZXQtaW9cbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ1RpbWVDb250cm9sTm9kZScsXG4gICAgICB2aXNpYmxlUHJvcGVydHlPcHRpb25zOiB7IHBoZXRpb0ZlYXR1cmVkOiB0cnVlIH0sXG4gICAgICBwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQ6IHRydWUsIC8vIG9wdCBpbnRvIGRlZmF1bHQgUGhFVC1pTyBpbnN0cnVtZW50ZWQgZW5hYmxlZFByb3BlcnR5XG5cbiAgICAgIC8vIHBkb21cbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxuICAgICAgbGFiZWxUYWdOYW1lOiAnaDMnLFxuICAgICAgbGFiZWxDb250ZW50OiBTY2VuZXJ5UGhldFN0cmluZ3MuYTExeS50aW1lQ29udHJvbE5vZGUubGFiZWxTdHJpbmdQcm9wZXJ0eVxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xuXG4gICAgc3VwZXIoKTtcblxuICAgIGNvbnN0IGNoaWxkcmVuID0gW107XG5cbiAgICB0aGlzLnBsYXlQYXVzZVN0ZXBCdXR0b25zID0gbmV3IFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCggaXNQbGF5aW5nUHJvcGVydHksXG4gICAgICBjb21iaW5lT3B0aW9uczxQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXBPcHRpb25zPigge1xuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3BsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCcgKVxuICAgICAgfSwgb3B0aW9ucy5wbGF5UGF1c2VTdGVwQnV0dG9uT3B0aW9ucyApICk7XG4gICAgY2hpbGRyZW4ucHVzaCggdGhpcy5wbGF5UGF1c2VTdGVwQnV0dG9ucyApO1xuXG4gICAgdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXAgPSBudWxsO1xuICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFyZW50ID0gbnVsbDtcbiAgICBpZiAoIG9wdGlvbnMudGltZVNwZWVkUHJvcGVydHkgIT09IG51bGwgKSB7XG5cbiAgICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwID0gbmV3IFRpbWVTcGVlZFJhZGlvQnV0dG9uR3JvdXAoXG4gICAgICAgIG9wdGlvbnMudGltZVNwZWVkUHJvcGVydHksXG4gICAgICAgIG9wdGlvbnMudGltZVNwZWVkcyxcbiAgICAgICAgY29tYmluZU9wdGlvbnM8VGltZVNwZWVkUmFkaW9CdXR0b25Hcm91cE9wdGlvbnM+KCB7XG4gICAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzcGVlZFJhZGlvQnV0dG9uR3JvdXAnIClcbiAgICAgICAgfSwgb3B0aW9ucy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBPcHRpb25zIClcbiAgICAgICk7XG5cbiAgICAgIGlmICggb3B0aW9ucy53cmFwU3BlZWRSYWRpb0J1dHRvbkdyb3VwSW5QYW5lbCApIHtcbiAgICAgICAgdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBQYXJlbnQgPSBuZXcgUGFuZWwoIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwLCBvcHRpb25zLnNwZWVkUmFkaW9CdXR0b25Hcm91cFBhbmVsT3B0aW9ucyApO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFyZW50ID0gbmV3IE5vZGUoIHsgY2hpbGRyZW46IFsgdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXAgXSB9ICk7XG4gICAgICB9XG5cbiAgICAgIGlmICggb3B0aW9ucy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBPbkxlZnQgKSB7XG4gICAgICAgIGNoaWxkcmVuLnVuc2hpZnQoIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFyZW50ICk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY2hpbGRyZW4ucHVzaCggdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBQYXJlbnQgKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBQYXJlbnQuY2VudGVyWSA9IHRoaXMucGxheVBhdXNlU3RlcEJ1dHRvbnMuY2VudGVyWTtcbiAgICB9XG5cbiAgICBvcHRpb25zLmNoaWxkcmVuID0gY2hpbGRyZW47XG5cbiAgICB0aGlzLnNwZWVkUmFkaW9CdXR0b25Hcm91cE9uTGVmdCA9IG9wdGlvbnMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwT25MZWZ0O1xuICAgIHRoaXMuYnV0dG9uR3JvdXBYU3BhY2luZyA9IG9wdGlvbnMuYnV0dG9uR3JvdXBYU3BhY2luZztcblxuICAgIHRoaXMuc2V0QnV0dG9uR3JvdXBYU3BhY2luZyggdGhpcy5idXR0b25Hcm91cFhTcGFjaW5nICk7XG5cbiAgICB0aGlzLmRpc3Bvc2VUaW1lQ29udHJvbE5vZGUgPSAoKSA9PiB7XG4gICAgICB0aGlzLnBsYXlQYXVzZVN0ZXBCdXR0b25zLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwICYmIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwLmRpc3Bvc2UoKTtcbiAgICB9O1xuXG4gICAgLy8gbXV0YXRlIHdpdGggb3B0aW9ucyBhZnRlciBzcGFjaW5nIGFuZCBsYXlvdXQgaXMgY29tcGxldGUgc28gb3RoZXIgbGF5b3V0IG9wdGlvbnMgYXBwbHkgY29ycmVjdGx5IHRvIHRoZVxuICAgIC8vIHdob2xlIFRpbWVDb250cm9sTm9kZVxuICAgIHRoaXMubXV0YXRlKCBvcHRpb25zICk7XG5cbiAgICAvLyBzdXBwb3J0IGZvciBiaW5kZXIgZG9jdW1lbnRhdGlvbiwgc3RyaXBwZWQgb3V0IGluIGJ1aWxkcyBhbmQgb25seSBydW5zIHdoZW4gP2JpbmRlciBpcyBzcGVjaWZpZWRcbiAgICBhc3NlcnQgJiYgd2luZG93LnBoZXQ/LmNoaXBwZXI/LnF1ZXJ5UGFyYW1ldGVycz8uYmluZGVyICYmIEluc3RhbmNlUmVnaXN0cnkucmVnaXN0ZXJEYXRhVVJMKCAnc2NlbmVyeS1waGV0JywgJ1RpbWVDb250cm9sTm9kZScsIHRoaXMgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmFuc2xhdGUgdGhpcyBub2RlIHNvIHRoYXQgdGhlIGNlbnRlciBvZiB0aGUgUGxheVBhdXNlQnV0dG9uIGlzIGF0IHRoZSBzcGVjaWZpZWQgcG9pbnQgaW4gdGhlIHBhcmVudFxuICAgKiBjb29yZGluYXRlIGZyYW1lIGZvciB0aGUgVGltZUNvbnRyb2xOb2RlLlxuICAgKi9cbiAgcHVibGljIHNldFBsYXlQYXVzZUJ1dHRvbkNlbnRlciggY2VudGVyOiBWZWN0b3IyICk6IHZvaWQge1xuICAgIGNvbnN0IGRpc3RhbmNlVG9DZW50ZXIgPSB0aGlzLmxvY2FsVG9QYXJlbnRQb2ludCggdGhpcy5nZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIoKSApLm1pbnVzKCB0aGlzLmNlbnRlciApO1xuICAgIHRoaXMuY2VudGVyID0gY2VudGVyLm1pbnVzKCBkaXN0YW5jZVRvQ2VudGVyICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjZW50ZXIgb2YgdGhlIFBsYXlQYXVzZUJ1dHRvbiwgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWUgb2YgdGhlIFRpbWVDb250cm9sTm9kZS4gVXNlZnVsIGlmIHRoZVxuICAgKiBUaW1lQ29udHJvbE5vZGUgbmVlZHMgdG8gYmUgcG9zaXRpb25lZCByZWxhdGl2ZSB0byB0aGUgUGxheVBhdXNlQnV0dG9ucy5cbiAgICovXG4gIHB1YmxpYyBnZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIoKTogVmVjdG9yMiB7XG4gICAgcmV0dXJuIHRoaXMucGxheVBhdXNlU3RlcEJ1dHRvbnMuZ2V0UGxheVBhdXNlQnV0dG9uQ2VudGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzcGFjaW5nIGJldHdlZW4gdGhlIFNwZWVkUmFkaW9CdXR0b25Hcm91cCBhbmQgdGhlIFBsYXlQYXVzZVN0ZXBCdXR0b25zLiBTcGFjaW5nIGlzIGZyb20gaG9yaXpvbnRhbFxuICAgKiBlZGdlIHRvIGVkZ2UgZm9yIGVhY2ggTm9kZS4gVGhpcyB3aWxsIG1vdmUgdGhlIFNwZWVkUmFkaW9CdXR0b25Hcm91cCByZWxhdGl2ZSB0byB0aGUgZWRnZSBvZiB0aGVcbiAgICogUGxheVBhdXNlU3RlcEJ1dHRvbnMuIE5vLW9wIGlmIHRoZXJlIGlzIG5vIFNwZWVkUmFkaW9CdXR0b25Hcm91cCBmb3IgdGhpcyBUaW1lQ29udHJvbE5vZGUuXG4gICAqL1xuICBwdWJsaWMgc2V0QnV0dG9uR3JvdXBYU3BhY2luZyggc3BhY2luZzogbnVtYmVyICk6IHZvaWQge1xuICAgIHRoaXMuYnV0dG9uR3JvdXBYU3BhY2luZyA9IHNwYWNpbmc7XG4gICAgaWYgKCB0aGlzLnNwZWVkUmFkaW9CdXR0b25Hcm91cFBhcmVudCApIHtcbiAgICAgIGlmICggdGhpcy5zcGVlZFJhZGlvQnV0dG9uR3JvdXBPbkxlZnQgKSB7XG4gICAgICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFyZW50LnJpZ2h0ID0gdGhpcy5wbGF5UGF1c2VTdGVwQnV0dG9ucy5sZWZ0IC0gdGhpcy5idXR0b25Hcm91cFhTcGFjaW5nO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFyZW50LmxlZnQgPSB0aGlzLnBsYXlQYXVzZVN0ZXBCdXR0b25zLnJpZ2h0ICsgdGhpcy5idXR0b25Hcm91cFhTcGFjaW5nO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRCdXR0b25Hcm91cFhTcGFjaW5nKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuYnV0dG9uR3JvdXBYU3BhY2luZztcbiAgfVxuXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuZGlzcG9zZVRpbWVDb250cm9sTm9kZSgpO1xuICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgfVxufVxuXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ1RpbWVDb250cm9sTm9kZScsIFRpbWVDb250cm9sTm9kZSApOyJdLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJOb2RlIiwiU2NlbmVyeUNvbnN0YW50cyIsIlBhbmVsIiwiVGFuZGVtIiwiUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIiwic2NlbmVyeVBoZXQiLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJUaW1lU3BlZWQiLCJUaW1lU3BlZWRSYWRpb0J1dHRvbkdyb3VwIiwiREVGQVVMVF9USU1FX1NQRUVEUyIsIk5PUk1BTCIsIlNMT1ciLCJUaW1lQ29udHJvbE5vZGUiLCJzZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIiLCJjZW50ZXIiLCJkaXN0YW5jZVRvQ2VudGVyIiwibG9jYWxUb1BhcmVudFBvaW50IiwiZ2V0UGxheVBhdXNlQnV0dG9uQ2VudGVyIiwibWludXMiLCJwbGF5UGF1c2VTdGVwQnV0dG9ucyIsInNldEJ1dHRvbkdyb3VwWFNwYWNpbmciLCJzcGFjaW5nIiwiYnV0dG9uR3JvdXBYU3BhY2luZyIsInNwZWVkUmFkaW9CdXR0b25Hcm91cFBhcmVudCIsInNwZWVkUmFkaW9CdXR0b25Hcm91cE9uTGVmdCIsInJpZ2h0IiwibGVmdCIsImdldEJ1dHRvbkdyb3VwWFNwYWNpbmciLCJkaXNwb3NlIiwiZGlzcG9zZVRpbWVDb250cm9sTm9kZSIsImlzUGxheWluZ1Byb3BlcnR5IiwicHJvdmlkZWRPcHRpb25zIiwid2luZG93Iiwib3B0aW9ucyIsInRpbWVTcGVlZFByb3BlcnR5IiwidGltZVNwZWVkcyIsIndyYXBTcGVlZFJhZGlvQnV0dG9uR3JvdXBJblBhbmVsIiwic3BlZWRSYWRpb0J1dHRvbkdyb3VwUGFuZWxPcHRpb25zIiwieE1hcmdpbiIsInlNYXJnaW4iLCJkaXNhYmxlZE9wYWNpdHkiLCJESVNBQkxFRF9PUEFDSVRZIiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwidmlzaWJsZVByb3BlcnR5T3B0aW9ucyIsInBoZXRpb0ZlYXR1cmVkIiwicGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkIiwidGFnTmFtZSIsImxhYmVsVGFnTmFtZSIsImxhYmVsQ29udGVudCIsImExMXkiLCJ0aW1lQ29udHJvbE5vZGUiLCJsYWJlbFN0cmluZ1Byb3BlcnR5IiwiY2hpbGRyZW4iLCJjcmVhdGVUYW5kZW0iLCJwbGF5UGF1c2VTdGVwQnV0dG9uT3B0aW9ucyIsInB1c2giLCJzcGVlZFJhZGlvQnV0dG9uR3JvdXAiLCJzcGVlZFJhZGlvQnV0dG9uR3JvdXBPcHRpb25zIiwidW5zaGlmdCIsImNlbnRlclkiLCJtdXRhdGUiLCJhc3NlcnQiLCJwaGV0IiwiY2hpcHBlciIsInF1ZXJ5UGFyYW1ldGVycyIsImJpbmRlciIsInJlZ2lzdGVyRGF0YVVSTCIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFFdEQ7Ozs7Ozs7O0NBUUMsR0FLRCxPQUFPQSxzQkFBc0IsdURBQXVEO0FBQ3BGLE9BQU9DLGFBQWFDLGNBQWMsUUFBUSxrQ0FBa0M7QUFFNUUsU0FBU0MsSUFBSSxFQUFlQyxnQkFBZ0IsUUFBUSw4QkFBOEI7QUFDbEYsT0FBT0MsV0FBNkIsd0JBQXdCO0FBQzVELE9BQU9DLFlBQVksNEJBQTRCO0FBQy9DLE9BQU9DLDhCQUFtRSx3Q0FBd0M7QUFDbEgsT0FBT0MsaUJBQWlCLG1CQUFtQjtBQUMzQyxPQUFPQyx3QkFBd0IsMEJBQTBCO0FBQ3pELE9BQU9DLGVBQWUsaUJBQWlCO0FBQ3ZDLE9BQU9DLCtCQUFxRSxpQ0FBaUM7QUFFN0csMkNBQTJDO0FBQzNDLE1BQU1DLHNCQUFzQjtJQUFFRixVQUFVRyxNQUFNO0lBQUVILFVBQVVJLElBQUk7Q0FBRTtBQWlDakQsSUFBQSxBQUFNQyxrQkFBTixNQUFNQSx3QkFBd0JaO0lBNkczQzs7O0dBR0MsR0FDRCxBQUFPYSx5QkFBMEJDLE1BQWUsRUFBUztRQUN2RCxNQUFNQyxtQkFBbUIsSUFBSSxDQUFDQyxrQkFBa0IsQ0FBRSxJQUFJLENBQUNDLHdCQUF3QixJQUFLQyxLQUFLLENBQUUsSUFBSSxDQUFDSixNQUFNO1FBQ3RHLElBQUksQ0FBQ0EsTUFBTSxHQUFHQSxPQUFPSSxLQUFLLENBQUVIO0lBQzlCO0lBRUE7OztHQUdDLEdBQ0QsQUFBT0UsMkJBQW9DO1FBQ3pDLE9BQU8sSUFBSSxDQUFDRSxvQkFBb0IsQ0FBQ0Ysd0JBQXdCO0lBQzNEO0lBRUE7Ozs7R0FJQyxHQUNELEFBQU9HLHVCQUF3QkMsT0FBZSxFQUFTO1FBQ3JELElBQUksQ0FBQ0MsbUJBQW1CLEdBQUdEO1FBQzNCLElBQUssSUFBSSxDQUFDRSwyQkFBMkIsRUFBRztZQUN0QyxJQUFLLElBQUksQ0FBQ0MsMkJBQTJCLEVBQUc7Z0JBQ3RDLElBQUksQ0FBQ0QsMkJBQTJCLENBQUNFLEtBQUssR0FBRyxJQUFJLENBQUNOLG9CQUFvQixDQUFDTyxJQUFJLEdBQUcsSUFBSSxDQUFDSixtQkFBbUI7WUFDcEcsT0FDSztnQkFDSCxJQUFJLENBQUNDLDJCQUEyQixDQUFDRyxJQUFJLEdBQUcsSUFBSSxDQUFDUCxvQkFBb0IsQ0FBQ00sS0FBSyxHQUFHLElBQUksQ0FBQ0gsbUJBQW1CO1lBQ3BHO1FBQ0Y7SUFDRjtJQUVPSyx5QkFBaUM7UUFDdEMsT0FBTyxJQUFJLENBQUNMLG1CQUFtQjtJQUNqQztJQUVnQk0sVUFBZ0I7UUFDOUIsSUFBSSxDQUFDQyxzQkFBc0I7UUFDM0IsS0FBSyxDQUFDRDtJQUNSO0lBbklBLFlBQW9CRSxpQkFBb0MsRUFBRUMsZUFBd0MsQ0FBRztZQXVGekZDLHNDQUFBQSxzQkFBQUE7UUFyRlYsTUFBTUMsVUFBVW5DLFlBQzBGO1lBRXhHLHlCQUF5QjtZQUN6Qm9DLG1CQUFtQjtZQUNuQkMsWUFBWTFCO1lBQ1plLDZCQUE2QjtZQUM3QkYscUJBQXFCO1lBQ3JCYyxrQ0FBa0M7WUFDbENDLG1DQUFtQztnQkFDakNDLFNBQVM7Z0JBQ1RDLFNBQVM7WUFDWDtZQUVBLGNBQWM7WUFDZEMsaUJBQWlCdkMsaUJBQWlCd0MsZ0JBQWdCO1lBRWxELFVBQVU7WUFDVkMsUUFBUXZDLE9BQU93QyxRQUFRO1lBQ3ZCQyxrQkFBa0I7WUFDbEJDLHdCQUF3QjtnQkFBRUMsZ0JBQWdCO1lBQUs7WUFDL0NDLG1DQUFtQztZQUVuQyxPQUFPO1lBQ1BDLFNBQVM7WUFDVEMsY0FBYztZQUNkQyxjQUFjNUMsbUJBQW1CNkMsSUFBSSxDQUFDQyxlQUFlLENBQUNDLG1CQUFtQjtRQUMzRSxHQUFHdEI7UUFFSCxLQUFLO1FBRUwsTUFBTXVCLFdBQVcsRUFBRTtRQUVuQixJQUFJLENBQUNuQyxvQkFBb0IsR0FBRyxJQUFJZix5QkFBMEIwQixtQkFDeEQvQixlQUFpRDtZQUMvQzJDLFFBQVFULFFBQVFTLE1BQU0sQ0FBQ2EsWUFBWSxDQUFFO1FBQ3ZDLEdBQUd0QixRQUFRdUIsMEJBQTBCO1FBQ3ZDRixTQUFTRyxJQUFJLENBQUUsSUFBSSxDQUFDdEMsb0JBQW9CO1FBRXhDLElBQUksQ0FBQ3VDLHFCQUFxQixHQUFHO1FBQzdCLElBQUksQ0FBQ25DLDJCQUEyQixHQUFHO1FBQ25DLElBQUtVLFFBQVFDLGlCQUFpQixLQUFLLE1BQU87WUFFeEMsSUFBSSxDQUFDd0IscUJBQXFCLEdBQUcsSUFBSWxELDBCQUMvQnlCLFFBQVFDLGlCQUFpQixFQUN6QkQsUUFBUUUsVUFBVSxFQUNsQnBDLGVBQWtEO2dCQUNoRDJDLFFBQVFULFFBQVFTLE1BQU0sQ0FBQ2EsWUFBWSxDQUFFO1lBQ3ZDLEdBQUd0QixRQUFRMEIsNEJBQTRCO1lBR3pDLElBQUsxQixRQUFRRyxnQ0FBZ0MsRUFBRztnQkFDOUMsSUFBSSxDQUFDYiwyQkFBMkIsR0FBRyxJQUFJckIsTUFBTyxJQUFJLENBQUN3RCxxQkFBcUIsRUFBRXpCLFFBQVFJLGlDQUFpQztZQUNySCxPQUNLO2dCQUNILElBQUksQ0FBQ2QsMkJBQTJCLEdBQUcsSUFBSXZCLEtBQU07b0JBQUVzRCxVQUFVO3dCQUFFLElBQUksQ0FBQ0kscUJBQXFCO3FCQUFFO2dCQUFDO1lBQzFGO1lBRUEsSUFBS3pCLFFBQVFULDJCQUEyQixFQUFHO2dCQUN6QzhCLFNBQVNNLE9BQU8sQ0FBRSxJQUFJLENBQUNyQywyQkFBMkI7WUFDcEQsT0FDSztnQkFDSCtCLFNBQVNHLElBQUksQ0FBRSxJQUFJLENBQUNsQywyQkFBMkI7WUFDakQ7WUFFQSxJQUFJLENBQUNBLDJCQUEyQixDQUFDc0MsT0FBTyxHQUFHLElBQUksQ0FBQzFDLG9CQUFvQixDQUFDMEMsT0FBTztRQUM5RTtRQUVBNUIsUUFBUXFCLFFBQVEsR0FBR0E7UUFFbkIsSUFBSSxDQUFDOUIsMkJBQTJCLEdBQUdTLFFBQVFULDJCQUEyQjtRQUN0RSxJQUFJLENBQUNGLG1CQUFtQixHQUFHVyxRQUFRWCxtQkFBbUI7UUFFdEQsSUFBSSxDQUFDRixzQkFBc0IsQ0FBRSxJQUFJLENBQUNFLG1CQUFtQjtRQUVyRCxJQUFJLENBQUNPLHNCQUFzQixHQUFHO1lBQzVCLElBQUksQ0FBQ1Ysb0JBQW9CLENBQUNTLE9BQU87WUFDakMsSUFBSSxDQUFDOEIscUJBQXFCLElBQUksSUFBSSxDQUFDQSxxQkFBcUIsQ0FBQzlCLE9BQU87UUFDbEU7UUFFQSwwR0FBMEc7UUFDMUcsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQ2tDLE1BQU0sQ0FBRTdCO1FBRWIsbUdBQW1HO1FBQ25HOEIsWUFBVS9CLGVBQUFBLE9BQU9nQyxJQUFJLHNCQUFYaEMsdUJBQUFBLGFBQWFpQyxPQUFPLHNCQUFwQmpDLHVDQUFBQSxxQkFBc0JrQyxlQUFlLHFCQUFyQ2xDLHFDQUF1Q21DLE1BQU0sS0FBSXRFLGlCQUFpQnVFLGVBQWUsQ0FBRSxnQkFBZ0IsbUJBQW1CLElBQUk7SUFDdEk7QUE0Q0Y7QUF2SkEsU0FBcUJ4RCw2QkF1SnBCO0FBRURQLFlBQVlnRSxRQUFRLENBQUUsbUJBQW1CekQifQ==