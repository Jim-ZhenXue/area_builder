// Copyright 2019-2022, University of Colorado Boulder
/**
 * Visual representation of a capacitor with a vacuum gap.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 * @author Andrew Adare (PhET Interactive Simulations)
 */ import Multilink from '../../../axon/js/Multilink.js';
import validate from '../../../axon/js/validate.js';
import Bounds2 from '../../../dot/js/Bounds2.js';
import { Shape } from '../../../kite/js/imports.js';
import merge from '../../../phet-core/js/merge.js';
import Orientation from '../../../phet-core/js/Orientation.js';
import { Node } from '../../../scenery/js/imports.js';
import sceneryPhet from '../sceneryPhet.js';
import CapacitorConstants from './CapacitorConstants.js';
import EFieldNode from './EFieldNode.js';
import PlateNode from './PlateNode.js';
// constants
const CLIP_HEIGHT = 100;
const CLIP_WIDTH = 300;
let CapacitorNode = class CapacitorNode extends Node {
    // @public
    dispose() {
        this.disposeCapacitorNode();
        super.dispose();
    }
    /**
   * Returns true if the front side contains the specified point, used for voltmeter probe hit testing.
   * @param {Vector2} globalPoint
   * @returns {boolean}
   * @public
   */ frontSideContainsSensorPoint(globalPoint) {
        const point = this.topPlateNode.globalToParentPoint(globalPoint);
        return this.topPlateNode.containsPoint(point);
    }
    /**
   * Returns true if the back side contains the specified point, used for voltmeter probe hit testing.
   * @param {Vector2} globalPoint
   * @returns {boolean}
   * @public
   */ backSideContainsSensorPoint(globalPoint) {
        const point = this.bottomPlateNode.globalToParentPoint(globalPoint);
        return this.bottomPlateNode.containsPoint(point);
    }
    /**
   * Returns the clipping region for the top shape, in global coordinates, used to show wires or electrons flowing in/out of the capacitor.
   * @returns {Shape}
   * @public
   */ getTopPlateClipShapeToGlobal() {
        // Note x & y are defined for a vertical capacitor, like in Capacitor Lab: Basics
        const topNode = this.topPlateNode.topNode;
        const shape = Shape.rect(topNode.center.x - CLIP_HEIGHT, topNode.center.y - CLIP_WIDTH, CLIP_HEIGHT * 2, CLIP_WIDTH);
        return shape.transformed(topNode.getLocalToGlobalMatrix());
    }
    /**
   * Returns the clipping region for the bottom shape, in global coordinates, used to show wires or electrons flowing in/out of the capacitor.
   * @returns {Shape}
   * @public
   */ getBottomPlateClipShapeToGlobal() {
        // Note x & y are defined for a vertical capacitor, like in Capacitor Lab: Basics
        const frontNode = this.bottomPlateNode.frontNode;
        const shape = Shape.rect(frontNode.bounds.center.x - CLIP_HEIGHT, frontNode.bounds.bottom, CLIP_HEIGHT * 2, CLIP_WIDTH);
        return shape.transformed(frontNode.getLocalToGlobalMatrix());
    }
    /**
   * Update the geometry of the capacitor plates.
   * @private
   */ updateGeometry() {
        // geometry
        this.topPlateNode.setBoxSize(this.capacitor.plateSizeProperty.value);
        this.bottomPlateNode.setBoxSize(this.capacitor.plateSizeProperty.value);
        // layout nodes
        const x = 0;
        const z = 0;
        const topPlateY = -this.capacitor.plateSeparationProperty.value / 2 - this.capacitor.plateSizeProperty.value.height;
        this.topPlateNode.center = this.modelViewTransform.modelToViewDeltaXYZ(x, topPlateY, z);
        const bottomPlateY = this.capacitor.plateSeparationProperty.value / 2;
        this.bottomPlateNode.center = this.modelViewTransform.modelToViewDeltaXYZ(x, bottomPlateY, z);
    }
    /**
   * Get the bound of the capacitor from the plates.  Allows for bounds to be passed into the canvas node before the
   * children are added to the view.
   * @public
   *
   * @returns {Bounds2}
   */ getPlatesBounds() {
        return new Bounds2(this.topPlateNode.left, this.topPlateNode.top, this.bottomPlateNode.right, this.bottomPlateNode.bottom);
    }
    /**
   * @param {ParallelCircuit} circuit
   * @param {YawPitchModelViewTransform3} modelViewTransform
   * @param {Property.<boolean>} plateChargeVisibleProperty
   * @param {Property.<boolean>} electricFieldVisibleProperty
   * @param {Object} [options]
   */ constructor(circuit, modelViewTransform, plateChargeVisibleProperty, electricFieldVisibleProperty, options){
        options = merge({
            orientation: Orientation.VERTICAL,
            includeChargeNode: true
        }, options);
        super();
        validate(options.orientation, {
            validValues: Orientation.enumeration.values
        });
        // @private
        this.capacitor = circuit.capacitor;
        this.modelViewTransform = modelViewTransform;
        // @private {PlateNode}
        this.topPlateNode = new PlateNode(this.capacitor, modelViewTransform, CapacitorConstants.POLARITY.POSITIVE, circuit.maxPlateCharge, options.orientation, options.includeChargeNode);
        this.bottomPlateNode = new PlateNode(this.capacitor, modelViewTransform, CapacitorConstants.POLARITY.NEGATIVE, circuit.maxPlateCharge, options.orientation, options.includeChargeNode);
        const eFieldNode = new EFieldNode(this.capacitor, modelViewTransform, circuit.maxEffectiveEField, this.getPlatesBounds());
        // rendering order
        this.addChild(this.bottomPlateNode);
        this.addChild(eFieldNode);
        this.addChild(this.topPlateNode);
        const updateGeometry = Multilink.multilink([
            this.capacitor.plateSizeProperty,
            this.capacitor.plateSeparationProperty
        ], ()=>this.updateGeometry());
        const updateVisibility = (visible)=>{
            this.topPlateNode.setChargeVisible(visible);
            this.bottomPlateNode.setChargeVisible(visible);
        };
        plateChargeVisibleProperty.link(updateVisibility);
        const updateElectricFieldVisibility = (visible)=>eFieldNode.setVisible(visible);
        electricFieldVisibleProperty.link(updateElectricFieldVisibility);
        this.mutate(options);
        // @private
        this.disposeCapacitorNode = ()=>{
            updateGeometry.dispose();
            plateChargeVisibleProperty.unlink(updateVisibility);
            electricFieldVisibleProperty.unlink(updateElectricFieldVisibility);
        };
    }
};
sceneryPhet.register('CapacitorNode', CapacitorNode);
export default CapacitorNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9jYXBhY2l0b3IvQ2FwYWNpdG9yTm9kZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDIyLCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBWaXN1YWwgcmVwcmVzZW50YXRpb24gb2YgYSBjYXBhY2l0b3Igd2l0aCBhIHZhY3V1bSBnYXAuXG4gKlxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxuICogQGF1dGhvciBBbmRyZXcgQWRhcmUgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKi9cblxuaW1wb3J0IE11bHRpbGluayBmcm9tICcuLi8uLi8uLi9heG9uL2pzL011bHRpbGluay5qcyc7XG5pbXBvcnQgdmFsaWRhdGUgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy92YWxpZGF0ZS5qcyc7XG5pbXBvcnQgQm91bmRzMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvQm91bmRzMi5qcyc7XG5pbXBvcnQgeyBTaGFwZSB9IGZyb20gJy4uLy4uLy4uL2tpdGUvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgbWVyZ2UgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL21lcmdlLmpzJztcbmltcG9ydCBPcmllbnRhdGlvbiBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvT3JpZW50YXRpb24uanMnO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgc2NlbmVyeVBoZXQgZnJvbSAnLi4vc2NlbmVyeVBoZXQuanMnO1xuaW1wb3J0IENhcGFjaXRvckNvbnN0YW50cyBmcm9tICcuL0NhcGFjaXRvckNvbnN0YW50cy5qcyc7XG5pbXBvcnQgRUZpZWxkTm9kZSBmcm9tICcuL0VGaWVsZE5vZGUuanMnO1xuaW1wb3J0IFBsYXRlTm9kZSBmcm9tICcuL1BsYXRlTm9kZS5qcyc7XG5cbi8vIGNvbnN0YW50c1xuY29uc3QgQ0xJUF9IRUlHSFQgPSAxMDA7XG5jb25zdCBDTElQX1dJRFRIID0gMzAwO1xuXG5jbGFzcyBDYXBhY2l0b3JOb2RlIGV4dGVuZHMgTm9kZSB7XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7UGFyYWxsZWxDaXJjdWl0fSBjaXJjdWl0XG4gICAqIEBwYXJhbSB7WWF3UGl0Y2hNb2RlbFZpZXdUcmFuc2Zvcm0zfSBtb2RlbFZpZXdUcmFuc2Zvcm1cbiAgICogQHBhcmFtIHtQcm9wZXJ0eS48Ym9vbGVhbj59IHBsYXRlQ2hhcmdlVmlzaWJsZVByb3BlcnR5XG4gICAqIEBwYXJhbSB7UHJvcGVydHkuPGJvb2xlYW4+fSBlbGVjdHJpY0ZpZWxkVmlzaWJsZVByb3BlcnR5XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICovXG4gIGNvbnN0cnVjdG9yKCBjaXJjdWl0LCBtb2RlbFZpZXdUcmFuc2Zvcm0sIHBsYXRlQ2hhcmdlVmlzaWJsZVByb3BlcnR5LCBlbGVjdHJpY0ZpZWxkVmlzaWJsZVByb3BlcnR5LCBvcHRpb25zICkge1xuXG4gICAgb3B0aW9ucyA9IG1lcmdlKCB7XG4gICAgICBvcmllbnRhdGlvbjogT3JpZW50YXRpb24uVkVSVElDQUwsXG4gICAgICBpbmNsdWRlQ2hhcmdlTm9kZTogdHJ1ZVxuICAgIH0sIG9wdGlvbnMgKTtcbiAgICBzdXBlcigpO1xuXG4gICAgdmFsaWRhdGUoIG9wdGlvbnMub3JpZW50YXRpb24sIHsgdmFsaWRWYWx1ZXM6IE9yaWVudGF0aW9uLmVudW1lcmF0aW9uLnZhbHVlcyB9ICk7XG5cbiAgICAvLyBAcHJpdmF0ZVxuICAgIHRoaXMuY2FwYWNpdG9yID0gY2lyY3VpdC5jYXBhY2l0b3I7XG4gICAgdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0gPSBtb2RlbFZpZXdUcmFuc2Zvcm07XG5cbiAgICAvLyBAcHJpdmF0ZSB7UGxhdGVOb2RlfVxuICAgIHRoaXMudG9wUGxhdGVOb2RlID0gbmV3IFBsYXRlTm9kZSggdGhpcy5jYXBhY2l0b3IsIG1vZGVsVmlld1RyYW5zZm9ybSwgQ2FwYWNpdG9yQ29uc3RhbnRzLlBPTEFSSVRZLlBPU0lUSVZFLCBjaXJjdWl0Lm1heFBsYXRlQ2hhcmdlLCBvcHRpb25zLm9yaWVudGF0aW9uLCBvcHRpb25zLmluY2x1ZGVDaGFyZ2VOb2RlICk7XG4gICAgdGhpcy5ib3R0b21QbGF0ZU5vZGUgPSBuZXcgUGxhdGVOb2RlKCB0aGlzLmNhcGFjaXRvciwgbW9kZWxWaWV3VHJhbnNmb3JtLCBDYXBhY2l0b3JDb25zdGFudHMuUE9MQVJJVFkuTkVHQVRJVkUsIGNpcmN1aXQubWF4UGxhdGVDaGFyZ2UsIG9wdGlvbnMub3JpZW50YXRpb24sIG9wdGlvbnMuaW5jbHVkZUNoYXJnZU5vZGUgKTtcblxuICAgIGNvbnN0IGVGaWVsZE5vZGUgPSBuZXcgRUZpZWxkTm9kZSggdGhpcy5jYXBhY2l0b3IsIG1vZGVsVmlld1RyYW5zZm9ybSwgY2lyY3VpdC5tYXhFZmZlY3RpdmVFRmllbGQsIHRoaXMuZ2V0UGxhdGVzQm91bmRzKCkgKTtcblxuICAgIC8vIHJlbmRlcmluZyBvcmRlclxuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMuYm90dG9tUGxhdGVOb2RlICk7XG4gICAgdGhpcy5hZGRDaGlsZCggZUZpZWxkTm9kZSApO1xuICAgIHRoaXMuYWRkQ2hpbGQoIHRoaXMudG9wUGxhdGVOb2RlICk7XG5cbiAgICBjb25zdCB1cGRhdGVHZW9tZXRyeSA9IE11bHRpbGluay5tdWx0aWxpbmsoIFtcbiAgICAgIHRoaXMuY2FwYWNpdG9yLnBsYXRlU2l6ZVByb3BlcnR5LFxuICAgICAgdGhpcy5jYXBhY2l0b3IucGxhdGVTZXBhcmF0aW9uUHJvcGVydHlcbiAgICBdLCAoKSA9PiB0aGlzLnVwZGF0ZUdlb21ldHJ5KCkgKTtcblxuICAgIGNvbnN0IHVwZGF0ZVZpc2liaWxpdHkgPSB2aXNpYmxlID0+IHtcbiAgICAgIHRoaXMudG9wUGxhdGVOb2RlLnNldENoYXJnZVZpc2libGUoIHZpc2libGUgKTtcbiAgICAgIHRoaXMuYm90dG9tUGxhdGVOb2RlLnNldENoYXJnZVZpc2libGUoIHZpc2libGUgKTtcbiAgICB9O1xuICAgIHBsYXRlQ2hhcmdlVmlzaWJsZVByb3BlcnR5LmxpbmsoIHVwZGF0ZVZpc2liaWxpdHkgKTtcblxuICAgIGNvbnN0IHVwZGF0ZUVsZWN0cmljRmllbGRWaXNpYmlsaXR5ID0gdmlzaWJsZSA9PiBlRmllbGROb2RlLnNldFZpc2libGUoIHZpc2libGUgKTtcbiAgICBlbGVjdHJpY0ZpZWxkVmlzaWJsZVByb3BlcnR5LmxpbmsoIHVwZGF0ZUVsZWN0cmljRmllbGRWaXNpYmlsaXR5ICk7XG5cbiAgICB0aGlzLm11dGF0ZSggb3B0aW9ucyApO1xuXG4gICAgLy8gQHByaXZhdGVcbiAgICB0aGlzLmRpc3Bvc2VDYXBhY2l0b3JOb2RlID0gKCkgPT4ge1xuICAgICAgdXBkYXRlR2VvbWV0cnkuZGlzcG9zZSgpO1xuICAgICAgcGxhdGVDaGFyZ2VWaXNpYmxlUHJvcGVydHkudW5saW5rKCB1cGRhdGVWaXNpYmlsaXR5ICk7XG4gICAgICBlbGVjdHJpY0ZpZWxkVmlzaWJsZVByb3BlcnR5LnVubGluayggdXBkYXRlRWxlY3RyaWNGaWVsZFZpc2liaWxpdHkgKTtcbiAgICB9O1xuICB9XG5cbiAgLy8gQHB1YmxpY1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuZGlzcG9zZUNhcGFjaXRvck5vZGUoKTtcbiAgICBzdXBlci5kaXNwb3NlKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBmcm9udCBzaWRlIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgcG9pbnQsIHVzZWQgZm9yIHZvbHRtZXRlciBwcm9iZSBoaXQgdGVzdGluZy5cbiAgICogQHBhcmFtIHtWZWN0b3IyfSBnbG9iYWxQb2ludFxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICogQHB1YmxpY1xuICAgKi9cbiAgZnJvbnRTaWRlQ29udGFpbnNTZW5zb3JQb2ludCggZ2xvYmFsUG9pbnQgKSB7XG4gICAgY29uc3QgcG9pbnQgPSB0aGlzLnRvcFBsYXRlTm9kZS5nbG9iYWxUb1BhcmVudFBvaW50KCBnbG9iYWxQb2ludCApO1xuICAgIHJldHVybiB0aGlzLnRvcFBsYXRlTm9kZS5jb250YWluc1BvaW50KCBwb2ludCApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgYmFjayBzaWRlIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgcG9pbnQsIHVzZWQgZm9yIHZvbHRtZXRlciBwcm9iZSBoaXQgdGVzdGluZy5cbiAgICogQHBhcmFtIHtWZWN0b3IyfSBnbG9iYWxQb2ludFxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICogQHB1YmxpY1xuICAgKi9cbiAgYmFja1NpZGVDb250YWluc1NlbnNvclBvaW50KCBnbG9iYWxQb2ludCApIHtcbiAgICBjb25zdCBwb2ludCA9IHRoaXMuYm90dG9tUGxhdGVOb2RlLmdsb2JhbFRvUGFyZW50UG9pbnQoIGdsb2JhbFBvaW50ICk7XG4gICAgcmV0dXJuIHRoaXMuYm90dG9tUGxhdGVOb2RlLmNvbnRhaW5zUG9pbnQoIHBvaW50ICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY2xpcHBpbmcgcmVnaW9uIGZvciB0aGUgdG9wIHNoYXBlLCBpbiBnbG9iYWwgY29vcmRpbmF0ZXMsIHVzZWQgdG8gc2hvdyB3aXJlcyBvciBlbGVjdHJvbnMgZmxvd2luZyBpbi9vdXQgb2YgdGhlIGNhcGFjaXRvci5cbiAgICogQHJldHVybnMge1NoYXBlfVxuICAgKiBAcHVibGljXG4gICAqL1xuICBnZXRUb3BQbGF0ZUNsaXBTaGFwZVRvR2xvYmFsKCkge1xuXG4gICAgLy8gTm90ZSB4ICYgeSBhcmUgZGVmaW5lZCBmb3IgYSB2ZXJ0aWNhbCBjYXBhY2l0b3IsIGxpa2UgaW4gQ2FwYWNpdG9yIExhYjogQmFzaWNzXG4gICAgY29uc3QgdG9wTm9kZSA9IHRoaXMudG9wUGxhdGVOb2RlLnRvcE5vZGU7XG4gICAgY29uc3Qgc2hhcGUgPSBTaGFwZS5yZWN0KCB0b3BOb2RlLmNlbnRlci54IC0gQ0xJUF9IRUlHSFQsIHRvcE5vZGUuY2VudGVyLnkgLSBDTElQX1dJRFRILCBDTElQX0hFSUdIVCAqIDIsIENMSVBfV0lEVEggKTtcbiAgICByZXR1cm4gc2hhcGUudHJhbnNmb3JtZWQoIHRvcE5vZGUuZ2V0TG9jYWxUb0dsb2JhbE1hdHJpeCgpICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgY2xpcHBpbmcgcmVnaW9uIGZvciB0aGUgYm90dG9tIHNoYXBlLCBpbiBnbG9iYWwgY29vcmRpbmF0ZXMsIHVzZWQgdG8gc2hvdyB3aXJlcyBvciBlbGVjdHJvbnMgZmxvd2luZyBpbi9vdXQgb2YgdGhlIGNhcGFjaXRvci5cbiAgICogQHJldHVybnMge1NoYXBlfVxuICAgKiBAcHVibGljXG4gICAqL1xuICBnZXRCb3R0b21QbGF0ZUNsaXBTaGFwZVRvR2xvYmFsKCkge1xuXG4gICAgLy8gTm90ZSB4ICYgeSBhcmUgZGVmaW5lZCBmb3IgYSB2ZXJ0aWNhbCBjYXBhY2l0b3IsIGxpa2UgaW4gQ2FwYWNpdG9yIExhYjogQmFzaWNzXG4gICAgY29uc3QgZnJvbnROb2RlID0gdGhpcy5ib3R0b21QbGF0ZU5vZGUuZnJvbnROb2RlO1xuICAgIGNvbnN0IHNoYXBlID0gU2hhcGUucmVjdCggZnJvbnROb2RlLmJvdW5kcy5jZW50ZXIueCAtIENMSVBfSEVJR0hULCBmcm9udE5vZGUuYm91bmRzLmJvdHRvbSwgQ0xJUF9IRUlHSFQgKiAyLCBDTElQX1dJRFRIICk7XG4gICAgcmV0dXJuIHNoYXBlLnRyYW5zZm9ybWVkKCBmcm9udE5vZGUuZ2V0TG9jYWxUb0dsb2JhbE1hdHJpeCgpICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBnZW9tZXRyeSBvZiB0aGUgY2FwYWNpdG9yIHBsYXRlcy5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHVwZGF0ZUdlb21ldHJ5KCkge1xuXG4gICAgLy8gZ2VvbWV0cnlcbiAgICB0aGlzLnRvcFBsYXRlTm9kZS5zZXRCb3hTaXplKCB0aGlzLmNhcGFjaXRvci5wbGF0ZVNpemVQcm9wZXJ0eS52YWx1ZSApO1xuICAgIHRoaXMuYm90dG9tUGxhdGVOb2RlLnNldEJveFNpemUoIHRoaXMuY2FwYWNpdG9yLnBsYXRlU2l6ZVByb3BlcnR5LnZhbHVlICk7XG5cbiAgICAvLyBsYXlvdXQgbm9kZXNcbiAgICBjb25zdCB4ID0gMDtcbiAgICBjb25zdCB6ID0gMDtcblxuICAgIGNvbnN0IHRvcFBsYXRlWSA9IC10aGlzLmNhcGFjaXRvci5wbGF0ZVNlcGFyYXRpb25Qcm9wZXJ0eS52YWx1ZSAvIDIgLSB0aGlzLmNhcGFjaXRvci5wbGF0ZVNpemVQcm9wZXJ0eS52YWx1ZS5oZWlnaHQ7XG4gICAgdGhpcy50b3BQbGF0ZU5vZGUuY2VudGVyID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVhZWiggeCwgdG9wUGxhdGVZLCB6ICk7XG5cbiAgICBjb25zdCBib3R0b21QbGF0ZVkgPSB0aGlzLmNhcGFjaXRvci5wbGF0ZVNlcGFyYXRpb25Qcm9wZXJ0eS52YWx1ZSAvIDI7XG4gICAgdGhpcy5ib3R0b21QbGF0ZU5vZGUuY2VudGVyID0gdGhpcy5tb2RlbFZpZXdUcmFuc2Zvcm0ubW9kZWxUb1ZpZXdEZWx0YVhZWiggeCwgYm90dG9tUGxhdGVZLCB6ICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBib3VuZCBvZiB0aGUgY2FwYWNpdG9yIGZyb20gdGhlIHBsYXRlcy4gIEFsbG93cyBmb3IgYm91bmRzIHRvIGJlIHBhc3NlZCBpbnRvIHRoZSBjYW52YXMgbm9kZSBiZWZvcmUgdGhlXG4gICAqIGNoaWxkcmVuIGFyZSBhZGRlZCB0byB0aGUgdmlldy5cbiAgICogQHB1YmxpY1xuICAgKlxuICAgKiBAcmV0dXJucyB7Qm91bmRzMn1cbiAgICovXG4gIGdldFBsYXRlc0JvdW5kcygpIHtcbiAgICByZXR1cm4gbmV3IEJvdW5kczIoXG4gICAgICB0aGlzLnRvcFBsYXRlTm9kZS5sZWZ0LFxuICAgICAgdGhpcy50b3BQbGF0ZU5vZGUudG9wLFxuICAgICAgdGhpcy5ib3R0b21QbGF0ZU5vZGUucmlnaHQsXG4gICAgICB0aGlzLmJvdHRvbVBsYXRlTm9kZS5ib3R0b21cbiAgICApO1xuICB9XG59XG5cbnNjZW5lcnlQaGV0LnJlZ2lzdGVyKCAnQ2FwYWNpdG9yTm9kZScsIENhcGFjaXRvck5vZGUgKTtcbmV4cG9ydCBkZWZhdWx0IENhcGFjaXRvck5vZGU7Il0sIm5hbWVzIjpbIk11bHRpbGluayIsInZhbGlkYXRlIiwiQm91bmRzMiIsIlNoYXBlIiwibWVyZ2UiLCJPcmllbnRhdGlvbiIsIk5vZGUiLCJzY2VuZXJ5UGhldCIsIkNhcGFjaXRvckNvbnN0YW50cyIsIkVGaWVsZE5vZGUiLCJQbGF0ZU5vZGUiLCJDTElQX0hFSUdIVCIsIkNMSVBfV0lEVEgiLCJDYXBhY2l0b3JOb2RlIiwiZGlzcG9zZSIsImRpc3Bvc2VDYXBhY2l0b3JOb2RlIiwiZnJvbnRTaWRlQ29udGFpbnNTZW5zb3JQb2ludCIsImdsb2JhbFBvaW50IiwicG9pbnQiLCJ0b3BQbGF0ZU5vZGUiLCJnbG9iYWxUb1BhcmVudFBvaW50IiwiY29udGFpbnNQb2ludCIsImJhY2tTaWRlQ29udGFpbnNTZW5zb3JQb2ludCIsImJvdHRvbVBsYXRlTm9kZSIsImdldFRvcFBsYXRlQ2xpcFNoYXBlVG9HbG9iYWwiLCJ0b3BOb2RlIiwic2hhcGUiLCJyZWN0IiwiY2VudGVyIiwieCIsInkiLCJ0cmFuc2Zvcm1lZCIsImdldExvY2FsVG9HbG9iYWxNYXRyaXgiLCJnZXRCb3R0b21QbGF0ZUNsaXBTaGFwZVRvR2xvYmFsIiwiZnJvbnROb2RlIiwiYm91bmRzIiwiYm90dG9tIiwidXBkYXRlR2VvbWV0cnkiLCJzZXRCb3hTaXplIiwiY2FwYWNpdG9yIiwicGxhdGVTaXplUHJvcGVydHkiLCJ2YWx1ZSIsInoiLCJ0b3BQbGF0ZVkiLCJwbGF0ZVNlcGFyYXRpb25Qcm9wZXJ0eSIsImhlaWdodCIsIm1vZGVsVmlld1RyYW5zZm9ybSIsIm1vZGVsVG9WaWV3RGVsdGFYWVoiLCJib3R0b21QbGF0ZVkiLCJnZXRQbGF0ZXNCb3VuZHMiLCJsZWZ0IiwidG9wIiwicmlnaHQiLCJjb25zdHJ1Y3RvciIsImNpcmN1aXQiLCJwbGF0ZUNoYXJnZVZpc2libGVQcm9wZXJ0eSIsImVsZWN0cmljRmllbGRWaXNpYmxlUHJvcGVydHkiLCJvcHRpb25zIiwib3JpZW50YXRpb24iLCJWRVJUSUNBTCIsImluY2x1ZGVDaGFyZ2VOb2RlIiwidmFsaWRWYWx1ZXMiLCJlbnVtZXJhdGlvbiIsInZhbHVlcyIsIlBPTEFSSVRZIiwiUE9TSVRJVkUiLCJtYXhQbGF0ZUNoYXJnZSIsIk5FR0FUSVZFIiwiZUZpZWxkTm9kZSIsIm1heEVmZmVjdGl2ZUVGaWVsZCIsImFkZENoaWxkIiwibXVsdGlsaW5rIiwidXBkYXRlVmlzaWJpbGl0eSIsInZpc2libGUiLCJzZXRDaGFyZ2VWaXNpYmxlIiwibGluayIsInVwZGF0ZUVsZWN0cmljRmllbGRWaXNpYmlsaXR5Iiwic2V0VmlzaWJsZSIsIm11dGF0ZSIsInVubGluayIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFFdEQ7Ozs7OztDQU1DLEdBRUQsT0FBT0EsZUFBZSxnQ0FBZ0M7QUFDdEQsT0FBT0MsY0FBYywrQkFBK0I7QUFDcEQsT0FBT0MsYUFBYSw2QkFBNkI7QUFDakQsU0FBU0MsS0FBSyxRQUFRLDhCQUE4QjtBQUNwRCxPQUFPQyxXQUFXLGlDQUFpQztBQUNuRCxPQUFPQyxpQkFBaUIsdUNBQXVDO0FBQy9ELFNBQVNDLElBQUksUUFBUSxpQ0FBaUM7QUFDdEQsT0FBT0MsaUJBQWlCLG9CQUFvQjtBQUM1QyxPQUFPQyx3QkFBd0IsMEJBQTBCO0FBQ3pELE9BQU9DLGdCQUFnQixrQkFBa0I7QUFDekMsT0FBT0MsZUFBZSxpQkFBaUI7QUFFdkMsWUFBWTtBQUNaLE1BQU1DLGNBQWM7QUFDcEIs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