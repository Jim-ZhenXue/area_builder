// Copyright 2022-2024, University of Colorado Boulder
/**
 * PlayPauseStepButtonGroup has a play & pause button, optional step-forward button, and optional step-back button.
 * It's typically a subcomponent of TimeControlNode, and was originally an inner class of TimeControlNode.
 *
 * @author Denzell Barnett (PhET Interactive Simulations)
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */ import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import optionize, { combineOptions } from '../../../phet-core/js/optionize.js';
import { HBox } from '../../../scenery/js/imports.js';
import Tandem from '../../../tandem/js/Tandem.js';
import BooleanIO from '../../../tandem/js/types/BooleanIO.js';
import sceneryPhet from '../sceneryPhet.js';
import SceneryPhetConstants from '../SceneryPhetConstants.js';
import SceneryPhetStrings from '../SceneryPhetStrings.js';
import PlayPauseButton from './PlayPauseButton.js';
import StepBackwardButton from './StepBackwardButton.js';
import StepForwardButton from './StepForwardButton.js';
const DEFAULT_STEP_BUTTON_RADIUS = 15;
const DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION = 5;
let PlayPauseStepButtonGroup = class PlayPauseStepButtonGroup extends HBox {
    /**
   * Get the center of the PlayPauseButton, in the local coordinate frame of the PlayPauseStepButtonGroup.
   */ getPlayPauseButtonCenter() {
        return this.playPauseButton.center;
    }
    dispose() {
        this.disposePlayPauseStepButtonGroup();
        super.dispose();
    }
    constructor(isPlayingProperty, providedOptions){
        const options = optionize()({
            // {boolean} - if true, a StepForwardButton is included in the button group
            includeStepForwardButton: true,
            // {boolean} - if true, a StepBackwardButton is included in the button group
            includeStepBackwardButton: false,
            // {number} horizontal space between Play/Pause and Step buttons
            playPauseStepXSpacing: 10,
            // Options for the PlayPauseButton
            playPauseButtonOptions: {
                radius: SceneryPhetConstants.DEFAULT_BUTTON_RADIUS,
                touchAreaDilation: 5
            },
            // Options for the StepBackwardButton
            stepBackwardButtonOptions: {
                radius: DEFAULT_STEP_BUTTON_RADIUS,
                touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
            },
            // Options for the StepForwardButton
            stepForwardButtonOptions: {
                radius: DEFAULT_STEP_BUTTON_RADIUS,
                touchAreaDilation: DEFAULT_STEP_BUTTON_TOUCH_AREA_DILATION
            },
            // HBoxOptions
            resize: false,
            // phet-io
            tandem: Tandem.REQUIRED,
            tandemNameSuffix: 'ButtonGroup',
            // pdom
            tagName: 'div',
            appendDescription: true,
            playingHelpText: null,
            pausedHelpText: null
        }, providedOptions);
        // by default, the step buttons are enabled when isPlayingProperty is false, but only create a PhET-iO instrumented
        // Property if it is going to be used
        if (!options.stepForwardButtonOptions.enabledProperty || !options.stepBackwardButtonOptions.enabledProperty) {
            // This is clearer than having the variable names match exactly. Opt out below
            // eslint-disable-next-line phet/tandem-name-should-match
            const defaultEnabledProperty = DerivedProperty.not(isPlayingProperty, {
                tandem: options.tandem.createTandem('enabledProperty'),
                phetioValueType: BooleanIO
            });
            if (!options.stepForwardButtonOptions.enabledProperty) {
                options.stepForwardButtonOptions.enabledProperty = defaultEnabledProperty;
            }
            if (!options.stepBackwardButtonOptions.enabledProperty) {
                options.stepBackwardButtonOptions.enabledProperty = defaultEnabledProperty;
            }
        }
        const children = [];
        const playPauseButton = new PlayPauseButton(isPlayingProperty, combineOptions({
            tandem: options.tandem.createTandem('playPauseButton'),
            phetioDocumentation: 'Button to control the animation in the simulation. This will also stop the model from stepping.'
        }, options.playPauseButtonOptions));
        children.push(playPauseButton);
        let stepForwardButton = null;
        if (options.includeStepForwardButton) {
            stepForwardButton = new StepForwardButton(combineOptions({
                tandem: options.tandem.createTandem('stepForwardButton'),
                phetioDocumentation: 'Progress the simulation a single model step forwards.'
            }, options.stepForwardButtonOptions));
            children.push(stepForwardButton);
        }
        let stepBackwardButton = null;
        if (options.includeStepBackwardButton) {
            stepBackwardButton = new StepBackwardButton(combineOptions({
                phetioDocumentation: 'Progress the simulation a single model step backwards.',
                tandem: options.tandem.createTandem('stepBackwardButton')
            }, options.stepBackwardButtonOptions));
            children.unshift(stepBackwardButton);
        }
        options.spacing = options.playPauseStepXSpacing;
        options.children = children;
        super(options);
        this.playPauseButton = playPauseButton;
        // pdom - Always use the provided help text. If not provided, a default string describes how to step forward and backward
        // when paused. The default helpText will only be used if a step button is visible.
        const eitherStepButtonVisible = options.includeStepForwardButton || options.includeStepBackwardButton;
        const playingHelpText = options.playingHelpText || (eitherStepButtonVisible ? SceneryPhetStrings.a11y.playPauseStepButtonGroup.playingHelpTextStringProperty : null);
        const pausedHelpText = options.pausedHelpText || (eitherStepButtonVisible ? SceneryPhetStrings.a11y.playPauseStepButtonGroup.pausedHelpTextStringProperty : null);
        const playingListener = (playing)=>{
            this.helpText = playing ? playingHelpText : pausedHelpText;
        };
        isPlayingProperty.link(playingListener);
        this.disposePlayPauseStepButtonGroup = ()=>{
            isPlayingProperty.unlink(playingListener);
            playPauseButton.dispose();
            stepForwardButton && stepForwardButton.dispose();
            stepBackwardButton && stepBackwardButton.dispose();
        };
    }
};
export { PlayPauseStepButtonGroup as default };
sceneryPhet.register('PlayPauseStepButtonGroup', PlayPauseStepButtonGroup);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnktcGhldC9qcy9idXR0b25zL1BsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMi0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAgaGFzIGEgcGxheSAmIHBhdXNlIGJ1dHRvbiwgb3B0aW9uYWwgc3RlcC1mb3J3YXJkIGJ1dHRvbiwgYW5kIG9wdGlvbmFsIHN0ZXAtYmFjayBidXR0b24uXG4gKiBJdCdzIHR5cGljYWxseSBhIHN1YmNvbXBvbmVudCBvZiBUaW1lQ29udHJvbE5vZGUsIGFuZCB3YXMgb3JpZ2luYWxseSBhbiBpbm5lciBjbGFzcyBvZiBUaW1lQ29udHJvbE5vZGUuXG4gKlxuICogQGF1dGhvciBEZW56ZWxsIEJhcm5ldHQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKiBAYXV0aG9yIEpvbmF0aGFuIE9sc29uIDxqb25hdGhhbi5vbHNvbkBjb2xvcmFkby5lZHU+XG4gKiBAYXV0aG9yIENocmlzIE1hbGxleSAoUGl4ZWxab29tLCBJbmMuKVxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKi9cblxuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XG5pbXBvcnQgb3B0aW9uaXplLCB7IGNvbWJpbmVPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL29wdGlvbml6ZS5qcyc7XG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XG5pbXBvcnQgeyBIQm94LCBIQm94T3B0aW9ucywgUmVtb3ZlUGFyYWxsZWxET01PcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XG5pbXBvcnQgQm9vbGVhbklPIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy90eXBlcy9Cb29sZWFuSU8uanMnO1xuaW1wb3J0IHNjZW5lcnlQaGV0IGZyb20gJy4uL3NjZW5lcnlQaGV0LmpzJztcbmltcG9ydCBTY2VuZXJ5UGhldENvbnN0YW50cyBmcm9tICcuLi9TY2VuZXJ5UGhldENvbnN0YW50cy5qcyc7XG5pbXBvcnQgU2NlbmVyeVBoZXRTdHJpbmdzIGZyb20gJy4uL1NjZW5lcnlQaGV0U3RyaW5ncy5qcyc7XG5pbXBvcnQgUGxheVBhdXNlQnV0dG9uLCB7IFBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1BsYXlQYXVzZUJ1dHRvbi5qcyc7XG5pbXBvcnQgU3RlcEJhY2t3YXJkQnV0dG9uLCB7IFN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMgfSBmcm9tICcuL1N0ZXBCYWNrd2FyZEJ1dHRvbi5qcyc7XG5pbXBvcnQgU3RlcEZvcndhcmRCdXR0b24sIHsgU3RlcEZvcndhcmRCdXR0b25PcHRpb25zIH0gZnJvbSAnLi9TdGVwRm9yd2FyZEJ1dHRvbi5qcyc7XG5cbmNvbnN0IERFRkFVTFRfU1RFUF9CVVRUT05fUkFESVVTID0gMTU7XG5jb25zdCBERUZBVUxUX1NURVBfQlVUVE9OX1RPVUNIX0FSRUFfRElMQVRJT04gPSA1O1xuXG50eXBlIFNlbGZPcHRpb25zID0ge1xuXG4gIC8vIGlmIHRydWUsIGEgU3RlcEZvcndhcmRCdXR0b24gaXMgaW5jbHVkZWQgaW4gdGhlIGJ1dHRvbiBncm91cFxuICBpbmNsdWRlU3RlcEZvcndhcmRCdXR0b24/OiBib29sZWFuO1xuXG4gIC8vIGlmIHRydWUsIGEgU3RlcEJhY2t3YXJkQnV0dG9uIGlzIGluY2x1ZGVkIGluIHRoZSBidXR0b24gZ3JvdXBcbiAgaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbj86IGJvb2xlYW47XG5cbiAgLy8gaG9yaXpvbnRhbCBzcGFjZSBiZXR3ZWVuIFBsYXkvUGF1c2UgYW5kIFN0ZXAgYnV0dG9uc1xuICBwbGF5UGF1c2VTdGVwWFNwYWNpbmc/OiBudW1iZXI7XG5cbiAgLy8gb3B0aW9ucyBmb3IgYnV0dG9uIHN1YmNvbXBvbmVudHNcbiAgcGxheVBhdXNlQnV0dG9uT3B0aW9ucz86IFN0cmljdE9taXQ8UGxheVBhdXNlQnV0dG9uT3B0aW9ucywgJ3RhbmRlbScgfCAncGhldGlvRG9jdW1lbnRhdGlvbic+O1xuICBzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnM/OiBTdHJpY3RPbWl0PFN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucywgJ3RhbmRlbScgfCAncGhldGlvRG9jdW1lbnRhdGlvbic+O1xuICBzdGVwQmFja3dhcmRCdXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxTdGVwQmFja3dhcmRCdXR0b25PcHRpb25zLCAndGFuZGVtJyB8ICdwaGV0aW9Eb2N1bWVudGF0aW9uJz47XG5cbiAgLy8gcGRvbSAtIFN0cmluZ3MgdXNlZCBmb3IgdGhlIGhlbHAgdGV4dCBvZiB0aGlzIGJ1dHRvbiBncm91cCBpbiB0aGUgcGxheWluZyBhbmQgcGF1c2VkIHN0YXRlcy4gSWYgbm90IHByb3ZpZGVkLFxuICAvLyBkZWZhdWx0IGhlbHAgdGV4dCB3aWxsIGJlIHVzZWQgd2hlbiBhIHN0ZXAgYnV0dG9uIGlzIHZpc2libGUuXG4gIHBsYXlpbmdIZWxwVGV4dD86IHN0cmluZyB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4gfCBudWxsO1xuICBwYXVzZWRIZWxwVGV4dD86IHN0cmluZyB8IFRSZWFkT25seVByb3BlcnR5PHN0cmluZz4gfCBudWxsO1xufTtcblxuZXhwb3J0IHR5cGUgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwT3B0aW9ucyA9IFNlbGZPcHRpb25zICYgU3RyaWN0T21pdDxSZW1vdmVQYXJhbGxlbERPTU9wdGlvbnM8SEJveE9wdGlvbnM+LCAnc3BhY2luZycgfCAnY2hpbGRyZW4nPjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIGV4dGVuZHMgSEJveCB7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBwbGF5UGF1c2VCdXR0b246IFBsYXlQYXVzZUJ1dHRvbjtcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwOiAoKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggaXNQbGF5aW5nUHJvcGVydHk6IFByb3BlcnR5PGJvb2xlYW4+LCBwcm92aWRlZE9wdGlvbnM/OiBQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXBPcHRpb25zICkge1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxQbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXBPcHRpb25zLCBTZWxmT3B0aW9ucywgSEJveE9wdGlvbnM+KCkoIHtcblxuICAgICAgLy8ge2Jvb2xlYW59IC0gaWYgdHJ1ZSwgYSBTdGVwRm9yd2FyZEJ1dHRvbiBpcyBpbmNsdWRlZCBpbiB0aGUgYnV0dG9uIGdyb3VwXG4gICAgICBpbmNsdWRlU3RlcEZvcndhcmRCdXR0b246IHRydWUsXG5cbiAgICAgIC8vIHtib29sZWFufSAtIGlmIHRydWUsIGEgU3RlcEJhY2t3YXJkQnV0dG9uIGlzIGluY2x1ZGVkIGluIHRoZSBidXR0b24gZ3JvdXBcbiAgICAgIGluY2x1ZGVTdGVwQmFja3dhcmRCdXR0b246IGZhbHNlLFxuXG4gICAgICAvLyB7bnVtYmVyfSBob3Jpem9udGFsIHNwYWNlIGJldHdlZW4gUGxheS9QYXVzZSBhbmQgU3RlcCBidXR0b25zXG4gICAgICBwbGF5UGF1c2VTdGVwWFNwYWNpbmc6IDEwLFxuXG4gICAgICAvLyBPcHRpb25zIGZvciB0aGUgUGxheVBhdXNlQnV0dG9uXG4gICAgICBwbGF5UGF1c2VCdXR0b25PcHRpb25zOiB7XG4gICAgICAgIHJhZGl1czogU2NlbmVyeVBoZXRDb25zdGFudHMuREVGQVVMVF9CVVRUT05fUkFESVVTLFxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogNVxuICAgICAgfSxcblxuICAgICAgLy8gT3B0aW9ucyBmb3IgdGhlIFN0ZXBCYWNrd2FyZEJ1dHRvblxuICAgICAgc3RlcEJhY2t3YXJkQnV0dG9uT3B0aW9uczoge1xuICAgICAgICByYWRpdXM6IERFRkFVTFRfU1RFUF9CVVRUT05fUkFESVVTLFxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogREVGQVVMVF9TVEVQX0JVVFRPTl9UT1VDSF9BUkVBX0RJTEFUSU9OXG4gICAgICB9LFxuXG4gICAgICAvLyBPcHRpb25zIGZvciB0aGUgU3RlcEZvcndhcmRCdXR0b25cbiAgICAgIHN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9uczoge1xuICAgICAgICByYWRpdXM6IERFRkFVTFRfU1RFUF9CVVRUT05fUkFESVVTLFxuICAgICAgICB0b3VjaEFyZWFEaWxhdGlvbjogREVGQVVMVF9TVEVQX0JVVFRPTl9UT1VDSF9BUkVBX0RJTEFUSU9OXG4gICAgICB9LFxuXG4gICAgICAvLyBIQm94T3B0aW9uc1xuICAgICAgcmVzaXplOiBmYWxzZSwgLy8gZG9uJ3QgY2hhbmdlIGxheW91dCBpZiBwbGF5UGF1c2VCdXR0b24gcmVzaXplcyB3aXRoIHNjYWxlRmFjdG9yV2hlbk5vdFBsYXlpbmdcblxuICAgICAgLy8gcGhldC1pb1xuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnQnV0dG9uR3JvdXAnLFxuXG4gICAgICAvLyBwZG9tXG4gICAgICB0YWdOYW1lOiAnZGl2JywgLy8gc28gdGhhdCBpdCBjYW4gcmVjZWl2ZSBkZXNjcmlwdGlvbnNcbiAgICAgIGFwcGVuZERlc2NyaXB0aW9uOiB0cnVlLFxuICAgICAgcGxheWluZ0hlbHBUZXh0OiBudWxsLFxuICAgICAgcGF1c2VkSGVscFRleHQ6IG51bGxcbiAgICB9LCBwcm92aWRlZE9wdGlvbnMgKTtcblxuICAgIC8vIGJ5IGRlZmF1bHQsIHRoZSBzdGVwIGJ1dHRvbnMgYXJlIGVuYWJsZWQgd2hlbiBpc1BsYXlpbmdQcm9wZXJ0eSBpcyBmYWxzZSwgYnV0IG9ubHkgY3JlYXRlIGEgUGhFVC1pTyBpbnN0cnVtZW50ZWRcbiAgICAvLyBQcm9wZXJ0eSBpZiBpdCBpcyBnb2luZyB0byBiZSB1c2VkXG4gICAgaWYgKCAoICFvcHRpb25zLnN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucy5lbmFibGVkUHJvcGVydHkgKSB8fCAoICFvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ICkgKSB7XG5cbiAgICAgIC8vIFRoaXMgaXMgY2xlYXJlciB0aGFuIGhhdmluZyB0aGUgdmFyaWFibGUgbmFtZXMgbWF0Y2ggZXhhY3RseS4gT3B0IG91dCBiZWxvd1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHBoZXQvdGFuZGVtLW5hbWUtc2hvdWxkLW1hdGNoXG4gICAgICBjb25zdCBkZWZhdWx0RW5hYmxlZFByb3BlcnR5ID0gRGVyaXZlZFByb3BlcnR5Lm5vdCggaXNQbGF5aW5nUHJvcGVydHksIHtcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdlbmFibGVkUHJvcGVydHknICksXG4gICAgICAgIHBoZXRpb1ZhbHVlVHlwZTogQm9vbGVhbklPXG4gICAgICB9ICk7XG5cbiAgICAgIGlmICggIW9wdGlvbnMuc3RlcEZvcndhcmRCdXR0b25PcHRpb25zLmVuYWJsZWRQcm9wZXJ0eSApIHtcblxuICAgICAgICBvcHRpb25zLnN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucy5lbmFibGVkUHJvcGVydHkgPSBkZWZhdWx0RW5hYmxlZFByb3BlcnR5O1xuICAgICAgfVxuICAgICAgaWYgKCAhb3B0aW9ucy5zdGVwQmFja3dhcmRCdXR0b25PcHRpb25zLmVuYWJsZWRQcm9wZXJ0eSApIHtcblxuICAgICAgICBvcHRpb25zLnN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMuZW5hYmxlZFByb3BlcnR5ID0gZGVmYXVsdEVuYWJsZWRQcm9wZXJ0eTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjaGlsZHJlbiA9IFtdO1xuXG4gICAgY29uc3QgcGxheVBhdXNlQnV0dG9uID0gbmV3IFBsYXlQYXVzZUJ1dHRvbiggaXNQbGF5aW5nUHJvcGVydHksXG4gICAgICBjb21iaW5lT3B0aW9uczxQbGF5UGF1c2VCdXR0b25PcHRpb25zPigge1xuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3BsYXlQYXVzZUJ1dHRvbicgKSxcbiAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0J1dHRvbiB0byBjb250cm9sIHRoZSBhbmltYXRpb24gaW4gdGhlIHNpbXVsYXRpb24uIFRoaXMgd2lsbCBhbHNvIHN0b3AgdGhlIG1vZGVsIGZyb20gc3RlcHBpbmcuJ1xuICAgICAgfSwgb3B0aW9ucy5wbGF5UGF1c2VCdXR0b25PcHRpb25zICkgKTtcbiAgICBjaGlsZHJlbi5wdXNoKCBwbGF5UGF1c2VCdXR0b24gKTtcblxuICAgIGxldCBzdGVwRm9yd2FyZEJ1dHRvbjogU3RlcEZvcndhcmRCdXR0b24gfCBudWxsID0gbnVsbDtcbiAgICBpZiAoIG9wdGlvbnMuaW5jbHVkZVN0ZXBGb3J3YXJkQnV0dG9uICkge1xuICAgICAgc3RlcEZvcndhcmRCdXR0b24gPSBuZXcgU3RlcEZvcndhcmRCdXR0b24oXG4gICAgICAgIGNvbWJpbmVPcHRpb25zPFN0ZXBGb3J3YXJkQnV0dG9uT3B0aW9ucz4oIHtcbiAgICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3N0ZXBGb3J3YXJkQnV0dG9uJyApLFxuICAgICAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdQcm9ncmVzcyB0aGUgc2ltdWxhdGlvbiBhIHNpbmdsZSBtb2RlbCBzdGVwIGZvcndhcmRzLidcbiAgICAgICAgfSwgb3B0aW9ucy5zdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMgKSApO1xuICAgICAgY2hpbGRyZW4ucHVzaCggc3RlcEZvcndhcmRCdXR0b24gKTtcbiAgICB9XG5cbiAgICBsZXQgc3RlcEJhY2t3YXJkQnV0dG9uOiBTdGVwQmFja3dhcmRCdXR0b24gfCBudWxsID0gbnVsbDtcbiAgICBpZiAoIG9wdGlvbnMuaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiApIHtcbiAgICAgIHN0ZXBCYWNrd2FyZEJ1dHRvbiA9IG5ldyBTdGVwQmFja3dhcmRCdXR0b24oXG4gICAgICAgIGNvbWJpbmVPcHRpb25zPFN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnM+KCB7XG4gICAgICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ1Byb2dyZXNzIHRoZSBzaW11bGF0aW9uIGEgc2luZ2xlIG1vZGVsIHN0ZXAgYmFja3dhcmRzLicsXG4gICAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdzdGVwQmFja3dhcmRCdXR0b24nIClcbiAgICAgICAgfSwgb3B0aW9ucy5zdGVwQmFja3dhcmRCdXR0b25PcHRpb25zICkgKTtcbiAgICAgIGNoaWxkcmVuLnVuc2hpZnQoIHN0ZXBCYWNrd2FyZEJ1dHRvbiApO1xuICAgIH1cblxuICAgIG9wdGlvbnMuc3BhY2luZyA9IG9wdGlvbnMucGxheVBhdXNlU3RlcFhTcGFjaW5nO1xuICAgIG9wdGlvbnMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcblxuICAgIHN1cGVyKCBvcHRpb25zICk7XG5cbiAgICB0aGlzLnBsYXlQYXVzZUJ1dHRvbiA9IHBsYXlQYXVzZUJ1dHRvbjtcblxuICAgIC8vIHBkb20gLSBBbHdheXMgdXNlIHRoZSBwcm92aWRlZCBoZWxwIHRleHQuIElmIG5vdCBwcm92aWRlZCwgYSBkZWZhdWx0IHN0cmluZyBkZXNjcmliZXMgaG93IHRvIHN0ZXAgZm9yd2FyZCBhbmQgYmFja3dhcmRcbiAgICAvLyB3aGVuIHBhdXNlZC4gVGhlIGRlZmF1bHQgaGVscFRleHQgd2lsbCBvbmx5IGJlIHVzZWQgaWYgYSBzdGVwIGJ1dHRvbiBpcyB2aXNpYmxlLlxuICAgIGNvbnN0IGVpdGhlclN0ZXBCdXR0b25WaXNpYmxlID0gb3B0aW9ucy5pbmNsdWRlU3RlcEZvcndhcmRCdXR0b24gfHwgb3B0aW9ucy5pbmNsdWRlU3RlcEJhY2t3YXJkQnV0dG9uO1xuICAgIGNvbnN0IHBsYXlpbmdIZWxwVGV4dCA9IG9wdGlvbnMucGxheWluZ0hlbHBUZXh0IHx8ICggZWl0aGVyU3RlcEJ1dHRvblZpc2libGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gU2NlbmVyeVBoZXRTdHJpbmdzLmExMXkucGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwLnBsYXlpbmdIZWxwVGV4dFN0cmluZ1Byb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwgKTtcblxuICAgIGNvbnN0IHBhdXNlZEhlbHBUZXh0ID0gb3B0aW9ucy5wYXVzZWRIZWxwVGV4dCB8fCAoIGVpdGhlclN0ZXBCdXR0b25WaXNpYmxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBTY2VuZXJ5UGhldFN0cmluZ3MuYTExeS5wbGF5UGF1c2VTdGVwQnV0dG9uR3JvdXAucGF1c2VkSGVscFRleHRTdHJpbmdQcm9wZXJ0eVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbCApO1xuXG4gICAgY29uc3QgcGxheWluZ0xpc3RlbmVyID0gKCBwbGF5aW5nOiBib29sZWFuICkgPT4ge1xuICAgICAgdGhpcy5oZWxwVGV4dCA9IHBsYXlpbmcgPyBwbGF5aW5nSGVscFRleHQgOiBwYXVzZWRIZWxwVGV4dDtcbiAgICB9O1xuICAgIGlzUGxheWluZ1Byb3BlcnR5LmxpbmsoIHBsYXlpbmdMaXN0ZW5lciApO1xuXG4gICAgdGhpcy5kaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwID0gKCkgPT4ge1xuICAgICAgaXNQbGF5aW5nUHJvcGVydHkudW5saW5rKCBwbGF5aW5nTGlzdGVuZXIgKTtcblxuICAgICAgcGxheVBhdXNlQnV0dG9uLmRpc3Bvc2UoKTtcbiAgICAgIHN0ZXBGb3J3YXJkQnV0dG9uICYmIHN0ZXBGb3J3YXJkQnV0dG9uLmRpc3Bvc2UoKTtcbiAgICAgIHN0ZXBCYWNrd2FyZEJ1dHRvbiAmJiBzdGVwQmFja3dhcmRCdXR0b24uZGlzcG9zZSgpO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjZW50ZXIgb2YgdGhlIFBsYXlQYXVzZUJ1dHRvbiwgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWUgb2YgdGhlIFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cC5cbiAgICovXG4gIHB1YmxpYyBnZXRQbGF5UGF1c2VCdXR0b25DZW50ZXIoKTogVmVjdG9yMiB7XG4gICAgcmV0dXJuIHRoaXMucGxheVBhdXNlQnV0dG9uLmNlbnRlcjtcbiAgfVxuXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuZGlzcG9zZVBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCgpO1xuICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgfVxufVxuXG5zY2VuZXJ5UGhldC5yZWdpc3RlciggJ1BsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCcsIFBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCApOyJdLCJuYW1lcyI6WyJEZXJpdmVkUHJvcGVydHkiLCJvcHRpb25pemUiLCJjb21iaW5lT3B0aW9ucyIsIkhCb3giLCJUYW5kZW0iLCJCb29sZWFuSU8iLCJzY2VuZXJ5UGhldCIsIlNjZW5lcnlQaGV0Q29uc3RhbnRzIiwiU2NlbmVyeVBoZXRTdHJpbmdzIiwiUGxheVBhdXNlQnV0dG9uIiwiU3RlcEJhY2t3YXJkQnV0dG9uIiwiU3RlcEZvcndhcmRCdXR0b24iLCJERUZBVUxUX1NURVBfQlVUVE9OX1JBRElVUyIsIkRFRkFVTFRfU1RFUF9CVVRUT05fVE9VQ0hfQVJFQV9ESUxBVElPTiIsIlBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCIsImdldFBsYXlQYXVzZUJ1dHRvbkNlbnRlciIsInBsYXlQYXVzZUJ1dHRvbiIsImNlbnRlciIsImRpc3Bvc2UiLCJkaXNwb3NlUGxheVBhdXNlU3RlcEJ1dHRvbkdyb3VwIiwiaXNQbGF5aW5nUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwiaW5jbHVkZVN0ZXBGb3J3YXJkQnV0dG9uIiwiaW5jbHVkZVN0ZXBCYWNrd2FyZEJ1dHRvbiIsInBsYXlQYXVzZVN0ZXBYU3BhY2luZyIsInBsYXlQYXVzZUJ1dHRvbk9wdGlvbnMiLCJyYWRpdXMiLCJERUZBVUxUX0JVVFRPTl9SQURJVVMiLCJ0b3VjaEFyZWFEaWxhdGlvbiIsInN0ZXBCYWNrd2FyZEJ1dHRvbk9wdGlvbnMiLCJzdGVwRm9yd2FyZEJ1dHRvbk9wdGlvbnMiLCJyZXNpemUiLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJ0YWdOYW1lIiwiYXBwZW5kRGVzY3JpcHRpb24iLCJwbGF5aW5nSGVscFRleHQiLCJwYXVzZWRIZWxwVGV4dCIsImVuYWJsZWRQcm9wZXJ0eSIsImRlZmF1bHRFbmFibGVkUHJvcGVydHkiLCJub3QiLCJjcmVhdGVUYW5kZW0iLCJwaGV0aW9WYWx1ZVR5cGUiLCJjaGlsZHJlbiIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJwdXNoIiwic3RlcEZvcndhcmRCdXR0b24iLCJzdGVwQmFja3dhcmRCdXR0b24iLCJ1bnNoaWZ0Iiwic3BhY2luZyIsImVpdGhlclN0ZXBCdXR0b25WaXNpYmxlIiwiYTExeSIsInBsYXlQYXVzZVN0ZXBCdXR0b25Hcm91cCIsInBsYXlpbmdIZWxwVGV4dFN0cmluZ1Byb3BlcnR5IiwicGF1c2VkSGVscFRleHRTdHJpbmdQcm9wZXJ0eSIsInBsYXlpbmdMaXN0ZW5lciIsInBsYXlpbmciLCJoZWxwVGV4dCIsImxpbmsiLCJ1bmxpbmsiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7Ozs7OztDQVFDLEdBRUQsT0FBT0EscUJBQXFCLHNDQUFzQztBQUlsRSxPQUFPQyxhQUFhQyxjQUFjLFFBQVEscUNBQXFDO0FBRS9FLFNBQVNDLElBQUksUUFBK0MsaUNBQWlDO0FBQzdGLE9BQU9DLFlBQVksK0JBQStCO0FBQ2xELE9BQU9DLGVBQWUsd0NBQXdDO0FBQzlELE9BQU9DLGlCQUFpQixvQkFBb0I7QUFDNUMsT0FBT0MsMEJBQTBCLDZCQUE2QjtBQUM5RCxPQUFPQyx3QkFBd0IsMkJBQTJCO0FBQzFELE9BQU9DLHFCQUFpRCx1QkFBdUI7QUFDL0UsT0FBT0Msd0JBQXVELDBCQUEwQjtBQUN4RixPQUFPQyx1QkFBcUQseUJBQXlCO0FBRXJGLE1BQU1DLDZCQUE2QjtBQUNuQyxNQUFNQywwQ0FBMEM7QUEwQmpDLElBQUEsQUFBTUMsMkJBQU4sTUFBTUEsaUNBQWlDWDtJQW9JcEQ7O0dBRUMsR0FDRCxBQUFPWSwyQkFBb0M7UUFDekMsT0FBTyxJQUFJLENBQUNDLGVBQWUsQ0FBQ0MsTUFBTTtJQUNwQztJQUVnQkMsVUFBZ0I7UUFDOUIsSUFBSSxDQUFDQywrQkFBK0I7UUFDcEMsS0FBSyxDQUFDRDtJQUNSO0lBeklBLFlBQW9CRSxpQkFBb0MsRUFBRUMsZUFBaUQsQ0FBRztRQUU1RyxNQUFNQyxVQUFVckIsWUFBd0U7WUFFdEYsMkVBQTJFO1lBQzNFc0IsMEJBQTBCO1lBRTFCLDRFQUE0RTtZQUM1RUMsMkJBQTJCO1lBRTNCLGdFQUFnRTtZQUNoRUMsdUJBQXVCO1lBRXZCLGtDQUFrQztZQUNsQ0Msd0JB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