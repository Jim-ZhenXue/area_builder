// Copyright 2017-2023, University of Colorado Boulder
/**
 * Bounds2 tests
 *
 * @author Jonathan Olson (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 */ import Matrix3, { m3 } from './Matrix3.js';
import Ray2 from './Ray2.js';
import Transform3 from './Transform3.js';
import Vector2 from './Vector2.js';
QUnit.module('Transform3');
const epsilon = 1e-7;
function approximateEqual(assert, a, b, msg) {
    assert.ok(Math.abs(a - b) < epsilon, `${msg} expected: ${b}, got: ${a}`);
}
function approximateRayEqual(assert, a, b, msg) {
    assert.ok(a.position.equalsEpsilon(b.position, 0.00001) && a.direction.equalsEpsilon(b.direction, 0.00001), `${msg} expected: ${b.toString()}, got: ${a.toString()}`);
}
QUnit.test('Ray2 transforms', (assert)=>{
    const transform = new Transform3(m3(0, -2, 5, 3, 0, 8, 0, 0, 1));
    const ray = new Ray2(new Vector2(2, 7), new Vector2(-5, 2).normalized());
    const tray = transform.transformRay2(ray);
    const iray = transform.inverseRay2(ray);
    const backOffset = transform.inversePosition2(tray.pointAtDistance(1));
    const backPos = transform.inversePosition2(tray.position);
    assert.ok(ray.direction.equalsEpsilon(backOffset.minus(backPos).normalized(), 0.00001), 'transformRay2 ray linearity');
    const forwardOffset = transform.transformPosition2(iray.pointAtDistance(1));
    const forwardPos = transform.transformPosition2(iray.position);
    assert.ok(ray.direction.equalsEpsilon(forwardOffset.minus(forwardPos).normalized(), 0.00001), 'inverseRay2 ray linearity');
    approximateRayEqual(assert, transform.inverseRay2(transform.transformRay2(ray)), ray, 'inverse correctness');
});
QUnit.test('Transform x/y', (assert)=>{
    const t = new Transform3(m3(2, 0, 10, 0, 3, 1, 0, 0, 1));
    assert.equal(t.transformX(5), 20);
    assert.equal(t.transformY(5), 16);
    assert.equal(t.inverseX(20), 5);
    assert.equal(t.inverseY(16), 5);
    const t2 = new Transform3(Matrix3.rotation2(Math.PI / 6));
    window.assert && assert.throws(()=>{
        t2.transformX(5);
    });
    window.assert && assert.throws(()=>{
        t2.transformY(5);
    });
});
QUnit.test('Transform delta', (assert)=>{
    const t1 = new Transform3(m3(2, 1, 0, -2, 5, 0, 0, 0, 1));
    const t2 = new Transform3(m3(2, 1, 52, -2, 5, -61, 0, 0, 1));
    assert.ok(t1.transformDelta2(Vector2.ZERO).equalsEpsilon(Vector2.ZERO, 1e-7), 'ensuring linearity at 0, no translation');
    assert.ok(t2.transformDelta2(Vector2.ZERO).equalsEpsilon(Vector2.ZERO, 1e-7), 'ensuring linearity at 0, with translation');
    assert.ok(t1.transformDelta2(new Vector2(2, -3)).equalsEpsilon(new Vector2(1, -19), 1e-7), 'basic delta check, no translation');
    assert.ok(t2.transformDelta2(new Vector2(2, -3)).equalsEpsilon(new Vector2(1, -19), 1e-7), 'basic delta check, with translation');
    const v = new Vector2(-71, 27);
    assert.ok(t1.inverseDelta2(t1.transformDelta2(v)).equalsEpsilon(v, 1e-7), 'inverse check, no translation');
    assert.ok(t2.inverseDelta2(t2.transformDelta2(v)).equalsEpsilon(v, 1e-7), 'inverse check, with translation');
});
QUnit.test('Transform delta x/y', (assert)=>{
    const t = new Transform3(m3(2, 0, 52, 0, 5, -61, 0, 0, 1));
    approximateEqual(assert, t.transformDeltaX(1), 2, 'deltaX');
    approximateEqual(assert, t.transformDeltaY(1), 5, 'deltaY');
    approximateEqual(assert, t.transformDeltaX(71), t.transformDelta2(new Vector2(71, 27)).x, 'deltaX check vs transformDelta');
    approximateEqual(assert, t.transformDeltaY(27), t.transformDelta2(new Vector2(71, 27)).y, 'deltaY check vs transformDelta');
    const v = new Vector2(-71, 27);
    approximateEqual(assert, t.inverseDeltaX(t.transformDeltaX(v.x)), v.x, 'inverse check X');
    approximateEqual(assert, t.inverseDeltaY(t.transformDeltaY(v.y)), v.y, 'inverse check Y');
});
QUnit.test('Transform setMatrix ensuring matrix instance equivalence', (assert)=>{
    const t = new Transform3();
    const m = t.getMatrix();
    t.setMatrix(m3(1, 2, 3, 4, 5, 6, 7, 8, 9));
    assert.equal(t.getMatrix(), m);
    assert.equal(t.getMatrix().m00(), 1);
    assert.equal(t.getMatrix().m01(), 2);
    t.setMatrix(m3(9, 8, 7, 6, 5, 4, 3, 2, 1));
    assert.equal(t.getMatrix(), m);
    assert.equal(t.getMatrix().m00(), 9);
    assert.equal(t.getMatrix().m01(), 8);
});
QUnit.test('Transform event firing', (assert)=>{
    const t = new Transform3();
    let count = 0;
    t.changeEmitter.addListener((assert)=>{
        count += 1;
    });
    assert.equal(count, 0);
    t.setMatrix(Matrix3.rotation2(Math.PI / 2));
    assert.equal(count, 1);
    t.prepend(Matrix3.rotation2(Math.PI / 2));
    assert.equal(count, 2);
    t.prependTranslation(1, 2);
    assert.equal(count, 3);
    t.append(Matrix3.rotation2(Math.PI / 2));
    assert.equal(count, 4);
});
QUnit.test('Transform inverse validation', (assert)=>{
    const t = new Transform3();
    assert.ok(t.transformPosition2(new Vector2(2, 4)).equals(new Vector2(2, 4)));
    assert.ok(t.inversePosition2(new Vector2(2, 4)).equals(new Vector2(2, 4)));
    t.getMatrix().setToScale(4, 2);
    t.invalidate();
    assert.ok(t.transformPosition2(new Vector2(2, 4)).equals(new Vector2(8, 8)));
    assert.ok(t.inversePosition2(new Vector2(2, 4)).equals(new Vector2(0.5, 2)));
    t.append(Matrix3.rotation2(Math.PI / 2));
    assert.ok(t.transformPosition2(new Vector2(2, 4)).equalsEpsilon(new Vector2(-16, 4), epsilon));
    assert.ok(t.inversePosition2(new Vector2(2, 4)).equalsEpsilon(new Vector2(2, -0.5), epsilon));
});
QUnit.test('transform creation and setting', (assert)=>{
    const t = new Transform3();
    t.append(Matrix3.rotation2(Math.PI));
    assert.ok(true, 'so we have at least 1 test in this set');
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2RvdC9qcy9UcmFuc2Zvcm0zVGVzdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTctMjAyMywgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbi8qKlxuICogQm91bmRzMiB0ZXN0c1xuICpcbiAqIEBhdXRob3IgSm9uYXRoYW4gT2xzb24gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKiBAYXV0aG9yIFNhbSBSZWlkIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxuICovXG5cbmltcG9ydCBNYXRyaXgzLCB7IG0zIH0gZnJvbSAnLi9NYXRyaXgzLmpzJztcbmltcG9ydCBSYXkyIGZyb20gJy4vUmF5Mi5qcyc7XG5pbXBvcnQgVHJhbnNmb3JtMyBmcm9tICcuL1RyYW5zZm9ybTMuanMnO1xuaW1wb3J0IFZlY3RvcjIgZnJvbSAnLi9WZWN0b3IyLmpzJztcblxuUVVuaXQubW9kdWxlKCAnVHJhbnNmb3JtMycgKTtcblxuY29uc3QgZXBzaWxvbiA9IDFlLTc7XG5cbmZ1bmN0aW9uIGFwcHJveGltYXRlRXF1YWwoIGFzc2VydCwgYSwgYiwgbXNnICkge1xuICBhc3NlcnQub2soIE1hdGguYWJzKCBhIC0gYiApIDwgZXBzaWxvbiwgYCR7bXNnfSBleHBlY3RlZDogJHtifSwgZ290OiAke2F9YCApO1xufVxuXG5mdW5jdGlvbiBhcHByb3hpbWF0ZVJheUVxdWFsKCBhc3NlcnQsIGEsIGIsIG1zZyApIHtcbiAgYXNzZXJ0Lm9rKCBhLnBvc2l0aW9uLmVxdWFsc0Vwc2lsb24oIGIucG9zaXRpb24sIDAuMDAwMDEgKSAmJiBhLmRpcmVjdGlvbi5lcXVhbHNFcHNpbG9uKCBiLmRpcmVjdGlvbiwgMC4wMDAwMSApLCBgJHttc2d9IGV4cGVjdGVkOiAke2IudG9TdHJpbmcoKX0sIGdvdDogJHthLnRvU3RyaW5nKCl9YCApO1xufVxuXG5RVW5pdC50ZXN0KCAnUmF5MiB0cmFuc2Zvcm1zJywgYXNzZXJ0ID0+IHtcbiAgY29uc3QgdHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybTMoIG0zKCAwLCAtMiwgNSwgMywgMCwgOCwgMCwgMCwgMSApICk7XG4gIGNvbnN0IHJheSA9IG5ldyBSYXkyKCBuZXcgVmVjdG9yMiggMiwgNyApLCBuZXcgVmVjdG9yMiggLTUsIDIgKS5ub3JtYWxpemVkKCkgKTtcblxuICBjb25zdCB0cmF5ID0gdHJhbnNmb3JtLnRyYW5zZm9ybVJheTIoIHJheSApO1xuICBjb25zdCBpcmF5ID0gdHJhbnNmb3JtLmludmVyc2VSYXkyKCByYXkgKTtcblxuICBjb25zdCBiYWNrT2Zmc2V0ID0gdHJhbnNmb3JtLmludmVyc2VQb3NpdGlvbjIoIHRyYXkucG9pbnRBdERpc3RhbmNlKCAxICkgKTtcbiAgY29uc3QgYmFja1BvcyA9IHRyYW5zZm9ybS5pbnZlcnNlUG9zaXRpb24yKCB0cmF5LnBvc2l0aW9uICk7XG4gIGFzc2VydC5vayggcmF5LmRpcmVjdGlvbi5lcXVhbHNFcHNpbG9uKCBiYWNrT2Zmc2V0Lm1pbnVzKCBiYWNrUG9zICkubm9ybWFsaXplZCgpLCAwLjAwMDAxICksICd0cmFuc2Zvcm1SYXkyIHJheSBsaW5lYXJpdHknICk7XG5cbiAgY29uc3QgZm9yd2FyZE9mZnNldCA9IHRyYW5zZm9ybS50cmFuc2Zvcm1Qb3NpdGlvbjIoIGlyYXkucG9pbnRBdERpc3RhbmNlKCAxICkgKTtcbiAgY29uc3QgZm9yd2FyZFBvcyA9IHRyYW5zZm9ybS50cmFuc2Zvcm1Qb3NpdGlvbjIoIGlyYXkucG9zaXRpb24gKTtcbiAgYXNzZXJ0Lm9rKCByYXkuZGlyZWN0aW9uLmVxdWFsc0Vwc2lsb24oIGZvcndhcmRPZmZzZXQubWludXMoIGZvcndhcmRQb3MgKS5ub3JtYWxpemVkKCksIDAuMDAwMDEgKSwgJ2ludmVyc2VSYXkyIHJheSBsaW5lYXJpdHknICk7XG5cbiAgYXBwcm94aW1hdGVSYXlFcXVhbCggYXNzZXJ0LCB0cmFuc2Zvcm0uaW52ZXJzZVJheTIoIHRyYW5zZm9ybS50cmFuc2Zvcm1SYXkyKCByYXkgKSApLCByYXksICdpbnZlcnNlIGNvcnJlY3RuZXNzJyApO1xufSApO1xuXG5RVW5pdC50ZXN0KCAnVHJhbnNmb3JtIHgveScsIGFzc2VydCA9PiB7XG4gIGNvbnN0IHQgPSBuZXcgVHJhbnNmb3JtMyggbTMoIDIsIDAsIDEwLCAwLCAzLCAxLCAwLCAwLCAxICkgKTtcbiAgYXNzZXJ0LmVxdWFsKCB0LnRyYW5zZm9ybVgoIDUgKSwgMjAgKTtcbiAgYXNzZXJ0LmVxdWFsKCB0LnRyYW5zZm9ybVkoIDUgKSwgMTYgKTtcbiAgYXNzZXJ0LmVxdWFsKCB0LmludmVyc2VYKCAyMCApLCA1ICk7XG4gIGFzc2VydC5lcXVhbCggdC5pbnZlcnNlWSggMTYgKSwgNSApO1xuXG4gIGNvbnN0IHQyID0gbmV3IFRyYW5zZm9ybTMoIE1hdHJpeDMucm90YXRpb24yKCBNYXRoLlBJIC8gNiApICk7XG4gIHdpbmRvdy5hc3NlcnQgJiYgYXNzZXJ0LnRocm93cyggKCkgPT4ge1xuICAgIHQyLnRyYW5zZm9ybVgoIDUgKTtcbiAgfSApO1xuICB3aW5kb3cuYXNzZXJ0ICYmIGFzc2VydC50aHJvd3MoICgpID0+IHtcbiAgICB0Mi50cmFuc2Zvcm1ZKCA1ICk7XG4gIH0gKTtcbn0gKTtcblxuUVVuaXQudGVzdCggJ1RyYW5zZm9ybSBkZWx0YScsIGFzc2VydCA9PiB7XG4gIGNvbnN0IHQxID0gbmV3IFRyYW5zZm9ybTMoIG0zKCAyLCAxLCAwLCAtMiwgNSwgMCwgMCwgMCwgMSApICk7XG4gIGNvbnN0IHQyID0gbmV3IFRyYW5zZm9ybTMoIG0zKCAyLCAxLCA1MiwgLTIsIDUsIC02MSwgMCwgMCwgMSApICk7XG5cbiAgYXNzZXJ0Lm9rKCB0MS50cmFuc2Zvcm1EZWx0YTIoIFZlY3RvcjIuWkVSTyApLmVxdWFsc0Vwc2lsb24oIFZlY3RvcjIuWkVSTywgMWUtNyApLCAnZW5zdXJpbmcgbGluZWFyaXR5IGF0IDAsIG5vIHRyYW5zbGF0aW9uJyApO1xuICBhc3NlcnQub2soIHQyLnRyYW5zZm9ybURlbHRhMiggVmVjdG9yMi5aRVJPICkuZXF1YWxzRXBzaWxvbiggVmVjdG9yMi5aRVJPLCAxZS03ICksICdlbnN1cmluZyBsaW5lYXJpdHkgYXQgMCwgd2l0aCB0cmFuc2xhdGlvbicgKTtcblxuICBhc3NlcnQub2soIHQxLnRyYW5zZm9ybURlbHRhMiggbmV3IFZlY3RvcjIoIDIsIC0zICkgKS5lcXVhbHNFcHNpbG9uKCBuZXcgVmVjdG9yMiggMSwgLTE5ICksIDFlLTcgKSwgJ2Jhc2ljIGRlbHRhIGNoZWNrLCBubyB0cmFuc2xhdGlvbicgKTtcbiAgYXNzZXJ0Lm9rKCB0Mi50cmFuc2Zvcm1EZWx0YTIoIG5ldyBWZWN0b3IyKCAyLCAtMyApICkuZXF1YWxzRXBzaWxvbiggbmV3IFZlY3RvcjIoIDEsIC0xOSApLCAxZS03ICksICdiYXNpYyBkZWx0YSBjaGVjaywgd2l0aCB0cmFuc2xhdGlvbicgKTtcblxuICBjb25zdCB2ID0gbmV3IFZlY3RvcjIoIC03MSwgMjcgKTtcbiAgYXNzZXJ0Lm9rKCB0MS5pbnZlcnNlRGVsdGEyKCB0MS50cmFuc2Zvcm1EZWx0YTIoIHYgKSApLmVxdWFsc0Vwc2lsb24oIHYsIDFlLTcgKSwgJ2ludmVyc2UgY2hlY2ssIG5vIHRyYW5zbGF0aW9uJyApO1xuICBhc3NlcnQub2soIHQyLmludmVyc2VEZWx0YTIoIHQyLnRyYW5zZm9ybURlbHRhMiggdiApICkuZXF1YWxzRXBzaWxvbiggdiwgMWUtNyApLCAnaW52ZXJzZSBjaGVjaywgd2l0aCB0cmFuc2xhdGlvbicgKTtcbn0gKTtcblxuUVVuaXQudGVzdCggJ1RyYW5zZm9ybSBkZWx0YSB4L3knLCBhc3NlcnQgPT4ge1xuICBjb25zdCB0ID0gbmV3IFRyYW5zZm9ybTMoIG0zKCAyLCAwLCA1MiwgMCwgNSwgLTYxLCAwLCAwLCAxICkgKTtcblxuICBhcHByb3hpbWF0ZUVxdWFsKCBhc3NlcnQsIHQudHJhbnNmb3JtRGVsdGFYKCAxICksIDIsICdkZWx0YVgnICk7XG4gIGFwcHJveGltYXRlRXF1YWwoIGFzc2VydCwgdC50cmFuc2Zvcm1EZWx0YVkoIDEgKSwgNSwgJ2RlbHRhWScgKTtcblxuICBhcHByb3hpbWF0ZUVxdWFsKCBhc3NlcnQsIHQudHJhbnNmb3JtRGVsdGFYKCA3MSApLCB0LnRyYW5zZm9ybURlbHRhMiggbmV3IFZlY3RvcjIoIDcxLCAyNyApICkueCwgJ2RlbHRhWCBjaGVjayB2cyB0cmFuc2Zvcm1EZWx0YScgKTtcbiAgYXBwcm94aW1hdGVFcXVhbCggYXNzZXJ0LCB0LnRyYW5zZm9ybURlbHRhWSggMjcgKSwgdC50cmFuc2Zvcm1EZWx0YTIoIG5ldyBWZWN0b3IyKCA3MSwgMjcgKSApLnksICdkZWx0YVkgY2hlY2sgdnMgdHJhbnNmb3JtRGVsdGEnICk7XG5cbiAgY29uc3QgdiA9IG5ldyBWZWN0b3IyKCAtNzEsIDI3ICk7XG4gIGFwcHJveGltYXRlRXF1YWwoIGFzc2VydCwgdC5pbnZlcnNlRGVsdGFYKCB0LnRyYW5zZm9ybURlbHRhWCggdi54ICkgKSwgdi54LCAnaW52ZXJzZSBjaGVjayBYJyApO1xuICBhcHByb3hpbWF0ZUVxdWFsKCBhc3NlcnQsIHQuaW52ZXJzZURlbHRhWSggdC50cmFuc2Zvcm1EZWx0YVkoIHYueSApICksIHYueSwgJ2ludmVyc2UgY2hlY2sgWScgKTtcbn0gKTtcblxuUVVuaXQudGVzdCggJ1RyYW5zZm9ybSBzZXRNYXRyaXggZW5zdXJpbmcgbWF0cml4IGluc3RhbmNlIGVxdWl2YWxlbmNlJywgYXNzZXJ0ID0+IHtcbiAgY29uc3QgdCA9IG5ldyBUcmFuc2Zvcm0zKCk7XG5cbiAgY29uc3QgbSA9IHQuZ2V0TWF0cml4KCk7XG5cbiAgdC5zZXRNYXRyaXgoIG0zKCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5ICkgKTtcbiAgYXNzZXJ0LmVxdWFsKCB0LmdldE1hdHJpeCgpLCBtICk7XG4gIGFzc2VydC5lcXVhbCggdC5nZXRNYXRyaXgoKS5tMDAoKSwgMSApO1xuICBhc3NlcnQuZXF1YWwoIHQuZ2V0TWF0cml4KCkubTAxKCksIDIgKTtcbiAgdC5zZXRNYXRyaXgoIG0zKCA5LCA4LCA3LCA2LCA1LCA0LCAzLCAyLCAxICkgKTtcbiAgYXNzZXJ0LmVxdWFsKCB0LmdldE1hdHJpeCgpLCBtICk7XG4gIGFzc2VydC5lcXVhbCggdC5nZXRNYXRyaXgoKS5tMDAoKSwgOSApO1xuICBhc3NlcnQuZXF1YWwoIHQuZ2V0TWF0cml4KCkubTAxKCksIDggKTtcbn0gKTtcblxuUVVuaXQudGVzdCggJ1RyYW5zZm9ybSBldmVudCBmaXJpbmcnLCBhc3NlcnQgPT4ge1xuICBjb25zdCB0ID0gbmV3IFRyYW5zZm9ybTMoKTtcblxuICBsZXQgY291bnQgPSAwO1xuXG4gIHQuY2hhbmdlRW1pdHRlci5hZGRMaXN0ZW5lciggYXNzZXJ0ID0+IHsgY291bnQgKz0gMTsgfSApO1xuICBhc3NlcnQuZXF1YWwoIGNvdW50LCAwICk7XG4gIHQuc2V0TWF0cml4KCBNYXRyaXgzLnJvdGF0aW9uMiggTWF0aC5QSSAvIDIgKSApO1xuICBhc3NlcnQuZXF1YWwoIGNvdW50LCAxICk7XG4gIHQucHJlcGVuZCggTWF0cml4My5yb3RhdGlvbjIoIE1hdGguUEkgLyAyICkgKTtcbiAgYXNzZXJ0LmVxdWFsKCBjb3VudCwgMiApO1xuICB0LnByZXBlbmRUcmFuc2xhdGlvbiggMSwgMiApO1xuICBhc3NlcnQuZXF1YWwoIGNvdW50LCAzICk7XG4gIHQuYXBwZW5kKCBNYXRyaXgzLnJvdGF0aW9uMiggTWF0aC5QSSAvIDIgKSApO1xuICBhc3NlcnQuZXF1YWwoIGNvdW50LCA0ICk7XG59ICk7XG5cblFVbml0LnRlc3QoICdUcmFuc2Zvcm0gaW52ZXJzZSB2YWxpZGF0aW9uJywgYXNzZXJ0ID0+IHtcbiAgY29uc3QgdCA9IG5ldyBUcmFuc2Zvcm0zKCk7XG5cbiAgYXNzZXJ0Lm9rKCB0LnRyYW5zZm9ybVBvc2l0aW9uMiggbmV3IFZlY3RvcjIoIDIsIDQgKSApLmVxdWFscyggbmV3IFZlY3RvcjIoIDIsIDQgKSApICk7XG4gIGFzc2VydC5vayggdC5pbnZlcnNlUG9zaXRpb24yKCBuZXcgVmVjdG9yMiggMiwgNCApICkuZXF1YWxzKCBuZXcgVmVjdG9yMiggMiwgNCApICkgKTtcbiAgdC5nZXRNYXRyaXgoKS5zZXRUb1NjYWxlKCA0LCAyICk7XG4gIHQuaW52YWxpZGF0ZSgpO1xuICBhc3NlcnQub2soIHQudHJhbnNmb3JtUG9zaXRpb24yKCBuZXcgVmVjdG9yMiggMiwgNCApICkuZXF1YWxzKCBuZXcgVmVjdG9yMiggOCwgOCApICkgKTtcbiAgYXNzZXJ0Lm9rKCB0LmludmVyc2VQb3NpdGlvbjIoIG5ldyBWZWN0b3IyKCAyLCA0ICkgKS5lcXVhbHMoIG5ldyBWZWN0b3IyKCAwLjUsIDIgKSApICk7XG4gIHQuYXBwZW5kKCBNYXRyaXgzLnJvdGF0aW9uMiggTWF0aC5QSSAvIDIgKSApO1xuICBhc3NlcnQub2soIHQudHJhbnNmb3JtUG9zaXRpb24yKCBuZXcgVmVjdG9yMiggMiwgNCApICkuZXF1YWxzRXBzaWxvbiggbmV3IFZlY3RvcjIoIC0xNiwgNCApLCBlcHNpbG9uICkgKTtcbiAgYXNzZXJ0Lm9rKCB0LmludmVyc2VQb3NpdGlvbjIoIG5ldyBWZWN0b3IyKCAyLCA0ICkgKS5lcXVhbHNFcHNpbG9uKCBuZXcgVmVjdG9yMiggMiwgLTAuNSApLCBlcHNpbG9uICkgKTtcbn0gKTtcblxuUVVuaXQudGVzdCggJ3RyYW5zZm9ybSBjcmVhdGlvbiBhbmQgc2V0dGluZycsIGFzc2VydCA9PiB7XG4gIGNvbnN0IHQgPSBuZXcgVHJhbnNmb3JtMygpO1xuICB0LmFwcGVuZCggTWF0cml4My5yb3RhdGlvbjIoIE1hdGguUEkgKSApO1xuICBhc3NlcnQub2soIHRydWUsICdzbyB3ZSBoYXZlIGF0IGxlYXN0IDEgdGVzdCBpbiB0aGlzIHNldCcgKTtcbn0gKTsiXSwibmFtZXMiOlsiTWF0cml4MyIsIm0zIiwiUmF5MiIsIlRyYW5zZm9ybTMiLCJWZWN0b3IyIiwiUVVuaXQiLCJtb2R1bGUiLCJlcHNpbG9uIiwiYXBwcm94aW1hdGVFcXVhbCIsImFzc2VydCIsImEiLCJiIiwibXNnIiwib2siLCJNYXRoIiwiYWJzIiwiYXBwcm94aW1hdGVSYXlFcXVhbCIsInBvc2l0aW9uIiwiZXF1YWxzRXBzaWxvbiIsImRpcmVjdGlvbiIsInRvU3RyaW5nIiwidGVzdCIsInRyYW5zZm9ybSIsInJheSIsIm5vcm1hbGl6ZWQiLCJ0cmF5IiwidHJhbnNmb3JtUmF5MiIsImlyYXkiLCJpbnZlcnNlUmF5MiIsImJhY2tPZmZzZXQiLCJpbnZlcnNlUG9zaXRpb24yIiwicG9pbnRBdERpc3RhbmNlIiwiYmFja1BvcyIsIm1pbnVzIiwiZm9yd2FyZE9mZnNldCIsInRyYW5zZm9ybVBvc2l0aW9uMiIsImZvcndhcmRQb3MiLCJ0IiwiZXF1YWwiLCJ0cmFuc2Zvcm1YIiwidHJhbnNmb3JtWSIsImludmVyc2VYIiwiaW52ZXJzZVkiLCJ0MiIsInJvdGF0aW9uMiIsIlBJIiwid2luZG93IiwidGhyb3dzIiwidDEiLCJ0cmFuc2Zvcm1EZWx0YTIiLCJaRVJPIiwidiIsImludmVyc2VEZWx0YTIiLCJ0cmFuc2Zvcm1EZWx0YVgiLCJ0cmFuc2Zvcm1EZWx0YVkiLCJ4IiwieSIsImludmVyc2VEZWx0YVgiLCJpbnZlcnNlRGVsdGFZIiwibSIsImdldE1hdHJpeCIsInNldE1hdHJpeCIsIm0wMCIsIm0wMSIsImNvdW50IiwiY2hhbmdlRW1pdHRlciIsImFkZExpc3RlbmVyIiwicHJlcGVuZCIsInByZXBlbmRUcmFuc2xhdGlvbiIsImFwcGVuZCIsImVxdWFscyIsInNldFRvU2NhbGUiLCJpbnZhbGlkYXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFFdEQ7Ozs7O0NBS0MsR0FFRCxPQUFPQSxXQUFXQyxFQUFFLFFBQVEsZUFBZTtBQUMzQyxPQUFPQyxVQUFVLFlBQVk7QUFDN0IsT0FBT0MsZ0JBQWdCLGtCQUFrQjtBQUN6QyxPQUFPQyxhQUFhLGVBQWU7QUFFbkNDLE1BQU1DLE1BQU0sQ0FBRTtBQUVkLE1BQU1DLFVBQVU7QUFFaEIsU0FBU0MsaUJBQWtCQyxNQUFNLEVBQUVDLENBQUMsRUFBRUMsQ0FBQyxFQUFFQyxHQUFHO0lBQzFDSCxPQUFPSSxFQUFFLENB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