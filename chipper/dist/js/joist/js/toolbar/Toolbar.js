// Copyright 2021-2024, University of Colorado Boulder
/**
 * The Toolbar along the left edge of the screen with controls related to the sim or active screen. Currently, it
 * only contains controls related to the Voicing feature. It isn't always displayed and the user must request it
 * from the PreferencesDialog. In order to be used, both voicing AND the Toolbar must be enabled by the user.
 * Voicing can be used without this shown.
 *
 * When open, the sim will resize and shift to the right to create space. Screen bounds are adjusted so that
 * simulation components will never overlap with the Toolbar.
 *
 * @author Jesse Greenberg
 */ import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import NumberProperty from '../../../axon/js/NumberProperty.js';
import stepTimer from '../../../axon/js/stepTimer.js';
import Matrix3 from '../../../dot/js/Matrix3.js';
import { Shape } from '../../../kite/js/imports.js';
import optionize from '../../../phet-core/js/optionize.js';
import { Node, Path, Rectangle, voicingManager } from '../../../scenery/js/imports.js';
import ButtonNode from '../../../sun/js/buttons/ButtonNode.js';
import RoundPushButton from '../../../sun/js/buttons/RoundPushButton.js';
import Tandem from '../../../tandem/js/Tandem.js';
import audioManager from '../audioManager.js';
import joist from '../joist.js';
import JoistStrings from '../JoistStrings.js';
import VoicingToolbarAlertManager from './VoicingToolbarAlertManager.js';
import VoicingToolbarItem from './VoicingToolbarItem.js';
// constants
const MAX_ANIMATION_SPEED = 250; // in view coordinates per second, assuming 60 fps
const CONTENT_TOP_MARGIN = 15; // margin between top of Toolbar and contents
// constants
const openToolbarStringProperty = JoistStrings.a11y.toolbar.openToolbarStringProperty;
const closeToolbarStringProperty = JoistStrings.a11y.toolbar.closeToolbarStringProperty;
const hideToolbarStringProperty = JoistStrings.a11y.toolbar.hideToolbarStringProperty;
const showToolbarStringProperty = JoistStrings.a11y.toolbar.showToolbarStringProperty;
const toolbarShownStringProperty = JoistStrings.a11y.toolbar.toolbarShownStringProperty;
const toolbarHiddenStringProperty = JoistStrings.a11y.toolbar.toolbarHiddenStringProperty;
let Toolbar = class Toolbar extends Node {
    /**
   * Returns the width of the Toolbar that can be seen on screen. This can be any value from the full width of the
   * Toolbar to zero width, depending on whether it is open, closed, removed entirely, or animating.
   */ getDisplayedWidth() {
        return this.rightPositionProperty.value * this.layoutScale + this.openButton.width / 2;
    }
    getHiddenPosition() {
        assert && assert(typeof this.contentMargin === 'number');
        return -this.contentMargin / 2;
    }
    /**
   * Update rightDestinationPosition so that the Toolbar will animate towards opening, closing, or being removed
   * entirely from view.
   */ updateDestinationPosition() {
        if (this.isShowingProperty.value) {
            // the Toolbar is enabled and should either show all content or just the openButton
            this.rightDestinationPosition = this.openProperty.value ? this.contentWidth + this.contentMargin * 2 : this.contentMargin;
        } else {
            // no aspect of the menu should be visible
            this.rightDestinationPosition = this.getHiddenPosition();
        }
    }
    /**
   * Animated the Toolbar as it opens and closes.
   */ step(dt) {
        const distance = Math.abs(this.rightPositionProperty.value - this.rightDestinationPosition);
        if (distance !== 0) {
            const animationDistance = Math.min(distance, MAX_ANIMATION_SPEED * dt);
            const currentPosition = this.rightPositionProperty.value;
            this.rightPositionProperty.value = this.rightDestinationPosition > currentPosition ? currentPosition + animationDistance : currentPosition - animationDistance;
        }
    }
    /**
   * Layout for the Toolbar, called whenever position changes or window is resized.
   */ layout(scale, height) {
        this.layoutScale = scale;
        this.menuContent.setScaleMagnitude(scale);
        this.openButton.setScaleMagnitude(scale);
        this.backgroundRectangle.rectWidth = scale * (this.contentWidth + this.contentMargin * 2);
        this.backgroundRectangle.rectHeight = height;
        this.backgroundRectangle.right = this.rightPositionProperty.value * scale;
        this.openButton.center = this.backgroundRectangle.rightCenter;
        this.menuContent.centerTop = this.backgroundRectangle.centerTop.plusXY(0, CONTENT_TOP_MARGIN);
    }
    constructor(enabledProperty, selectedScreenProperty, lookAndFeel, providedOptions){
        var _options_tandem;
        const options = optionize()({
            // Only one instance is expected so dispose is not necessary.
            isDisposable: false,
            // pdom
            tagName: 'div',
            // phet-io
            visiblePropertyOptions: {
                phetioReadOnly: true
            }
        }, providedOptions);
        super(options), // Scale applied to the Toolbar and its contents in response to layout and window resizing.
        this.layoutScale = 1;
        this.isEnabledProperty = enabledProperty;
        this.backgroundRectangle = new Rectangle(0, 0, 0, 0, {
            fill: lookAndFeel.navigationBarFillProperty
        });
        // The Voicing toolbar is initially open unless explicitly collapsed because of a query parameter.
        this.openProperty = new BooleanProperty(!phet.chipper.queryParameters.voicingCollapseToolbar);
        this.isShowingProperty = DerivedProperty.and([
            this.isEnabledProperty,
            voicingManager.enabledProperty,
            audioManager.audioEnabledProperty
        ]);
        const voicingAlertManager = new VoicingToolbarAlertManager(selectedScreenProperty);
        this.menuContent = new VoicingToolbarItem(voicingAlertManager, lookAndFeel, {
            tandem: (_options_tandem = options.tandem) == null ? void 0 : _options_tandem.createTandem('menuContent')
        });
        // icon for the openButton
        const chevronIcon = new DoubleChevron();
        this.openButton = new RoundPushButton({
            content: chevronIcon,
            listener: ()=>this.openProperty.toggle(),
            buttonAppearanceStrategy: ButtonNode.FlatAppearanceStrategy,
            baseColor: 'lightgrey',
            // phet-io - opting out of Tandems for now
            tandem: Tandem.OPT_OUT
        });
        this.contentWidth = this.menuContent.localBounds.width;
        this.contentMargin = this.openButton.localBounds.width;
        // The position of the right edge of the backgroundRectangle in local coordinates.
        // This is what controls the position of the Toolbar as it is open/closed/removed/animating.
        this.rightPositionProperty = new NumberProperty(this.getHiddenPosition());
        // The target position for the rightPositionProperty, to support animation. In step,
        // the rightPositionProperty will be changed until the rightPositionProperty equals the rightDestinationPosition.
        this.rightDestinationPosition = 0;
        // a parent for all Nodes of the toolbar, so we can set visibility of this group internally when
        // the isShowingProperty changes
        const contentParent = new Node({
            children: [
                this.backgroundRectangle,
                this.menuContent,
                this.openButton
            ]
        });
        this.addChild(contentParent);
        // move to destination position in the animation frame
        const timerListener = (dt)=>{
            this.step(dt);
        };
        stepTimer.addListener(timerListener);
        const isOpenListener = (open, oldValue)=>{
            // rotate chevron to indicate direction of toolbar movement
            chevronIcon.matrix = open ? Matrix3.scaling(-1, 1) : Matrix3.IDENTITY;
            // when closed, menu content should be hidden from screen readers and the navigation order
            this.menuContent.pdomVisible = open;
            this.openButton.innerContent = open ? closeToolbarStringProperty : openToolbarStringProperty;
            this.openButton.voicingNameResponse = open ? hideToolbarStringProperty : showToolbarStringProperty;
            this.updateDestinationPosition();
            if (oldValue !== null) {
                const alertProperty = open ? toolbarShownStringProperty : toolbarHiddenStringProperty;
                this.openButton.voicingSpeakContextResponse({
                    contextResponse: alertProperty
                });
                this.alertDescriptionUtterance(alertProperty);
            }
        };
        this.openProperty.link(isOpenListener);
        // when shown or hidden update destination positions so it animates open or close
        const isShowingListener = (showing)=>{
            this.updateDestinationPosition();
            // when now showing, this entire toolbar should be hidden for Interactive Description, but we don't use
            // visibility directly because we want to see the Toolbar animate away
            contentParent.pdomVisible = showing;
        };
        this.isShowingProperty.link(isShowingListener);
    }
};
/**
 * The icon for the button that opens and closes the Toolbar.
 */ let DoubleChevron = class DoubleChevron extends Path {
    constructor(){
        // spacing and dimensions for the arrows
        const chevronSpacing = 8;
        const chevronWidth = 5;
        const chevronHeight = 12;
        const chevronShape = new Shape();
        for(let i = 0; i < 2; i++){
            const left = i * chevronSpacing;
            chevronShape.moveTo(left, 0);
            chevronShape.lineTo(left + chevronWidth, chevronHeight / 2);
            chevronShape.lineTo(left, chevronHeight);
        }
        super(chevronShape, {
            stroke: 'black',
            lineWidth: 3.5,
            lineCap: 'round'
        });
    }
};
joist.register('Toolbar', Toolbar);
export default Toolbar;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2pvaXN0L2pzL3Rvb2xiYXIvVG9vbGJhci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBUaGUgVG9vbGJhciBhbG9uZyB0aGUgbGVmdCBlZGdlIG9mIHRoZSBzY3JlZW4gd2l0aCBjb250cm9scyByZWxhdGVkIHRvIHRoZSBzaW0gb3IgYWN0aXZlIHNjcmVlbi4gQ3VycmVudGx5LCBpdFxuICogb25seSBjb250YWlucyBjb250cm9scyByZWxhdGVkIHRvIHRoZSBWb2ljaW5nIGZlYXR1cmUuIEl0IGlzbid0IGFsd2F5cyBkaXNwbGF5ZWQgYW5kIHRoZSB1c2VyIG11c3QgcmVxdWVzdCBpdFxuICogZnJvbSB0aGUgUHJlZmVyZW5jZXNEaWFsb2cuIEluIG9yZGVyIHRvIGJlIHVzZWQsIGJvdGggdm9pY2luZyBBTkQgdGhlIFRvb2xiYXIgbXVzdCBiZSBlbmFibGVkIGJ5IHRoZSB1c2VyLlxuICogVm9pY2luZyBjYW4gYmUgdXNlZCB3aXRob3V0IHRoaXMgc2hvd24uXG4gKlxuICogV2hlbiBvcGVuLCB0aGUgc2ltIHdpbGwgcmVzaXplIGFuZCBzaGlmdCB0byB0aGUgcmlnaHQgdG8gY3JlYXRlIHNwYWNlLiBTY3JlZW4gYm91bmRzIGFyZSBhZGp1c3RlZCBzbyB0aGF0XG4gKiBzaW11bGF0aW9uIGNvbXBvbmVudHMgd2lsbCBuZXZlciBvdmVybGFwIHdpdGggdGhlIFRvb2xiYXIuXG4gKlxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmdcbiAqL1xuXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xuaW1wb3J0IE51bWJlclByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvTnVtYmVyUHJvcGVydHkuanMnO1xuaW1wb3J0IHN0ZXBUaW1lciBmcm9tICcuLi8uLi8uLi9heG9uL2pzL3N0ZXBUaW1lci5qcyc7XG5pbXBvcnQgVFByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFByb3BlcnR5LmpzJztcbmltcG9ydCBUUmVhZE9ubHlQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL1RSZWFkT25seVByb3BlcnR5LmpzJztcbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcbmltcG9ydCBvcHRpb25pemUsIHsgRW1wdHlTZWxmT3B0aW9ucyB9IGZyb20gJy4uLy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xuaW1wb3J0IHsgTm9kZSwgTm9kZU9wdGlvbnMsIFBhdGgsIFJlY3RhbmdsZSwgdm9pY2luZ01hbmFnZXIgfSBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xuaW1wb3J0IEJ1dHRvbk5vZGUgZnJvbSAnLi4vLi4vLi4vc3VuL2pzL2J1dHRvbnMvQnV0dG9uTm9kZS5qcyc7XG5pbXBvcnQgUm91bmRQdXNoQnV0dG9uIGZyb20gJy4uLy4uLy4uL3N1bi9qcy9idXR0b25zL1JvdW5kUHVzaEJ1dHRvbi5qcyc7XG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xuaW1wb3J0IGF1ZGlvTWFuYWdlciBmcm9tICcuLi9hdWRpb01hbmFnZXIuanMnO1xuaW1wb3J0IGpvaXN0IGZyb20gJy4uL2pvaXN0LmpzJztcbmltcG9ydCBKb2lzdFN0cmluZ3MgZnJvbSAnLi4vSm9pc3RTdHJpbmdzLmpzJztcbmltcG9ydCBMb29rQW5kRmVlbCBmcm9tICcuLi9Mb29rQW5kRmVlbC5qcyc7XG5pbXBvcnQgeyBBbnlTY3JlZW4gfSBmcm9tICcuLi9TY3JlZW4uanMnO1xuaW1wb3J0IFZvaWNpbmdUb29sYmFyQWxlcnRNYW5hZ2VyIGZyb20gJy4vVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIuanMnO1xuaW1wb3J0IFZvaWNpbmdUb29sYmFySXRlbSBmcm9tICcuL1ZvaWNpbmdUb29sYmFySXRlbS5qcyc7XG5cbi8vIGNvbnN0YW50c1xuY29uc3QgTUFYX0FOSU1BVElPTl9TUEVFRCA9IDI1MDsgLy8gaW4gdmlldyBjb29yZGluYXRlcyBwZXIgc2Vjb25kLCBhc3N1bWluZyA2MCBmcHNcbmNvbnN0IENPTlRFTlRfVE9QX01BUkdJTiA9IDE1OyAvLyBtYXJnaW4gYmV0d2VlbiB0b3Agb2YgVG9vbGJhciBhbmQgY29udGVudHNcblxuLy8gY29uc3RhbnRzXG5jb25zdCBvcGVuVG9vbGJhclN0cmluZ1Byb3BlcnR5ID0gSm9pc3RTdHJpbmdzLmExMXkudG9vbGJhci5vcGVuVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xuY29uc3QgY2xvc2VUb29sYmFyU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLmNsb3NlVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xuY29uc3QgaGlkZVRvb2xiYXJTdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIuaGlkZVRvb2xiYXJTdHJpbmdQcm9wZXJ0eTtcbmNvbnN0IHNob3dUb29sYmFyU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnNob3dUb29sYmFyU3RyaW5nUHJvcGVydHk7XG5jb25zdCB0b29sYmFyU2hvd25TdHJpbmdQcm9wZXJ0eSA9IEpvaXN0U3RyaW5ncy5hMTF5LnRvb2xiYXIudG9vbGJhclNob3duU3RyaW5nUHJvcGVydHk7XG5jb25zdCB0b29sYmFySGlkZGVuU3RyaW5nUHJvcGVydHkgPSBKb2lzdFN0cmluZ3MuYTExeS50b29sYmFyLnRvb2xiYXJIaWRkZW5TdHJpbmdQcm9wZXJ0eTtcblxudHlwZSBTZWxmT3B0aW9ucyA9IEVtcHR5U2VsZk9wdGlvbnM7XG50eXBlIFRvb2xiYXJPcHRpb25zID0gRW1wdHlTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8Tm9kZU9wdGlvbnMsICdpc0Rpc3Bvc2FibGUnPjtcblxuY2xhc3MgVG9vbGJhciBleHRlbmRzIE5vZGUge1xuXG4gIC8vIFdoZXRoZXIgdGhlIFRvb2xiYXIgaXMgZW5hYmxlZCAodmlzaWJsZSB0byB0aGUgdXNlcilcbiAgcHJpdmF0ZSByZWFkb25seSBpc0VuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgLy8gdGhlIFJlY3RhbmdsZSBmb3IgdGhlIFRvb2xiYXIgdGhhdCBzdXJyb3VuZHMgYWxsIGNvbnRlbnQsIGJvdW5kcyBzZXQgb25jZVxuICAvLyBjb250ZW50IGlzIGNyZWF0ZWQgYW5kIGluIGxheW91dCB0byBmaWxsIGhlaWdodCBvZiBzY3JlZW5cbiAgcHJpdmF0ZSByZWFkb25seSBiYWNrZ3JvdW5kUmVjdGFuZ2xlOiBSZWN0YW5nbGU7XG5cbiAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSByaWdodCBlZGdlIG9mIHRoZSBiYWNrZ3JvdW5kUmVjdGFuZ2xlIGluIGxvY2FsIGNvb3JkaW5hdGVzLlxuICAvLyBUaGlzIGlzIHdoYXQgY29udHJvbHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBUb29sYmFyIGFzIGl0IGlzIG9wZW4vY2xvc2VkL3JlbW92ZWQvYW5pbWF0aW5nLlxuICBwdWJsaWMgcmVhZG9ubHkgcmlnaHRQb3NpdGlvblByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPjtcblxuICAvLyBUaGUgdGFyZ2V0IHBvc2l0aW9uIGZvciB0aGUgcmlnaHRQb3NpdGlvblByb3BlcnR5LCB0byBzdXBwb3J0IGFuaW1hdGlvbi4gSW4gc3RlcCxcbiAgLy8gdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSB3aWxsIGJlIGNoYW5nZWQgdW50aWwgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSBlcXVhbHMgdGhlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbi5cbiAgcHJpdmF0ZSByaWdodERlc3RpbmF0aW9uUG9zaXRpb246IG51bWJlcjtcblxuICAvLyBXaGV0aGVyIHRoZSBUb29sYmFyIGlzIG9wZW4gb3IgY2xvc2VkLiBUaGlzIGlzIGRpZmZlcmVudCBmcm9tIHdoZXRoZXIgb3Igbm90IGl0IGlzIHNob3dpbmcuXG4gIHByaXZhdGUgcmVhZG9ubHkgb3BlblByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XG5cbiAgLy8gIFdoZXRoZXIgdGhlIFRvb2xiYXIgaXMgc2hvd24gdG8gdGhlIHVzZXIuIEF0IHRoaXMgdGltZSxcbiAgLy8gdGhhdCBpcyB0cnVlIGlmIHRoZSB0b29sYmFyIGlzIGVuYWJsZWQsIHZvaWNpbmcgaXMgZW5hYmxlZCwgYW5kIGlmIGFsbCBhdWRpbyBpcyBlbmFibGVkLiBUaGUgVG9vbGJhciBvbmx5XG4gIC8vIGluY2x1ZGVzIGNvbnRyb2xzIHJlbGF0ZWQgdG8gYXVkaW8gKHZvaWNpbmcpIHNvIHdoZW4gYXVkaW8gaXMgZGlzYWJsZWQgdGhlcmUgaXMgbm8gbmVlZCB0byBzaG93IGl0LlxuICBwcml2YXRlIHJlYWRvbmx5IGlzU2hvd2luZ1Byb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcblxuICAvLyBTY2FsZSBhcHBsaWVkIHRvIHRoZSBUb29sYmFyIGFuZCBpdHMgY29udGVudHMgaW4gcmVzcG9uc2UgdG8gbGF5b3V0IGFuZCB3aW5kb3cgcmVzaXppbmcuXG4gIHByaXZhdGUgbGF5b3V0U2NhbGUgPSAxO1xuXG4gIC8vIENvbnRlbnRzIGZvciB0aGUgVG9vbGJhciwgY3VycmVudGx5IG9ubHkgY29udHJvbHMgcmVsYXRlZCB0byB0aGUgdm9pY2luZ1xuICAvLyBmZWF0dXJlLlxuICBwcml2YXRlIHJlYWRvbmx5IG1lbnVDb250ZW50OiBWb2ljaW5nVG9vbGJhckl0ZW07XG5cbiAgcHJpdmF0ZSByZWFkb25seSBvcGVuQnV0dG9uOiBSb3VuZFB1c2hCdXR0b247XG5cbiAgLy8gd2lkdGggb2YgY29udGVudCBmb3IgdGhlIHRvb2xiYXIgaW4gdGhlIGxvY2FsIGNvb3JkaW5hdGUgZnJhbWVcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZW50V2lkdGg6IG51bWJlcjtcblxuICAvLyBNYXJnaW4gYmV0d2VlbiB0b29sYmFyIGNvbnRlbnQgYW5kIGVkZ2Ugb2YgdGhlIGJhY2tncm91bmRSZWN0YW5nbGUsIGluIHRoZSBsb2NhbCBjb29yZGluYXRlXG4gIC8vIGZyYW1lLiBBbHNvIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSByaWdodCBwb3NpdGlvbiB3aGVuIGNsb3NlZC4gVGhpcyBpcyB0aGUgd2lkdGggb2YgdGhlIGJ1dHRvbiBzbyB0aGF0IHdoZW4gdGhlXG4gIC8vIFRvb2xiYXIgaXMgY2xvc2VkIG9ubHkgdGhlIGJ1dHRvbiBpcyBzaG93biBhbmQgYWxsIG90aGVyIGNvbnRlbnQgaXMgaGlkZGVuLlxuICBwcml2YXRlIHJlYWRvbmx5IGNvbnRlbnRNYXJnaW46IG51bWJlcjtcblxuICBwdWJsaWMgY29uc3RydWN0b3IoIGVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj4sIHNlbGVjdGVkU2NyZWVuUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PEFueVNjcmVlbj4sXG4gICAgICAgICAgICAgICAgICAgICAgbG9va0FuZEZlZWw6IExvb2tBbmRGZWVsLCBwcm92aWRlZE9wdGlvbnM/OiBUb29sYmFyT3B0aW9ucyApIHtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8VG9vbGJhck9wdGlvbnMsIFNlbGZPcHRpb25zLCBOb2RlT3B0aW9ucz4oKSgge1xuXG4gICAgICAvLyBPbmx5IG9uZSBpbnN0YW5jZSBpcyBleHBlY3RlZCBzbyBkaXNwb3NlIGlzIG5vdCBuZWNlc3NhcnkuXG4gICAgICBpc0Rpc3Bvc2FibGU6IGZhbHNlLFxuXG4gICAgICAvLyBwZG9tXG4gICAgICB0YWdOYW1lOiAnZGl2JyxcblxuICAgICAgLy8gcGhldC1pb1xuICAgICAgdmlzaWJsZVByb3BlcnR5T3B0aW9uczoge1xuICAgICAgICBwaGV0aW9SZWFkT25seTogdHJ1ZVxuICAgICAgfVxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xuXG4gICAgc3VwZXIoIG9wdGlvbnMgKTtcblxuICAgIHRoaXMuaXNFbmFibGVkUHJvcGVydHkgPSBlbmFibGVkUHJvcGVydHk7XG5cbiAgICB0aGlzLmJhY2tncm91bmRSZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKCAwLCAwLCAwLCAwLCB7XG4gICAgICBmaWxsOiBsb29rQW5kRmVlbC5uYXZpZ2F0aW9uQmFyRmlsbFByb3BlcnR5XG4gICAgfSApO1xuXG4gICAgLy8gVGhlIFZvaWNpbmcgdG9vbGJhciBpcyBpbml0aWFsbHkgb3BlbiB1bmxlc3MgZXhwbGljaXRseSBjb2xsYXBzZWQgYmVjYXVzZSBvZiBhIHF1ZXJ5IHBhcmFtZXRlci5cbiAgICB0aGlzLm9wZW5Qcm9wZXJ0eSA9IG5ldyBCb29sZWFuUHJvcGVydHkoICFwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnZvaWNpbmdDb2xsYXBzZVRvb2xiYXIgKTtcblxuICAgIHRoaXMuaXNTaG93aW5nUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkuYW5kKCBbXG4gICAgICB0aGlzLmlzRW5hYmxlZFByb3BlcnR5LFxuICAgICAgdm9pY2luZ01hbmFnZXIuZW5hYmxlZFByb3BlcnR5LFxuICAgICAgYXVkaW9NYW5hZ2VyLmF1ZGlvRW5hYmxlZFByb3BlcnR5IF0gKTtcblxuICAgIGNvbnN0IHZvaWNpbmdBbGVydE1hbmFnZXIgPSBuZXcgVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIoIHNlbGVjdGVkU2NyZWVuUHJvcGVydHkgKTtcbiAgICB0aGlzLm1lbnVDb250ZW50ID0gbmV3IFZvaWNpbmdUb29sYmFySXRlbSggdm9pY2luZ0FsZXJ0TWFuYWdlciwgbG9va0FuZEZlZWwsIHtcbiAgICAgIHRhbmRlbTogb3B0aW9ucy50YW5kZW0/LmNyZWF0ZVRhbmRlbSggJ21lbnVDb250ZW50JyApXG4gICAgfSApO1xuXG4gICAgLy8gaWNvbiBmb3IgdGhlIG9wZW5CdXR0b25cbiAgICBjb25zdCBjaGV2cm9uSWNvbiA9IG5ldyBEb3VibGVDaGV2cm9uKCk7XG5cbiAgICB0aGlzLm9wZW5CdXR0b24gPSBuZXcgUm91bmRQdXNoQnV0dG9uKCB7XG4gICAgICBjb250ZW50OiBjaGV2cm9uSWNvbixcbiAgICAgIGxpc3RlbmVyOiAoKSA9PiB0aGlzLm9wZW5Qcm9wZXJ0eS50b2dnbGUoKSxcbiAgICAgIGJ1dHRvbkFwcGVhcmFuY2VTdHJhdGVneTogQnV0dG9uTm9kZS5GbGF0QXBwZWFyYW5jZVN0cmF0ZWd5LFxuICAgICAgYmFzZUNvbG9yOiAnbGlnaHRncmV5JyxcblxuICAgICAgLy8gcGhldC1pbyAtIG9wdGluZyBvdXQgb2YgVGFuZGVtcyBmb3Igbm93XG4gICAgICB0YW5kZW06IFRhbmRlbS5PUFRfT1VUXG4gICAgfSApO1xuXG4gICAgdGhpcy5jb250ZW50V2lkdGggPSB0aGlzLm1lbnVDb250ZW50LmxvY2FsQm91bmRzLndpZHRoO1xuXG4gICAgdGhpcy5jb250ZW50TWFyZ2luID0gdGhpcy5vcGVuQnV0dG9uLmxvY2FsQm91bmRzLndpZHRoO1xuXG4gICAgLy8gVGhlIHBvc2l0aW9uIG9mIHRoZSByaWdodCBlZGdlIG9mIHRoZSBiYWNrZ3JvdW5kUmVjdGFuZ2xlIGluIGxvY2FsIGNvb3JkaW5hdGVzLlxuICAgIC8vIFRoaXMgaXMgd2hhdCBjb250cm9scyB0aGUgcG9zaXRpb24gb2YgdGhlIFRvb2xiYXIgYXMgaXQgaXMgb3Blbi9jbG9zZWQvcmVtb3ZlZC9hbmltYXRpbmcuXG4gICAgdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkgPSBuZXcgTnVtYmVyUHJvcGVydHkoIHRoaXMuZ2V0SGlkZGVuUG9zaXRpb24oKSApO1xuXG4gICAgLy8gVGhlIHRhcmdldCBwb3NpdGlvbiBmb3IgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSwgdG8gc3VwcG9ydCBhbmltYXRpb24uIEluIHN0ZXAsXG4gICAgLy8gdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSB3aWxsIGJlIGNoYW5nZWQgdW50aWwgdGhlIHJpZ2h0UG9zaXRpb25Qcm9wZXJ0eSBlcXVhbHMgdGhlIHJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbi5cbiAgICB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA9IDA7XG5cbiAgICAvLyBhIHBhcmVudCBmb3IgYWxsIE5vZGVzIG9mIHRoZSB0b29sYmFyLCBzbyB3ZSBjYW4gc2V0IHZpc2liaWxpdHkgb2YgdGhpcyBncm91cCBpbnRlcm5hbGx5IHdoZW5cbiAgICAvLyB0aGUgaXNTaG93aW5nUHJvcGVydHkgY2hhbmdlc1xuICAgIGNvbnN0IGNvbnRlbnRQYXJlbnQgPSBuZXcgTm9kZSgge1xuICAgICAgY2hpbGRyZW46IFsgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLCB0aGlzLm1lbnVDb250ZW50LCB0aGlzLm9wZW5CdXR0b24gXVxuICAgIH0gKTtcbiAgICB0aGlzLmFkZENoaWxkKCBjb250ZW50UGFyZW50ICk7XG5cbiAgICAvLyBtb3ZlIHRvIGRlc3RpbmF0aW9uIHBvc2l0aW9uIGluIHRoZSBhbmltYXRpb24gZnJhbWVcbiAgICBjb25zdCB0aW1lckxpc3RlbmVyID0gKCBkdDogbnVtYmVyICkgPT4ge1xuICAgICAgdGhpcy5zdGVwKCBkdCApO1xuICAgIH07XG4gICAgc3RlcFRpbWVyLmFkZExpc3RlbmVyKCB0aW1lckxpc3RlbmVyICk7XG5cbiAgICBjb25zdCBpc09wZW5MaXN0ZW5lciA9ICggb3BlbjogYm9vbGVhbiwgb2xkVmFsdWU6IGJvb2xlYW4gfCBudWxsICkgPT4ge1xuXG4gICAgICAvLyByb3RhdGUgY2hldnJvbiB0byBpbmRpY2F0ZSBkaXJlY3Rpb24gb2YgdG9vbGJhciBtb3ZlbWVudFxuICAgICAgY2hldnJvbkljb24ubWF0cml4ID0gb3BlbiA/IE1hdHJpeDMuc2NhbGluZyggLTEsIDEgKSA6IE1hdHJpeDMuSURFTlRJVFk7XG5cbiAgICAgIC8vIHdoZW4gY2xvc2VkLCBtZW51IGNvbnRlbnQgc2hvdWxkIGJlIGhpZGRlbiBmcm9tIHNjcmVlbiByZWFkZXJzIGFuZCB0aGUgbmF2aWdhdGlvbiBvcmRlclxuICAgICAgdGhpcy5tZW51Q29udGVudC5wZG9tVmlzaWJsZSA9IG9wZW47XG5cbiAgICAgIHRoaXMub3BlbkJ1dHRvbi5pbm5lckNvbnRlbnQgPSBvcGVuID8gY2xvc2VUb29sYmFyU3RyaW5nUHJvcGVydHkgOiBvcGVuVG9vbGJhclN0cmluZ1Byb3BlcnR5O1xuICAgICAgdGhpcy5vcGVuQnV0dG9uLnZvaWNpbmdOYW1lUmVzcG9uc2UgPSBvcGVuID8gaGlkZVRvb2xiYXJTdHJpbmdQcm9wZXJ0eSA6IHNob3dUb29sYmFyU3RyaW5nUHJvcGVydHk7XG5cbiAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb25Qb3NpdGlvbigpO1xuXG4gICAgICBpZiAoIG9sZFZhbHVlICE9PSBudWxsICkge1xuICAgICAgICBjb25zdCBhbGVydFByb3BlcnR5ID0gb3BlbiA/IHRvb2xiYXJTaG93blN0cmluZ1Byb3BlcnR5IDogdG9vbGJhckhpZGRlblN0cmluZ1Byb3BlcnR5O1xuICAgICAgICB0aGlzLm9wZW5CdXR0b24udm9pY2luZ1NwZWFrQ29udGV4dFJlc3BvbnNlKCB7XG4gICAgICAgICAgY29udGV4dFJlc3BvbnNlOiBhbGVydFByb3BlcnR5XG4gICAgICAgIH0gKTtcblxuICAgICAgICB0aGlzLmFsZXJ0RGVzY3JpcHRpb25VdHRlcmFuY2UoIGFsZXJ0UHJvcGVydHkgKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMub3BlblByb3BlcnR5LmxpbmsoIGlzT3Blbkxpc3RlbmVyICk7XG5cbiAgICAvLyB3aGVuIHNob3duIG9yIGhpZGRlbiB1cGRhdGUgZGVzdGluYXRpb24gcG9zaXRpb25zIHNvIGl0IGFuaW1hdGVzIG9wZW4gb3IgY2xvc2VcbiAgICBjb25zdCBpc1Nob3dpbmdMaXN0ZW5lciA9ICggc2hvd2luZzogYm9vbGVhbiApID0+IHtcbiAgICAgIHRoaXMudXBkYXRlRGVzdGluYXRpb25Qb3NpdGlvbigpO1xuXG4gICAgICAvLyB3aGVuIG5vdyBzaG93aW5nLCB0aGlzIGVudGlyZSB0b29sYmFyIHNob3VsZCBiZSBoaWRkZW4gZm9yIEludGVyYWN0aXZlIERlc2NyaXB0aW9uLCBidXQgd2UgZG9uJ3QgdXNlXG4gICAgICAvLyB2aXNpYmlsaXR5IGRpcmVjdGx5IGJlY2F1c2Ugd2Ugd2FudCB0byBzZWUgdGhlIFRvb2xiYXIgYW5pbWF0ZSBhd2F5XG4gICAgICBjb250ZW50UGFyZW50LnBkb21WaXNpYmxlID0gc2hvd2luZztcbiAgICB9O1xuICAgIHRoaXMuaXNTaG93aW5nUHJvcGVydHkubGluayggaXNTaG93aW5nTGlzdGVuZXIgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSB3aWR0aCBvZiB0aGUgVG9vbGJhciB0aGF0IGNhbiBiZSBzZWVuIG9uIHNjcmVlbi4gVGhpcyBjYW4gYmUgYW55IHZhbHVlIGZyb20gdGhlIGZ1bGwgd2lkdGggb2YgdGhlXG4gICAqIFRvb2xiYXIgdG8gemVybyB3aWR0aCwgZGVwZW5kaW5nIG9uIHdoZXRoZXIgaXQgaXMgb3BlbiwgY2xvc2VkLCByZW1vdmVkIGVudGlyZWx5LCBvciBhbmltYXRpbmcuXG4gICAqL1xuICBwdWJsaWMgZ2V0RGlzcGxheWVkV2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgKiB0aGlzLmxheW91dFNjYWxlICsgdGhpcy5vcGVuQnV0dG9uLndpZHRoIC8gMjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SGlkZGVuUG9zaXRpb24oKTogbnVtYmVyIHtcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCB0eXBlb2YgdGhpcy5jb250ZW50TWFyZ2luID09PSAnbnVtYmVyJyApO1xuICAgIHJldHVybiAtdGhpcy5jb250ZW50TWFyZ2luIC8gMjtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcmlnaHREZXN0aW5hdGlvblBvc2l0aW9uIHNvIHRoYXQgdGhlIFRvb2xiYXIgd2lsbCBhbmltYXRlIHRvd2FyZHMgb3BlbmluZywgY2xvc2luZywgb3IgYmVpbmcgcmVtb3ZlZFxuICAgKiBlbnRpcmVseSBmcm9tIHZpZXcuXG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZURlc3RpbmF0aW9uUG9zaXRpb24oKTogdm9pZCB7XG4gICAgaWYgKCB0aGlzLmlzU2hvd2luZ1Byb3BlcnR5LnZhbHVlICkge1xuICAgICAgLy8gdGhlIFRvb2xiYXIgaXMgZW5hYmxlZCBhbmQgc2hvdWxkIGVpdGhlciBzaG93IGFsbCBjb250ZW50IG9yIGp1c3QgdGhlIG9wZW5CdXR0b25cbiAgICAgIHRoaXMucmlnaHREZXN0aW5hdGlvblBvc2l0aW9uID0gdGhpcy5vcGVuUHJvcGVydHkudmFsdWUgPyB0aGlzLmNvbnRlbnRXaWR0aCArIHRoaXMuY29udGVudE1hcmdpbiAqIDIgOiB0aGlzLmNvbnRlbnRNYXJnaW47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gbm8gYXNwZWN0IG9mIHRoZSBtZW51IHNob3VsZCBiZSB2aXNpYmxlXG4gICAgICB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA9IHRoaXMuZ2V0SGlkZGVuUG9zaXRpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW5pbWF0ZWQgdGhlIFRvb2xiYXIgYXMgaXQgb3BlbnMgYW5kIGNsb3Nlcy5cbiAgICovXG4gIHByaXZhdGUgc3RlcCggZHQ6IG51bWJlciApOiB2b2lkIHtcbiAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguYWJzKCB0aGlzLnJpZ2h0UG9zaXRpb25Qcm9wZXJ0eS52YWx1ZSAtIHRoaXMucmlnaHREZXN0aW5hdGlvblBvc2l0aW9uICk7XG4gICAgaWYgKCBkaXN0YW5jZSAhPT0gMCApIHtcbiAgICAgIGNvbnN0IGFuaW1hdGlvbkRpc3RhbmNlID0gTWF0aC5taW4oIGRpc3RhbmNlLCBNQVhfQU5JTUFUSU9OX1NQRUVEICogZHQgKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IHRoaXMucmlnaHRQb3NpdGlvblByb3BlcnR5LnZhbHVlO1xuICAgICAgdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgPSB0aGlzLnJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiA+IGN1cnJlbnRQb3NpdGlvbiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3NpdGlvbiArIGFuaW1hdGlvbkRpc3RhbmNlIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvc2l0aW9uIC0gYW5pbWF0aW9uRGlzdGFuY2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExheW91dCBmb3IgdGhlIFRvb2xiYXIsIGNhbGxlZCB3aGVuZXZlciBwb3NpdGlvbiBjaGFuZ2VzIG9yIHdpbmRvdyBpcyByZXNpemVkLlxuICAgKi9cbiAgcHVibGljIGxheW91dCggc2NhbGU6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIgKTogdm9pZCB7XG4gICAgdGhpcy5sYXlvdXRTY2FsZSA9IHNjYWxlO1xuICAgIHRoaXMubWVudUNvbnRlbnQuc2V0U2NhbGVNYWduaXR1ZGUoIHNjYWxlICk7XG4gICAgdGhpcy5vcGVuQnV0dG9uLnNldFNjYWxlTWFnbml0dWRlKCBzY2FsZSApO1xuICAgIHRoaXMuYmFja2dyb3VuZFJlY3RhbmdsZS5yZWN0V2lkdGggPSBzY2FsZSAqICggdGhpcy5jb250ZW50V2lkdGggKyB0aGlzLmNvbnRlbnRNYXJnaW4gKiAyICk7XG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLnJlY3RIZWlnaHQgPSBoZWlnaHQ7XG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLnJpZ2h0ID0gdGhpcy5yaWdodFBvc2l0aW9uUHJvcGVydHkudmFsdWUgKiBzY2FsZTtcbiAgICB0aGlzLm9wZW5CdXR0b24uY2VudGVyID0gdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLnJpZ2h0Q2VudGVyO1xuICAgIHRoaXMubWVudUNvbnRlbnQuY2VudGVyVG9wID0gdGhpcy5iYWNrZ3JvdW5kUmVjdGFuZ2xlLmNlbnRlclRvcC5wbHVzWFkoIDAsIENPTlRFTlRfVE9QX01BUkdJTiApO1xuICB9XG59XG5cbi8qKlxuICogVGhlIGljb24gZm9yIHRoZSBidXR0b24gdGhhdCBvcGVucyBhbmQgY2xvc2VzIHRoZSBUb29sYmFyLlxuICovXG5jbGFzcyBEb3VibGVDaGV2cm9uIGV4dGVuZHMgUGF0aCB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcblxuICAgIC8vIHNwYWNpbmcgYW5kIGRpbWVuc2lvbnMgZm9yIHRoZSBhcnJvd3NcbiAgICBjb25zdCBjaGV2cm9uU3BhY2luZyA9IDg7XG4gICAgY29uc3QgY2hldnJvbldpZHRoID0gNTtcbiAgICBjb25zdCBjaGV2cm9uSGVpZ2h0ID0gMTI7XG5cbiAgICBjb25zdCBjaGV2cm9uU2hhcGUgPSBuZXcgU2hhcGUoKTtcbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCAyOyBpKysgKSB7XG4gICAgICBjb25zdCBsZWZ0ID0gaSAqIGNoZXZyb25TcGFjaW5nO1xuICAgICAgY2hldnJvblNoYXBlLm1vdmVUbyggbGVmdCwgMCApO1xuICAgICAgY2hldnJvblNoYXBlLmxpbmVUbyggbGVmdCArIGNoZXZyb25XaWR0aCwgY2hldnJvbkhlaWdodCAvIDIgKTtcbiAgICAgIGNoZXZyb25TaGFwZS5saW5lVG8oIGxlZnQsIGNoZXZyb25IZWlnaHQgKTtcbiAgICB9XG5cbiAgICBzdXBlciggY2hldnJvblNoYXBlLCB7XG4gICAgICBzdHJva2U6ICdibGFjaycsXG4gICAgICBsaW5lV2lkdGg6IDMuNSxcbiAgICAgIGxpbmVDYXA6ICdyb3VuZCdcbiAgICB9ICk7XG4gIH1cbn1cblxuam9pc3QucmVnaXN0ZXIoICdUb29sYmFyJywgVG9vbGJhciApO1xuZXhwb3J0IGRlZmF1bHQgVG9vbGJhcjsiXSwibmFtZXMiOlsiQm9vbGVhblByb3BlcnR5IiwiRGVyaXZlZFByb3BlcnR5IiwiTnVtYmVyUHJvcGVydHkiLCJzdGVwVGltZXIiLCJNYXRyaXgzIiwiU2hhcGUiLCJvcHRpb25pemUiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsInZvaWNpbmdNYW5hZ2VyIiwiQnV0dG9uTm9kZSIsIlJvdW5kUHVzaEJ1dHRvbiIsIlRhbmRlbSIsImF1ZGlvTWFuYWdlciIsImpvaXN0IiwiSm9pc3RTdHJpbmdzIiwiVm9pY2luZ1Rvb2xiYXJBbGVydE1hbmFnZXIiLCJWb2ljaW5nVG9vbGJhckl0ZW0iLCJNQVhfQU5JTUFUSU9OX1NQRUVEIiwiQ09OVEVOVF9UT1BfTUFSR0lOIiwib3BlblRvb2xiYXJTdHJpbmdQcm9wZXJ0eSIsImExMXkiLCJ0b29sYmFyIiwiY2xvc2VUb29sYmFyU3RyaW5nUHJvcGVydHkiLCJoaWRlVG9vbGJhclN0cmluZ1Byb3BlcnR5Iiwic2hvd1Rvb2xiYXJTdHJpbmdQcm9wZXJ0eSIsInRvb2xiYXJTaG93blN0cmluZ1Byb3BlcnR5IiwidG9vbGJhckhpZGRlblN0cmluZ1Byb3BlcnR5IiwiVG9vbGJhciIsImdldERpc3BsYXllZFdpZHRoIiwicmlnaHRQb3NpdGlvblByb3BlcnR5IiwidmFsdWUiLCJsYXlvdXRTY2FsZSIsIm9wZW5CdXR0b24iLCJ3aWR0aCIsImdldEhpZGRlblBvc2l0aW9uIiwiYXNzZXJ0IiwiY29udGVudE1hcmdpbiIsInVwZGF0ZURlc3RpbmF0aW9uUG9zaXRpb24iLCJpc1Nob3dpbmdQcm9wZXJ0eSIsInJpZ2h0RGVzdGluYXRpb25Qb3NpdGlvbiIsIm9wZW5Qcm9wZXJ0eSIsImNvbnRlbnRXaWR0aCIsInN0ZXAiLCJkdCIsImRpc3RhbmNlIiwiTWF0aCIsImFicyIsImFuaW1hdGlvbkRpc3RhbmNlIiwibWluIiwiY3VycmVudFBvc2l0aW9uIiwibGF5b3V0Iiwic2NhbGUiLCJoZWlnaHQiLCJtZW51Q29udGVudCIsInNldFNjYWxlTWFnbml0dWRlIiwiYmFja2dyb3VuZFJlY3RhbmdsZSIsInJlY3RXaWR0aCIsInJlY3RIZWlnaHQiLCJyaWdodCIsImNlbnRlciIsInJpZ2h0Q2VudGVyIiwiY2VudGVyVG9wIiwicGx1c1hZIiwiZW5hYmxlZFByb3BlcnR5Iiwic2VsZWN0ZWRTY3JlZW5Qcm9wZXJ0eSIsImxvb2tBbmRGZWVsIiwicHJvdmlkZWRPcHRpb25zIiwib3B0aW9ucyIsImlzRGlzcG9zYWJsZSIsInRhZ05hbWUiLCJ2aXNpYmxlUHJvcGVydHlPcHRpb25zIiwicGhldGlvUmVhZE9ubHkiLCJpc0VuYWJsZWRQcm9wZXJ0eSIsImZpbGwiLCJuYXZpZ2F0aW9uQmFyRmlsbFByb3BlcnR5IiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJ2b2ljaW5nQ29sbGFwc2VUb29sYmFyIiwiYW5kIiwiYXVkaW9FbmFibGVkUHJvcGVydHkiLCJ2b2ljaW5nQWxlcnRNYW5hZ2VyIiwidGFuZGVtIiwiY3JlYXRlVGFuZGVtIiwiY2hldnJvbkljb24iLCJEb3VibGVDaGV2cm9uIiwiY29udGVudCIsImxpc3RlbmVyIiwidG9nZ2xlIiwiYnV0dG9uQXBwZWFyYW5jZVN0cmF0ZWd5IiwiRmxhdEFwcGVhcmFuY2VTdHJhdGVneSIsImJhc2VDb2xvciIsIk9QVF9PVVQiLCJsb2NhbEJvdW5kcyIsImNvbnRlbnRQYXJlbnQiLCJjaGlsZHJlbiIsImFkZENoaWxkIiwidGltZXJMaXN0ZW5lciIsImFkZExpc3RlbmVyIiwiaXNPcGVuTGlzdGVuZXIiLCJvcGVuIiwib2xkVmFsdWUiLCJtYXRyaXgiLCJzY2FsaW5nIiwiSURFTlRJVFkiLCJwZG9tVmlzaWJsZSIsImlubmVyQ29udGVudCIsInZvaWNpbmdOYW1lUmVzcG9uc2UiLCJhbGVydFByb3BlcnR5Iiwidm9pY2luZ1NwZWFrQ29udGV4dFJlc3BvbnNlIiwiY29udGV4dFJlc3BvbnNlIiwiYWxlcnREZXNjcmlwdGlvblV0dGVyYW5jZSIsImxpbmsiLCJpc1Nob3dpbmdMaXN0ZW5lciIsInNob3dpbmciLCJjaGV2cm9uU3BhY2luZyIsImNoZXZyb25XaWR0aCIsImNoZXZyb25IZWlnaHQiLCJjaGV2cm9uU2hhcGUiLCJpIiwibGVmdCIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZSIsImxpbmVXaWR0aCIsImxpbmVDYXAiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7Ozs7Ozs7O0NBVUMsR0FFRCxPQUFPQSxxQkFBcUIsc0NBQXNDO0FBQ2xFLE9BQU9DLHFCQUFxQixzQ0FBc0M7QUFDbEUsT0FBT0Msb0JBQW9CLHFDQUFxQztBQUNoRSxPQUFPQyxlQUFlLGdDQUFnQztBQUd0RCxPQUFPQyxhQUFhLDZCQUE2QjtBQUNqRCxTQUFTQyxLQUFLLFFBQVEsOEJBQThCO0FBQ3BELE9BQU9DLGVBQXFDLHFDQUFxQztBQUVqRixTQUFTQyxJQUFJLEVBQWVDLElBQUksRUFBRUMsU0FBUyxFQUFFQyxjQUFjLFFBQVEsaUNBQWlDO0FBQ3BHLE9BQU9DLGdCQUFnQix3Q0FBd0M7QUFDL0QsT0FBT0MscUJBQXFCLDZDQUE2QztBQUN6RSxPQUFPQyxZQUFZLCtCQUErQjtBQUNsRCxPQUFPQyxrQkFBa0IscUJBQXFCO0FBQzlDLE9BQU9DLFdBQVcsY0FBYztBQUNoQyxPQUFPQyxrQkFBa0IscUJBQXFCO0FBRzlDLE9BQU9DLGdDQUFnQyxrQ0FBa0M7QUFDekUsT0FBT0Msd0JBQXdCLDBCQUEwQjtBQUV6RCxZQUFZO0FBQ1osTUFBTUMsc0JBQXNCLEtBQUssa0RBQWtEO0FBQ25GLE1BQU1DLHFCQUFxQixJQUFJLDZDQUE2QztBQUU1RSxZQUFZO0FBQ1osTUFBTUMsNEJBQTRCTCxhQUFhTSxJQUFJLENBQUNDLE9BQU8sQ0FBQ0YseUJBQXlCO0FBQ3JGLE1BQU1HLDZCQUE2QlIsYUFBYU0sSUFBSSxDQUFDQyxPQUFPLENBQUNDLDBCQUEwQjtBQUN2RixNQUFNQyw0QkFBNEJULGFBQWFNLElBQUksQ0FBQ0Ms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