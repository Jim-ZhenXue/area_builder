// Copyright 2021-2024, University of Colorado Boulder
/**
 * A manager that controls whether all audio is enabled and whether each auditory feature is enabled. Has flags that
 * indicate which auditory features are supported. Also responsible for initializing managers for sub-components
 * of the AudioManager.
 *
 * PhET uses the term "Audio" to describe the collection of all auditory features that are provided by the simulation.
 * Under "Audio" there are currently two sub-features that can be separately enabled and disabled that PhET calls
 * "Sound" and "Voicing". Illustrated below:
 *
 * "Audio" - All auditory output in the sim.
 *  - "Sound" - All sound effects and sonifications that represent the simulation.
 *    - "Extra Sound" - Additional Sounds that can be enabled separately, but may not be beneficial for all users.
 *  - "Voicing" - Spoken text that describes what is happening in the simulation.
 *
 *  Disabling Audio will mute all subcomponents. But each subcomponent can be muted separately.
 *
 * @author Jesse Greenberg
 */ import BooleanProperty from '../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../axon/js/DerivedProperty.js';
import { Display, voicingManager } from '../../scenery/js/imports.js';
import soundManager from '../../tambo/js/soundManager.js';
import isSettingPhetioStateProperty from '../../tandem/js/isSettingPhetioStateProperty.js';
import PhetioObject from '../../tandem/js/PhetioObject.js';
import Tandem from '../../tandem/js/Tandem.js';
import joist from './joist.js';
const ANY_AUDIO_SUPPORTED = phet.chipper.queryParameters.supportsVoicing || phet.chipper.queryParameters.supportsSound;
let AudioManager = class AudioManager extends PhetioObject {
    /**
   * Initialize the AudioManager and subcomponents.
   */ initialize(sim) {
        if (sim.preferencesModel.audioModel.supportsSound) {
            soundManager.initialize(sim.isConstructionCompleteProperty, this.audioEnabledProperty, sim.browserTabVisibleProperty, sim.activeProperty, isSettingPhetioStateProperty);
        }
        if (sim.preferencesModel.audioModel.supportsVoicing) {
            voicingManager.initialize(Display.userGestureEmitter, {
                // specify the Properties that control whether or not output is allowed from voicingManager
                speechAllowedProperty: new DerivedProperty([
                    sim.isConstructionCompleteProperty,
                    sim.browserTabVisibleProperty,
                    sim.activeProperty,
                    isSettingPhetioStateProperty,
                    this.audioEnabledProperty
                ], (simConstructionComplete, simVisible, simActive, simSettingPhetioState, audioEnabled)=>{
                    return simConstructionComplete && simVisible && simActive && !simSettingPhetioState && audioEnabled;
                })
            });
        }
        // If both sound and voicing are enabled, hook up a feature that will turn down the sound level when the speech
        // synthesizer is speaking.  This is called "ducking".
        if (sim.preferencesModel.audioModel.supportsSound && sim.preferencesModel.audioModel.supportsVoicing) {
            // state checking
            assert && assert(voicingManager.initialized, 'voicingManager must be initialized before ducking can be set up');
            assert && assert(soundManager.initialized, 'soundManager must be initialized before ducking can be set up');
            // Set up the ducking Property and hook it to the emitters that indicate when speaking is occurring in the voicing
            // manager.
            const duckSoundProperty = new BooleanProperty(false);
            voicingManager.startSpeakingEmitter.addListener(()=>duckSoundProperty.set(true));
            voicingManager.endSpeakingEmitter.addListener(()=>duckSoundProperty.set(false));
            // Add the ducking property to the sound manager.
            soundManager.addDuckingProperty(duckSoundProperty);
        }
    }
    constructor(tandem){
        super({
            tandem: tandem,
            phetioState: false,
            phetioDocumentation: 'Controls the simulation\'s audio features. This includes sound and voicing. For sims that ' + 'do not support these features, this element and its children can be ignored.'
        });
        this.audioEnabledProperty = new BooleanProperty(phet.chipper.queryParameters.audio === 'enabled', {
            tandem: tandem.createTandem('audioEnabledProperty'),
            phetioFeatured: true,
            phetioDocumentation: 'toggles all audio features on and off; supported only if this sim supports audio features.'
        });
        this.audioAndSoundEnabledProperty = DerivedProperty.and([
            this.audioEnabledProperty,
            soundManager.enabledProperty
        ]);
        this.audioAndVoicingEnabledProperty = DerivedProperty.and([
            this.audioEnabledProperty,
            voicingManager.enabledProperty
        ]);
        this.anySubcomponentEnabledProperty = new DerivedProperty([
            soundManager.enabledProperty,
            voicingManager.enabledProperty
        ], (soundEnabled, voicingEnabled)=>{
            return soundEnabled || voicingEnabled;
        });
        this.anyOutputEnabledProperty = new DerivedProperty([
            this.audioEnabledProperty,
            this.anySubcomponentEnabledProperty
        ], (audioEnabled, anySubcomponentEnabled)=>{
            return audioEnabled && anySubcomponentEnabled;
        });
    }
};
const audioManager = new AudioManager(ANY_AUDIO_SUPPORTED ? Tandem.GENERAL_VIEW.createTandem('audioManager') : Tandem.OPT_OUT);
joist.register('audioManager', audioManager);
export default audioManager;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2pvaXN0L2pzL2F1ZGlvTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyMS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBBIG1hbmFnZXIgdGhhdCBjb250cm9scyB3aGV0aGVyIGFsbCBhdWRpbyBpcyBlbmFibGVkIGFuZCB3aGV0aGVyIGVhY2ggYXVkaXRvcnkgZmVhdHVyZSBpcyBlbmFibGVkLiBIYXMgZmxhZ3MgdGhhdFxuICogaW5kaWNhdGUgd2hpY2ggYXVkaXRvcnkgZmVhdHVyZXMgYXJlIHN1cHBvcnRlZC4gQWxzbyByZXNwb25zaWJsZSBmb3IgaW5pdGlhbGl6aW5nIG1hbmFnZXJzIGZvciBzdWItY29tcG9uZW50c1xuICogb2YgdGhlIEF1ZGlvTWFuYWdlci5cbiAqXG4gKiBQaEVUIHVzZXMgdGhlIHRlcm0gXCJBdWRpb1wiIHRvIGRlc2NyaWJlIHRoZSBjb2xsZWN0aW9uIG9mIGFsbCBhdWRpdG9yeSBmZWF0dXJlcyB0aGF0IGFyZSBwcm92aWRlZCBieSB0aGUgc2ltdWxhdGlvbi5cbiAqIFVuZGVyIFwiQXVkaW9cIiB0aGVyZSBhcmUgY3VycmVudGx5IHR3byBzdWItZmVhdHVyZXMgdGhhdCBjYW4gYmUgc2VwYXJhdGVseSBlbmFibGVkIGFuZCBkaXNhYmxlZCB0aGF0IFBoRVQgY2FsbHNcbiAqIFwiU291bmRcIiBhbmQgXCJWb2ljaW5nXCIuIElsbHVzdHJhdGVkIGJlbG93OlxuICpcbiAqIFwiQXVkaW9cIiAtIEFsbCBhdWRpdG9yeSBvdXRwdXQgaW4gdGhlIHNpbS5cbiAqICAtIFwiU291bmRcIiAtIEFsbCBzb3VuZCBlZmZlY3RzIGFuZCBzb25pZmljYXRpb25zIHRoYXQgcmVwcmVzZW50IHRoZSBzaW11bGF0aW9uLlxuICogICAgLSBcIkV4dHJhIFNvdW5kXCIgLSBBZGRpdGlvbmFsIFNvdW5kcyB0aGF0IGNhbiBiZSBlbmFibGVkIHNlcGFyYXRlbHksIGJ1dCBtYXkgbm90IGJlIGJlbmVmaWNpYWwgZm9yIGFsbCB1c2Vycy5cbiAqICAtIFwiVm9pY2luZ1wiIC0gU3Bva2VuIHRleHQgdGhhdCBkZXNjcmliZXMgd2hhdCBpcyBoYXBwZW5pbmcgaW4gdGhlIHNpbXVsYXRpb24uXG4gKlxuICogIERpc2FibGluZyBBdWRpbyB3aWxsIG11dGUgYWxsIHN1YmNvbXBvbmVudHMuIEJ1dCBlYWNoIHN1YmNvbXBvbmVudCBjYW4gYmUgbXV0ZWQgc2VwYXJhdGVseS5cbiAqXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZ1xuICovXG5cbmltcG9ydCBCb29sZWFuUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Cb29sZWFuUHJvcGVydHkuanMnO1xuaW1wb3J0IERlcml2ZWRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL0Rlcml2ZWRQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgeyBEaXNwbGF5LCB2b2ljaW5nTWFuYWdlciB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgc291bmRNYW5hZ2VyIGZyb20gJy4uLy4uL3RhbWJvL2pzL3NvdW5kTWFuYWdlci5qcyc7XG5pbXBvcnQgaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSBmcm9tICcuLi8uLi90YW5kZW0vanMvaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgUGhldGlvT2JqZWN0IGZyb20gJy4uLy4uL3RhbmRlbS9qcy9QaGV0aW9PYmplY3QuanMnO1xuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcbmltcG9ydCBqb2lzdCBmcm9tICcuL2pvaXN0LmpzJztcbmltcG9ydCBTaW0gZnJvbSAnLi9TaW0uanMnO1xuXG5jb25zdCBBTllfQVVESU9fU1VQUE9SVEVEID0gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zdXBwb3J0c1ZvaWNpbmcgfHwgcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zdXBwb3J0c1NvdW5kO1xuXG5jbGFzcyBBdWRpb01hbmFnZXIgZXh0ZW5kcyBQaGV0aW9PYmplY3Qge1xuXG4gIC8vIFdoZXRoZXIgYWxsIGZlYXR1cmVzIGludm9sdmluZyBhdWRpbyBhcmUgZW5hYmxlZCAoaW5jbHVkaW5nIHNvdW5kLCBleHRyYSBzb3VuZCwgYW5kIHZvaWNpbmcpLiBXaGVuIGZhbHNlLFxuICAvLyBldmVyeXRoaW5nIHNob3VsZCBiZSB0b3RhbGx5IHNpbGVudC5cbiAgcHVibGljIHJlYWRvbmx5IGF1ZGlvRW5hYmxlZFByb3BlcnR5OiBCb29sZWFuUHJvcGVydHk7XG5cbiAgLy8gSW5kaWNhdGVzIHdoZW4gYm90aCBBdWRpbyBhbmQgU291bmQgYXJlIGVuYWJsZWQuIFdoZW4gZmFsc2UsIHRoZSBzb3VuZE1hbmFnZXIgd2lsbCBub3QgcHJvZHVjZSBhbnkgc291bmQuXG4gIHB1YmxpYyByZWFkb25seSBhdWRpb0FuZFNvdW5kRW5hYmxlZFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcblxuICAvLyBJbmRpY2F0ZXMgd2hlbiBib3RoIEF1ZGlvIGFuZCBWb2ljaW5nIGFyZSBlbmFibGVkLiBXaGVuIGZhbHNlLCB0aGUgdm9pY2luZ01hbmFnZXIgd2lsbCBub3QgcHJvZHVjZSBhbnkgc3BlZWNoLlxuICBwdWJsaWMgcmVhZG9ubHkgYXVkaW9BbmRWb2ljaW5nRW5hYmxlZFByb3BlcnR5OiBUUmVhZE9ubHlQcm9wZXJ0eTxib29sZWFuPjtcblxuICAvLyBJbmRpY2F0ZXMgd2hlbiBhbnkgc3ViY29tcG9uZW50IG9mIGF1ZGlvIGlzIGVuYWJsZWQuIE5vdGUgdGhpcyB3aWxsIHN0aWxsIGJlIHRydWUgd2hlbiBhdWRpbyBpcyBkaXNhYmxlZC4gSXQgaXNcbiAgLy8gb25seSBmb3Igc3ViY29tcG9uZW50cy5cbiAgcHVibGljIHJlYWRvbmx5IGFueVN1YmNvbXBvbmVudEVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgLy8gSW5kaWNhdGVzIHdoZW4gYXVkaW8gYW5kIGF0IGxlYXN0IG9uZSBvZiBpdHMgc3ViY29tcG9uZW50cyBhcmUgZW5hYmxlZC4gV2hlbiBmYWxzZSwgdGhlcmUgc2hvdWxkIGJlIG5vIGF1ZGl0b3J5IG91dHB1dC5cbiAgcHVibGljIHJlYWRvbmx5IGFueU91dHB1dEVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKCB0YW5kZW06IFRhbmRlbSApIHtcblxuICAgIHN1cGVyKCB7XG4gICAgICB0YW5kZW06IHRhbmRlbSxcbiAgICAgIHBoZXRpb1N0YXRlOiBmYWxzZSxcbiAgICAgIHBoZXRpb0RvY3VtZW50YXRpb246ICdDb250cm9scyB0aGUgc2ltdWxhdGlvblxcJ3MgYXVkaW8gZmVhdHVyZXMuIFRoaXMgaW5jbHVkZXMgc291bmQgYW5kIHZvaWNpbmcuIEZvciBzaW1zIHRoYXQgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnZG8gbm90IHN1cHBvcnQgdGhlc2UgZmVhdHVyZXMsIHRoaXMgZWxlbWVudCBhbmQgaXRzIGNoaWxkcmVuIGNhbiBiZSBpZ25vcmVkLidcbiAgICB9ICk7XG5cbiAgICB0aGlzLmF1ZGlvRW5hYmxlZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5hdWRpbyA9PT0gJ2VuYWJsZWQnLCB7XG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhdWRpb0VuYWJsZWRQcm9wZXJ0eScgKSxcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxuICAgICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ3RvZ2dsZXMgYWxsIGF1ZGlvIGZlYXR1cmVzIG9uIGFuZCBvZmY7IHN1cHBvcnRlZCBvbmx5IGlmIHRoaXMgc2ltIHN1cHBvcnRzIGF1ZGlvIGZlYXR1cmVzLidcbiAgICB9ICk7XG5cbiAgICB0aGlzLmF1ZGlvQW5kU291bmRFbmFibGVkUHJvcGVydHkgPSBEZXJpdmVkUHJvcGVydHkuYW5kKCBbIHRoaXMuYXVkaW9FbmFibGVkUHJvcGVydHksIHNvdW5kTWFuYWdlci5lbmFibGVkUHJvcGVydHkgXSApO1xuICAgIHRoaXMuYXVkaW9BbmRWb2ljaW5nRW5hYmxlZFByb3BlcnR5ID0gRGVyaXZlZFByb3BlcnR5LmFuZCggWyB0aGlzLmF1ZGlvRW5hYmxlZFByb3BlcnR5LCB2b2ljaW5nTWFuYWdlci5lbmFibGVkUHJvcGVydHkgXSApO1xuXG4gICAgdGhpcy5hbnlTdWJjb21wb25lbnRFbmFibGVkUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxuICAgICAgWyBzb3VuZE1hbmFnZXIuZW5hYmxlZFByb3BlcnR5LCB2b2ljaW5nTWFuYWdlci5lbmFibGVkUHJvcGVydHkgXSxcbiAgICAgICggc291bmRFbmFibGVkLCB2b2ljaW5nRW5hYmxlZCApID0+IHtcbiAgICAgICAgcmV0dXJuIHNvdW5kRW5hYmxlZCB8fCB2b2ljaW5nRW5hYmxlZDtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5hbnlPdXRwdXRFbmFibGVkUHJvcGVydHkgPSBuZXcgRGVyaXZlZFByb3BlcnR5KFxuICAgICAgWyB0aGlzLmF1ZGlvRW5hYmxlZFByb3BlcnR5LCB0aGlzLmFueVN1YmNvbXBvbmVudEVuYWJsZWRQcm9wZXJ0eSBdLFxuICAgICAgKCBhdWRpb0VuYWJsZWQsIGFueVN1YmNvbXBvbmVudEVuYWJsZWQgKSA9PiB7XG4gICAgICAgIHJldHVybiBhdWRpb0VuYWJsZWQgJiYgYW55U3ViY29tcG9uZW50RW5hYmxlZDtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIEF1ZGlvTWFuYWdlciBhbmQgc3ViY29tcG9uZW50cy5cbiAgICovXG4gIHB1YmxpYyBpbml0aWFsaXplKCBzaW06IFNpbSApOiB2b2lkIHtcblxuICAgIGlmICggc2ltLnByZWZlcmVuY2VzTW9kZWwuYXVkaW9Nb2RlbC5zdXBwb3J0c1NvdW5kICkge1xuICAgICAgc291bmRNYW5hZ2VyLmluaXRpYWxpemUoXG4gICAgICAgIHNpbS5pc0NvbnN0cnVjdGlvbkNvbXBsZXRlUHJvcGVydHksXG4gICAgICAgIHRoaXMuYXVkaW9FbmFibGVkUHJvcGVydHksXG4gICAgICAgIHNpbS5icm93c2VyVGFiVmlzaWJsZVByb3BlcnR5LFxuICAgICAgICBzaW0uYWN0aXZlUHJvcGVydHksXG4gICAgICAgIGlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCBzaW0ucHJlZmVyZW5jZXNNb2RlbC5hdWRpb01vZGVsLnN1cHBvcnRzVm9pY2luZyApIHtcbiAgICAgIHZvaWNpbmdNYW5hZ2VyLmluaXRpYWxpemUoIERpc3BsYXkudXNlckdlc3R1cmVFbWl0dGVyLCB7XG5cbiAgICAgICAgLy8gc3BlY2lmeSB0aGUgUHJvcGVydGllcyB0aGF0IGNvbnRyb2wgd2hldGhlciBvciBub3Qgb3V0cHV0IGlzIGFsbG93ZWQgZnJvbSB2b2ljaW5nTWFuYWdlclxuICAgICAgICBzcGVlY2hBbGxvd2VkUHJvcGVydHk6IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcbiAgICAgICAgICBzaW0uaXNDb25zdHJ1Y3Rpb25Db21wbGV0ZVByb3BlcnR5LFxuICAgICAgICAgIHNpbS5icm93c2VyVGFiVmlzaWJsZVByb3BlcnR5LFxuICAgICAgICAgIHNpbS5hY3RpdmVQcm9wZXJ0eSxcbiAgICAgICAgICBpc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5LFxuICAgICAgICAgIHRoaXMuYXVkaW9FbmFibGVkUHJvcGVydHlcbiAgICAgICAgXSwgKCBzaW1Db25zdHJ1Y3Rpb25Db21wbGV0ZSwgc2ltVmlzaWJsZSwgc2ltQWN0aXZlLCBzaW1TZXR0aW5nUGhldGlvU3RhdGUsIGF1ZGlvRW5hYmxlZCApID0+IHtcbiAgICAgICAgICByZXR1cm4gc2ltQ29uc3RydWN0aW9uQ29tcGxldGUgJiYgc2ltVmlzaWJsZSAmJiBzaW1BY3RpdmUgJiYgIXNpbVNldHRpbmdQaGV0aW9TdGF0ZSAmJiBhdWRpb0VuYWJsZWQ7XG4gICAgICAgIH0gKVxuICAgICAgfSApO1xuICAgIH1cblxuICAgIC8vIElmIGJvdGggc291bmQgYW5kIHZvaWNpbmcgYXJlIGVuYWJsZWQsIGhvb2sgdXAgYSBmZWF0dXJlIHRoYXQgd2lsbCB0dXJuIGRvd24gdGhlIHNvdW5kIGxldmVsIHdoZW4gdGhlIHNwZWVjaFxuICAgIC8vIHN5bnRoZXNpemVyIGlzIHNwZWFraW5nLiAgVGhpcyBpcyBjYWxsZWQgXCJkdWNraW5nXCIuXG4gICAgaWYgKCBzaW0ucHJlZmVyZW5jZXNNb2RlbC5hdWRpb01vZGVsLnN1cHBvcnRzU291bmQgJiYgc2ltLnByZWZlcmVuY2VzTW9kZWwuYXVkaW9Nb2RlbC5zdXBwb3J0c1ZvaWNpbmcgKSB7XG5cbiAgICAgIC8vIHN0YXRlIGNoZWNraW5nXG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCB2b2ljaW5nTWFuYWdlci5pbml0aWFsaXplZCwgJ3ZvaWNpbmdNYW5hZ2VyIG11c3QgYmUgaW5pdGlhbGl6ZWQgYmVmb3JlIGR1Y2tpbmcgY2FuIGJlIHNldCB1cCcgKTtcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHNvdW5kTWFuYWdlci5pbml0aWFsaXplZCwgJ3NvdW5kTWFuYWdlciBtdXN0IGJlIGluaXRpYWxpemVkIGJlZm9yZSBkdWNraW5nIGNhbiBiZSBzZXQgdXAnICk7XG5cbiAgICAgIC8vIFNldCB1cCB0aGUgZHVja2luZyBQcm9wZXJ0eSBhbmQgaG9vayBpdCB0byB0aGUgZW1pdHRlcnMgdGhhdCBpbmRpY2F0ZSB3aGVuIHNwZWFraW5nIGlzIG9jY3VycmluZyBpbiB0aGUgdm9pY2luZ1xuICAgICAgLy8gbWFuYWdlci5cbiAgICAgIGNvbnN0IGR1Y2tTb3VuZFByb3BlcnR5ID0gbmV3IEJvb2xlYW5Qcm9wZXJ0eSggZmFsc2UgKTtcbiAgICAgIHZvaWNpbmdNYW5hZ2VyLnN0YXJ0U3BlYWtpbmdFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiBkdWNrU291bmRQcm9wZXJ0eS5zZXQoIHRydWUgKSApO1xuICAgICAgdm9pY2luZ01hbmFnZXIuZW5kU3BlYWtpbmdFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiBkdWNrU291bmRQcm9wZXJ0eS5zZXQoIGZhbHNlICkgKTtcblxuICAgICAgLy8gQWRkIHRoZSBkdWNraW5nIHByb3BlcnR5IHRvIHRoZSBzb3VuZCBtYW5hZ2VyLlxuICAgICAgc291bmRNYW5hZ2VyLmFkZER1Y2tpbmdQcm9wZXJ0eSggZHVja1NvdW5kUHJvcGVydHkgKTtcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgYXVkaW9NYW5hZ2VyID0gbmV3IEF1ZGlvTWFuYWdlciggQU5ZX0FVRElPX1NVUFBPUlRFRCA/IFRhbmRlbS5HRU5FUkFMX1ZJRVcuY3JlYXRlVGFuZGVtKCAnYXVkaW9NYW5hZ2VyJyApIDogVGFuZGVtLk9QVF9PVVQgKTtcblxuam9pc3QucmVnaXN0ZXIoICdhdWRpb01hbmFnZXInLCBhdWRpb01hbmFnZXIgKTtcbmV4cG9ydCBkZWZhdWx0IGF1ZGlvTWFuYWdlcjsiXSwibmFtZXMiOlsiQm9vbGVhblByb3BlcnR5IiwiRGVyaXZlZFByb3BlcnR5IiwiRGlzcGxheSIsInZvaWNpbmdNYW5hZ2VyIiwic291bmRNYW5hZ2VyIiwiaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSIsIlBoZXRpb09iamVjdCIsIlRhbmRlbSIsImpvaXN0IiwiQU5ZX0FVRElPX1NVUFBPUlRFRCIsInBoZXQiLCJjaGlwcGVyIiwicXVlcnlQYXJhbWV0ZXJzIiwic3VwcG9ydHNWb2ljaW5nIiwic3VwcG9ydHNTb3VuZCIsIkF1ZGlvTWFuYWdlciIsImluaXRpYWxpemUiLCJzaW0iLCJwcmVmZXJlbmNlc01vZGVsIiwiYXVkaW9Nb2RlbCIsImlzQ29uc3RydWN0aW9uQ29tcGxldGVQcm9wZXJ0eSIsImF1ZGlvRW5hYmxlZFByb3BlcnR5IiwiYnJvd3NlclRhYlZpc2libGVQcm9wZXJ0eSIsImFjdGl2ZVByb3BlcnR5IiwidXNlckdlc3R1cmVFbWl0dGVyIiwic3BlZWNoQWxsb3dlZFByb3BlcnR5Iiwic2ltQ29uc3RydWN0aW9uQ29tcGxldGUiLCJzaW1WaXNpYmxlIiwic2ltQWN0aXZlIiwic2ltU2V0dGluZ1BoZXRpb1N0YXRlIiwiYXVkaW9FbmFibGVkIiwiYXNzZXJ0IiwiaW5pdGlhbGl6ZWQiLCJkdWNrU291bmRQcm9wZXJ0eSIsInN0YXJ0U3BlYWtpbmdFbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJzZXQiLCJlbmRTcGVha2luZ0VtaXR0ZXIiLCJhZGREdWNraW5nUHJvcGVydHkiLCJ0YW5kZW0iLCJwaGV0aW9TdGF0ZSIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJhdWRpbyIsImNyZWF0ZVRhbmRlbSIsInBoZXRpb0ZlYXR1cmVkIiwiYXVkaW9BbmRTb3VuZEVuYWJsZWRQcm9wZXJ0eSIsImFuZCIsImVuYWJsZWRQcm9wZXJ0eSIsImF1ZGlvQW5kVm9pY2luZ0VuYWJsZWRQcm9wZXJ0eSIsImFueVN1YmNvbXBvbmVudEVuYWJsZWRQcm9wZXJ0eSIsInNvdW5kRW5hYmxlZCIsInZvaWNpbmdFbmFibGVkIiwiYW55T3V0cHV0RW5hYmxlZFByb3BlcnR5IiwiYW55U3ViY29tcG9uZW50RW5hYmxlZCIsImF1ZGlvTWFuYWdlciIsIkdFTkVSQUxfVklFVyIsIk9QVF9PVVQiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7Ozs7Ozs7Ozs7Ozs7OztDQWlCQyxHQUVELE9BQU9BLHFCQUFxQixtQ0FBbUM7QUFDL0QsT0FBT0MscUJBQXFCLG1DQUFtQztBQUUvRCxTQUFTQyxPQUFPLEVBQUVDLGNBQWMsUUFBUSw4QkFBOEI7QUFDdEUsT0FBT0Msa0JBQWtCLGlDQUFpQztBQUMxRCxPQUFPQyxrQ0FBa0Msa0RBQWtEO0FBQzNGLE9BQU9DLGtC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