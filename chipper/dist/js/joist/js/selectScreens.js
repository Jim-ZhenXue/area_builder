// Copyright 2020-2024, University of Colorado Boulder
import joist from './joist.js';
/**
 * Given an array of all possible screens that a sim can have, select and order them according to the relevant query
 * parameters. This also will create a homeScreen if needed, and specify the initialScreen for startup.
 *
 * Parameters suffixed with "Provided" will be true if the that query parameter was actually in the URL, as opposed to
 * the value of the query parameter being the default.
 *
 * @author Chris Klusendorf (PhET Interactive Simulations)
 * @author Michael Kauzmann (PhET Interactive Simulations)
 * @author Sam Reid (PhET Interactive Simulations)
 *
 * @param allSimScreens - all of the screens declared by the sim, duck-typed for tests
 * @param homeScreenQueryParameter - from phet.chipper.queryParameters.homeScreen
 * @param homeScreenQueryParameterProvided
 * @param initialScreenIndex - from phet.chipper.queryParameters.initialScreen
 * @param initialScreenQueryParameterProvided
 * @param screensQueryParameter - from phet.chipper.queryParameters.screens
 * @param screensQueryParameterProvided
 * @param createHomeScreen
 * @returns - duck-typed for tests
 * @throws Error if incompatible data is provided
 */ export default function selectScreens(allSimScreens, homeScreenQueryParameter, homeScreenQueryParameterProvided, initialScreenIndex, initialScreenQueryParameterProvided, screensQueryParameter, screensQueryParameterProvided, setupScreens, createHomeScreen) {
    if (allSimScreens.length === 1 && homeScreenQueryParameterProvided && homeScreenQueryParameter) {
        gracefulAssert('homeScreen', homeScreenQueryParameter, 'cannot specify homeScreen=true for single-screen sims');
    }
    // the ordered list of sim screens for this runtime
    let selectedSimScreens = [];
    if (screensQueryParameterProvided && (!screensQueryParameter || screensQueryParameter.length === 0)) {
        gracefulAssert('screens', screensQueryParameter, '"?screens" query parameter must have screen values');
        selectedSimScreens = allSimScreens;
    }
    // If a subset of screens was specified with the `screens` query parameter, add them to selectedSimScreens. Otherwise,
    // use all of the available sim screens as the default. Note that if the value of `screens` did not pass validation
    // in QueryStringMachine, it will be reverted to its default value of `null`, so it also needs to be checked for
    // truthiness before attempting to use it. For `screens` documentation, see the schema at
    // phet.chipper.queryParameters.screens in initialize-globals.js.
    if (screensQueryParameterProvided && screensQueryParameter) {
        for(let i = 0; i < screensQueryParameter.length; i++){
            const userIndex = screensQueryParameter[i];
            const screenIndex = userIndex - 1; // screens query parameter uses 1-based indices, so convert to 0-based index
            if (screenIndex >= 0 && screenIndex < allSimScreens.length) {
                // index is valid, add screen
                selectedSimScreens.push(allSimScreens[screenIndex]);
            } else {
                // index is invalid
                gracefulAssert('screens', screensQueryParameter, `invalid value in screens query parameter: ${userIndex}`);
                selectedSimScreens = allSimScreens;
                break;
            }
        }
    } else {
        selectedSimScreens = allSimScreens;
    }
    setupScreens(selectedSimScreens);
    // Specifying ?homeScreen=false creates a simulation with no HomeScreen, and hence is incompatible with
    // ?initialScreen=0, which specifies to show the home screen. Note that the default value of initialScreen:0 is
    // ignored when there is no HomeScreen.
    if (initialScreenQueryParameterProvided && initialScreenIndex === 0 && !homeScreenQueryParameter) {
        const errorMessage = 'cannot specify initialScreen=0 when home screen is disabled with homeScreen=false';
        gracefulAssert('initialScreen', initialScreenIndex, errorMessage);
        gracefulAssert('homeScreen', homeScreenQueryParameter, errorMessage);
    }
    // For a single screen simulation (whether the simulation only declares one screen, or whether the user has specified
    // a single screen via ?screens), there is no HomeScreen, and hence ?initialScreen=0 which requests to show the
    // HomeScreen on startup should fail.
    if (initialScreenQueryParameterProvided && initialScreenIndex === 0 && selectedSimScreens.length === 1) {
        // handle gracefully when running without ?ea
        gracefulAssert('initialScreen', initialScreenIndex, 'cannot specify initialScreen=0 for single-screen sims or when only one screen is loaded with screens=n');
    }
    const screens = selectedSimScreens.slice();
    let homeScreen = null;
    // If a sim has multiple screens and the query parameter homeScreen=false is not provided, add a HomeScreen
    if (selectedSimScreens.length > 1 && homeScreenQueryParameter) {
        homeScreen = createHomeScreen(selectedSimScreens);
        screens.unshift(homeScreen);
    }
    // Initial screen is 1-indexed, but taken from the 0-index list of allSimScreens. If the initial screen index is 0, then we need to consider if there is a
    // home screen to show (which "screens" already does for us).
    let initialScreen = initialScreenIndex === 0 ? screens[0] : allSimScreens[initialScreenIndex - 1];
    if (!screens.includes(initialScreen)) {
        gracefulAssert('initialScreen', initialScreenIndex, `invalid initial screen: ${initialScreenIndex}`);
        initialScreen = screens[0];
    }
    // {boolean} indicates whether all possible screens have been created (order-independent)
    const allScreensCreated = _.isEqual(new Set(allSimScreens), new Set(selectedSimScreens)) && (allSimScreens.length > 1 ? !!homeScreen : true);
    return {
        homeScreen: homeScreen,
        initialScreen: initialScreen,
        selectedSimScreens: selectedSimScreens,
        screens: screens,
        allScreensCreated: allScreensCreated
    };
}
// handle gracefully when running without ?ea, and to support setting selectedSimScreens to default values,
// see https://github.com/phetsims/joist/issues/599
function gracefulAssert(key, value, message) {
    // handle gracefully when running without ?ea
    QueryStringMachine.addWarning(key, value, message);
    // to support expected failures in selectScreensTests.js unit tests
    assert && assert(false, message);
}
joist.register('selectScreens', selectScreens);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2pvaXN0L2pzL3NlbGVjdFNjcmVlbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMjAtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbmltcG9ydCBJbnRlbnRpb25hbEFueSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvSW50ZW50aW9uYWxBbnkuanMnO1xuaW1wb3J0IEhvbWVTY3JlZW4gZnJvbSAnLi9Ib21lU2NyZWVuLmpzJztcbmltcG9ydCBqb2lzdCBmcm9tICcuL2pvaXN0LmpzJztcbmltcG9ydCB7IEFueVNjcmVlbiB9IGZyb20gJy4vU2NyZWVuLmpzJztcblxuZXhwb3J0IHR5cGUgU2NyZWVuUmV0dXJuVHlwZSA9IHtcbiAgaG9tZVNjcmVlbjogSG9tZVNjcmVlbiB8IG51bGw7XG4gIGluaXRpYWxTY3JlZW46IEFueVNjcmVlbjtcbiAgc2VsZWN0ZWRTaW1TY3JlZW5zOiBBbnlTY3JlZW5bXTtcbiAgc2NyZWVuczogQW55U2NyZWVuW107XG4gIGFsbFNjcmVlbnNDcmVhdGVkOiBib29sZWFuO1xufTtcblxuLyoqXG4gKiBHaXZlbiBhbiBhcnJheSBvZiBhbGwgcG9zc2libGUgc2NyZWVucyB0aGF0IGEgc2ltIGNhbiBoYXZlLCBzZWxlY3QgYW5kIG9yZGVyIHRoZW0gYWNjb3JkaW5nIHRvIHRoZSByZWxldmFudCBxdWVyeVxuICogcGFyYW1ldGVycy4gVGhpcyBhbHNvIHdpbGwgY3JlYXRlIGEgaG9tZVNjcmVlbiBpZiBuZWVkZWQsIGFuZCBzcGVjaWZ5IHRoZSBpbml0aWFsU2NyZWVuIGZvciBzdGFydHVwLlxuICpcbiAqIFBhcmFtZXRlcnMgc3VmZml4ZWQgd2l0aCBcIlByb3ZpZGVkXCIgd2lsbCBiZSB0cnVlIGlmIHRoZSB0aGF0IHF1ZXJ5IHBhcmFtZXRlciB3YXMgYWN0dWFsbHkgaW4gdGhlIFVSTCwgYXMgb3Bwb3NlZCB0b1xuICogdGhlIHZhbHVlIG9mIHRoZSBxdWVyeSBwYXJhbWV0ZXIgYmVpbmcgdGhlIGRlZmF1bHQuXG4gKlxuICogQGF1dGhvciBDaHJpcyBLbHVzZW5kb3JmIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxuICogQGF1dGhvciBNaWNoYWVsIEthdXptYW5uIChQaEVUIEludGVyYWN0aXZlIFNpbXVsYXRpb25zKVxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqXG4gKiBAcGFyYW0gYWxsU2ltU2NyZWVucyAtIGFsbCBvZiB0aGUgc2NyZWVucyBkZWNsYXJlZCBieSB0aGUgc2ltLCBkdWNrLXR5cGVkIGZvciB0ZXN0c1xuICogQHBhcmFtIGhvbWVTY3JlZW5RdWVyeVBhcmFtZXRlciAtIGZyb20gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5ob21lU2NyZWVuXG4gKiBAcGFyYW0gaG9tZVNjcmVlblF1ZXJ5UGFyYW1ldGVyUHJvdmlkZWRcbiAqIEBwYXJhbSBpbml0aWFsU2NyZWVuSW5kZXggLSBmcm9tIHBoZXQuY2hpcHBlci5xdWVyeVBhcmFtZXRlcnMuaW5pdGlhbFNjcmVlblxuICogQHBhcmFtIGluaXRpYWxTY3JlZW5RdWVyeVBhcmFtZXRlclByb3ZpZGVkXG4gKiBAcGFyYW0gc2NyZWVuc1F1ZXJ5UGFyYW1ldGVyIC0gZnJvbSBwaGV0LmNoaXBwZXIucXVlcnlQYXJhbWV0ZXJzLnNjcmVlbnNcbiAqIEBwYXJhbSBzY3JlZW5zUXVlcnlQYXJhbWV0ZXJQcm92aWRlZFxuICogQHBhcmFtIGNyZWF0ZUhvbWVTY3JlZW5cbiAqIEByZXR1cm5zIC0gZHVjay10eXBlZCBmb3IgdGVzdHNcbiAqIEB0aHJvd3MgRXJyb3IgaWYgaW5jb21wYXRpYmxlIGRhdGEgaXMgcHJvdmlkZWRcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc2VsZWN0U2NyZWVucyggYWxsU2ltU2NyZWVuczogQW55U2NyZWVuW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXI6IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXJQcm92aWRlZDogYm9vbGVhbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxTY3JlZW5JbmRleDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFNjcmVlblF1ZXJ5UGFyYW1ldGVyUHJvdmlkZWQ6IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5zUXVlcnlQYXJhbWV0ZXI6IG51bWJlcltdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyZWVuc1F1ZXJ5UGFyYW1ldGVyUHJvdmlkZWQ6IGJvb2xlYW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR1cFNjcmVlbnM6ICggc2NyZWVuczogQW55U2NyZWVuW10gKSA9PiB2b2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlSG9tZVNjcmVlbjogKCBzY3JlZW5zOiBBbnlTY3JlZW5bXSApID0+IEhvbWVTY3JlZW4gKTogU2NyZWVuUmV0dXJuVHlwZSB7XG5cbiAgaWYgKCBhbGxTaW1TY3JlZW5zLmxlbmd0aCA9PT0gMSAmJiBob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXJQcm92aWRlZCAmJiBob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXIgKSB7XG4gICAgZ3JhY2VmdWxBc3NlcnQoICdob21lU2NyZWVuJywgaG9tZVNjcmVlblF1ZXJ5UGFyYW1ldGVyLCAnY2Fubm90IHNwZWNpZnkgaG9tZVNjcmVlbj10cnVlIGZvciBzaW5nbGUtc2NyZWVuIHNpbXMnICk7XG4gIH1cblxuICAvLyB0aGUgb3JkZXJlZCBsaXN0IG9mIHNpbSBzY3JlZW5zIGZvciB0aGlzIHJ1bnRpbWVcbiAgbGV0IHNlbGVjdGVkU2ltU2NyZWVuczogQW55U2NyZWVuW10gPSBbXTtcblxuICBpZiAoIHNjcmVlbnNRdWVyeVBhcmFtZXRlclByb3ZpZGVkICYmICggIXNjcmVlbnNRdWVyeVBhcmFtZXRlciB8fCBzY3JlZW5zUXVlcnlQYXJhbWV0ZXIubGVuZ3RoID09PSAwICkgKSB7XG4gICAgZ3JhY2VmdWxBc3NlcnQoICdzY3JlZW5zJywgc2NyZWVuc1F1ZXJ5UGFyYW1ldGVyLCAnXCI/c2NyZWVuc1wiIHF1ZXJ5IHBhcmFtZXRlciBtdXN0IGhhdmUgc2NyZWVuIHZhbHVlcycgKTtcbiAgICBzZWxlY3RlZFNpbVNjcmVlbnMgPSBhbGxTaW1TY3JlZW5zO1xuICB9XG5cbiAgLy8gSWYgYSBzdWJzZXQgb2Ygc2NyZWVucyB3YXMgc3BlY2lmaWVkIHdpdGggdGhlIGBzY3JlZW5zYCBxdWVyeSBwYXJhbWV0ZXIsIGFkZCB0aGVtIHRvIHNlbGVjdGVkU2ltU2NyZWVucy4gT3RoZXJ3aXNlLFxuICAvLyB1c2UgYWxsIG9mIHRoZSBhdmFpbGFibGUgc2ltIHNjcmVlbnMgYXMgdGhlIGRlZmF1bHQuIE5vdGUgdGhhdCBpZiB0aGUgdmFsdWUgb2YgYHNjcmVlbnNgIGRpZCBub3QgcGFzcyB2YWxpZGF0aW9uXG4gIC8vIGluIFF1ZXJ5U3RyaW5nTWFjaGluZSwgaXQgd2lsbCBiZSByZXZlcnRlZCB0byBpdHMgZGVmYXVsdCB2YWx1ZSBvZiBgbnVsbGAsIHNvIGl0IGFsc28gbmVlZHMgdG8gYmUgY2hlY2tlZCBmb3JcbiAgLy8gdHJ1dGhpbmVzcyBiZWZvcmUgYXR0ZW1wdGluZyB0byB1c2UgaXQuIEZvciBgc2NyZWVuc2AgZG9jdW1lbnRhdGlvbiwgc2VlIHRoZSBzY2hlbWEgYXRcbiAgLy8gcGhldC5jaGlwcGVyLnF1ZXJ5UGFyYW1ldGVycy5zY3JlZW5zIGluIGluaXRpYWxpemUtZ2xvYmFscy5qcy5cbiAgaWYgKCBzY3JlZW5zUXVlcnlQYXJhbWV0ZXJQcm92aWRlZCAmJiBzY3JlZW5zUXVlcnlQYXJhbWV0ZXIgKSB7XG5cbiAgICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBzY3JlZW5zUXVlcnlQYXJhbWV0ZXIubGVuZ3RoOyBpKysgKSB7XG5cbiAgICAgIGNvbnN0IHVzZXJJbmRleCA9IHNjcmVlbnNRdWVyeVBhcmFtZXRlclsgaSBdO1xuICAgICAgY29uc3Qgc2NyZWVuSW5kZXggPSB1c2VySW5kZXggLSAxOyAvLyBzY3JlZW5zIHF1ZXJ5IHBhcmFtZXRlciB1c2VzIDEtYmFzZWQgaW5kaWNlcywgc28gY29udmVydCB0byAwLWJhc2VkIGluZGV4XG5cbiAgICAgIGlmICggc2NyZWVuSW5kZXggPj0gMCAmJiBzY3JlZW5JbmRleCA8IGFsbFNpbVNjcmVlbnMubGVuZ3RoICkge1xuXG4gICAgICAgIC8vIGluZGV4IGlzIHZhbGlkLCBhZGQgc2NyZWVuXG4gICAgICAgIHNlbGVjdGVkU2ltU2NyZWVucy5wdXNoKCBhbGxTaW1TY3JlZW5zWyBzY3JlZW5JbmRleCBdICk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcblxuICAgICAgICAvLyBpbmRleCBpcyBpbnZhbGlkXG4gICAgICAgIGdyYWNlZnVsQXNzZXJ0KCAnc2NyZWVucycsIHNjcmVlbnNRdWVyeVBhcmFtZXRlciwgYGludmFsaWQgdmFsdWUgaW4gc2NyZWVucyBxdWVyeSBwYXJhbWV0ZXI6ICR7dXNlckluZGV4fWAgKTtcbiAgICAgICAgc2VsZWN0ZWRTaW1TY3JlZW5zID0gYWxsU2ltU2NyZWVucztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIHNlbGVjdGVkU2ltU2NyZWVucyA9IGFsbFNpbVNjcmVlbnM7XG4gIH1cblxuICBzZXR1cFNjcmVlbnMoIHNlbGVjdGVkU2ltU2NyZWVucyApO1xuXG4gIC8vIFNwZWNpZnlpbmcgP2hvbWVTY3JlZW49ZmFsc2UgY3JlYXRlcyBhIHNpbXVsYXRpb24gd2l0aCBubyBIb21lU2NyZWVuLCBhbmQgaGVuY2UgaXMgaW5jb21wYXRpYmxlIHdpdGhcbiAgLy8gP2luaXRpYWxTY3JlZW49MCwgd2hpY2ggc3BlY2lmaWVzIHRvIHNob3cgdGhlIGhvbWUgc2NyZWVuLiBOb3RlIHRoYXQgdGhlIGRlZmF1bHQgdmFsdWUgb2YgaW5pdGlhbFNjcmVlbjowIGlzXG4gIC8vIGlnbm9yZWQgd2hlbiB0aGVyZSBpcyBubyBIb21lU2NyZWVuLlxuICBpZiAoIGluaXRpYWxTY3JlZW5RdWVyeVBhcmFtZXRlclByb3ZpZGVkICYmIGluaXRpYWxTY3JlZW5JbmRleCA9PT0gMCAmJiAhaG9tZVNjcmVlblF1ZXJ5UGFyYW1ldGVyICkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9ICdjYW5ub3Qgc3BlY2lmeSBpbml0aWFsU2NyZWVuPTAgd2hlbiBob21lIHNjcmVlbiBpcyBkaXNhYmxlZCB3aXRoIGhvbWVTY3JlZW49ZmFsc2UnO1xuXG4gICAgZ3JhY2VmdWxBc3NlcnQoICdpbml0aWFsU2NyZWVuJywgaW5pdGlhbFNjcmVlbkluZGV4LCBlcnJvck1lc3NhZ2UgKTtcbiAgICBncmFjZWZ1bEFzc2VydCggJ2hvbWVTY3JlZW4nLCBob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXIsIGVycm9yTWVzc2FnZSApO1xuICB9XG5cbiAgLy8gRm9yIGEgc2luZ2xlIHNjcmVlbiBzaW11bGF0aW9uICh3aGV0aGVyIHRoZSBzaW11bGF0aW9uIG9ubHkgZGVjbGFyZXMgb25lIHNjcmVlbiwgb3Igd2hldGhlciB0aGUgdXNlciBoYXMgc3BlY2lmaWVkXG4gIC8vIGEgc2luZ2xlIHNjcmVlbiB2aWEgP3NjcmVlbnMpLCB0aGVyZSBpcyBubyBIb21lU2NyZWVuLCBhbmQgaGVuY2UgP2luaXRpYWxTY3JlZW49MCB3aGljaCByZXF1ZXN0cyB0byBzaG93IHRoZVxuICAvLyBIb21lU2NyZWVuIG9uIHN0YXJ0dXAgc2hvdWxkIGZhaWwuXG4gIGlmICggaW5pdGlhbFNjcmVlblF1ZXJ5UGFyYW1ldGVyUHJvdmlkZWQgJiYgaW5pdGlhbFNjcmVlbkluZGV4ID09PSAwICYmIHNlbGVjdGVkU2ltU2NyZWVucy5sZW5ndGggPT09IDEgKSB7XG5cbiAgICAvLyBoYW5kbGUgZ3JhY2VmdWxseSB3aGVuIHJ1bm5pbmcgd2l0aG91dCA/ZWFcbiAgICBncmFjZWZ1bEFzc2VydCggJ2luaXRpYWxTY3JlZW4nLCBpbml0aWFsU2NyZWVuSW5kZXgsXG4gICAgICAnY2Fubm90IHNwZWNpZnkgaW5pdGlhbFNjcmVlbj0wIGZvciBzaW5nbGUtc2NyZWVuIHNpbXMgb3Igd2hlbiBvbmx5IG9uZSBzY3JlZW4gaXMgbG9hZGVkIHdpdGggc2NyZWVucz1uJyApO1xuICB9XG5cbiAgY29uc3Qgc2NyZWVucyA9IHNlbGVjdGVkU2ltU2NyZWVucy5zbGljZSgpO1xuXG4gIGxldCBob21lU2NyZWVuID0gbnVsbDtcblxuICAvLyBJZiBhIHNpbSBoYXMgbXVsdGlwbGUgc2NyZWVucyBhbmQgdGhlIHF1ZXJ5IHBhcmFtZXRlciBob21lU2NyZWVuPWZhbHNlIGlzIG5vdCBwcm92aWRlZCwgYWRkIGEgSG9tZVNjcmVlblxuICBpZiAoIHNlbGVjdGVkU2ltU2NyZWVucy5sZW5ndGggPiAxICYmIGhvbWVTY3JlZW5RdWVyeVBhcmFtZXRlciApIHtcbiAgICBob21lU2NyZWVuID0gY3JlYXRlSG9tZVNjcmVlbiggc2VsZWN0ZWRTaW1TY3JlZW5zICk7XG4gICAgc2NyZWVucy51bnNoaWZ0KCBob21lU2NyZWVuICk7XG4gIH1cblxuICAvLyBJbml0aWFsIHNjcmVlbiBpcyAxLWluZGV4ZWQsIGJ1dCB0YWtlbiBmcm9tIHRoZSAwLWluZGV4IGxpc3Qgb2YgYWxsU2ltU2NyZWVucy4gSWYgdGhlIGluaXRpYWwgc2NyZWVuIGluZGV4IGlzIDAsIHRoZW4gd2UgbmVlZCB0byBjb25zaWRlciBpZiB0aGVyZSBpcyBhXG4gIC8vIGhvbWUgc2NyZWVuIHRvIHNob3cgKHdoaWNoIFwic2NyZWVuc1wiIGFscmVhZHkgZG9lcyBmb3IgdXMpLlxuICBsZXQgaW5pdGlhbFNjcmVlbiA9IGluaXRpYWxTY3JlZW5JbmRleCA9PT0gMCA/IHNjcmVlbnNbIDAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGFsbFNpbVNjcmVlbnNbIGluaXRpYWxTY3JlZW5JbmRleCAtIDEgXTtcblxuICBpZiAoICFzY3JlZW5zLmluY2x1ZGVzKCBpbml0aWFsU2NyZWVuICkgKSB7XG4gICAgZ3JhY2VmdWxBc3NlcnQoICdpbml0aWFsU2NyZWVuJywgaW5pdGlhbFNjcmVlbkluZGV4LCBgaW52YWxpZCBpbml0aWFsIHNjcmVlbjogJHtpbml0aWFsU2NyZWVuSW5kZXh9YCApO1xuICAgIGluaXRpYWxTY3JlZW4gPSBzY3JlZW5zWyAwIF07XG4gIH1cblxuICAvLyB7Ym9vbGVhbn0gaW5kaWNhdGVzIHdoZXRoZXIgYWxsIHBvc3NpYmxlIHNjcmVlbnMgaGF2ZSBiZWVuIGNyZWF0ZWQgKG9yZGVyLWluZGVwZW5kZW50KVxuICBjb25zdCBhbGxTY3JlZW5zQ3JlYXRlZCA9IF8uaXNFcXVhbCggbmV3IFNldCggYWxsU2ltU2NyZWVucyApLCBuZXcgU2V0KCBzZWxlY3RlZFNpbVNjcmVlbnMgKSApICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKCBhbGxTaW1TY3JlZW5zLmxlbmd0aCA+IDEgPyAhIWhvbWVTY3JlZW4gOiB0cnVlICk7XG4gIHJldHVybiB7XG4gICAgaG9tZVNjcmVlbjogaG9tZVNjcmVlbixcbiAgICBpbml0aWFsU2NyZWVuOiBpbml0aWFsU2NyZWVuLFxuICAgIHNlbGVjdGVkU2ltU2NyZWVuczogc2VsZWN0ZWRTaW1TY3JlZW5zLFxuICAgIHNjcmVlbnM6IHNjcmVlbnMsXG4gICAgYWxsU2NyZWVuc0NyZWF0ZWQ6IGFsbFNjcmVlbnNDcmVhdGVkXG4gIH07XG59XG5cbi8vIGhhbmRsZSBncmFjZWZ1bGx5IHdoZW4gcnVubmluZyB3aXRob3V0ID9lYSwgYW5kIHRvIHN1cHBvcnQgc2V0dGluZyBzZWxlY3RlZFNpbVNjcmVlbnMgdG8gZGVmYXVsdCB2YWx1ZXMsXG4vLyBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL2pvaXN0L2lzc3Vlcy81OTlcbmZ1bmN0aW9uIGdyYWNlZnVsQXNzZXJ0KCBrZXk6IHN0cmluZywgdmFsdWU6IEludGVudGlvbmFsQW55LCBtZXNzYWdlOiBzdHJpbmcgKTogdm9pZCB7XG5cbiAgLy8gaGFuZGxlIGdyYWNlZnVsbHkgd2hlbiBydW5uaW5nIHdpdGhvdXQgP2VhXG4gIFF1ZXJ5U3RyaW5nTWFjaGluZS5hZGRXYXJuaW5nKCBrZXksIHZhbHVlLCBtZXNzYWdlICk7XG5cbiAgLy8gdG8gc3VwcG9ydCBleHBlY3RlZCBmYWlsdXJlcyBpbiBzZWxlY3RTY3JlZW5zVGVzdHMuanMgdW5pdCB0ZXN0c1xuICBhc3NlcnQgJiYgYXNzZXJ0KCBmYWxzZSwgbWVzc2FnZSApO1xufVxuXG5qb2lzdC5yZWdpc3RlciggJ3NlbGVjdFNjcmVlbnMnLCBzZWxlY3RTY3JlZW5zICk7Il0sIm5hbWVzIjpbImpvaXN0Iiwic2VsZWN0U2NyZWVucyIsImFsbFNpbVNjcmVlbnMiLCJob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXIiLCJob21lU2NyZWVuUXVlcnlQYXJhbWV0ZXJQcm92aWRlZCIsImluaXRpYWxTY3JlZW5JbmRleCIsImluaXRpYWxTY3JlZW5RdWVyeVBhcmFtZXRlclByb3ZpZGVkIiwic2NyZWVuc1F1ZXJ5UGFyYW1ldGVyIiwic2NyZWVuc1F1ZXJ5UGFyYW1ldGVyUHJvdmlkZWQiLCJzZXR1cFNjcmVlbnMiLCJjcmVhdGVIb21lU2NyZWVuIiwibGVuZ3RoIiwiZ3JhY2VmdWxBc3NlcnQiLCJzZWxlY3RlZFNpbVNjcmVlbnMiLCJpIiwidXNlckluZGV4Iiwic2NyZWVuSW5kZXgiLCJwdXNoIiwiZXJyb3JNZXNzYWdlIiwic2NyZWVucyIsInNsaWNlIiwiaG9tZVNjcmVlbiIsInVuc2hpZnQiLCJpbml0aWFsU2NyZWVuIiwiaW5jbHVkZXMiLCJhbGxTY3JlZW5zQ3JlYXRlZCIsIl8iLCJpc0VxdWFsIiwiU2V0Iiwia2V5IiwidmFsdWUiLCJtZXNzYWdlIiwi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