// Copyright 2018-2024, University of Colorado Boulder
/**
 * SoundGenerator is an abstract base class for Web-Audio-based sound-producing elements that work in conjunction with
 * the soundManager to produces sounds.
 *
 * @author John Blanco (PhET Interactive Simulations)
 */ import BooleanProperty from '../../../axon/js/BooleanProperty.js';
import DerivedProperty from '../../../axon/js/DerivedProperty.js';
import EnabledComponent from '../../../axon/js/EnabledComponent.js';
import optionize from '../../../phet-core/js/optionize.js';
import ResetAllButton from '../../../scenery-phet/js/buttons/ResetAllButton.js';
import { DisplayedProperty } from '../../../scenery/js/imports.js';
import isSettingPhetioStateProperty from '../../../tandem/js/isSettingPhetioStateProperty.js';
import phetAudioContext from '../phetAudioContext.js';
import soundConstants from '../soundConstants.js';
import SoundLevelEnum from '../SoundLevelEnum.js';
import soundManager from '../soundManager.js';
import tambo from '../tambo.js';
// constants
const DEFAULT_TIME_CONSTANT = soundConstants.DEFAULT_PARAM_CHANGE_TIME_CONSTANT;
let SoundGenerator = class SoundGenerator extends EnabledComponent {
    /**
   * Connect the sound generator to an audio parameter.
   */ connect(audioParam) {
        this.mainGainNode.connect(audioParam);
        // Track this sound generator's connections.  This is necessary because Web Audio doesn't support checking which
        // nodes are connected to which, and we need this information when disconnecting.
        this.connectionList.push(audioParam);
    }
    /**
   * Disconnect the sound generator from an audio parameter.
   */ disconnect(audioParam) {
        this.mainGainNode.disconnect(audioParam);
        this.connectionList = _.without(this.connectionList, audioParam);
    }
    /**
   * Test if this sound generator is connected to the provided audio param.
   */ isConnectedTo(audioParam) {
        return this.connectionList.includes(audioParam);
    }
    /**
   * Sets the output level of the sound generator.
   *
   * @param outputLevel - generally between 0 and 1, but can be larger than 1 if necessary to amplify a small signal,
   *   and can be negative to invert the phase.
   * @param [timeConstant] - time constant for output level change, longer values mean slower transitions, in seconds.
   *   Note that timeConstant is NOT a fade time. It's an exponential approach to the target output level, and the argument to
   *   setTargetAtTime, documented at https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime#timeconstant
   *   The document has this suggestion for choosing the value for timeConstant: "Depending on your use case, getting
   *   95% toward the target value may already be enough; in that case, you could set timeConstant to one third of the
   *   desired duration."
   */ setOutputLevel(outputLevel, timeConstant = DEFAULT_TIME_CONSTANT) {
        // Ignore attempts to set the output level to the same value.
        if (outputLevel !== this._outputLevel) {
            const now = this.audioContext.currentTime;
            // The output level should take effect immediately if this sound generator is fully enabled.  Otherwise, the value
            // is saved and restored the next time the sound generator transitions to fully enabled.
            if (this.fullyEnabledProperty.value) {
                // Cancel any gain transitions that are currently in progress.
                this.mainGainNode.gain.cancelScheduledValues(now);
                // Set the output level on the gain node.  A different method is used for instant changes.
                if (timeConstant === 0) {
                    this.mainGainNode.gain.setValueAtTime(outputLevel, now);
                } else {
                    // The setTargetAtTime method doesn't seem to work if the audio context isn't running, and the event doesn't
                    // seem to be scheduled - it's just ignored.  So, if the audio context isn't running, use an alternative
                    // approach.  See https://github.com/phetsims/tambo/issues/74.
                    if (this.audioContext.state === 'running') {
                        this.mainGainNode.gain.setTargetAtTime(outputLevel, now, timeConstant);
                    } else {
                        this.mainGainNode.gain.linearRampToValueAtTime(outputLevel, now + soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME);
                    }
                }
            }
            // Set local copy of output level.
            this._outputLevel = outputLevel;
        }
    }
    set outputLevel(outputLevel) {
        this.setOutputLevel(outputLevel);
    }
    get outputLevel() {
        return this.getOutputLevel();
    }
    /**
   * Get the current output level setting.  Note that if the sound generator is disabled, this could return a non-zero
   * value but the sound generator won't produce audible sound.
   */ getOutputLevel() {
        return this._outputLevel;
    }
    get fullyEnabled() {
        return this.fullyEnabledProperty.value;
    }
    constructor(providedOptions){
        const options = optionize()({
            initialOutputLevel: 1,
            audioContext: phetAudioContext,
            connectImmediately: false,
            sonificationLevel: SoundLevelEnum.BASIC,
            additionalAudioNodes: [],
            associatedViewNode: null,
            enabledDuringReset: false,
            enabledDuringPhetioStateSetting: false
        }, providedOptions);
        super(options);
        this.audioContext = options.audioContext;
        this._outputLevel = options.initialOutputLevel;
        this.connectionList = [];
        this.mainGainNode = this.audioContext.createGain();
        this.mainGainNode.gain.setValueAtTime(this._outputLevel, this.audioContext.currentTime);
        // If an associated view node was specified, create a boolean Property that is true only when the node is displayed.
        const viewNodeDisplayedProperty = options.associatedViewNode ? new DisplayedProperty(options.associatedViewNode) : new BooleanProperty(true);
        // Define the property that will determine whether this sound generator should produce sound at all.
        this.fullyEnabledProperty = new DerivedProperty([
            soundManager.enabledProperty,
            this.enabledProperty,
            ResetAllButton.isResettingAllProperty,
            viewNodeDisplayedProperty,
            soundManager.extraSoundEnabledProperty,
            isSettingPhetioStateProperty
        ], (soundEnabled, enabled, isResettingAll, viewNodeDisplayed, extraSoundEnabled, isSettingPhetioState)=>soundEnabled && enabled && viewNodeDisplayed && (options.sonificationLevel === SoundLevelEnum.BASIC || extraSoundEnabled) && (!isResettingAll || options.enabledDuringReset) && (!isSettingPhetioState || options.enabledDuringPhetioStateSetting));
        // If the option specifies immediate connection, connect the main gain node to the audio context destination.
        if (options.connectImmediately) {
            this.mainGainNode.connect(this.audioContext.destination);
        }
        // Turn down the gain to zero when not fully enabled and up to the current output level when becoming fully enabled.
        this.fullyEnabledProperty.link((fullyEnabled)=>{
            const previousGainSetting = fullyEnabled ? 0 : this._outputLevel;
            const newGainSetting = fullyEnabled ? this._outputLevel : 0;
            const now = this.audioContext.currentTime;
            // For the linear ramp to work consistently on all browsers, the gain must be explicitly set to what it is
            // supposed to be before making any changes.  Otherwise, it may extrapolate from the most recent previous event.
            this.mainGainNode.gain.setValueAtTime(previousGainSetting, now);
            // Ramp the gain to the new level.
            this.mainGainNode.gain.linearRampToValueAtTime(newGainSetting, this.audioContext.currentTime + soundConstants.DEFAULT_LINEAR_GAIN_CHANGE_TIME);
        });
        this.soundSourceDestination = this.mainGainNode;
        // Insert any additional audio nodes into the signal chain by iterating backwards through the provided list.
        for(let i = options.additionalAudioNodes.length - 1; i >= 0; i--){
            const audioNode = options.additionalAudioNodes[i];
            audioNode.connect(this.soundSourceDestination);
            this.soundSourceDestination = audioNode;
        }
        // Clean up memory references when this object is disposed.
        this.disposeEmitter.addListener(()=>{
            this.fullyEnabledProperty.dispose();
        });
    }
};
tambo.register('SoundGenerator', SoundGenerator);
export default SoundGenerator;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3RhbWJvL2pzL3NvdW5kLWdlbmVyYXRvcnMvU291bmRHZW5lcmF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbi8qKlxuICogU291bmRHZW5lcmF0b3IgaXMgYW4gYWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgV2ViLUF1ZGlvLWJhc2VkIHNvdW5kLXByb2R1Y2luZyBlbGVtZW50cyB0aGF0IHdvcmsgaW4gY29uanVuY3Rpb24gd2l0aFxuICogdGhlIHNvdW5kTWFuYWdlciB0byBwcm9kdWNlcyBzb3VuZHMuXG4gKlxuICogQGF1dGhvciBKb2huIEJsYW5jbyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqL1xuXG5pbXBvcnQgQm9vbGVhblByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvQm9vbGVhblByb3BlcnR5LmpzJztcbmltcG9ydCBEZXJpdmVkUHJvcGVydHkgZnJvbSAnLi4vLi4vLi4vYXhvbi9qcy9EZXJpdmVkUHJvcGVydHkuanMnO1xuaW1wb3J0IEVuYWJsZWRDb21wb25lbnQsIHsgRW5hYmxlZENvbXBvbmVudE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi9heG9uL2pzL0VuYWJsZWRDb21wb25lbnQuanMnO1xuaW1wb3J0IFRSZWFkT25seVByb3BlcnR5IGZyb20gJy4uLy4uLy4uL2F4b24vanMvVFJlYWRPbmx5UHJvcGVydHkuanMnO1xuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcbmltcG9ydCBSZXNldEFsbEJ1dHRvbiBmcm9tICcuLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvYnV0dG9ucy9SZXNldEFsbEJ1dHRvbi5qcyc7XG5pbXBvcnQgeyBEaXNwbGF5ZWRQcm9wZXJ0eSwgTm9kZSB9IGZyb20gJy4uLy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eSBmcm9tICcuLi8uLi8uLi90YW5kZW0vanMvaXNTZXR0aW5nUGhldGlvU3RhdGVQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgcGhldEF1ZGlvQ29udGV4dCBmcm9tICcuLi9waGV0QXVkaW9Db250ZXh0LmpzJztcbmltcG9ydCBzb3VuZENvbnN0YW50cyBmcm9tICcuLi9zb3VuZENvbnN0YW50cy5qcyc7XG5pbXBvcnQgU291bmRMZXZlbEVudW0gZnJvbSAnLi4vU291bmRMZXZlbEVudW0uanMnO1xuaW1wb3J0IHNvdW5kTWFuYWdlciBmcm9tICcuLi9zb3VuZE1hbmFnZXIuanMnO1xuaW1wb3J0IHRhbWJvIGZyb20gJy4uL3RhbWJvLmpzJztcblxuLy8gY29uc3RhbnRzXG5jb25zdCBERUZBVUxUX1RJTUVfQ09OU1RBTlQgPSBzb3VuZENvbnN0YW50cy5ERUZBVUxUX1BBUkFNX0NIQU5HRV9USU1FX0NPTlNUQU5UO1xuXG50eXBlIFNlbGZPcHRpb25zID0ge1xuXG4gIC8vIEluaXRpYWwgdmFsdWUgZm9yIHRoZSBvdXRwdXQgbGV2ZWwuICBHZW5lcmFsbHksIHRoaXMgc2hvdWxkIGFsd2F5cyBiZSBiZXR3ZWVuIDAgYW5kIDEsIGJ1dCB2YWx1ZXMgZ3JlYXRlciB0aGFuIDFcbiAgLy8gbWF5IGJlIG5lZWRlZCBpbiBzb21lIHJhcmUgY2FzZXMgaW4gb3JkZXIgdG8gY3JlYXRlIGVub3VnaCBvdXRwdXQgdG8gYmUgYXVkaWJsZS5cbiAgaW5pdGlhbE91dHB1dExldmVsPzogbnVtYmVyO1xuXG4gIC8vIEJ5IGRlZmF1bHQsIHRoZSBzaGFyZWQgYXVkaW8gY29udGV4dCBpcyB1c2VkIHNvIHRoYXQgdGhpcyBzb3VuZCBjYW4gYmUgcmVnaXN0ZXJlZCB3aXRoIHRoZSBzb25pZmljYXRpb24gbWFuYWdlcixcbiAgLy8gYnV0IHRoaXMgY2FuIGJlIG92ZXJyaWRkZW4gaWYgZGVzaXJlZC4gIEluIGdlbmVyYWwsIG92ZXJyaWRpbmcgd2lsbCBvbmx5IGJlIGRvbmUgZm9yIHRlc3RpbmcuXG4gIGF1ZGlvQ29udGV4dD86IEF1ZGlvQ29udGV4dDtcblxuICAvLyBUaGlzIGZsYWcgY29udHJvbHMgd2hldGhlciB0aGUgb3V0cHV0IG9mIHRoaXMgc291bmQgZ2VuZXJhdG9yIGlzIGltbWVkaWF0ZWx5IGNvbm5lY3RlZCB0byB0aGUgYXVkaW8gY29udGV4dFxuICAvLyBkZXN0aW5hdGlvbi4gIFRoaXMgaXMgdXNlZnVsIGZvciB0ZXN0aW5nLCBidXQgc2hvdWxkIG5vdCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBiZWluZyB1c2VkXG4gIC8vIGluIGNvbmp1bmN0aW9uIHdpdGggdGhlIHNvdW5kIG1hbmFnZXIuXG4gIGNvbm5lY3RJbW1lZGlhdGVseT86IGJvb2xlYW47XG5cbiAgLy8gQXVkaW8gbm9kZXMgdGhhdCB3aWxsIGJlIGNvbm5lY3RlZCBpbiB0aGUgc3BlY2lmaWVkIG9yZGVyIGJldHdlZW4gdGhlIGJ1ZmZlclNvdXJjZSBhbmQgbG9jYWxHYWluTm9kZSwgdXNlZCB0b1xuICAvLyBpbnNlcnQgdGhpbmdzIGxpa2UgZmlsdGVycywgY29tcHJlc3NvcnMsIGV0Yy5cbiAgYWRkaXRpb25hbEF1ZGlvTm9kZXM/OiBBdWRpb05vZGVbXTtcblxuICAvLyBUaGUgXCJsZXZlbFwiIGZvciB3aGljaCB0aGlzIHNvdW5kIHNob3VsZCBiZSBwbGF5ZWQsIGVpdGhlciBCQVNJQyBvciBFWFRSQS5cbiAgc29uaWZpY2F0aW9uTGV2ZWw/OiBTb3VuZExldmVsRW51bTtcblxuICAvLyBUaGUgYXNzb2NpYXRlZCB2aWV3IG5vZGUgaXMgYSBTY2VuZXJ5IG5vZGUgdGhhdCwgaWYgcHJvdmlkZWQsIG11c3QgYmUgdmlzaWJsZSBpbiB0aGUgZGlzcGxheSBmb3IgdGhlIHNvdW5kXG4gIC8vIGdlbmVyYXRvciB0byBiZSBlbmFibGVkLiAgVGhpcyBpcyBnZW5lcmFsbHkgdXNlZCBvbmx5IGZvciBzb3VuZHMgdGhhdCBjYW4gcGxheSBmb3IgbG9uZyBkdXJhdGlvbnMsIHN1Y2ggYXMgYVxuICAvLyBsb29waW5nIHNvdW5kIGNsaXAsIHRoYXQgc2hvdWxkIGJlIHN0b3BwZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCB2aXN1YWwgcmVwcmVzZW50YXRpb24gaXMgaGlkZGVuLlxuICBhc3NvY2lhdGVkVmlld05vZGU/OiBOb2RlIHwgbnVsbDtcblxuICAvLyBDb250cm9scyB3aGV0aGVyIHNvdW5kIHNob3VsZCBiZSBnZW5lcmF0ZWQgZHVyaW5nIGEgcmVzZXQuICBHZW5lcmFsbHkgdGhlIGRlZmF1bHQgdmFsdWUgc2hvdWxkIGJlIHVzZWQsIHdoaWNoIGlzXG4gIC8vIGBmYWxzZWAsIG1lYW5pbmcgdGhhdCBzb3VuZCBpcyBub3QgcHJvZHVjZWQgZHVyaW5nIGEgcmVzZXQuICBUaGVyZSBhcmUgc29tZSBjYXNlcyB3aGVyZSB0aGlzIGlzIHR1cm5lZCBvbiwgc3VjaCBhc1xuICAvLyBmb3IgdGhlIHNvdW5kIHByb2R1Y2VkIGJ5IHRoZSBSZXNldCBBbGwgYnV0dG9uLlxuICBlbmFibGVkRHVyaW5nUmVzZXQ/OiBib29sZWFuO1xuXG4gIC8vIENvbnRyb2xzIHdoZXRoZXIgc291bmRzIHNob3VsZCBiZSBnZW5lcmF0ZWQgd2hlbiBwaGV0LWlvIHN0YXRlIGlzIGJlaW5nIHNldC4gIEluIGFsbW9zdCBhbGwgY2FzZXMsIHRoaXMgc2hvdWxkIG5vdFxuICAvLyBiZSBvdmVycmlkZGVuIGFuZCB0aGUgZGVmYXVsdCBiZWhhdmlvciBzaG91bGQgYmUgdXNlZCwgd2hpY2ggaXMgdG8gcHJldmVudCBhbGwgc291bmQgcHJvZHVjdGlvbiBkdXJpbmcgdGhlIHNldHRpbmdcbiAgLy8gb2YgcGhldC1pbyBzdGF0ZS5cbiAgZW5hYmxlZER1cmluZ1BoZXRpb1N0YXRlU2V0dGluZz86IGJvb2xlYW47XG59O1xuZXhwb3J0IHR5cGUgU291bmRHZW5lcmF0b3JPcHRpb25zID0gU2VsZk9wdGlvbnMgJiBFbmFibGVkQ29tcG9uZW50T3B0aW9ucztcblxuYWJzdHJhY3QgY2xhc3MgU291bmRHZW5lcmF0b3IgZXh0ZW5kcyBFbmFibGVkQ29tcG9uZW50IHtcblxuICBwcm90ZWN0ZWQgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQ7XG4gIHByaXZhdGUgX291dHB1dExldmVsOiBudW1iZXI7XG5cbiAgLy8gYSBsaXN0IG9mIGFsbCBhdWRpbyBub2RlcyB0byB3aGljaCB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBjb25uZWN0ZWRcbiAgcHJpdmF0ZSBjb25uZWN0aW9uTGlzdDogKCBBdWRpb1BhcmFtIHwgQXVkaW9Ob2RlIClbXTtcblxuICAvLyBBIFByb3BlcnR5IHRoYXQgdHJhY2tzIHdoZXRoZXIgdGhpcyBzb3VuZCBnZW5lcmF0b3IgaXMgZnVsbHkgZW5hYmxlZCwgbWVhbmluZyB0aGF0IGFsbCB0aGUgZW5hYmxlIGNvbnRyb2xcbiAgLy8gUHJvcGVydGllcyBhcmUgaW4gYSBzdGF0ZSBpbmRpY2F0aW5nIHRoYXQgc291bmQgY2FuIGJlIHByb2R1Y2VkLiAgVGhpcyBzaG91bGQgb25seSBiZSB1cGRhdGVkIGluIHRoZSBsaXN0ZW5lclxuICAvLyBmdW5jdGlvbiBkZWZpbmVkIGJlbG93LCBub3doZXJlIGVsc2UuXG4gIHB1YmxpYyByZWFkb25seSBmdWxseUVuYWJsZWRQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8Ym9vbGVhbj47XG5cbiAgLy8gbWFpbiBnYWluIGNvbnRyb2wgdGhhdCB3aWxsIGJlIHVzZWQgdG8gY29udHJvbCB0aGUgdm9sdW1lIG9mIHRoZSBzb3VuZFxuICBwcm90ZWN0ZWQgbWFpbkdhaW5Ob2RlOiBHYWluTm9kZTtcblxuICAvLyBUaGUgYXVkaW8gbm9kZSB0byB3aGljaCB0aGUgc291bmQgc291cmNlcyB3aWxsIGNvbm5lY3QsIGFuYWxvZ291cyB0byBBdWRpb0NvbnRleHQuZGVzdGluYXRpb24uICBJZiBubyBhZGRpdGlvbmFsXG4gIC8vIGF1ZGlvIG5vZGVzIHdlcmUgcHJvdmlkZWQgdXBvbiBjb25zdHJ1Y3Rpb24sIHRoaXMgd2lsbCBiZSB0aGUgbWFpbiBnYWluIG5vZGUuXG4gIHByb3RlY3RlZCBzb3VuZFNvdXJjZURlc3RpbmF0aW9uOiBBdWRpb05vZGU7XG5cbiAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKCBwcm92aWRlZE9wdGlvbnM/OiBTb3VuZEdlbmVyYXRvck9wdGlvbnMgKSB7XG5cbiAgICBjb25zdCBvcHRpb25zID0gb3B0aW9uaXplPFNvdW5kR2VuZXJhdG9yT3B0aW9ucywgU2VsZk9wdGlvbnMsIEVuYWJsZWRDb21wb25lbnRPcHRpb25zPigpKCB7XG4gICAgICBpbml0aWFsT3V0cHV0TGV2ZWw6IDEsXG4gICAgICBhdWRpb0NvbnRleHQ6IHBoZXRBdWRpb0NvbnRleHQsXG4gICAgICBjb25uZWN0SW1tZWRpYXRlbHk6IGZhbHNlLFxuICAgICAgc29uaWZpY2F0aW9uTGV2ZWw6IFNvdW5kTGV2ZWxFbnVtLkJBU0lDLFxuICAgICAgYWRkaXRpb25hbEF1ZGlvTm9kZXM6IFtdLFxuICAgICAgYXNzb2NpYXRlZFZpZXdOb2RlOiBudWxsLFxuICAgICAgZW5hYmxlZER1cmluZ1Jlc2V0OiBmYWxzZSxcbiAgICAgIGVuYWJsZWREdXJpbmdQaGV0aW9TdGF0ZVNldHRpbmc6IGZhbHNlXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XG5cbiAgICBzdXBlciggb3B0aW9ucyApO1xuXG4gICAgdGhpcy5hdWRpb0NvbnRleHQgPSBvcHRpb25zLmF1ZGlvQ29udGV4dDtcbiAgICB0aGlzLl9vdXRwdXRMZXZlbCA9IG9wdGlvbnMuaW5pdGlhbE91dHB1dExldmVsO1xuICAgIHRoaXMuY29ubmVjdGlvbkxpc3QgPSBbXTtcbiAgICB0aGlzLm1haW5HYWluTm9kZSA9IHRoaXMuYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTtcbiAgICB0aGlzLm1haW5HYWluTm9kZS5nYWluLnNldFZhbHVlQXRUaW1lKFxuICAgICAgdGhpcy5fb3V0cHV0TGV2ZWwsXG4gICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZVxuICAgICk7XG5cbiAgICAvLyBJZiBhbiBhc3NvY2lhdGVkIHZpZXcgbm9kZSB3YXMgc3BlY2lmaWVkLCBjcmVhdGUgYSBib29sZWFuIFByb3BlcnR5IHRoYXQgaXMgdHJ1ZSBvbmx5IHdoZW4gdGhlIG5vZGUgaXMgZGlzcGxheWVkLlxuICAgIGNvbnN0IHZpZXdOb2RlRGlzcGxheWVkUHJvcGVydHkgPSBvcHRpb25zLmFzc29jaWF0ZWRWaWV3Tm9kZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEaXNwbGF5ZWRQcm9wZXJ0eSggb3B0aW9ucy5hc3NvY2lhdGVkVmlld05vZGUgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBCb29sZWFuUHJvcGVydHkoIHRydWUgKTtcblxuICAgIC8vIERlZmluZSB0aGUgcHJvcGVydHkgdGhhdCB3aWxsIGRldGVybWluZSB3aGV0aGVyIHRoaXMgc291bmQgZ2VuZXJhdG9yIHNob3VsZCBwcm9kdWNlIHNvdW5kIGF0IGFsbC5cbiAgICB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eShcbiAgICAgIFtcbiAgICAgICAgc291bmRNYW5hZ2VyLmVuYWJsZWRQcm9wZXJ0eSxcbiAgICAgICAgdGhpcy5lbmFibGVkUHJvcGVydHksXG4gICAgICAgIFJlc2V0QWxsQnV0dG9uLmlzUmVzZXR0aW5nQWxsUHJvcGVydHksXG4gICAgICAgIHZpZXdOb2RlRGlzcGxheWVkUHJvcGVydHksXG4gICAgICAgIHNvdW5kTWFuYWdlci5leHRyYVNvdW5kRW5hYmxlZFByb3BlcnR5LFxuICAgICAgICBpc1NldHRpbmdQaGV0aW9TdGF0ZVByb3BlcnR5XG4gICAgICBdLFxuICAgICAgKCBzb3VuZEVuYWJsZWQsIGVuYWJsZWQsIGlzUmVzZXR0aW5nQWxsLCB2aWV3Tm9kZURpc3BsYXllZCwgZXh0cmFTb3VuZEVuYWJsZWQsIGlzU2V0dGluZ1BoZXRpb1N0YXRlICkgPT5cbiAgICAgICAgc291bmRFbmFibGVkICYmIGVuYWJsZWQgJiYgdmlld05vZGVEaXNwbGF5ZWQgJiZcbiAgICAgICAgKCBvcHRpb25zLnNvbmlmaWNhdGlvbkxldmVsID09PSBTb3VuZExldmVsRW51bS5CQVNJQyB8fCBleHRyYVNvdW5kRW5hYmxlZCApICYmXG4gICAgICAgICggIWlzUmVzZXR0aW5nQWxsIHx8IG9wdGlvbnMuZW5hYmxlZER1cmluZ1Jlc2V0ICkgJiZcbiAgICAgICAgKCAhaXNTZXR0aW5nUGhldGlvU3RhdGUgfHwgb3B0aW9ucy5lbmFibGVkRHVyaW5nUGhldGlvU3RhdGVTZXR0aW5nIClcbiAgICApO1xuXG4gICAgLy8gSWYgdGhlIG9wdGlvbiBzcGVjaWZpZXMgaW1tZWRpYXRlIGNvbm5lY3Rpb24sIGNvbm5lY3QgdGhlIG1haW4gZ2FpbiBub2RlIHRvIHRoZSBhdWRpbyBjb250ZXh0IGRlc3RpbmF0aW9uLlxuICAgIGlmICggb3B0aW9ucy5jb25uZWN0SW1tZWRpYXRlbHkgKSB7XG4gICAgICB0aGlzLm1haW5HYWluTm9kZS5jb25uZWN0KCB0aGlzLmF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbiApO1xuICAgIH1cblxuICAgIC8vIFR1cm4gZG93biB0aGUgZ2FpbiB0byB6ZXJvIHdoZW4gbm90IGZ1bGx5IGVuYWJsZWQgYW5kIHVwIHRvIHRoZSBjdXJyZW50IG91dHB1dCBsZXZlbCB3aGVuIGJlY29taW5nIGZ1bGx5IGVuYWJsZWQuXG4gICAgdGhpcy5mdWxseUVuYWJsZWRQcm9wZXJ0eS5saW5rKCBmdWxseUVuYWJsZWQgPT4ge1xuXG4gICAgICBjb25zdCBwcmV2aW91c0dhaW5TZXR0aW5nID0gZnVsbHlFbmFibGVkID8gMCA6IHRoaXMuX291dHB1dExldmVsO1xuICAgICAgY29uc3QgbmV3R2FpblNldHRpbmcgPSBmdWxseUVuYWJsZWQgPyB0aGlzLl9vdXRwdXRMZXZlbCA6IDA7XG4gICAgICBjb25zdCBub3cgPSB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZTtcblxuICAgICAgLy8gRm9yIHRoZSBsaW5lYXIgcmFtcCB0byB3b3JrIGNvbnNpc3RlbnRseSBvbiBhbGwgYnJvd3NlcnMsIHRoZSBnYWluIG11c3QgYmUgZXhwbGljaXRseSBzZXQgdG8gd2hhdCBpdCBpc1xuICAgICAgLy8gc3VwcG9zZWQgdG8gYmUgYmVmb3JlIG1ha2luZyBhbnkgY2hhbmdlcy4gIE90aGVyd2lzZSwgaXQgbWF5IGV4dHJhcG9sYXRlIGZyb20gdGhlIG1vc3QgcmVjZW50IHByZXZpb3VzIGV2ZW50LlxuICAgICAgdGhpcy5tYWluR2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSggcHJldmlvdXNHYWluU2V0dGluZywgbm93ICk7XG5cbiAgICAgIC8vIFJhbXAgdGhlIGdhaW4gdG8gdGhlIG5ldyBsZXZlbC5cbiAgICAgIHRoaXMubWFpbkdhaW5Ob2RlLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoXG4gICAgICAgIG5ld0dhaW5TZXR0aW5nLFxuICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSArIHNvdW5kQ29uc3RhbnRzLkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUVcbiAgICAgICk7XG4gICAgfSApO1xuXG4gICAgdGhpcy5zb3VuZFNvdXJjZURlc3RpbmF0aW9uID0gdGhpcy5tYWluR2Fpbk5vZGU7XG5cbiAgICAvLyBJbnNlcnQgYW55IGFkZGl0aW9uYWwgYXVkaW8gbm9kZXMgaW50byB0aGUgc2lnbmFsIGNoYWluIGJ5IGl0ZXJhdGluZyBiYWNrd2FyZHMgdGhyb3VnaCB0aGUgcHJvdmlkZWQgbGlzdC5cbiAgICBmb3IgKCBsZXQgaSA9IG9wdGlvbnMuYWRkaXRpb25hbEF1ZGlvTm9kZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7XG4gICAgICBjb25zdCBhdWRpb05vZGUgPSBvcHRpb25zLmFkZGl0aW9uYWxBdWRpb05vZGVzWyBpIF07XG4gICAgICBhdWRpb05vZGUuY29ubmVjdCggdGhpcy5zb3VuZFNvdXJjZURlc3RpbmF0aW9uICk7XG4gICAgICB0aGlzLnNvdW5kU291cmNlRGVzdGluYXRpb24gPSBhdWRpb05vZGU7XG4gICAgfVxuXG4gICAgLy8gQ2xlYW4gdXAgbWVtb3J5IHJlZmVyZW5jZXMgd2hlbiB0aGlzIG9iamVjdCBpcyBkaXNwb3NlZC5cbiAgICB0aGlzLmRpc3Bvc2VFbWl0dGVyLmFkZExpc3RlbmVyKCAoKSA9PiB7XG4gICAgICB0aGlzLmZ1bGx5RW5hYmxlZFByb3BlcnR5LmRpc3Bvc2UoKTtcbiAgICB9ICk7XG4gIH1cblxuICAvKipcbiAgICogQ29ubmVjdCB0aGUgc291bmQgZ2VuZXJhdG9yIHRvIGFuIGF1ZGlvIHBhcmFtZXRlci5cbiAgICovXG4gIHB1YmxpYyBjb25uZWN0KCBhdWRpb1BhcmFtOiBBdWRpb1BhcmFtIHwgQXVkaW9Ob2RlICk6IHZvaWQge1xuICAgIHRoaXMubWFpbkdhaW5Ob2RlLmNvbm5lY3QoIGF1ZGlvUGFyYW0gYXMgQXVkaW9QYXJhbSApO1xuXG4gICAgLy8gVHJhY2sgdGhpcyBzb3VuZCBnZW5lcmF0b3IncyBjb25uZWN0aW9ucy4gIFRoaXMgaXMgbmVjZXNzYXJ5IGJlY2F1c2UgV2ViIEF1ZGlvIGRvZXNuJ3Qgc3VwcG9ydCBjaGVja2luZyB3aGljaFxuICAgIC8vIG5vZGVzIGFyZSBjb25uZWN0ZWQgdG8gd2hpY2gsIGFuZCB3ZSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gd2hlbiBkaXNjb25uZWN0aW5nLlxuICAgIHRoaXMuY29ubmVjdGlvbkxpc3QucHVzaCggYXVkaW9QYXJhbSBhcyBBdWRpb1BhcmFtICk7XG4gIH1cblxuICAvKipcbiAgICogRGlzY29ubmVjdCB0aGUgc291bmQgZ2VuZXJhdG9yIGZyb20gYW4gYXVkaW8gcGFyYW1ldGVyLlxuICAgKi9cbiAgcHVibGljIGRpc2Nvbm5lY3QoIGF1ZGlvUGFyYW06IEF1ZGlvUGFyYW0gfCBBdWRpb05vZGUgKTogdm9pZCB7XG4gICAgdGhpcy5tYWluR2Fpbk5vZGUuZGlzY29ubmVjdCggYXVkaW9QYXJhbSBhcyBBdWRpb05vZGUgKTtcbiAgICB0aGlzLmNvbm5lY3Rpb25MaXN0ID0gXy53aXRob3V0KCB0aGlzLmNvbm5lY3Rpb25MaXN0LCBhdWRpb1BhcmFtICk7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBpZiB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBjb25uZWN0ZWQgdG8gdGhlIHByb3ZpZGVkIGF1ZGlvIHBhcmFtLlxuICAgKi9cbiAgcHVibGljIGlzQ29ubmVjdGVkVG8oIGF1ZGlvUGFyYW06IEF1ZGlvUGFyYW0gfCBBdWRpb05vZGUgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbkxpc3QuaW5jbHVkZXMoIGF1ZGlvUGFyYW0gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBvdXRwdXQgbGV2ZWwgb2YgdGhlIHNvdW5kIGdlbmVyYXRvci5cbiAgICpcbiAgICogQHBhcmFtIG91dHB1dExldmVsIC0gZ2VuZXJhbGx5IGJldHdlZW4gMCBhbmQgMSwgYnV0IGNhbiBiZSBsYXJnZXIgdGhhbiAxIGlmIG5lY2Vzc2FyeSB0byBhbXBsaWZ5IGEgc21hbGwgc2lnbmFsLFxuICAgKiAgIGFuZCBjYW4gYmUgbmVnYXRpdmUgdG8gaW52ZXJ0IHRoZSBwaGFzZS5cbiAgICogQHBhcmFtIFt0aW1lQ29uc3RhbnRdIC0gdGltZSBjb25zdGFudCBmb3Igb3V0cHV0IGxldmVsIGNoYW5nZSwgbG9uZ2VyIHZhbHVlcyBtZWFuIHNsb3dlciB0cmFuc2l0aW9ucywgaW4gc2Vjb25kcy5cbiAgICogICBOb3RlIHRoYXQgdGltZUNvbnN0YW50IGlzIE5PVCBhIGZhZGUgdGltZS4gSXQncyBhbiBleHBvbmVudGlhbCBhcHByb2FjaCB0byB0aGUgdGFyZ2V0IG91dHB1dCBsZXZlbCwgYW5kIHRoZSBhcmd1bWVudCB0b1xuICAgKiAgIHNldFRhcmdldEF0VGltZSwgZG9jdW1lbnRlZCBhdCBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQXVkaW9QYXJhbS9zZXRUYXJnZXRBdFRpbWUjdGltZWNvbnN0YW50XG4gICAqICAgVGhlIGRvY3VtZW50IGhhcyB0aGlzIHN1Z2dlc3Rpb24gZm9yIGNob29zaW5nIHRoZSB2YWx1ZSBmb3IgdGltZUNvbnN0YW50OiBcIkRlcGVuZGluZyBvbiB5b3VyIHVzZSBjYXNlLCBnZXR0aW5nXG4gICAqICAgOTUlIHRvd2FyZCB0aGUgdGFyZ2V0IHZhbHVlIG1heSBhbHJlYWR5IGJlIGVub3VnaDsgaW4gdGhhdCBjYXNlLCB5b3UgY291bGQgc2V0IHRpbWVDb25zdGFudCB0byBvbmUgdGhpcmQgb2YgdGhlXG4gICAqICAgZGVzaXJlZCBkdXJhdGlvbi5cIlxuICAgKi9cbiAgcHVibGljIHNldE91dHB1dExldmVsKCBvdXRwdXRMZXZlbDogbnVtYmVyLCB0aW1lQ29uc3RhbnQ6IG51bWJlciA9IERFRkFVTFRfVElNRV9DT05TVEFOVCApOiB2b2lkIHtcblxuICAgIC8vIElnbm9yZSBhdHRlbXB0cyB0byBzZXQgdGhlIG91dHB1dCBsZXZlbCB0byB0aGUgc2FtZSB2YWx1ZS5cbiAgICBpZiAoIG91dHB1dExldmVsICE9PSB0aGlzLl9vdXRwdXRMZXZlbCApIHtcbiAgICAgIGNvbnN0IG5vdyA9IHRoaXMuYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lO1xuXG4gICAgICAvLyBUaGUgb3V0cHV0IGxldmVsIHNob3VsZCB0YWtlIGVmZmVjdCBpbW1lZGlhdGVseSBpZiB0aGlzIHNvdW5kIGdlbmVyYXRvciBpcyBmdWxseSBlbmFibGVkLiAgT3RoZXJ3aXNlLCB0aGUgdmFsdWVcbiAgICAgIC8vIGlzIHNhdmVkIGFuZCByZXN0b3JlZCB0aGUgbmV4dCB0aW1lIHRoZSBzb3VuZCBnZW5lcmF0b3IgdHJhbnNpdGlvbnMgdG8gZnVsbHkgZW5hYmxlZC5cbiAgICAgIGlmICggdGhpcy5mdWxseUVuYWJsZWRQcm9wZXJ0eS52YWx1ZSApIHtcblxuICAgICAgICAvLyBDYW5jZWwgYW55IGdhaW4gdHJhbnNpdGlvbnMgdGhhdCBhcmUgY3VycmVudGx5IGluIHByb2dyZXNzLlxuICAgICAgICB0aGlzLm1haW5HYWluTm9kZS5nYWluLmNhbmNlbFNjaGVkdWxlZFZhbHVlcyggbm93ICk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBvdXRwdXQgbGV2ZWwgb24gdGhlIGdhaW4gbm9kZS4gIEEgZGlmZmVyZW50IG1ldGhvZCBpcyB1c2VkIGZvciBpbnN0YW50IGNoYW5nZXMuXG4gICAgICAgIGlmICggdGltZUNvbnN0YW50ID09PSAwICkge1xuICAgICAgICAgIHRoaXMubWFpbkdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoIG91dHB1dExldmVsLCBub3cgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcblxuICAgICAgICAgIC8vIFRoZSBzZXRUYXJnZXRBdFRpbWUgbWV0aG9kIGRvZXNuJ3Qgc2VlbSB0byB3b3JrIGlmIHRoZSBhdWRpbyBjb250ZXh0IGlzbid0IHJ1bm5pbmcsIGFuZCB0aGUgZXZlbnQgZG9lc24ndFxuICAgICAgICAgIC8vIHNlZW0gdG8gYmUgc2NoZWR1bGVkIC0gaXQncyBqdXN0IGlnbm9yZWQuICBTbywgaWYgdGhlIGF1ZGlvIGNvbnRleHQgaXNuJ3QgcnVubmluZywgdXNlIGFuIGFsdGVybmF0aXZlXG4gICAgICAgICAgLy8gYXBwcm9hY2guICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3RhbWJvL2lzc3Vlcy83NC5cbiAgICAgICAgICBpZiAoIHRoaXMuYXVkaW9Db250ZXh0LnN0YXRlID09PSAncnVubmluZycgKSB7XG4gICAgICAgICAgICB0aGlzLm1haW5HYWluTm9kZS5nYWluLnNldFRhcmdldEF0VGltZSggb3V0cHV0TGV2ZWwsIG5vdywgdGltZUNvbnN0YW50ICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tYWluR2Fpbk5vZGUuZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZShcbiAgICAgICAgICAgICAgb3V0cHV0TGV2ZWwsXG4gICAgICAgICAgICAgIG5vdyArIHNvdW5kQ29uc3RhbnRzLkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBsb2NhbCBjb3B5IG9mIG91dHB1dCBsZXZlbC5cbiAgICAgIHRoaXMuX291dHB1dExldmVsID0gb3V0cHV0TGV2ZWw7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNldCBvdXRwdXRMZXZlbCggb3V0cHV0TGV2ZWw6IG51bWJlciApIHtcbiAgICB0aGlzLnNldE91dHB1dExldmVsKCBvdXRwdXRMZXZlbCApO1xuICB9XG5cbiAgcHVibGljIGdldCBvdXRwdXRMZXZlbCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmdldE91dHB1dExldmVsKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IG91dHB1dCBsZXZlbCBzZXR0aW5nLiAgTm90ZSB0aGF0IGlmIHRoZSBzb3VuZCBnZW5lcmF0b3IgaXMgZGlzYWJsZWQsIHRoaXMgY291bGQgcmV0dXJuIGEgbm9uLXplcm9cbiAgICogdmFsdWUgYnV0IHRoZSBzb3VuZCBnZW5lcmF0b3Igd29uJ3QgcHJvZHVjZSBhdWRpYmxlIHNvdW5kLlxuICAgKi9cbiAgcHVibGljIGdldE91dHB1dExldmVsKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX291dHB1dExldmVsO1xuICB9XG5cbiAgcHVibGljIGdldCBmdWxseUVuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZnVsbHlFbmFibGVkUHJvcGVydHkudmFsdWU7XG4gIH1cbn1cblxudGFtYm8ucmVnaXN0ZXIoICdTb3VuZEdlbmVyYXRvcicsIFNvdW5kR2VuZXJhdG9yICk7XG5cbmV4cG9ydCBkZWZhdWx0IFNvdW5kR2VuZXJhdG9yOyJdLCJuYW1lcyI6WyJCb29sZWFuUHJvcGVydHkiLCJEZXJpdmVkUHJvcGVydHkiLCJFbmFibGVkQ29tcG9uZW50Iiwib3B0aW9uaXplIiwiUmVzZXRBbGxCdXR0b24iLCJEaXNwbGF5ZWRQcm9wZXJ0eSIsImlzU2V0dGluZ1BoZXRpb1N0YXRlUHJvcGVydHkiLCJwaGV0QXVkaW9Db250ZXh0Iiwic291bmRDb25zdGFudHMiLCJTb3VuZExldmVsRW51bSIsInNvdW5kTWFuYWdlciIsInRhbWJvIiwiREVGQVVMVF9USU1FX0NPTlNUQU5UIiwiREVGQVVMVF9QQVJBTV9DSEFOR0VfVElNRV9DT05TVEFOVCIsIlNvdW5kR2VuZXJhdG9yIiwiY29ubmVjdCIsImF1ZGlvUGFyYW0iLCJtYWluR2Fpbk5vZGUiLCJjb25uZWN0aW9uTGlzdCIsInB1c2giLCJkaXNjb25uZWN0IiwiXyIsIndpdGhvdXQiLCJpc0Nvbm5lY3RlZFRvIiwiaW5jbHVkZXMiLCJzZXRPdXRwdXRMZXZlbCIsIm91dHB1dExldmVsIiwidGltZUNvbnN0YW50IiwiX291dHB1dExldmVsIiwibm93IiwiYXVkaW9Db250ZXh0IiwiY3VycmVudFRpbWUiLCJmdWxseUVuYWJsZWRQcm9wZXJ0eSIsInZhbHVlIiwiZ2FpbiIsImNhbmNlbFNjaGVkdWxlZFZhbHVlcyIsInNldFZhbHVlQXRUaW1lIiwic3RhdGUiLCJzZXRUYXJnZXRBdFRpbWUiLCJsaW5lYXJSYW1wVG9WYWx1ZUF0VGltZSIsIkRFRkFVTFRfTElORUFSX0dBSU5fQ0hBTkdFX1RJTUUiLCJnZXRPdXRwdXRMZXZlbCIsImZ1bGx5RW5hYmxlZCIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJpbml0aWFsT3V0cHV0TGV2ZWwiLCJjb25uZWN0SW1tZWRpYXRlbHkiLCJzb25pZmljYXRpb25MZXZlbCIsIkJBU0lDIiwiYWRkaXRpb25hbEF1ZGlvTm9kZXMiLCJhc3NvY2lhdGVkVmlld05vZGUiLCJlbmFibGVkRHVyaW5nUmVzZXQiLCJlbmFibGVkRHVyaW5nUGhldGlvU3RhdGVTZXR0aW5nIiwiY3JlYXRlR2FpbiIsInZpZXdOb2RlRGlzcGxheWVkUHJvcGVydHkiLCJlbmFibGVkUHJvcGVydHkiLCJpc1Jlc2V0dGluZ0FsbFByb3BlcnR5IiwiZXh0cmFTb3VuZEVuYWJsZWRQcm9wZXJ0eSIsInNvdW5kRW5hYmxlZCIsImVuYWJsZWQiLCJpc1Jlc2V0dGluZ0FsbCIsInZpZXdOb2RlRGlzcGxheWVkIiwiZXh0cmFTb3VuZEVuYWJsZWQiLCJpc1NldHRpbmdQaGV0aW9TdGF0ZSIsImRlc3RpbmF0aW9uIiwibGluayIsInByZXZpb3VzR2FpblNldHRpbmciLCJuZXdHYWluU2V0dGluZyIsInNvdW5kU291cmNlRGVzdGluYXRpb24iLCJpIiwibGVuZ3RoIiwiYXVkaW9Ob2RlIiwiZGlzcG9zZUVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsImRpc3Bvc2UiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7OztDQUtDLEdBRUQsT0FBT0EscUJBQXFCLHNDQUFzQztBQUNsRSxPQUFPQyxxQkFBcUIsc0NBQXNDO0FBQ2xFLE9BQU9DLHNCQUFtRCx1Q0FBdUM7QUFFakcsT0FBT0MsZUFBZSxxQ0FBcUM7QUFDM0QsT0FBT0Msb0JBQW9CLHFEQUFxRDtBQUNoRixTQUFTQyxpQkFBaUIsUUFBYyxpQ0FBaUM7QUFDekUsT0FBT0Msa0NBQWtDLHFEQUFxRDtBQUM5RixPQUFPQyxzQkFBc0IseUJBQXlCO0FBQ3RELE9BQU9DLG9CQUFvQix1QkFBdUI7QUFDbEQsT0FBT0Msb0JBQW9CLHVCQUF1QjtBQUNsRCxPQUFPQyxrQkFBa0IscUJBQXFCO0FBQzlDLE9BQU9DLFdBQVcsY0FBYztBQUVoQyxZQUFZO0FBQ1osTUFBTUMsd0JBQXdCSixlQUFlSyxrQ0FBa0M7QUF5Qy9FLElBQUEsQUFBZUMsaUJBQWYsTUFBZUEsdUJBQXVCWjtJQXdHcEM7O0dBRUMsR0FDRCxBQUFPYSxRQUFTQyxVQUFrQyxFQUFTO1FBQ3pELElBQUksQ0FBQ0MsWUFBWSxDQUFDRixPQUFPLENBQUVDO1FBRTNCLGdIQUFnSDtRQUNoSCxpRkFBaUY7UUFDakYsSUFBSSxDQUFDRSxjQUFjLENBQUNDLElBQUksQ0FBRUg7SUFD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