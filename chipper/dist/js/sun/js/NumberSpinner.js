// Copyright 2016-2024, University of Colorado Boulder
/**
 * Spinner for numbers.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Andrea Lin (PhET Interactive Simulations)
 */ import InstanceRegistry from '../../phet-core/js/documentation/InstanceRegistry.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import NumberDisplay from '../../scenery-phet/js/NumberDisplay.js';
import { KeyboardUtils, Node, SceneryConstants } from '../../scenery/js/imports.js';
import nullSoundPlayer from '../../tambo/js/nullSoundPlayer.js';
import sharedSoundPlayers from '../../tambo/js/sharedSoundPlayers.js';
import Tandem from '../../tandem/js/Tandem.js';
import AccessibleNumberSpinner from './accessibility/AccessibleNumberSpinner.js';
import ArrowButton from './buttons/ArrowButton.js';
import sun from './sun.js';
let NumberSpinner = class NumberSpinner extends AccessibleNumberSpinner(Node, 0) {
    dispose() {
        this.disposeNumberSpinner();
        super.dispose();
    }
    /**
   * @param numberProperty - value, must be an integer
   * @param rangeProperty - dynamic range of values, min and max must be integers
   * @param [providedOptions]
   */ constructor(numberProperty, rangeProperty, providedOptions){
        var _window_phet_chipper_queryParameters, _window_phet_chipper, _window_phet;
        assert && assert(rangeProperty.value.contains(numberProperty.get()), `value ${numberProperty.get()} is out of range ${rangeProperty.value.toString()}`);
        const options = optionize()({
            // SelfOptions
            arrowsSoundPlayer: sharedSoundPlayers.get('pushButton'),
            arrowsPosition: 'bothRight',
            arrowsScale: null,
            arrowButtonFill: 'white',
            arrowButtonStroke: 'black',
            arrowButtonLineWidth: 1,
            deltaValue: 1,
            xSpacing: 5,
            ySpacing: 3,
            numberDisplayOptions: {
                cornerRadius: 5,
                backgroundStroke: 'black'
            },
            touchAreaXDilation: 0,
            touchAreaYDilation: 0,
            mouseAreaXDilation: 0,
            mouseAreaYDilation: 0,
            // AccessibleNumberSpinnerOptions
            valueProperty: numberProperty,
            enabledRangeProperty: rangeProperty,
            disabledOpacity: SceneryConstants.DISABLED_OPACITY,
            // The focus highlight surrounds the entire component, but the spinner display is not interactive with
            // mouse and touch events so this highlight is hidden. Instead, default highlights surround the arrow buttons.
            interactiveHighlight: 'invisible',
            // PhET-iO
            tandem: Tandem.REQUIRED,
            tandemNameSuffix: 'Spinner',
            phetioFeatured: true,
            phetioEnabledPropertyInstrumented: true // opt into default PhET-iO instrumented enabledProperty
        }, providedOptions);
        // Defaults for incrementFunction and decrementFunction
        const incrementFunction = options.incrementFunction || ((value)=>value + options.deltaValue);
        const decrementFunction = options.decrementFunction || ((value)=>value - options.deltaValue);
        const numberDisplay = new NumberDisplay(numberProperty, rangeProperty.value, combineOptions({
            tandem: options.tandem.createTandem('numberDisplay')
        }, options.numberDisplayOptions));
        // buttons
        const arrowButtonOptions = {
            baseColor: options.arrowButtonFill,
            stroke: options.arrowButtonStroke,
            lineWidth: options.arrowButtonLineWidth,
            focusable: false,
            // Override the default sound player for the buttons since sound production is handled in this class.
            soundPlayer: nullSoundPlayer,
            // as requested in https://github.com/phetsims/sun/issues/575
            enabledPropertyOptions: {
                phetioReadOnly: true,
                phetioFeatured: false
            }
        };
        // increment button
        const incrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'up' : 'right', ()=>{
            numberProperty.set(incrementFunction(numberProperty.get()));
            options.arrowsSoundPlayer.play();
        }, combineOptions({
            tandem: options.tandem.createTandem('incrementButton')
        }, arrowButtonOptions));
        // decrement button
        const decrementButton = new ArrowButton(options.arrowsPosition === 'topBottom' || options.arrowsPosition === 'bothRight' ? 'down' : 'left', ()=>{
            numberProperty.set(decrementFunction(numberProperty.get()));
            options.arrowsSoundPlayer.play();
        }, combineOptions({
            tandem: options.tandem.createTandem('decrementButton')
        }, arrowButtonOptions));
        // arrow button scaling
        let arrowsScale;
        if (!arrowsScale) {
            if (options.arrowsPosition === 'leftRight') {
                arrowsScale = numberDisplay.height / incrementButton.height;
            } else if (options.arrowsPosition === 'topBottom') {
                arrowsScale = numberDisplay.width / incrementButton.width;
            } else if (options.arrowsPosition === 'bothRight') {
                arrowsScale = (numberDisplay.height / 2 - options.ySpacing / 2) / incrementButton.height;
            } else {
                arrowsScale = (numberDisplay.width / 2 - options.xSpacing / 2) / incrementButton.width;
            }
        }
        if (options.arrowsScale) {
            arrowsScale = arrowsScale * options.arrowsScale;
        }
        incrementButton.setScaleMagnitude(arrowsScale);
        decrementButton.setScaleMagnitude(arrowsScale);
        // Because range may change via rangeProperty, the size of numberDisplay may change, in which case layout will need
        // to be revised. See https://github.com/phetsims/sun/issues/709
        const updateLayout = ()=>{
            if (options.arrowsPosition === 'leftRight') {
                incrementButton.left = numberDisplay.right + options.xSpacing;
                decrementButton.right = numberDisplay.left - options.xSpacing;
                incrementButton.centerY = decrementButton.centerY = numberDisplay.centerY;
            } else if (options.arrowsPosition === 'topBottom') {
                incrementButton.centerX = decrementButton.centerX = numberDisplay.centerX;
                incrementButton.bottom = numberDisplay.top - options.ySpacing;
                decrementButton.top = numberDisplay.bottom + options.ySpacing;
            } else if (options.arrowsPosition === 'bothRight') {
                incrementButton.left = decrementButton.left = numberDisplay.right + options.xSpacing;
                incrementButton.bottom = numberDisplay.centerY - options.ySpacing / 2;
                decrementButton.top = numberDisplay.centerY + options.ySpacing / 2;
            } else {
                incrementButton.left = numberDisplay.centerX + options.xSpacing / 2;
                decrementButton.right = numberDisplay.centerX - options.xSpacing / 2;
                incrementButton.top = decrementButton.top = numberDisplay.bottom + options.ySpacing;
            }
        };
        numberDisplay.boundsProperty.link(()=>updateLayout());
        // touch areas
        if (options.touchAreaXDilation || options.touchAreaYDilation) {
            incrementButton.touchArea = incrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);
            decrementButton.touchArea = decrementButton.localBounds.dilatedXY(options.touchAreaXDilation, options.touchAreaYDilation);
            // shift touch areas for these options, to prevent overlap
            if (options.arrowsPosition === 'bothRight') {
                incrementButton.touchArea = incrementButton.touchArea.shiftedY(-options.touchAreaYDilation);
                decrementButton.touchArea = decrementButton.touchArea.shiftedY(options.touchAreaYDilation);
            } else if (options.arrowsPosition === 'bothBottom') {
                incrementButton.touchArea = incrementButton.touchArea.shiftedX(options.touchAreaXDilation);
                decrementButton.touchArea = decrementButton.touchArea.shiftedX(-options.touchAreaXDilation);
            }
        }
        // mouse areas
        if (options.mouseAreaXDilation || options.mouseAreaYDilation) {
            incrementButton.mouseArea = incrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);
            decrementButton.mouseArea = decrementButton.localBounds.dilatedXY(options.mouseAreaXDilation, options.mouseAreaYDilation);
            // shift touch areas for these options, to prevent overlap
            if (options.arrowsPosition === 'bothRight') {
                incrementButton.mouseArea = incrementButton.mouseArea.shiftedY(-options.mouseAreaYDilation);
                decrementButton.mouseArea = decrementButton.mouseArea.shiftedY(options.mouseAreaYDilation);
            } else if (options.arrowsPosition === 'bothBottom') {
                incrementButton.mouseArea = incrementButton.mouseArea.shiftedX(options.mouseAreaXDilation);
                decrementButton.mouseArea = decrementButton.mouseArea.shiftedX(-options.mouseAreaXDilation);
            }
        }
        options.children = [
            numberDisplay,
            incrementButton,
            decrementButton
        ];
        // pdom - NumberSpinner uses AccessibleValueHandler for accessibility, but it was decided that keyboardStep
        // and shiftKeyboardStep should have the same behavior as the NumberSpinner ArrowButtons AND the ArrowButtons
        // should look depressed when interacting with those keys. To accomplish this we actually press the ArrowButtons
        // in response to input with those keys. keyboardStep and shiftKeyboardStep are set to zero so the value isn't
        // modified again by AccessibleValueHandler. See https://github.com/phetsims/scenery/issues/1340.
        assert && assert(options.keyboardStep === undefined, 'NumberSpinner sets keyboardStep, it will be the same as deltaValue');
        assert && assert(options.shiftKeyboardStep === undefined, 'NumberSpinner sets shiftKeyboardStep, it will be the same as deltaValue');
        assert && assert(options.pageKeyboardStep === undefined, 'NumberSpinner sets pageKeyboardStep, it should not be used with NumberSpinner');
        options.keyboardStep = 0;
        options.shiftKeyboardStep = 0;
        options.pageKeyboardStep = 0;
        // Sounds are played when the button is pressed. But for 'home' and 'end' keys, the button is not pressed, so the
        // sound is played manually.
        options.onInput = (event, oldValue)=>{
            if (event.isFromPDOM()) {
                const domEvent = event.domEvent;
                // The sound should not play if the value is already at the home or end value.
                const currentValue = numberProperty.value;
                if (KeyboardUtils.isKeyEvent(domEvent, KeyboardUtils.KEY_HOME) && oldValue !== currentValue) {
                    options.arrowsSoundPlayer.play();
                } else if (KeyboardUtils.isKeyEvent(domEvent, KeyboardUtils.KEY_END) && oldValue !== currentValue) {
                    options.arrowsSoundPlayer.play();
                }
            }
        };
        // Call super without the options that require valid bounds. Call mutate later with those options.
        const boundsRequiredOptionKeys = _.pick(options, Node.REQUIRES_BOUNDS_OPTION_KEYS);
        super(_.omit(options, Node.REQUIRES_BOUNDS_OPTION_KEYS));
        // enable/disable arrow buttons
        const updateEnabled = ()=>{
            incrementButton.enabled = incrementFunction(numberProperty.value) <= rangeProperty.value.max;
            decrementButton.enabled = decrementFunction(numberProperty.value) >= rangeProperty.value.min;
        };
        // synchronize with number value
        const numberPropertyObserver = (value)=>{
            assert && assert(rangeProperty.value.contains(value), `value out of range: ${value}`);
            updateEnabled();
        };
        numberProperty.link(numberPropertyObserver); // must be unlinked in dispose
        // Dynamic range changes, see https://github.com/phetsims/scenery-phet/issues/305
        const rangeObserver = (range)=>{
            // If our value is outside our new range, adjust it to be within the range.
            numberProperty.value = range.constrainValue(numberProperty.value);
            // Range changes may change whether the buttons are enabled
            updateEnabled();
        };
        rangeProperty.link(rangeObserver);
        // pdom - click arrow buttons on press of arrow keys so that the Property value changes by deltaValue
        // and the buttons look depressed
        const increasedListener = (isDown)=>isDown && incrementButton.pdomClick();
        const decreasedListener = (isDown)=>isDown && decrementButton.pdomClick();
        this.pdomIncrementDownEmitter.addListener(increasedListener);
        this.pdomDecrementDownEmitter.addListener(decreasedListener);
        this.disposeNumberSpinner = ()=>{
            // dispose of subcomponents
            numberDisplay.dispose();
            incrementButton.dispose();
            decrementButton.dispose();
            // dispose a11y features
            this.pdomIncrementDownEmitter.removeListener(increasedListener);
            this.pdomDecrementDownEmitter.removeListener(decreasedListener);
            numberProperty.unlink(numberPropertyObserver);
            rangeProperty.unlink(rangeObserver);
        };
        this.mutate(boundsRequiredOptionKeys);
        this.numberDisplay = numberDisplay;
        // Create a link to associated Property, so it's easier to find in Studio. Must be after instrumentation
        this.addLinkedElement(numberProperty, {
            tandemName: 'property'
        });
        // support for binder documentation, stripped out in builds and only runs when ?binder is specified
        assert && ((_window_phet = window.phet) == null ? void 0 : (_window_phet_chipper = _window_phet.chipper) == null ? void 0 : (_window_phet_chipper_queryParameters = _window_phet_chipper.queryParameters) == null ? void 0 : _window_phet_chipper_queryParameters.binder) && InstanceRegistry.registerDataURL('sun', 'NumberSpinner', this);
    }
};
export { NumberSpinner as default };
sun.register('NumberSpinner', NumberSpinner);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3N1bi9qcy9OdW1iZXJTcGlubmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE2LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxuXG4vKipcbiAqIFNwaW5uZXIgZm9yIG51bWJlcnMuXG4gKlxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcbiAqIEBhdXRob3IgQW5kcmVhIExpbiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqL1xuXG5pbXBvcnQgUHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9Qcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgUmFuZ2UgZnJvbSAnLi4vLi4vZG90L2pzL1JhbmdlLmpzJztcbmltcG9ydCBJbnN0YW5jZVJlZ2lzdHJ5IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9kb2N1bWVudGF0aW9uL0luc3RhbmNlUmVnaXN0cnkuanMnO1xuaW1wb3J0IG9wdGlvbml6ZSwgeyBjb21iaW5lT3B0aW9ucyB9IGZyb20gJy4uLy4uL3BoZXQtY29yZS9qcy9vcHRpb25pemUuanMnO1xuaW1wb3J0IFN0cmljdE9taXQgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1N0cmljdE9taXQuanMnO1xuaW1wb3J0IE51bWJlckRpc3BsYXksIHsgTnVtYmVyRGlzcGxheU9wdGlvbnMgfSBmcm9tICcuLi8uLi9zY2VuZXJ5LXBoZXQvanMvTnVtYmVyRGlzcGxheS5qcyc7XG5pbXBvcnQgeyBLZXlib2FyZFV0aWxzLCBOb2RlLCBOb2RlT3B0aW9ucywgU2NlbmVyeUNvbnN0YW50cywgU2NlbmVyeUV2ZW50LCBUQ29sb3IgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xuaW1wb3J0IG51bGxTb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9udWxsU291bmRQbGF5ZXIuanMnO1xuaW1wb3J0IHNoYXJlZFNvdW5kUGxheWVycyBmcm9tICcuLi8uLi90YW1iby9qcy9zaGFyZWRTb3VuZFBsYXllcnMuanMnO1xuaW1wb3J0IFRTb3VuZFBsYXllciBmcm9tICcuLi8uLi90YW1iby9qcy9UU291bmRQbGF5ZXIuanMnO1xuaW1wb3J0IFRhbmRlbSBmcm9tICcuLi8uLi90YW5kZW0vanMvVGFuZGVtLmpzJztcbmltcG9ydCBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lciwgeyBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lck9wdGlvbnMgfSBmcm9tICcuL2FjY2Vzc2liaWxpdHkvQWNjZXNzaWJsZU51bWJlclNwaW5uZXIuanMnO1xuaW1wb3J0IEFycm93QnV0dG9uLCB7IEFycm93QnV0dG9uT3B0aW9ucyB9IGZyb20gJy4vYnV0dG9ucy9BcnJvd0J1dHRvbi5qcyc7XG5cbmltcG9ydCBzdW4gZnJvbSAnLi9zdW4uanMnO1xuXG50eXBlIE51bWJlclNwaW5uZXJBcnJvd3NQb3NpdGlvbiA9XG4gICdsZWZ0UmlnaHQnIHwgLy8gYXJyb3cgYnV0dG9ucyBvbiBsZWZ0IGFuZCByaWdodCBvZiB2YWx1ZVxuICAndG9wQm90dG9tJyB8IC8vIGFycm93IGJ1dHRvbnMgb24gdG9wIGFuZCBib3R0b20gb2YgdmFsdWVcbiAgJ2JvdGhSaWdodCcgfCAvLyBib3RoIGFycm93IGJ1dHRvbnMgdG8gdGhlIHJpZ2h0IG9mIHRoZSB2YWx1ZVxuICAnYm90aEJvdHRvbSc7IC8vIGJvdGggYXJyb3cgYnV0dG9ucyBiZWxvdyB0aGUgdmFsdWVcblxudHlwZSBTZWxmT3B0aW9ucyA9IHtcblxuICAvLyB3aGVyZSB0byBwbGFjZSB0aGUgYXJyb3cgYnV0dG9uc1xuICBhcnJvd3NQb3NpdGlvbj86IE51bWJlclNwaW5uZXJBcnJvd3NQb3NpdGlvbjtcblxuICAvLyBCeSBkZWZhdWx0LCBhcnJvd3MgYXJlIHNjYWxlZCB0byBmaXQgZGltZW5zaW9ucyBvZiB2YWx1ZSBiYWNrZ3JvdW5kLiBUaGlzIGlzIGFuIGFkZGl0aW9uYWwgc2NhbGUgZmFjdG9yLlxuICBhcnJvd3NTY2FsZT86IG51bWJlciB8IG51bGw7XG4gIGFycm93QnV0dG9uRmlsbD86IFRDb2xvcjtcbiAgYXJyb3dCdXR0b25TdHJva2U/OiBUQ29sb3I7XG4gIGFycm93QnV0dG9uTGluZVdpZHRoPzogbnVtYmVyO1xuXG4gIGFycm93c1NvdW5kUGxheWVyPzogVFNvdW5kUGxheWVyO1xuXG4gIC8vIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSBpbmNyZW1lbnQgYnV0dG9uIGlzIHByZXNzZWQuIERlZmF1bHRzIHRvIGFkZGluZyBvcHRpb25zLmRlbHRhVmFsdWUuXG4gIGluY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcblxuICAvLyBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgZGVjcmVtZW50IGJ1dHRvbiBpcyBwcmVzc2VkLiBEZWZhdWx0cyB0byBzdWJ0cmFjdGluZyBvcHRpb25zLmRlbHRhVmFsdWUuXG4gIGRlY3JlbWVudEZ1bmN0aW9uPzogKCAoIHZhbHVlOiBudW1iZXIgKSA9PiBudW1iZXIgKTtcblxuICAvLyBtYXkgYmUgaWdub3JlZCBpZiBpbmNyZW1lbnRGdW5jdGlvbiBhbmQgZGVjcmVtZW50RnVuY3Rpb24gYXJlIHByb3ZpZGVkXG4gIGRlbHRhVmFsdWU/OiBudW1iZXI7XG5cbiAgeFNwYWNpbmc/OiBudW1iZXI7XG4gIHlTcGFjaW5nPzogbnVtYmVyO1xuXG4gIC8vIE51bWJlckRpc3BsYXkgb3B0aW9uc1xuICBudW1iZXJEaXNwbGF5T3B0aW9ucz86IE51bWJlckRpc3BsYXlPcHRpb25zO1xuXG4gIC8vIGFycm93IGJ1dHRvbiBwb2ludGVyIGFyZWFzXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcbiAgdG91Y2hBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xuICBtb3VzZUFyZWFYRGlsYXRpb24/OiBudW1iZXI7XG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcbn07XG50eXBlIFBhcmVudE9wdGlvbnMgPSBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lck9wdGlvbnMgJiBOb2RlT3B0aW9ucztcbmV4cG9ydCB0eXBlIE51bWJlclNwaW5uZXJPcHRpb25zID0gU2VsZk9wdGlvbnMgJlxuICBTdHJpY3RPbWl0PFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbicgfCAndmFsdWVQcm9wZXJ0eScgfCAnZW5hYmxlZFJhbmdlUHJvcGVydHknIHwgJ2tleWJvYXJkU3RlcCcgfCAnc2hpZnRLZXlib2FyZFN0ZXAnIHwgJ3BhZ2VLZXlib2FyZFN0ZXAnIHwgJ29uSW5wdXQnPjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTnVtYmVyU3Bpbm5lciBleHRlbmRzIEFjY2Vzc2libGVOdW1iZXJTcGlubmVyKCBOb2RlLCAwICkge1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgbnVtYmVyRGlzcGxheTogTnVtYmVyRGlzcGxheTtcbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlTnVtYmVyU3Bpbm5lcjogKCkgPT4gdm9pZDtcblxuICAvKipcbiAgICogQHBhcmFtIG51bWJlclByb3BlcnR5IC0gdmFsdWUsIG11c3QgYmUgYW4gaW50ZWdlclxuICAgKiBAcGFyYW0gcmFuZ2VQcm9wZXJ0eSAtIGR5bmFtaWMgcmFuZ2Ugb2YgdmFsdWVzLCBtaW4gYW5kIG1heCBtdXN0IGJlIGludGVnZXJzXG4gICAqIEBwYXJhbSBbcHJvdmlkZWRPcHRpb25zXVxuICAgKi9cbiAgcHVibGljIGNvbnN0cnVjdG9yKCBudW1iZXJQcm9wZXJ0eTogUHJvcGVydHk8bnVtYmVyPiwgcmFuZ2VQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8UmFuZ2U+LCBwcm92aWRlZE9wdGlvbnM/OiBOdW1iZXJTcGlubmVyT3B0aW9ucyApIHtcblxuICAgIGFzc2VydCAmJiBhc3NlcnQoIHJhbmdlUHJvcGVydHkudmFsdWUuY29udGFpbnMoIG51bWJlclByb3BlcnR5LmdldCgpICksXG4gICAgICBgdmFsdWUgJHtudW1iZXJQcm9wZXJ0eS5nZXQoKX0gaXMgb3V0IG9mIHJhbmdlICR7cmFuZ2VQcm9wZXJ0eS52YWx1ZS50b1N0cmluZygpfWAgKTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8TnVtYmVyU3Bpbm5lck9wdGlvbnMsXG4gICAgICBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAnaW5jcmVtZW50RnVuY3Rpb24nIHwgJ2RlY3JlbWVudEZ1bmN0aW9uJz4sXG4gICAgICBQYXJlbnRPcHRpb25zPigpKCB7XG5cbiAgICAgIC8vIFNlbGZPcHRpb25zXG4gICAgICBhcnJvd3NTb3VuZFBsYXllcjogc2hhcmVkU291bmRQbGF5ZXJzLmdldCggJ3B1c2hCdXR0b24nICksXG5cbiAgICAgIGFycm93c1Bvc2l0aW9uOiAnYm90aFJpZ2h0JyxcbiAgICAgIGFycm93c1NjYWxlOiBudWxsLFxuICAgICAgYXJyb3dCdXR0b25GaWxsOiAnd2hpdGUnLFxuICAgICAgYXJyb3dCdXR0b25TdHJva2U6ICdibGFjaycsXG4gICAgICBhcnJvd0J1dHRvbkxpbmVXaWR0aDogMSxcbiAgICAgIGRlbHRhVmFsdWU6IDEsXG4gICAgICB4U3BhY2luZzogNSxcbiAgICAgIHlTcGFjaW5nOiAzLFxuICAgICAgbnVtYmVyRGlzcGxheU9wdGlvbnM6IHtcbiAgICAgICAgY29ybmVyUmFkaXVzOiA1LFxuICAgICAgICBiYWNrZ3JvdW5kU3Ryb2tlOiAnYmxhY2snXG4gICAgICB9LFxuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAwLFxuICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiAwLFxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxuICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiAwLFxuXG4gICAgICAvLyBBY2Nlc3NpYmxlTnVtYmVyU3Bpbm5lck9wdGlvbnNcbiAgICAgIHZhbHVlUHJvcGVydHk6IG51bWJlclByb3BlcnR5LFxuICAgICAgZW5hYmxlZFJhbmdlUHJvcGVydHk6IHJhbmdlUHJvcGVydHksXG4gICAgICBkaXNhYmxlZE9wYWNpdHk6IFNjZW5lcnlDb25zdGFudHMuRElTQUJMRURfT1BBQ0lUWSxcblxuICAgICAgLy8gVGhlIGZvY3VzIGhpZ2hsaWdodCBzdXJyb3VuZHMgdGhlIGVudGlyZSBjb21wb25lbnQsIGJ1dCB0aGUgc3Bpbm5lciBkaXNwbGF5IGlzIG5vdCBpbnRlcmFjdGl2ZSB3aXRoXG4gICAgICAvLyBtb3VzZSBhbmQgdG91Y2ggZXZlbnRzIHNvIHRoaXMgaGlnaGxpZ2h0IGlzIGhpZGRlbi4gSW5zdGVhZCwgZGVmYXVsdCBoaWdobGlnaHRzIHN1cnJvdW5kIHRoZSBhcnJvdyBidXR0b25zLlxuICAgICAgaW50ZXJhY3RpdmVIaWdobGlnaHQ6ICdpbnZpc2libGUnLFxuXG4gICAgICAvLyBQaEVULWlPXG4gICAgICB0YW5kZW06IFRhbmRlbS5SRVFVSVJFRCxcbiAgICAgIHRhbmRlbU5hbWVTdWZmaXg6ICdTcGlubmVyJyxcbiAgICAgIHBoZXRpb0ZlYXR1cmVkOiB0cnVlLFxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlIC8vIG9wdCBpbnRvIGRlZmF1bHQgUGhFVC1pTyBpbnN0cnVtZW50ZWQgZW5hYmxlZFByb3BlcnR5XG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XG5cbiAgICAvLyBEZWZhdWx0cyBmb3IgaW5jcmVtZW50RnVuY3Rpb24gYW5kIGRlY3JlbWVudEZ1bmN0aW9uXG4gICAgY29uc3QgaW5jcmVtZW50RnVuY3Rpb24gPSBvcHRpb25zLmluY3JlbWVudEZ1bmN0aW9uIHx8ICggKCB2YWx1ZTogbnVtYmVyICkgPT4gdmFsdWUgKyBvcHRpb25zLmRlbHRhVmFsdWUgKTtcbiAgICBjb25zdCBkZWNyZW1lbnRGdW5jdGlvbiA9IG9wdGlvbnMuZGVjcmVtZW50RnVuY3Rpb24gfHwgKCAoIHZhbHVlOiBudW1iZXIgKSA9PiB2YWx1ZSAtIG9wdGlvbnMuZGVsdGFWYWx1ZSApO1xuXG4gICAgY29uc3QgbnVtYmVyRGlzcGxheSA9IG5ldyBOdW1iZXJEaXNwbGF5KCBudW1iZXJQcm9wZXJ0eSwgcmFuZ2VQcm9wZXJ0eS52YWx1ZSxcbiAgICAgIGNvbWJpbmVPcHRpb25zPE51bWJlckRpc3BsYXlPcHRpb25zPigge1xuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ251bWJlckRpc3BsYXknIClcbiAgICAgIH0sIG9wdGlvbnMubnVtYmVyRGlzcGxheU9wdGlvbnMgKSApO1xuXG4gICAgLy8gYnV0dG9uc1xuICAgIGNvbnN0IGFycm93QnV0dG9uT3B0aW9uczogQXJyb3dCdXR0b25PcHRpb25zID0ge1xuICAgICAgYmFzZUNvbG9yOiBvcHRpb25zLmFycm93QnV0dG9uRmlsbCxcbiAgICAgIHN0cm9rZTogb3B0aW9ucy5hcnJvd0J1dHRvblN0cm9rZSxcbiAgICAgIGxpbmVXaWR0aDogb3B0aW9ucy5hcnJvd0J1dHRvbkxpbmVXaWR0aCxcbiAgICAgIGZvY3VzYWJsZTogZmFsc2UsXG5cbiAgICAgIC8vIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHNvdW5kIHBsYXllciBmb3IgdGhlIGJ1dHRvbnMgc2luY2Ugc291bmQgcHJvZHVjdGlvbiBpcyBoYW5kbGVkIGluIHRoaXMgY2xhc3MuXG4gICAgICBzb3VuZFBsYXllcjogbnVsbFNvdW5kUGxheWVyLFxuXG4gICAgICAvLyBhcyByZXF1ZXN0ZWQgaW4gaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNTc1XG4gICAgICBlbmFibGVkUHJvcGVydHlPcHRpb25zOiB7XG4gICAgICAgIHBoZXRpb1JlYWRPbmx5OiB0cnVlLFxuICAgICAgICBwaGV0aW9GZWF0dXJlZDogZmFsc2VcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gaW5jcmVtZW50IGJ1dHRvblxuICAgIGNvbnN0IGluY3JlbWVudEJ1dHRvbiA9IG5ldyBBcnJvd0J1dHRvbihcbiAgICAgICggb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ3RvcEJvdHRvbScgfHwgb3B0aW9ucy5hcnJvd3NQb3NpdGlvbiA9PT0gJ2JvdGhSaWdodCcgKSA/ICd1cCcgOiAncmlnaHQnLFxuICAgICAgKCkgPT4ge1xuICAgICAgICBudW1iZXJQcm9wZXJ0eS5zZXQoIGluY3JlbWVudEZ1bmN0aW9uKCBudW1iZXJQcm9wZXJ0eS5nZXQoKSApICk7XG4gICAgICAgIG9wdGlvbnMuYXJyb3dzU291bmRQbGF5ZXIucGxheSgpO1xuICAgICAgfSxcbiAgICAgIGNvbWJpbmVPcHRpb25zPEFycm93QnV0dG9uT3B0aW9ucz4oIHtcbiAgICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdpbmNyZW1lbnRCdXR0b24nIClcbiAgICAgIH0sIGFycm93QnV0dG9uT3B0aW9ucyApXG4gICAgKTtcblxuICAgIC8vIGRlY3JlbWVudCBidXR0b25cbiAgICBjb25zdCBkZWNyZW1lbnRCdXR0b24gPSBuZXcgQXJyb3dCdXR0b24oXG4gICAgICAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICd0b3BCb3R0b20nIHx8IG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkgPyAnZG93bicgOiAnbGVmdCcsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIG51bWJlclByb3BlcnR5LnNldCggZGVjcmVtZW50RnVuY3Rpb24oIG51bWJlclByb3BlcnR5LmdldCgpICkgKTtcbiAgICAgICAgb3B0aW9ucy5hcnJvd3NTb3VuZFBsYXllci5wbGF5KCk7XG4gICAgICB9LFxuICAgICAgY29tYmluZU9wdGlvbnM8QXJyb3dCdXR0b25PcHRpb25zPigge1xuICAgICAgICB0YW5kZW06IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RlY3JlbWVudEJ1dHRvbicgKVxuICAgICAgfSwgYXJyb3dCdXR0b25PcHRpb25zIClcbiAgICApO1xuXG4gICAgLy8gYXJyb3cgYnV0dG9uIHNjYWxpbmdcbiAgICBsZXQgYXJyb3dzU2NhbGU7XG4gICAgaWYgKCAhYXJyb3dzU2NhbGUgKSB7XG4gICAgICBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdsZWZ0UmlnaHQnICkge1xuICAgICAgICBhcnJvd3NTY2FsZSA9IG51bWJlckRpc3BsYXkuaGVpZ2h0IC8gaW5jcmVtZW50QnV0dG9uLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAndG9wQm90dG9tJyApIHtcbiAgICAgICAgYXJyb3dzU2NhbGUgPSBudW1iZXJEaXNwbGF5LndpZHRoIC8gaW5jcmVtZW50QnV0dG9uLndpZHRoO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkge1xuICAgICAgICBhcnJvd3NTY2FsZSA9ICggKCBudW1iZXJEaXNwbGF5LmhlaWdodCAvIDIgKSAtICggb3B0aW9ucy55U3BhY2luZyAvIDIgKSApIC8gaW5jcmVtZW50QnV0dG9uLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGVsc2UgeyAvLyAnYm90aEJvdHRvbSdcbiAgICAgICAgYXJyb3dzU2NhbGUgPSAoICggbnVtYmVyRGlzcGxheS53aWR0aCAvIDIgKSAtICggb3B0aW9ucy54U3BhY2luZyAvIDIgKSApIC8gaW5jcmVtZW50QnV0dG9uLndpZHRoO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIG9wdGlvbnMuYXJyb3dzU2NhbGUgKSB7XG4gICAgICBhcnJvd3NTY2FsZSA9IGFycm93c1NjYWxlICogb3B0aW9ucy5hcnJvd3NTY2FsZTtcbiAgICB9XG4gICAgaW5jcmVtZW50QnV0dG9uLnNldFNjYWxlTWFnbml0dWRlKCBhcnJvd3NTY2FsZSApO1xuICAgIGRlY3JlbWVudEJ1dHRvbi5zZXRTY2FsZU1hZ25pdHVkZSggYXJyb3dzU2NhbGUgKTtcblxuICAgIC8vIEJlY2F1c2UgcmFuZ2UgbWF5IGNoYW5nZSB2aWEgcmFuZ2VQcm9wZXJ0eSwgdGhlIHNpemUgb2YgbnVtYmVyRGlzcGxheSBtYXkgY2hhbmdlLCBpbiB3aGljaCBjYXNlIGxheW91dCB3aWxsIG5lZWRcbiAgICAvLyB0byBiZSByZXZpc2VkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNzA5XG4gICAgY29uc3QgdXBkYXRlTGF5b3V0ID0gKCkgPT4ge1xuICAgICAgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnbGVmdFJpZ2h0JyApIHtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmxlZnQgPSBudW1iZXJEaXNwbGF5LnJpZ2h0ICsgb3B0aW9ucy54U3BhY2luZztcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnJpZ2h0ID0gbnVtYmVyRGlzcGxheS5sZWZ0IC0gb3B0aW9ucy54U3BhY2luZztcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmNlbnRlclkgPSBkZWNyZW1lbnRCdXR0b24uY2VudGVyWSA9IG51bWJlckRpc3BsYXkuY2VudGVyWTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAndG9wQm90dG9tJyApIHtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmNlbnRlclggPSBkZWNyZW1lbnRCdXR0b24uY2VudGVyWCA9IG51bWJlckRpc3BsYXkuY2VudGVyWDtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmJvdHRvbSA9IG51bWJlckRpc3BsYXkudG9wIC0gb3B0aW9ucy55U3BhY2luZztcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnRvcCA9IG51bWJlckRpc3BsYXkuYm90dG9tICsgb3B0aW9ucy55U3BhY2luZztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aFJpZ2h0JyApIHtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLmxlZnQgPSBkZWNyZW1lbnRCdXR0b24ubGVmdCA9IG51bWJlckRpc3BsYXkucmlnaHQgKyBvcHRpb25zLnhTcGFjaW5nO1xuICAgICAgICBpbmNyZW1lbnRCdXR0b24uYm90dG9tID0gbnVtYmVyRGlzcGxheS5jZW50ZXJZIC0gKCBvcHRpb25zLnlTcGFjaW5nIC8gMiApO1xuICAgICAgICBkZWNyZW1lbnRCdXR0b24udG9wID0gbnVtYmVyRGlzcGxheS5jZW50ZXJZICsgKCBvcHRpb25zLnlTcGFjaW5nIC8gMiApO1xuICAgICAgfVxuICAgICAgZWxzZSB7IC8vICdib3RoQm90dG9tJ1xuICAgICAgICBpbmNyZW1lbnRCdXR0b24ubGVmdCA9IG51bWJlckRpc3BsYXkuY2VudGVyWCArICggb3B0aW9ucy54U3BhY2luZyAvIDIgKTtcbiAgICAgICAgZGVjcmVtZW50QnV0dG9uLnJpZ2h0ID0gbnVtYmVyRGlzcGxheS5jZW50ZXJYIC0gKCBvcHRpb25zLnhTcGFjaW5nIC8gMiApO1xuICAgICAgICBpbmNyZW1lbnRCdXR0b24udG9wID0gZGVjcmVtZW50QnV0dG9uLnRvcCA9IG51bWJlckRpc3BsYXkuYm90dG9tICsgb3B0aW9ucy55U3BhY2luZztcbiAgICAgIH1cbiAgICB9O1xuICAgIG51bWJlckRpc3BsYXkuYm91bmRzUHJvcGVydHkubGluayggKCkgPT4gdXBkYXRlTGF5b3V0KCkgKTtcblxuICAgIC8vIHRvdWNoIGFyZWFzXG4gICAgaWYgKCBvcHRpb25zLnRvdWNoQXJlYVhEaWxhdGlvbiB8fCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApIHtcblxuICAgICAgaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xuICAgICAgZGVjcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGRlY3JlbWVudEJ1dHRvbi5sb2NhbEJvdW5kcy5kaWxhdGVkWFkoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uLCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xuXG4gICAgICAvLyBzaGlmdCB0b3VjaCBhcmVhcyBmb3IgdGhlc2Ugb3B0aW9ucywgdG8gcHJldmVudCBvdmVybGFwXG4gICAgICBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoUmlnaHQnICkge1xuICAgICAgICBpbmNyZW1lbnRCdXR0b24udG91Y2hBcmVhID0gaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYS5zaGlmdGVkWSggLW9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uICk7XG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRZKCBvcHRpb25zLnRvdWNoQXJlYVlEaWxhdGlvbiApO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoIG9wdGlvbnMuYXJyb3dzUG9zaXRpb24gPT09ICdib3RoQm90dG9tJyApIHtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLnRvdWNoQXJlYSA9IGluY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEuc2hpZnRlZFgoIG9wdGlvbnMudG91Y2hBcmVhWERpbGF0aW9uICk7XG4gICAgICAgIGRlY3JlbWVudEJ1dHRvbi50b3VjaEFyZWEgPSBkZWNyZW1lbnRCdXR0b24udG91Y2hBcmVhLnNoaWZ0ZWRYKCAtb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBtb3VzZSBhcmVhc1xuICAgIGlmICggb3B0aW9ucy5tb3VzZUFyZWFYRGlsYXRpb24gfHwgb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKSB7XG5cbiAgICAgIGluY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEgPSBpbmNyZW1lbnRCdXR0b24ubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKTtcbiAgICAgIGRlY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEgPSBkZWNyZW1lbnRCdXR0b24ubG9jYWxCb3VuZHMuZGlsYXRlZFhZKCBvcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiwgb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKTtcblxuICAgICAgLy8gc2hpZnQgdG91Y2ggYXJlYXMgZm9yIHRoZXNlIG9wdGlvbnMsIHRvIHByZXZlbnQgb3ZlcmxhcFxuICAgICAgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aFJpZ2h0JyApIHtcbiAgICAgICAgaW5jcmVtZW50QnV0dG9uLm1vdXNlQXJlYSA9IGluY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEuc2hpZnRlZFkoIC1vcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvbiApO1xuICAgICAgICBkZWNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gZGVjcmVtZW50QnV0dG9uLm1vdXNlQXJlYS5zaGlmdGVkWSggb3B0aW9ucy5tb3VzZUFyZWFZRGlsYXRpb24gKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBvcHRpb25zLmFycm93c1Bvc2l0aW9uID09PSAnYm90aEJvdHRvbScgKSB7XG4gICAgICAgIGluY3JlbWVudEJ1dHRvbi5tb3VzZUFyZWEgPSBpbmNyZW1lbnRCdXR0b24ubW91c2VBcmVhLnNoaWZ0ZWRYKCBvcHRpb25zLm1vdXNlQXJlYVhEaWxhdGlvbiApO1xuICAgICAgICBkZWNyZW1lbnRCdXR0b24ubW91c2VBcmVhID0gZGVjcmVtZW50QnV0dG9uLm1vdXNlQXJlYS5zaGlmdGVkWCggLW9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IFsgbnVtYmVyRGlzcGxheSwgaW5jcmVtZW50QnV0dG9uLCBkZWNyZW1lbnRCdXR0b24gXTtcblxuICAgIC8vIHBkb20gLSBOdW1iZXJTcGlubmVyIHVzZXMgQWNjZXNzaWJsZVZhbHVlSGFuZGxlciBmb3IgYWNjZXNzaWJpbGl0eSwgYnV0IGl0IHdhcyBkZWNpZGVkIHRoYXQga2V5Ym9hcmRTdGVwXG4gICAgLy8gYW5kIHNoaWZ0S2V5Ym9hcmRTdGVwIHNob3VsZCBoYXZlIHRoZSBzYW1lIGJlaGF2aW9yIGFzIHRoZSBOdW1iZXJTcGlubmVyIEFycm93QnV0dG9ucyBBTkQgdGhlIEFycm93QnV0dG9uc1xuICAgIC8vIHNob3VsZCBsb29rIGRlcHJlc3NlZCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhvc2Uga2V5cy4gVG8gYWNjb21wbGlzaCB0aGlzIHdlIGFjdHVhbGx5IHByZXNzIHRoZSBBcnJvd0J1dHRvbnNcbiAgICAvLyBpbiByZXNwb25zZSB0byBpbnB1dCB3aXRoIHRob3NlIGtleXMuIGtleWJvYXJkU3RlcCBhbmQgc2hpZnRLZXlib2FyZFN0ZXAgYXJlIHNldCB0byB6ZXJvIHNvIHRoZSB2YWx1ZSBpc24ndFxuICAgIC8vIG1vZGlmaWVkIGFnYWluIGJ5IEFjY2Vzc2libGVWYWx1ZUhhbmRsZXIuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvc2NlbmVyeS9pc3N1ZXMvMTM0MC5cbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBvcHRpb25zLmtleWJvYXJkU3RlcCA9PT0gdW5kZWZpbmVkLCAnTnVtYmVyU3Bpbm5lciBzZXRzIGtleWJvYXJkU3RlcCwgaXQgd2lsbCBiZSB0aGUgc2FtZSBhcyBkZWx0YVZhbHVlJyApO1xuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMuc2hpZnRLZXlib2FyZFN0ZXAgPT09IHVuZGVmaW5lZCwgJ051bWJlclNwaW5uZXIgc2V0cyBzaGlmdEtleWJvYXJkU3RlcCwgaXQgd2lsbCBiZSB0aGUgc2FtZSBhcyBkZWx0YVZhbHVlJyApO1xuICAgIGFzc2VydCAmJiBhc3NlcnQoIG9wdGlvbnMucGFnZUtleWJvYXJkU3RlcCA9PT0gdW5kZWZpbmVkLCAnTnVtYmVyU3Bpbm5lciBzZXRzIHBhZ2VLZXlib2FyZFN0ZXAsIGl0IHNob3VsZCBub3QgYmUgdXNlZCB3aXRoIE51bWJlclNwaW5uZXInICk7XG4gICAgb3B0aW9ucy5rZXlib2FyZFN0ZXAgPSAwO1xuICAgIG9wdGlvbnMuc2hpZnRLZXlib2FyZFN0ZXAgPSAwO1xuICAgIG9wdGlvbnMucGFnZUtleWJvYXJkU3RlcCA9IDA7XG5cbiAgICAvLyBTb3VuZHMgYXJlIHBsYXllZCB3aGVuIHRoZSBidXR0b24gaXMgcHJlc3NlZC4gQnV0IGZvciAnaG9tZScgYW5kICdlbmQnIGtleXMsIHRoZSBidXR0b24gaXMgbm90IHByZXNzZWQsIHNvIHRoZVxuICAgIC8vIHNvdW5kIGlzIHBsYXllZCBtYW51YWxseS5cbiAgICBvcHRpb25zLm9uSW5wdXQgPSAoICggKCBldmVudDogU2NlbmVyeUV2ZW50LCBvbGRWYWx1ZTogbnVtYmVyICkgPT4ge1xuICAgICAgaWYgKCBldmVudC5pc0Zyb21QRE9NKCkgKSB7XG4gICAgICAgIGNvbnN0IGRvbUV2ZW50ID0gZXZlbnQuZG9tRXZlbnQ7XG5cbiAgICAgICAgLy8gVGhlIHNvdW5kIHNob3VsZCBub3QgcGxheSBpZiB0aGUgdmFsdWUgaXMgYWxyZWFkeSBhdCB0aGUgaG9tZSBvciBlbmQgdmFsdWUuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IG51bWJlclByb3BlcnR5LnZhbHVlO1xuICAgICAgICBpZiAoIEtleWJvYXJkVXRpbHMuaXNLZXlFdmVudCggZG9tRXZlbnQsIEtleWJvYXJkVXRpbHMuS0VZX0hPTUUgKSAmJiBvbGRWYWx1ZSAhPT0gY3VycmVudFZhbHVlICkge1xuICAgICAgICAgIG9wdGlvbnMuYXJyb3dzU291bmRQbGF5ZXIucGxheSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCBLZXlib2FyZFV0aWxzLmlzS2V5RXZlbnQoIGRvbUV2ZW50LCBLZXlib2FyZFV0aWxzLktFWV9FTkQgKSAmJiBvbGRWYWx1ZSAhPT0gY3VycmVudFZhbHVlICkge1xuICAgICAgICAgIG9wdGlvbnMuYXJyb3dzU291bmRQbGF5ZXIucGxheSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSApICk7XG5cbiAgICAvLyBDYWxsIHN1cGVyIHdpdGhvdXQgdGhlIG9wdGlvbnMgdGhhdCByZXF1aXJlIHZhbGlkIGJvdW5kcy4gQ2FsbCBtdXRhdGUgbGF0ZXIgd2l0aCB0aG9zZSBvcHRpb25zLlxuICAgIGNvbnN0IGJvdW5kc1JlcXVpcmVkT3B0aW9uS2V5cyA9IF8ucGljayggb3B0aW9ucywgTm9kZS5SRVFVSVJFU19CT1VORFNfT1BUSU9OX0tFWVMgKTtcbiAgICBzdXBlciggXy5vbWl0KCBvcHRpb25zLCBOb2RlLlJFUVVJUkVTX0JPVU5EU19PUFRJT05fS0VZUyApICk7XG5cbiAgICAvLyBlbmFibGUvZGlzYWJsZSBhcnJvdyBidXR0b25zXG4gICAgY29uc3QgdXBkYXRlRW5hYmxlZCA9ICgpID0+IHtcbiAgICAgIGluY3JlbWVudEJ1dHRvbi5lbmFibGVkID0gKCBpbmNyZW1lbnRGdW5jdGlvbiggbnVtYmVyUHJvcGVydHkudmFsdWUgKSA8PSByYW5nZVByb3BlcnR5LnZhbHVlLm1heCApO1xuICAgICAgZGVjcmVtZW50QnV0dG9uLmVuYWJsZWQgPSAoIGRlY3JlbWVudEZ1bmN0aW9uKCBudW1iZXJQcm9wZXJ0eS52YWx1ZSApID49IHJhbmdlUHJvcGVydHkudmFsdWUubWluICk7XG4gICAgfTtcblxuICAgIC8vIHN5bmNocm9uaXplIHdpdGggbnVtYmVyIHZhbHVlXG4gICAgY29uc3QgbnVtYmVyUHJvcGVydHlPYnNlcnZlciA9ICggdmFsdWU6IG51bWJlciApID0+IHtcbiAgICAgIGFzc2VydCAmJiBhc3NlcnQoIHJhbmdlUHJvcGVydHkudmFsdWUuY29udGFpbnMoIHZhbHVlICksIGB2YWx1ZSBvdXQgb2YgcmFuZ2U6ICR7dmFsdWV9YCApO1xuICAgICAgdXBkYXRlRW5hYmxlZCgpO1xuICAgIH07XG4gICAgbnVtYmVyUHJvcGVydHkubGluayggbnVtYmVyUHJvcGVydHlPYnNlcnZlciApOyAvLyBtdXN0IGJlIHVubGlua2VkIGluIGRpc3Bvc2VcblxuICAgIC8vIER5bmFtaWMgcmFuZ2UgY2hhbmdlcywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5LXBoZXQvaXNzdWVzLzMwNVxuICAgIGNvbnN0IHJhbmdlT2JzZXJ2ZXIgPSAoIHJhbmdlOiBSYW5nZSApID0+IHtcblxuICAgICAgLy8gSWYgb3VyIHZhbHVlIGlzIG91dHNpZGUgb3VyIG5ldyByYW5nZSwgYWRqdXN0IGl0IHRvIGJlIHdpdGhpbiB0aGUgcmFuZ2UuXG4gICAgICBudW1iZXJQcm9wZXJ0eS52YWx1ZSA9IHJhbmdlLmNvbnN0cmFpblZhbHVlKCBudW1iZXJQcm9wZXJ0eS52YWx1ZSApO1xuXG4gICAgICAvLyBSYW5nZSBjaGFuZ2VzIG1heSBjaGFuZ2Ugd2hldGhlciB0aGUgYnV0dG9ucyBhcmUgZW5hYmxlZFxuICAgICAgdXBkYXRlRW5hYmxlZCgpO1xuICAgIH07XG4gICAgcmFuZ2VQcm9wZXJ0eS5saW5rKCByYW5nZU9ic2VydmVyICk7XG5cbiAgICAvLyBwZG9tIC0gY2xpY2sgYXJyb3cgYnV0dG9ucyBvbiBwcmVzcyBvZiBhcnJvdyBrZXlzIHNvIHRoYXQgdGhlIFByb3BlcnR5IHZhbHVlIGNoYW5nZXMgYnkgZGVsdGFWYWx1ZVxuICAgIC8vIGFuZCB0aGUgYnV0dG9ucyBsb29rIGRlcHJlc3NlZFxuICAgIGNvbnN0IGluY3JlYXNlZExpc3RlbmVyID0gKCBpc0Rvd246IGJvb2xlYW4gKSA9PiAoIGlzRG93biAmJiBpbmNyZW1lbnRCdXR0b24ucGRvbUNsaWNrKCkgKTtcbiAgICBjb25zdCBkZWNyZWFzZWRMaXN0ZW5lciA9ICggaXNEb3duOiBib29sZWFuICkgPT4gKCBpc0Rvd24gJiYgZGVjcmVtZW50QnV0dG9uLnBkb21DbGljaygpICk7XG4gICAgdGhpcy5wZG9tSW5jcmVtZW50RG93bkVtaXR0ZXIuYWRkTGlzdGVuZXIoIGluY3JlYXNlZExpc3RlbmVyICk7XG4gICAgdGhpcy5wZG9tRGVjcmVtZW50RG93bkVtaXR0ZXIuYWRkTGlzdGVuZXIoIGRlY3JlYXNlZExpc3RlbmVyICk7XG5cbiAgICB0aGlzLmRpc3Bvc2VOdW1iZXJTcGlubmVyID0gKCkgPT4ge1xuXG4gICAgICAvLyBkaXNwb3NlIG9mIHN1YmNvbXBvbmVudHNcbiAgICAgIG51bWJlckRpc3BsYXkuZGlzcG9zZSgpO1xuICAgICAgaW5jcmVtZW50QnV0dG9uLmRpc3Bvc2UoKTtcbiAgICAgIGRlY3JlbWVudEJ1dHRvbi5kaXNwb3NlKCk7XG5cbiAgICAgIC8vIGRpc3Bvc2UgYTExeSBmZWF0dXJlc1xuICAgICAgdGhpcy5wZG9tSW5jcmVtZW50RG93bkVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoIGluY3JlYXNlZExpc3RlbmVyICk7XG4gICAgICB0aGlzLnBkb21EZWNyZW1lbnREb3duRW1pdHRlci5yZW1vdmVMaXN0ZW5lciggZGVjcmVhc2VkTGlzdGVuZXIgKTtcblxuICAgICAgbnVtYmVyUHJvcGVydHkudW5saW5rKCBudW1iZXJQcm9wZXJ0eU9ic2VydmVyICk7XG4gICAgICByYW5nZVByb3BlcnR5LnVubGluayggcmFuZ2VPYnNlcnZlciApO1xuICAgIH07XG5cbiAgICB0aGlzLm11dGF0ZSggYm91bmRzUmVxdWlyZWRPcHRpb25LZXlzICk7XG5cbiAgICB0aGlzLm51bWJlckRpc3BsYXkgPSBudW1iZXJEaXNwbGF5O1xuXG4gICAgLy8gQ3JlYXRlIGEgbGluayB0byBhc3NvY2lhdGVkIFByb3BlcnR5LCBzbyBpdCdzIGVhc2llciB0byBmaW5kIGluIFN0dWRpby4gTXVzdCBiZSBhZnRlciBpbnN0cnVtZW50YXRpb25cbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIG51bWJlclByb3BlcnR5LCB7XG4gICAgICB0YW5kZW1OYW1lOiAncHJvcGVydHknXG4gICAgfSApO1xuXG4gICAgLy8gc3VwcG9ydCBmb3IgYmluZGVyIGRvY3VtZW50YXRpb24sIHN0cmlwcGVkIG91dCBpbiBidWlsZHMgYW5kIG9ubHkgcnVucyB3aGVuID9iaW5kZXIgaXMgc3BlY2lmaWVkXG4gICAgYXNzZXJ0ICYmIHdpbmRvdy5waGV0Py5jaGlwcGVyPy5xdWVyeVBhcmFtZXRlcnM/LmJpbmRlciAmJiBJbnN0YW5jZVJlZ2lzdHJ5LnJlZ2lzdGVyRGF0YVVSTCggJ3N1bicsICdOdW1iZXJTcGlubmVyJywgdGhpcyApO1xuICB9XG5cbiAgcHVibGljIG92ZXJyaWRlIGRpc3Bvc2UoKTogdm9pZCB7XG4gICAgdGhpcy5kaXNwb3NlTnVtYmVyU3Bpbm5lcigpO1xuICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgfVxufVxuXG5zdW4ucmVnaXN0ZXIoICdOdW1iZXJTcGlubmVyJywgTnVtYmVyU3Bpbm5lciApOyJdLCJuYW1lcyI6WyJJbnN0YW5jZVJlZ2lzdHJ5Iiwib3B0aW9uaXplIiwiY29tYmluZU9wdGlvbnMiLCJOdW1iZXJEaXNwbGF5IiwiS2V5Ym9hcmRVdGlscyIsIk5vZGUiLCJTY2VuZXJ5Q29uc3RhbnRzIiwibnVsbFNvdW5kUGxheWVyIiwic2hhcmVkU291bmRQbGF5ZXJzIiwiVGFuZGVtIiwiQWNjZXNzaWJsZU51bWJlclNwaW5uZXIiLCJBcnJvd0J1dHRvbiIsInN1biIsIk51bWJlclNwaW5uZXIiLCJkaXNwb3NlIiwiZGlzcG9zZU51bWJlclNwaW5uZXIiLCJudW1iZXJQcm9wZXJ0eSIsInJhbmdlUHJvcGVydHkiLCJwcm92aWRlZE9wdGlvbnMiLCJ3aW5kb3ciLCJhc3NlcnQiLCJ2YWx1ZSIsImNvbnRhaW5zIiwiZ2V0IiwidG9TdHJpbmciLCJvcHRpb25zIiwiYXJyb3dzU291bmRQbGF5ZXIiLCJhcnJvd3NQb3NpdGlvbiIsImFycm93c1NjYWxlIiwiYXJyb3dCdXR0b25GaWxsIiwiYXJyb3dCdXR0b25TdHJva2UiLCJhcnJvd0J1dHRvbkxpbmVXaWR0aCIsImRlbHRhVmFsdWUiLCJ4U3BhY2luZyIsInlTcGFjaW5nIiwibnVtYmVyRGlzcGxheU9wdGlvbnMiLCJjb3JuZXJSYWRpdXMiLCJiYWNrZ3JvdW5kU3Ryb2tlIiwidG91Y2hBcmVhWERpbGF0aW9uIiwidG91Y2hBcmVhWURpbGF0aW9uIiwibW91c2VBcmVhWERpbGF0aW9uIiwibW91c2VBcmVhWURpbGF0aW9uIiwidmFsdWVQcm9wZXJ0eSIsImVuYWJsZWRSYW5nZVByb3BlcnR5IiwiZGlzYWJsZWRPcGFjaXR5IiwiRElTQUJMRURfT1BBQ0lUWSIsImludGVyYWN0aXZlSGlnaGxpZ2h0IiwidGFuZGVtIiwiUkVRVUlSRUQiLCJ0YW5kZW1OYW1lU3VmZml4IiwicGhldGlvRmVhdHVyZWQiLCJwaGV0aW9FbmFibGVkUHJvcGVydHlJbnN0cnVtZW50ZWQiLCJpbmNyZW1lbnRGdW5jdGlvbiIsImRlY3JlbWVudEZ1bmN0aW9uIiwibnVtYmVyRGlzcGxheSIsImNyZWF0ZVRhbmRlbSIsImFycm93QnV0dG9uT3B0aW9ucyIsImJhc2VDb2xvciIsInN0cm9rZSIsImxpbmVXaWR0aCIsImZvY3VzYWJsZSIsInNvdW5kUGxheWVyIiwiZW5hYmxlZFByb3BlcnR5T3B0aW9ucyIsInBoZXRpb1JlYWRPbmx5IiwiaW5jcmVtZW50QnV0dG9uIiwic2V0IiwicGxheSIsImRlY3JlbWVudEJ1dHRvbiIsImhlaWdodCIsIndpZHRoIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJ1cGRhdGVMYXlvdXQiLCJsZWZ0IiwicmlnaHQiLCJjZW50ZXJZIiwiY2VudGVyWCIsImJvdHRvbSIsInRvcCIsImJvdW5kc1Byb3BlcnR5IiwibGluayIsInRvdWNoQXJlYSIsImxvY2FsQm91bmRzIiwiZGlsYXRlZFhZIiwic2hpZnRlZFkiLCJzaGlmdGVkWCIsIm1vdXNlQXJlYSIsImNoaWxkcmVuIiwia2V5Ym9hcmRTdGVwIiwidW5kZWZpbmVkIiwic2hpZnRLZXlib2FyZFN0ZXAiLCJwYWdlS2V5Ym9hcmRTdGVwIiwib25JbnB1dCIsImV2ZW50Iiwib2xkVmFsdWUiLCJpc0Zyb21QRE9NIiwiZG9tRXZlbnQiLCJjdXJyZW50VmFsdWUiLCJpc0tleUV2ZW50IiwiS0VZX0hPTUUiLCJLRVlfRU5EIiwiYm91bmRzUmVxdWlyZWRPcHRpb25LZXlzIiwiXyIsInBpY2siLCJSRVFVSVJFU19CT1VORFNfT1BUSU9OX0tFWVMiLCJvbWl0IiwidXBkYXRlRW5hYmxlZCIsImVuYWJsZWQiLCJtYXgiLCJtaW4iLCJudW1iZXJQcm9wZXJ0eU9ic2VydmVyIiwicmFuZ2VPYnNlcnZlciIsInJhbmdlIiwiY29uc3RyYWluVmFsdWUiLCJpbmNyZWFzZWRMaXN0ZW5lciIsImlzRG93biIsInBkb21DbGljayIsImRlY3JlYXNlZExpc3RlbmVyIiwicGRvbUluY3JlbWVudERvd25FbWl0dGVyIiwiYWRkTGlzdGVuZXIiLCJwZG9tRGVjcmVtZW50RG93bkVtaXR0ZXIiLCJyZW1vdmVMaXN0ZW5lciIsInVubGluayIsIm11dGF0ZSIsImFkZExpbmtlZEVsZW1lbnQiLCJ0YW5kZW1OYW1lIiwicGhldCIsImNoaXBwZXIiLCJxdWVyeVBhcmFtZXRlcnMiLCJiaW5kZXIiLCJyZWdpc3RlckRhdGFVUkwiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7OztDQUtDLEdBS0QsT0FBT0Esc0JBQXNCLHVEQUF1RDtBQUNwRixPQUFPQyxhQUFhQyxjQUFjLFFBQVEsa0NBQWtDO0FBRTVFLE9BQU9DLG1CQUE2Qyx5Q0FBeUM7QUFDN0YsU0FBU0MsYUFBYSxFQUFFQyxJQUFJLEVBQWVDLGdCQUFnQixRQUE4Qiw4QkFBOEI7QUFDdkgsT0FBT0MscUJBQXFCLG9DQUFvQztBQUNoRSxPQUFPQyx3QkFBd0IsdUNBQXVDO0FBRXRFLE9BQU9DLFlBQVksNEJBQTRCO0FBQy9DLE9BQU9DLDZCQUFpRSw2Q0FBNkM7QUFDckgsT0FBT0MsaUJBQXlDLDJCQUEyQjtBQUUzRSxPQUFPQyxTQUFTLFdBQVc7QUE4Q1osSUFBQSxBQUFNQyxnQkFBTixNQUFNQSxzQkFBc0JILHdCQUF5QkwsTUFBTTtJQXlSeERTLFVBQWdCO1FBQzlCLElBQUksQ0FBQ0Msb0JBQW9CO1FBQ3pCLEtBQUssQ0FBQ0Q7SUFDUjtJQXZSQTs7OztHQUlDLEdBQ0QsWUFBb0JFLGNBQWdDLEVBQUVDLGFBQXVDLEVBQUVDLGVBQXNDLENBQUc7WUE0UTVIQyxzQ0FBQUEsc0JBQUFBO1FBMVFWQyxVQUFVQSxPQUFR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