// Copyright 2013-2024, University of Colorado Boulder
/**
 * AquaRadioButtonGroup creates a group of AquaRadioButtons and manages their layout.
 *
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Chris Malley (PixelZoom, Inc.)
 */ import Emitter from '../../axon/js/Emitter.js';
import optionize, { combineOptions } from '../../phet-core/js/optionize.js';
import { assertNoAdditionalChildren, FlowBox, KeyboardUtils, ParallelDOM, PDOMPeer, SceneryConstants } from '../../scenery/js/imports.js';
import multiSelectionSoundPlayerFactory from '../../tambo/js/multiSelectionSoundPlayerFactory.js';
import Tandem from '../../tandem/js/Tandem.js';
import AquaRadioButton from './AquaRadioButton.js';
import { getGroupItemNodes } from './GroupItemOptions.js';
import sun from './sun.js';
// pdom - An id for each instance of AquaRadioButtonGroup, passed to individual buttons in the group.
// Each button in a radio button group must have the same "name" attribute to be considered in a group, otherwise
// arrow keys will navigate all radio type inputs in the document.
let instanceCount = 0;
// to prefix instanceCount in case there are different kinds of "groups"
const CLASS_NAME = 'AquaRadioButtonGroup';
let AquaRadioButtonGroup = class AquaRadioButtonGroup extends FlowBox {
    onRadioButtonInput() {
        this.onInputEmitter.emit();
    }
    dispose() {
        this.disposeAquaRadioButtonGroup();
        super.dispose();
    }
    /**
   * Gets the radio button that corresponds to the specified value.
   */ getButton(value) {
        const button = _.find(this.radioButtons, (radioButton)=>radioButton.value === value);
        assert && assert(button, `no radio button found for value ${value}`);
        return button;
    }
    constructor(property, items, providedOptions){
        instanceCount++;
        const options = optionize()({
            // AquaRadioButtonGroupOptions
            touchAreaXDilation: 0,
            touchAreaYDilation: 0,
            mouseAreaXDilation: 0,
            mouseAreaYDilation: 0,
            // FlowBoxOptions
            orientation: 'vertical',
            spacing: 3,
            stretch: true,
            disabledOpacity: SceneryConstants.DISABLED_OPACITY,
            // phet-io
            tandem: Tandem.REQUIRED,
            tandemNameSuffix: 'RadioButtonGroup',
            visiblePropertyOptions: {
                phetioFeatured: true
            },
            phetioEnabledPropertyInstrumented: true,
            phetioFeatured: true,
            // pdom
            tagName: 'ul',
            labelTagName: 'h3',
            ariaRole: 'radiogroup',
            helpTextBehavior: ParallelDOM.HELP_TEXT_BEFORE_CONTENT,
            groupFocusHighlight: true
        }, providedOptions);
        const nodes = getGroupItemNodes(items, options.tandem);
        // Default to a left alignment for vertical layout
        if (options.orientation === 'vertical') {
            options.align = options.align || 'left';
        }
        // Create a radio button for each item
        const radioButtons = items.map((item, index)=>{
            // @ts-expect-error - runtime check to prevent prior pattern, see https://github.com/phetsims/sun/issues/794
            assert && assert(!item.tandem, 'Cannot specify tandem any more');
            const node = nodes[index];
            assert && assert(!node.hasPDOMContent, 'Accessibility is provided by AquaRadioButton and accessibleName of the AquaRadioButtonGroupItem options. ' + 'Additional PDOM content in the provided Node could break accessibility.');
            return new AquaRadioButton(property, item.value, node, combineOptions({
                a11yNameAttribute: CLASS_NAME + instanceCount,
                soundPlayer: multiSelectionSoundPlayerFactory.getSelectionSoundPlayer(index),
                tandem: item.tandemName ? options.tandem.createTandem(item.tandemName) : options.tandem === Tandem.OPT_OUT ? Tandem.OPT_OUT : Tandem.REQUIRED,
                // NOTE: This does NOT support dynamic orientation changes. If you need that, change RectangularButton to support
                // dynamic options
                touchAreaXDilation: options.orientation === 'horizontal' ? options.spacing / 2 : options.touchAreaXDilation,
                touchAreaYDilation: options.orientation === 'vertical' ? options.spacing / 2 : options.touchAreaYDilation,
                mouseAreaXDilation: options.orientation === 'horizontal' ? options.spacing / 2 : options.mouseAreaXDilation,
                mouseAreaYDilation: options.orientation === 'vertical' ? options.spacing / 2 : options.mouseAreaYDilation
            }, options.radioButtonOptions, item.options));
        });
        options.children = radioButtons;
        super(options), this.onInputEmitter = new Emitter();
        // pdom - this node's primary sibling is aria-labelledby its own label so the label content is read whenever
        // a member of the group receives focus
        this.addAriaLabelledbyAssociation({
            thisElementName: PDOMPeer.PRIMARY_SIBLING,
            otherNode: this,
            otherElementName: PDOMPeer.LABEL_SIBLING
        });
        // zoom - signify that key input is reserved and we should not pan when user presses arrow keys
        // See https://github.com/phetsims/scenery/issues/974
        const intentListener = {
            keydown: (event)=>{
                if (KeyboardUtils.isArrowKey(event.domEvent)) {
                    event.pointer.reserveForKeyboardDrag();
                }
            }
        };
        this.addInputListener(intentListener);
        const boundOnRadioButtonInput = this.onRadioButtonInput.bind(this);
        for(let i = 0; i < radioButtons.length; i++){
            const radioButton = radioButtons[i];
            radioButton.onInputEmitter.addListener(boundOnRadioButtonInput);
        }
        // Add linked element after the radio button is instrumented
        this.addLinkedElement(property, {
            tandemName: 'property'
        });
        this.disposeAquaRadioButtonGroup = ()=>{
            this.removeInputListener(intentListener);
            radioButtons.forEach((radioButton)=>radioButton.dispose());
            this.onInputEmitter.dispose();
            nodes.forEach((node)=>node.dispose());
        };
        this.radioButtons = radioButtons;
        // Decorating with additional content is an anti-pattern, see https://github.com/phetsims/sun/issues/860
        assert && assertNoAdditionalChildren(this);
    }
};
export { AquaRadioButtonGroup as default };
sun.register('AquaRadioButtonGroup', AquaRadioButtonGroup);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3N1bi9qcy9BcXVhUmFkaW9CdXR0b25Hcm91cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxMy0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBBcXVhUmFkaW9CdXR0b25Hcm91cCBjcmVhdGVzIGEgZ3JvdXAgb2YgQXF1YVJhZGlvQnV0dG9ucyBhbmQgbWFuYWdlcyB0aGVpciBsYXlvdXQuXG4gKlxuICogQGF1dGhvciBTYW0gUmVpZCAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqIEBhdXRob3IgQ2hyaXMgTWFsbGV5IChQaXhlbFpvb20sIEluYy4pXG4gKi9cblxuaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vLi4vYXhvbi9qcy9FbWl0dGVyLmpzJztcbmltcG9ydCBQaGV0aW9Qcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1BoZXRpb1Byb3BlcnR5LmpzJztcbmltcG9ydCBURW1pdHRlciBmcm9tICcuLi8uLi9heG9uL2pzL1RFbWl0dGVyLmpzJztcbmltcG9ydCBvcHRpb25pemUsIHsgY29tYmluZU9wdGlvbnMgfSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcbmltcG9ydCBQaWNrT3B0aW9uYWwgZnJvbSAnLi4vLi4vcGhldC1jb3JlL2pzL3R5cGVzL1BpY2tPcHRpb25hbC5qcyc7XG5pbXBvcnQgU3RyaWN0T21pdCBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvdHlwZXMvU3RyaWN0T21pdC5qcyc7XG5pbXBvcnQgeyBhc3NlcnROb0FkZGl0aW9uYWxDaGlsZHJlbiwgRmxvd0JveCwgRmxvd0JveE9wdGlvbnMsIEtleWJvYXJkVXRpbHMsIFBhcmFsbGVsRE9NLCBQYXJhbGxlbERPTU9wdGlvbnMsIFBET01QZWVyLCBTY2VuZXJ5Q29uc3RhbnRzLCBTY2VuZXJ5RXZlbnQsIFRyaW1QYXJhbGxlbERPTU9wdGlvbnMgfSBmcm9tICcuLi8uLi9zY2VuZXJ5L2pzL2ltcG9ydHMuanMnO1xuaW1wb3J0IG11bHRpU2VsZWN0aW9uU291bmRQbGF5ZXJGYWN0b3J5IGZyb20gJy4uLy4uL3RhbWJvL2pzL211bHRpU2VsZWN0aW9uU291bmRQbGF5ZXJGYWN0b3J5LmpzJztcbmltcG9ydCBUYW5kZW0gZnJvbSAnLi4vLi4vdGFuZGVtL2pzL1RhbmRlbS5qcyc7XG5pbXBvcnQgQXF1YVJhZGlvQnV0dG9uLCB7IEFxdWFSYWRpb0J1dHRvbk9wdGlvbnMgfSBmcm9tICcuL0FxdWFSYWRpb0J1dHRvbi5qcyc7XG5pbXBvcnQgR3JvdXBJdGVtT3B0aW9ucywgeyBnZXRHcm91cEl0ZW1Ob2RlcyB9IGZyb20gJy4vR3JvdXBJdGVtT3B0aW9ucy5qcyc7XG5pbXBvcnQgc3VuIGZyb20gJy4vc3VuLmpzJztcblxuLy8gcGRvbSAtIEFuIGlkIGZvciBlYWNoIGluc3RhbmNlIG9mIEFxdWFSYWRpb0J1dHRvbkdyb3VwLCBwYXNzZWQgdG8gaW5kaXZpZHVhbCBidXR0b25zIGluIHRoZSBncm91cC5cbi8vIEVhY2ggYnV0dG9uIGluIGEgcmFkaW8gYnV0dG9uIGdyb3VwIG11c3QgaGF2ZSB0aGUgc2FtZSBcIm5hbWVcIiBhdHRyaWJ1dGUgdG8gYmUgY29uc2lkZXJlZCBpbiBhIGdyb3VwLCBvdGhlcndpc2Vcbi8vIGFycm93IGtleXMgd2lsbCBuYXZpZ2F0ZSBhbGwgcmFkaW8gdHlwZSBpbnB1dHMgaW4gdGhlIGRvY3VtZW50LlxubGV0IGluc3RhbmNlQ291bnQgPSAwO1xuXG4vLyB0byBwcmVmaXggaW5zdGFuY2VDb3VudCBpbiBjYXNlIHRoZXJlIGFyZSBkaWZmZXJlbnQga2luZHMgb2YgXCJncm91cHNcIlxuY29uc3QgQ0xBU1NfTkFNRSA9ICdBcXVhUmFkaW9CdXR0b25Hcm91cCc7XG5cbnR5cGUgU2VsZk9wdGlvbnMgPSB7XG5cbiAgLy8gb3B0aW9ucyBwcm9wYWdhdGVkIHRvIEFxdWFSYWRpb0J1dHRvbiBpbnN0YW5jZXNcbiAgcmFkaW9CdXR0b25PcHRpb25zPzogU3RyaWN0T21pdDxBcXVhUmFkaW9CdXR0b25PcHRpb25zLCAnc291bmRQbGF5ZXInIHwgJ3RhbmRlbSc+O1xuXG4gIC8vIERpbGF0aW9uIG9mIHBvaW50ZXIgYXJlYXMgZm9yIGVhY2ggcmFkaW8gYnV0dG9uLlxuICAvLyBYIGRpbGF0aW9uIGlzIGlnbm9yZWQgZm9yIG9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCcuXG4gIC8vIFkgZGlsYXRpb24gaXMgaWdub3JlZCBmb3Igb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcuXG4gIHRvdWNoQXJlYVhEaWxhdGlvbj86IG51bWJlcjtcbiAgdG91Y2hBcmVhWURpbGF0aW9uPzogbnVtYmVyO1xuICBtb3VzZUFyZWFYRGlsYXRpb24/OiBudW1iZXI7XG4gIG1vdXNlQXJlYVlEaWxhdGlvbj86IG51bWJlcjtcbn07XG5cbi8vIFNvIHRoYXQgaXQgaXMgY2xlYXIgdGhhdCBSZWN0YW5ndWxhclJhZGlvQnV0dG9uR3JvdXBPcHRpb25zIG9ubHkgc3VwcG9ydHMgYSBoaWdoLWxldmVsIFBhcmFsbGVsRE9NIG9wdGlvbnMuXG4vLyBUT0RPOiBUaGlzIFBpY2tPcHRpb25hbCBzaG91bGQgYmUgcmVtb3ZlZCBvbmNlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzkwMCBpcyByZXNvbHZlZC4gbGFiZWxUYWdOYW1lIGlzIHJlcXVpcmVkIGJlY2F1c2UgY2xpZW50cyBuZWVkIHRvIHByb3ZpZGUgYSBoZWFkaW5nIGxldmVsLlxudHlwZSBUcmltbWVkUGFyZW50T3B0aW9ucyA9IFRyaW1QYXJhbGxlbERPTU9wdGlvbnM8Rmxvd0JveE9wdGlvbnM+ICYgUGlja09wdGlvbmFsPFBhcmFsbGVsRE9NT3B0aW9ucywgJ2xhYmVsVGFnTmFtZSc+O1xuXG5leHBvcnQgdHlwZSBBcXVhUmFkaW9CdXR0b25Hcm91cE9wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIFN0cmljdE9taXQ8VHJpbW1lZFBhcmVudE9wdGlvbnMsICdjaGlsZHJlbic+O1xuXG5leHBvcnQgdHlwZSBBcXVhUmFkaW9CdXR0b25Hcm91cEl0ZW08VD4gPSB7XG4gIHZhbHVlOiBUOyAvLyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggdGhlIGJ1dHRvblxuICBvcHRpb25zPzogU3RyaWN0T21pdDxBcXVhUmFkaW9CdXR0b25PcHRpb25zLCAndGFuZGVtJz47IC8vIG9wdGlvbnMgcGFzc2VkIHRvIEFxdWFSYWRpb0J1dHRvbiBjb25zdHJ1Y3RvclxufSAmIEdyb3VwSXRlbU9wdGlvbnM7IC8vIGFkZGl0aW9uYWwgb3B0aW9ucyB0aGF0IGFyZSBjb21tb24gdG8gJ2dyb3VwIGl0ZW1zJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcXVhUmFkaW9CdXR0b25Hcm91cDxUPiBleHRlbmRzIEZsb3dCb3gge1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgcmFkaW9CdXR0b25zOiBBcXVhUmFkaW9CdXR0b248VD5bXTtcbiAgcHVibGljIHJlYWRvbmx5IG9uSW5wdXRFbWl0dGVyOiBURW1pdHRlciA9IG5ldyBFbWl0dGVyKCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGlzcG9zZUFxdWFSYWRpb0J1dHRvbkdyb3VwOiAoKSA9PiB2b2lkO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvcGVydHk6IFBoZXRpb1Byb3BlcnR5PFQ+LCBpdGVtczogQXF1YVJhZGlvQnV0dG9uR3JvdXBJdGVtPFQ+W10sIHByb3ZpZGVkT3B0aW9ucz86IEFxdWFSYWRpb0J1dHRvbkdyb3VwT3B0aW9ucyApIHtcblxuICAgIGluc3RhbmNlQ291bnQrKztcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8QXF1YVJhZGlvQnV0dG9uR3JvdXBPcHRpb25zLCBTdHJpY3RPbWl0PFNlbGZPcHRpb25zLCAncmFkaW9CdXR0b25PcHRpb25zJz4sIEZsb3dCb3hPcHRpb25zPigpKCB7XG5cbiAgICAgIC8vIEFxdWFSYWRpb0J1dHRvbkdyb3VwT3B0aW9uc1xuICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiAwLFxuICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiAwLFxuICAgICAgbW91c2VBcmVhWERpbGF0aW9uOiAwLFxuICAgICAgbW91c2VBcmVhWURpbGF0aW9uOiAwLFxuXG4gICAgICAvLyBGbG93Qm94T3B0aW9uc1xuICAgICAgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcsIC8vIEFxdWEgcmFkaW8gYnV0dG9ucyBhcmUgdHlwaWNhbGx5IHZlcnRpY2FsLCByYXJlbHkgaG9yaXpvbnRhbFxuICAgICAgc3BhY2luZzogMywgLy8gc3BhY2UgYmV0d2VlbiBlYWNoIGJ1dHRvbiwgcGVycGVuZGljdWxhciB0byBvcHRpb25zLm9yaWVudGF0aW9uXG4gICAgICBzdHJldGNoOiB0cnVlLFxuICAgICAgZGlzYWJsZWRPcGFjaXR5OiBTY2VuZXJ5Q29uc3RhbnRzLkRJU0FCTEVEX09QQUNJVFksXG5cbiAgICAgIC8vIHBoZXQtaW9cbiAgICAgIHRhbmRlbTogVGFuZGVtLlJFUVVJUkVELFxuICAgICAgdGFuZGVtTmFtZVN1ZmZpeDogJ1JhZGlvQnV0dG9uR3JvdXAnLFxuICAgICAgdmlzaWJsZVByb3BlcnR5T3B0aW9uczogeyBwaGV0aW9GZWF0dXJlZDogdHJ1ZSB9LFxuICAgICAgcGhldGlvRW5hYmxlZFByb3BlcnR5SW5zdHJ1bWVudGVkOiB0cnVlLCAvLyBvcHQgaW50byBkZWZhdWx0IFBoRVQtaU8gaW5zdHJ1bWVudGVkIGVuYWJsZWRQcm9wZXJ0eVxuICAgICAgcGhldGlvRmVhdHVyZWQ6IHRydWUsXG5cbiAgICAgIC8vIHBkb21cbiAgICAgIHRhZ05hbWU6ICd1bCcsXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoMycsXG4gICAgICBhcmlhUm9sZTogJ3JhZGlvZ3JvdXAnLFxuICAgICAgaGVscFRleHRCZWhhdmlvcjogUGFyYWxsZWxET00uSEVMUF9URVhUX0JFRk9SRV9DT05URU5ULFxuICAgICAgZ3JvdXBGb2N1c0hpZ2hsaWdodDogdHJ1ZVxuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xuXG4gICAgY29uc3Qgbm9kZXMgPSBnZXRHcm91cEl0ZW1Ob2RlcyggaXRlbXMsIG9wdGlvbnMudGFuZGVtICk7XG5cbiAgICAvLyBEZWZhdWx0IHRvIGEgbGVmdCBhbGlnbm1lbnQgZm9yIHZlcnRpY2FsIGxheW91dFxuICAgIGlmICggb3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJyApIHtcbiAgICAgIG9wdGlvbnMuYWxpZ24gPSBvcHRpb25zLmFsaWduIHx8ICdsZWZ0JztcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSByYWRpbyBidXR0b24gZm9yIGVhY2ggaXRlbVxuICAgIGNvbnN0IHJhZGlvQnV0dG9ucyA9IGl0ZW1zLm1hcCggKCBpdGVtLCBpbmRleCApID0+IHtcblxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIHJ1bnRpbWUgY2hlY2sgdG8gcHJldmVudCBwcmlvciBwYXR0ZXJuLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNzk0XG4gICAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhaXRlbS50YW5kZW0sICdDYW5ub3Qgc3BlY2lmeSB0YW5kZW0gYW55IG1vcmUnICk7XG5cbiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1sgaW5kZXggXTtcblxuICAgICAgYXNzZXJ0ICYmIGFzc2VydCggIW5vZGUuaGFzUERPTUNvbnRlbnQsXG4gICAgICAgICdBY2Nlc3NpYmlsaXR5IGlzIHByb3ZpZGVkIGJ5IEFxdWFSYWRpb0J1dHRvbiBhbmQgYWNjZXNzaWJsZU5hbWUgb2YgdGhlIEFxdWFSYWRpb0J1dHRvbkdyb3VwSXRlbSBvcHRpb25zLiAnICtcbiAgICAgICAgJ0FkZGl0aW9uYWwgUERPTSBjb250ZW50IGluIHRoZSBwcm92aWRlZCBOb2RlIGNvdWxkIGJyZWFrIGFjY2Vzc2liaWxpdHkuJyApO1xuXG4gICAgICByZXR1cm4gbmV3IEFxdWFSYWRpb0J1dHRvbiggcHJvcGVydHksIGl0ZW0udmFsdWUsIG5vZGUsXG4gICAgICAgIGNvbWJpbmVPcHRpb25zPEFxdWFSYWRpb0J1dHRvbk9wdGlvbnM+KCB7XG4gICAgICAgICAgYTExeU5hbWVBdHRyaWJ1dGU6IENMQVNTX05BTUUgKyBpbnN0YW5jZUNvdW50LFxuICAgICAgICAgIHNvdW5kUGxheWVyOiBtdWx0aVNlbGVjdGlvblNvdW5kUGxheWVyRmFjdG9yeS5nZXRTZWxlY3Rpb25Tb3VuZFBsYXllciggaW5kZXggKSxcbiAgICAgICAgICB0YW5kZW06IGl0ZW0udGFuZGVtTmFtZSA/IG9wdGlvbnMudGFuZGVtLmNyZWF0ZVRhbmRlbSggaXRlbS50YW5kZW1OYW1lICkgOlxuICAgICAgICAgICAgICAgICAgb3B0aW9ucy50YW5kZW0gPT09IFRhbmRlbS5PUFRfT1VUID8gVGFuZGVtLk9QVF9PVVQgOlxuICAgICAgICAgICAgICAgICAgVGFuZGVtLlJFUVVJUkVELFxuICAgICAgICAgIC8vIE5PVEU6IFRoaXMgZG9lcyBOT1Qgc3VwcG9ydCBkeW5hbWljIG9yaWVudGF0aW9uIGNoYW5nZXMuIElmIHlvdSBuZWVkIHRoYXQsIGNoYW5nZSBSZWN0YW5ndWxhckJ1dHRvbiB0byBzdXBwb3J0XG4gICAgICAgICAgLy8gZHluYW1pYyBvcHRpb25zXG4gICAgICAgICAgdG91Y2hBcmVhWERpbGF0aW9uOiBvcHRpb25zLm9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCcgPyBvcHRpb25zLnNwYWNpbmcgLyAyIDogb3B0aW9ucy50b3VjaEFyZWFYRGlsYXRpb24sXG4gICAgICAgICAgdG91Y2hBcmVhWURpbGF0aW9uOiBvcHRpb25zLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnID8gb3B0aW9ucy5zcGFjaW5nIC8gMiA6IG9wdGlvbnMudG91Y2hBcmVhWURpbGF0aW9uLFxuICAgICAgICAgIG1vdXNlQXJlYVhEaWxhdGlvbjogb3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ2hvcml6b250YWwnID8gb3B0aW9ucy5zcGFjaW5nIC8gMiA6IG9wdGlvbnMubW91c2VBcmVhWERpbGF0aW9uLFxuICAgICAgICAgIG1vdXNlQXJlYVlEaWxhdGlvbjogb3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJyA/IG9wdGlvbnMuc3BhY2luZyAvIDIgOiBvcHRpb25zLm1vdXNlQXJlYVlEaWxhdGlvblxuICAgICAgICB9LCBvcHRpb25zLnJhZGlvQnV0dG9uT3B0aW9ucywgaXRlbS5vcHRpb25zICkgKTtcbiAgICB9ICk7XG4gICAgb3B0aW9ucy5jaGlsZHJlbiA9IHJhZGlvQnV0dG9ucztcblxuICAgIHN1cGVyKCBvcHRpb25zICk7XG5cbiAgICAvLyBwZG9tIC0gdGhpcyBub2RlJ3MgcHJpbWFyeSBzaWJsaW5nIGlzIGFyaWEtbGFiZWxsZWRieSBpdHMgb3duIGxhYmVsIHNvIHRoZSBsYWJlbCBjb250ZW50IGlzIHJlYWQgd2hlbmV2ZXJcbiAgICAvLyBhIG1lbWJlciBvZiB0aGUgZ3JvdXAgcmVjZWl2ZXMgZm9jdXNcbiAgICB0aGlzLmFkZEFyaWFMYWJlbGxlZGJ5QXNzb2NpYXRpb24oIHtcbiAgICAgIHRoaXNFbGVtZW50TmFtZTogUERPTVBlZXIuUFJJTUFSWV9TSUJMSU5HLFxuICAgICAgb3RoZXJOb2RlOiB0aGlzLFxuICAgICAgb3RoZXJFbGVtZW50TmFtZTogUERPTVBlZXIuTEFCRUxfU0lCTElOR1xuICAgIH0gKTtcblxuICAgIC8vIHpvb20gLSBzaWduaWZ5IHRoYXQga2V5IGlucHV0IGlzIHJlc2VydmVkIGFuZCB3ZSBzaG91bGQgbm90IHBhbiB3aGVuIHVzZXIgcHJlc3NlcyBhcnJvdyBrZXlzXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zY2VuZXJ5L2lzc3Vlcy85NzRcbiAgICBjb25zdCBpbnRlbnRMaXN0ZW5lciA9IHtcbiAgICAgIGtleWRvd246ICggZXZlbnQ6IFNjZW5lcnlFdmVudDxLZXlib2FyZEV2ZW50PiApID0+IHtcbiAgICAgICAgaWYgKCBLZXlib2FyZFV0aWxzLmlzQXJyb3dLZXkoIGV2ZW50LmRvbUV2ZW50ICkgKSB7XG4gICAgICAgICAgZXZlbnQucG9pbnRlci5yZXNlcnZlRm9yS2V5Ym9hcmREcmFnKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYWRkSW5wdXRMaXN0ZW5lciggaW50ZW50TGlzdGVuZXIgKTtcblxuICAgIGNvbnN0IGJvdW5kT25SYWRpb0J1dHRvbklucHV0ID0gdGhpcy5vblJhZGlvQnV0dG9uSW5wdXQuYmluZCggdGhpcyApO1xuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHJhZGlvQnV0dG9ucy5sZW5ndGg7IGkrKyApIHtcbiAgICAgIGNvbnN0IHJhZGlvQnV0dG9uID0gcmFkaW9CdXR0b25zWyBpIF07XG4gICAgICByYWRpb0J1dHRvbi5vbklucHV0RW1pdHRlci5hZGRMaXN0ZW5lciggYm91bmRPblJhZGlvQnV0dG9uSW5wdXQgKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgbGlua2VkIGVsZW1lbnQgYWZ0ZXIgdGhlIHJhZGlvIGJ1dHRvbiBpcyBpbnN0cnVtZW50ZWRcbiAgICB0aGlzLmFkZExpbmtlZEVsZW1lbnQoIHByb3BlcnR5LCB7XG4gICAgICB0YW5kZW1OYW1lOiAncHJvcGVydHknXG4gICAgfSApO1xuXG4gICAgdGhpcy5kaXNwb3NlQXF1YVJhZGlvQnV0dG9uR3JvdXAgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUlucHV0TGlzdGVuZXIoIGludGVudExpc3RlbmVyICk7XG4gICAgICByYWRpb0J1dHRvbnMuZm9yRWFjaCggcmFkaW9CdXR0b24gPT4gcmFkaW9CdXR0b24uZGlzcG9zZSgpICk7XG4gICAgICB0aGlzLm9uSW5wdXRFbWl0dGVyLmRpc3Bvc2UoKTtcbiAgICAgIG5vZGVzLmZvckVhY2goIG5vZGUgPT4gbm9kZS5kaXNwb3NlKCkgKTtcbiAgICB9O1xuXG4gICAgdGhpcy5yYWRpb0J1dHRvbnMgPSByYWRpb0J1dHRvbnM7XG5cbiAgICAvLyBEZWNvcmF0aW5nIHdpdGggYWRkaXRpb25hbCBjb250ZW50IGlzIGFuIGFudGktcGF0dGVybiwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9zdW4vaXNzdWVzLzg2MFxuICAgIGFzc2VydCAmJiBhc3NlcnROb0FkZGl0aW9uYWxDaGlsZHJlbiggdGhpcyApO1xuICB9XG5cbiAgcHJpdmF0ZSBvblJhZGlvQnV0dG9uSW5wdXQoKTogdm9pZCB7XG4gICAgdGhpcy5vbklucHV0RW1pdHRlci5lbWl0KCk7XG4gIH1cblxuICBwdWJsaWMgb3ZlcnJpZGUgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLmRpc3Bvc2VBcXVhUmFkaW9CdXR0b25Hcm91cCgpO1xuICAgIHN1cGVyLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSByYWRpbyBidXR0b24gdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgc3BlY2lmaWVkIHZhbHVlLlxuICAgKi9cbiAgcHVibGljIGdldEJ1dHRvbiggdmFsdWU6IFQgKTogQXF1YVJhZGlvQnV0dG9uPFQ+IHtcbiAgICBjb25zdCBidXR0b24gPSBfLmZpbmQoIHRoaXMucmFkaW9CdXR0b25zLCAoIHJhZGlvQnV0dG9uOiBBcXVhUmFkaW9CdXR0b248VD4gKSA9PiByYWRpb0J1dHRvbi52YWx1ZSA9PT0gdmFsdWUgKTtcbiAgICBhc3NlcnQgJiYgYXNzZXJ0KCBidXR0b24sIGBubyByYWRpbyBidXR0b24gZm91bmQgZm9yIHZhbHVlICR7dmFsdWV9YCApO1xuICAgIHJldHVybiBidXR0b24hO1xuICB9XG59XG5cbnN1bi5yZWdpc3RlciggJ0FxdWFSYWRpb0J1dHRvbkdyb3VwJywgQXF1YVJhZGlvQnV0dG9uR3JvdXAgKTsiXSwibmFtZXMiOlsiRW1pdHRlciIsIm9wdGlvbml6ZSIsImNvbWJpbmVPcHRpb25zIiwiYXNzZXJ0Tm9BZGRpdGlvbmFsQ2hpbGRyZW4iLCJGbG93Qm94IiwiS2V5Ym9hcmRVdGlscyIsIlBhcmFsbGVsRE9NIiwiUERPTVBlZXIiLCJTY2VuZXJ5Q29uc3RhbnRzIiwibXVsdGlTZWxlY3Rpb25Tb3VuZFBsYXllckZhY3RvcnkiLCJUYW5kZW0iLCJBcXVhUmFkaW9CdXR0b24iLCJnZXRHcm91cEl0ZW1Ob2RlcyIsInN1biIsImluc3RhbmNlQ291bnQiLCJDTEFTU19OQU1FIiwiQXF1YVJhZGlvQnV0dG9uR3JvdXAiLCJvblJhZGlvQnV0dG9uSW5wdXQiLCJvbklucHV0RW1pdHRlciIsImVtaXQiLCJkaXNwb3NlIiwiZGlzcG9zZUFxdWFSYWRpb0J1dHRvbkdyb3VwIiwiZ2V0QnV0dG9uIiwidmFsdWUiLCJidXR0b24iLCJfIiwiZmluZCIsInJhZGlvQnV0dG9ucyIsInJhZGlvQnV0dG9uIiwiYXNzZXJ0IiwicHJvcGVydHkiLCJpdGVtcyIsInByb3ZpZGVkT3B0aW9ucyIsIm9wdGlvbnMiLCJ0b3VjaEFyZWFYRGlsYXRpb24iLCJ0b3VjaEFyZWFZRGlsYXRpb24iLCJtb3VzZUFyZWFYRGlsYXRpb24iLCJtb3VzZUFyZWFZRGlsYXRpb24iLCJvcmllbnRhdGlvbiIsInNwYWNpbmciLCJzdHJldGNoIiwiZGlzYWJsZWRPcGFjaXR5IiwiRElTQUJMRURfT1BBQ0lUWSIsInRhbmRlbSIsIlJFUVVJUkVEIiwidGFuZGVtTmFtZVN1ZmZpeCIsInZpc2libGVQcm9wZXJ0eU9wdGlvbnMiLCJwaGV0aW9GZWF0dXJlZCIsInBoZXRpb0VuYWJsZWRQcm9wZXJ0eUluc3RydW1lbnRlZCIsInRhZ05hbWUiLCJsYWJlbFRhZ05hbWUiLCJhcmlhUm9sZSIsImhlbHBUZXh0QmVoYXZpb3IiLCJIRUxQX1RFWFRfQkVGT1JFX0NPTlRFTlQiLCJncm91cEZvY3VzSGlnaGxpZ2h0Iiwibm9kZXMiLCJhbGlnbiIsIm1hcCIsIml0ZW0iLCJpbmRleCIsIm5vZGUiLCJoYXNQRE9NQ29udGVudCIsImExMXlOYW1lQXR0cmlidXRlIiwic291bmRQbGF5ZXIiLCJnZXRTZWxlY3Rpb25Tb3VuZFBsYXllciIsInRhbmRlbU5hbWUiLCJjcmVhdGVUYW5kZW0iLCJPUFRfT1VUIiwicmFkaW9CdXR0b25PcHRpb25zIiwiY2hpbGRyZW4iLCJhZGRBcmlhTGFiZWxsZWRieUFzc29jaWF0aW9uIiwidGhpc0VsZW1lbnROYW1lIiwiUFJJTUFSWV9TSUJMSU5HIiwib3RoZXJOb2RlIiwib3RoZXJFbGVtZW50TmFtZSIsIkxBQkVMX1NJQkxJTkciLCJpbnRlbnRMaXN0ZW5lciIsImtleWRvd24iLCJldmVudCIsImlzQXJyb3dLZXkiLCJkb21FdmVudCIsInBvaW50ZXIiLCJyZXNlcnZlRm9yS2V5Ym9hcmREcmFnIiwiYWRkSW5wdXRMaXN0ZW5lciIsImJvdW5kT25SYWRpb0J1dHRvbklucHV0IiwiYmluZCIsImkiLCJsZW5ndGgiLCJhZGRMaXN0ZW5lciIsImFkZExpbmtlZEVsZW1lbnQiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwiZm9yRWFjaCIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiQUFBQSxzREFBc0Q7QUFFdEQ7Ozs7O0NBS0MsR0FFRCxPQUFPQSxhQUFhLDJCQUEyQjtBQUcvQyxPQUFPQyxhQUFhQyxjQUFjLFFBQVEsa0NBQWtDO0FBRzVFLFNBQVNDLDBCQUEwQixFQUFFQyxPQUFPLEVBQWtCQyxhQUFhLEVBQUVDLFdBQVcsRUFBc0JDLFFBQVEsRUFBRUMsZ0JBQWdCLFFBQThDLDhCQUE4QjtBQUNwTixPQUFPQyxzQ0FBc0MscURBQXFEO0FBQ2xHLE9BQU9DLFlBQVksNEJBQTRCO0FBQy9DLE9BQU9DLHFCQUFpRCx1QkFBdUI7QUFDL0UsU0FBMkJDLGlCQUFpQixRQUFRLHdCQUF3QjtBQUM1RSxPQUFPQyxTQUFTLFdBQVc7QUFFM0IscUdBQXFHO0FBQ3JHLGlIQUFpSDtBQUNqSCxrRUFBa0U7QUFDbEUsSUFBSUMsZ0JBQWdCO0FBRXBCLHdFQUF3RTtBQUN4RSxNQUFNQyxhQUFhO0FBMkJKLElBQUEsQUFBTUMsdUJBQU4sTUFBTUEsNkJBQWdDWjtJQXdIM0NhLHFCQUEyQjtRQUNqQyxJQUFJLENBQUNDLGNBQWMsQ0FBQ0MsSUFBSTtJQUMxQjtJQUVnQkMsVUFBZ0I7UUFDOUIsSUFBSSxDQUFDQywyQkFBMkI7UUFDaEMsS0FBSyxDQUFDRDtJQUNSO0lBRUE7O0dBRUMsR0FDRCxBQUFPRSxVQUFXQyxLQUFRLEVB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