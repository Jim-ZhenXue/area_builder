// Copyright 2016-2024, University of Colorado Boulder
/**
 * Shows a track on a slider.  Must be supplied a Node for rendering the track.
 *
 * @author Chris Malley (PixelZoom, Inc.)
 * @author Sam Reid (PhET Interactive Simulations)
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */ import DerivedProperty from '../../axon/js/DerivedProperty.js';
import TinyProperty from '../../axon/js/TinyProperty.js';
import Dimension2 from '../../dot/js/Dimension2.js';
import LinearFunction from '../../dot/js/LinearFunction.js';
import Range from '../../dot/js/Range.js';
import optionize from '../../phet-core/js/optionize.js';
import { DragListener, Node, WidthSizable } from '../../scenery/js/imports.js';
import ValueChangeSoundPlayer from '../../tambo/js/sound-generators/ValueChangeSoundPlayer.js';
import Tandem from '../../tandem/js/Tandem.js';
import Slider from './Slider.js';
import sun from './sun.js';
let SliderTrack = class SliderTrack extends WidthSizable(Node) {
    dispose() {
        this.disposeSliderTrack();
        super.dispose();
    }
    constructor(valueProperty, trackNode, range, providedOptions){
        super();
        this.rangeProperty = range instanceof Range ? new TinyProperty(range) : range;
        const options = optionize()({
            size: new Dimension2(100, 5),
            startDrag: _.noop,
            drag: _.noop,
            endDrag: _.noop,
            constrainValue: _.identity,
            enabledRangeProperty: this.rangeProperty,
            soundGenerator: Slider.DEFAULT_SOUND_GENERATOR,
            valueChangeSoundGeneratorOptions: {},
            voicingOnEndResponse: _.noop,
            leftVisualOverflow: 0,
            rightVisualOverflow: 0,
            // phet-io
            tandem: Tandem.REQUIRED,
            tandemNameSuffix: 'TrackNode'
        }, providedOptions);
        // If no sound generator was provided, create the default.
        if (options.soundGenerator === Slider.DEFAULT_SOUND_GENERATOR) {
            // NOTE: We'll want to update ValueChangeSoundPlayer for dynamic ranges if it's used more for that
            options.soundGenerator = new ValueChangeSoundPlayer(this.rangeProperty.value, options.valueChangeSoundGeneratorOptions || {});
        } else if (options.soundGenerator === null) {
            options.soundGenerator = ValueChangeSoundPlayer.NO_SOUND;
        }
        this.leftVisualOverflow = options.leftVisualOverflow;
        this.rightVisualOverflow = options.rightVisualOverflow;
        this.minimumSize = options.size;
        this.minimumWidth = this.minimumSize.width;
        this.internalWidthProperty = new DerivedProperty([
            this.localPreferredWidthProperty
        ], (localPreferredWidth)=>{
            // Our preferred width should be subtracted out by the anticipated overflow, so that our size can be slightly
            // smaller.
            return (localPreferredWidth === null ? this.minimumSize.width : Math.max(this.minimumSize.width, localPreferredWidth)) - options.leftVisualOverflow - options.rightVisualOverflow;
        });
        this.sizeProperty = new DerivedProperty([
            this.internalWidthProperty
        ], (width)=>new Dimension2(width, this.minimumSize.height));
        // NOTE: Slider needs to make a lot of assumptions about how this works (in order to figure out proper layout).
        // DO NOT change without taking a CLOSE CLOSE look at Slider's layout code.
        this.valueToPositionProperty = new DerivedProperty([
            this.rangeProperty,
            this.internalWidthProperty
        ], (range, width)=>{
            return new LinearFunction(range.min, range.max, 0, width, true);
        });
        // click in the track to change the value, continue dragging if desired
        const handleTrackEvent = (event, trail)=>{
            const oldValue = valueProperty.value;
            const transform = trail.subtrailTo(this).getTransform();
            const x = transform.inversePosition2(event.pointer.point).x;
            const value = this.valueToPositionProperty.value.inverse(x);
            const valueInRange = options.enabledRangeProperty.value.constrainValue(value);
            const newValue = options.constrainValue(valueInRange);
            valueProperty.set(newValue);
            // Down events on the track can cause value changes.  If that's what just happened, play a sound.
            if (event.type === 'down') {
                options.soundGenerator.playSoundIfThresholdReached(newValue, oldValue);
            }
        };
        this.addChild(trackNode);
        let valueOnStart = valueProperty.value;
        this.dragListener = new DragListener({
            tandem: options.tandem.createTandem('dragListener'),
            start: (event, listener)=>{
                options.startDrag(event);
                valueOnStart = valueProperty.value;
                handleTrackEvent(event, listener.pressedTrail);
            },
            drag: (event, listener)=>{
                options.drag(event);
                // Reuse the same handleTrackEvent but make sure the startedCallbacks call is made before the value changes
                handleTrackEvent(event, listener.pressedTrail);
            },
            end: (event)=>{
                options.endDrag(event);
                options.voicingOnEndResponse(valueOnStart);
            }
        });
        trackNode.addInputListener(this.dragListener);
        this.mutate(options);
        this.disposeSliderTrack = ()=>{
            trackNode.removeInputListener(this.dragListener);
            this.dragListener.dispose();
        };
    }
};
export { SliderTrack as default };
sun.register('SliderTrack', SliderTrack);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3N1bi9qcy9TbGlkZXJUcmFjay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxNi0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBTaG93cyBhIHRyYWNrIG9uIGEgc2xpZGVyLiAgTXVzdCBiZSBzdXBwbGllZCBhIE5vZGUgZm9yIHJlbmRlcmluZyB0aGUgdHJhY2suXG4gKlxuICogQGF1dGhvciBDaHJpcyBNYWxsZXkgKFBpeGVsWm9vbSwgSW5jLilcbiAqIEBhdXRob3IgU2FtIFJlaWQgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKiBAYXV0aG9yIEplc3NlIEdyZWVuYmVyZyAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcbiAqL1xuXG5pbXBvcnQgRGVyaXZlZFByb3BlcnR5IGZyb20gJy4uLy4uL2F4b24vanMvRGVyaXZlZFByb3BlcnR5LmpzJztcbmltcG9ydCBUaW55UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UaW55UHJvcGVydHkuanMnO1xuaW1wb3J0IFRQcm9wZXJ0eSBmcm9tICcuLi8uLi9heG9uL2pzL1RQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgVFJlYWRPbmx5UHJvcGVydHkgZnJvbSAnLi4vLi4vYXhvbi9qcy9UUmVhZE9ubHlQcm9wZXJ0eS5qcyc7XG5pbXBvcnQgRGltZW5zaW9uMiBmcm9tICcuLi8uLi9kb3QvanMvRGltZW5zaW9uMi5qcyc7XG5pbXBvcnQgTGluZWFyRnVuY3Rpb24gZnJvbSAnLi4vLi4vZG90L2pzL0xpbmVhckZ1bmN0aW9uLmpzJztcbmltcG9ydCBSYW5nZSBmcm9tICcuLi8uLi9kb3QvanMvUmFuZ2UuanMnO1xuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcbmltcG9ydCB7IERyYWdMaXN0ZW5lciwgTm9kZSwgTm9kZU9wdGlvbnMsIFNjZW5lcnlFdmVudCwgVHJhaWwsIFdpZHRoU2l6YWJsZSB9IGZyb20gJy4uLy4uL3NjZW5lcnkvanMvaW1wb3J0cy5qcyc7XG5pbXBvcnQgVmFsdWVDaGFuZ2VTb3VuZFBsYXllciwgeyBWYWx1ZUNoYW5nZVNvdW5kUGxheWVyT3B0aW9ucyB9IGZyb20gJy4uLy4uL3RhbWJvL2pzL3NvdW5kLWdlbmVyYXRvcnMvVmFsdWVDaGFuZ2VTb3VuZFBsYXllci5qcyc7XG5pbXBvcnQgVGFuZGVtIGZyb20gJy4uLy4uL3RhbmRlbS9qcy9UYW5kZW0uanMnO1xuaW1wb3J0IHsgVm9pY2luZ09uRW5kUmVzcG9uc2UgfSBmcm9tICcuL2FjY2Vzc2liaWxpdHkvQWNjZXNzaWJsZVZhbHVlSGFuZGxlci5qcyc7XG5pbXBvcnQgU2xpZGVyIGZyb20gJy4vU2xpZGVyLmpzJztcbmltcG9ydCBzdW4gZnJvbSAnLi9zdW4uanMnO1xuXG50eXBlIFNlbGZPcHRpb25zID0ge1xuICAvLyBOT1RFOiBmb3IgYmFja3dhcmRzLWNvbXBhdGliaWxpdHksIHRoZSBzaXplIGRvZXMgTk9UIGluY2x1ZGUgdGhlIGV4dGVudCBvZiB0aGUgc3Ryb2tlLCBzbyB0aGUgdHJhY2sgd2lsbCBiZSBsYXJnZXJcbiAgLy8gdGhhbiB0aGlzIHNpemVcbiAgc2l6ZT86IERpbWVuc2lvbjI7XG5cbiAgLy8gY2FsbGVkIHdoZW4gYSBkcmFnIHNlcXVlbmNlIHN0YXJ0c1xuICBzdGFydERyYWc/OiAoIGU6IFNjZW5lcnlFdmVudCApID0+IHZvaWQ7XG5cbiAgLy8gY2FsbGVkIGF0IHRoZSBiZWdpbm5pbmcgb2YgYSBkcmFnIGV2ZW50LCBiZWZvcmUgYW55IG90aGVyIGRyYWcgd29yayBoYXBwZW5zXG4gIGRyYWc/OiAoIGU6IFNjZW5lcnlFdmVudCApID0+IHZvaWQ7XG5cbiAgLy8gY2FsbGVkIHdoZW4gYSBkcmFnIHNlcXVlbmNlIGVuZHNcbiAgZW5kRHJhZz86ICggZTogU2NlbmVyeUV2ZW50IHwgbnVsbCApID0+IHZvaWQ7XG5cbiAgLy8gY2FsbGVkIGJlZm9yZSB2YWx1ZVByb3BlcnR5IGlzIHNldFxuICBjb25zdHJhaW5WYWx1ZT86ICggbjogbnVtYmVyICkgPT4gbnVtYmVyO1xuXG4gIC8vIERlZmF1bHRzIHRvIGEgY29uc3RhbnQgcmFuZ2VcbiAgZW5hYmxlZFJhbmdlUHJvcGVydHk/OiBUUmVhZE9ubHlQcm9wZXJ0eTxSYW5nZT47XG5cbiAgLy8gVGhpcyBpcyB1c2VkIHRvIGdlbmVyYXRlIHNvdW5kcyB3aGVuIGNsaWNraW5nIGluIHRoZSB0cmFjay4gIElmIG5vdCBwcm92aWRlZCwgdGhlIGRlZmF1bHQgc291bmQgZ2VuZXJhdG9yXG4gIC8vIHdpbGwgYmUgY3JlYXRlZC4gSWYgc2V0IHRvIG51bGwsIHRoZSBzbGlkZXIgd2lsbCBnZW5lcmF0ZSBubyBzb3VuZC5cbiAgc291bmRHZW5lcmF0b3I/OiBWYWx1ZUNoYW5nZVNvdW5kUGxheWVyIHwgbnVsbDtcblxuICAvLyBPcHRpb25zIGZvciB0aGUgZGVmYXVsdCBzb3VuZCBnZW5lcmF0b3IuICBUaGVzZSBzaG91bGQgb25seSBiZSBwcm92aWRlZCB3aGVuIHVzaW5nIHRoZSBkZWZhdWx0LlxuICB2YWx1ZUNoYW5nZVNvdW5kR2VuZXJhdG9yT3B0aW9ucz86IFZhbHVlQ2hhbmdlU291bmRQbGF5ZXJPcHRpb25zO1xuXG4gIC8vIEFubm91bmNlcyB0aGUgdm9pY2luZyByZXNwb25zZSBhdCB0aGUgZW5kIG9mIGFuIGludGVyYWN0aW9uLiBVc2VkIGJ5IEFjY2Vzc2libGVWYWx1ZUhhbmRsZXIsIHNlZVxuICAvLyBTbGlkZXIgZm9yIGFuIGV4YW1wbGUgdXNhZ2UuXG4gIHZvaWNpbmdPbkVuZFJlc3BvbnNlPzogVm9pY2luZ09uRW5kUmVzcG9uc2U7XG5cbiAgLy8gU2luY2Ugb3VyIGhpc3RvcmljYWwgc2xpZGVyIHRyYWNrcyBleHRlbmQgUEFTVCB0aGUgMCxzaXplIHJhbmdlIChlLmcuIHdpdGggc3Ryb2tlcyksIGFuZCB0aGlzIGluZm9ybWF0aW9uIGlzIG5lZWRlZFxuICAvLyBzbyB3ZSBjYW4gY29udHJvbCB0aGUgc2l6ZSBiYXNlZCBvbiBvdXIgcHJlZmVycmVkV2lkdGguIFdlJ2xsIG5lZWQgdGhlIHNpemUgdG8gYmUgc29tZXdoYXQgc21hbGxlciB0aGFuIG91clxuICAvLyBwcmVmZXJyZWRXaWR0aFxuICBsZWZ0VmlzdWFsT3ZlcmZsb3c/OiBudW1iZXI7XG4gIHJpZ2h0VmlzdWFsT3ZlcmZsb3c/OiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBTbGlkZXJUcmFja09wdGlvbnMgPSBTZWxmT3B0aW9ucyAmIE5vZGVPcHRpb25zO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTbGlkZXJUcmFjayBleHRlbmRzIFdpZHRoU2l6YWJsZSggTm9kZSApIHtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbWluaW11bVNpemU6IERpbWVuc2lvbjI7XG4gIHByb3RlY3RlZCByZWFkb25seSBpbnRlcm5hbFdpZHRoUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PG51bWJlcj47XG4gIHByb3RlY3RlZCByZWFkb25seSBzaXplUHJvcGVydHk6IFRSZWFkT25seVByb3BlcnR5PERpbWVuc2lvbjI+O1xuXG4gIC8vIEZvciB1c2UgYnkgU2xpZGVyLCBtYXBzIHRoZSB2YWx1ZSBhbG9uZyB0aGUgcmFuZ2Ugb2YgdGhlIHRyYWNrIHRvIHRoZSBwb3NpdGlvbiBhbG9uZyB0aGUgd2lkdGggb2YgdGhlIHRyYWNrXG4gIHB1YmxpYyByZWFkb25seSB2YWx1ZVRvUG9zaXRpb25Qcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8TGluZWFyRnVuY3Rpb24+O1xuXG4gIC8vIHB1YmxpYyBzbyB0aGF0IGNsaWVudHMgY2FuIGFjY2VzcyBQcm9wZXJ0aWVzIG9mIHRoZSBEcmFnTGlzdGVuZXIgdGhhdCB0ZWxsIHVzIGFib3V0IGl0cyBzdGF0ZVxuICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3BoZXRzaW1zL3N1bi9pc3N1ZXMvNjgwXG4gIHB1YmxpYyByZWFkb25seSBkcmFnTGlzdGVuZXI6IERyYWdMaXN0ZW5lcjtcblxuICAvLyAoc3VuLWludGVybmFsKVxuICBwdWJsaWMgcmVhZG9ubHkgcmFuZ2VQcm9wZXJ0eTogVFJlYWRPbmx5UHJvcGVydHk8UmFuZ2U+O1xuICBwdWJsaWMgcmVhZG9ubHkgbGVmdFZpc3VhbE92ZXJmbG93OiBudW1iZXI7XG4gIHB1YmxpYyByZWFkb25seSByaWdodFZpc3VhbE92ZXJmbG93OiBudW1iZXI7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBkaXNwb3NlU2xpZGVyVHJhY2s6ICgpID0+IHZvaWQ7XG5cbiAgcHVibGljIGNvbnN0cnVjdG9yKCB2YWx1ZVByb3BlcnR5OiBUUHJvcGVydHk8bnVtYmVyPiwgdHJhY2tOb2RlOiBOb2RlLCByYW5nZTogUmFuZ2UgfCBUUmVhZE9ubHlQcm9wZXJ0eTxSYW5nZT4sIHByb3ZpZGVkT3B0aW9ucz86IFNsaWRlclRyYWNrT3B0aW9ucyApIHtcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5yYW5nZVByb3BlcnR5ID0gcmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSA/IG5ldyBUaW55UHJvcGVydHkoIHJhbmdlICkgOiByYW5nZTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBvcHRpb25pemU8U2xpZGVyVHJhY2tPcHRpb25zLCBTZWxmT3B0aW9ucywgTm9kZU9wdGlvbnM+KCkoIHtcbiAgICAgIHNpemU6IG5ldyBEaW1lbnNpb24yKCAxMDAsIDUgKSxcbiAgICAgIHN0YXJ0RHJhZzogXy5ub29wLCAvLyBjYWxsZWQgd2hlbiBhIGRyYWcgc2VxdWVuY2Ugc3RhcnRzXG4gICAgICBkcmFnOiBfLm5vb3AsIC8vIGNhbGxlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgZHJhZyBldmVudCwgYmVmb3JlIGFueSBvdGhlciBkcmFnIHdvcmsgaGFwcGVuc1xuICAgICAgZW5kRHJhZzogXy5ub29wLCAvLyBjYWxsZWQgd2hlbiBhIGRyYWcgc2VxdWVuY2UgZW5kc1xuICAgICAgY29uc3RyYWluVmFsdWU6IF8uaWRlbnRpdHksIC8vIGNhbGxlZCBiZWZvcmUgdmFsdWVQcm9wZXJ0eSBpcyBzZXRcbiAgICAgIGVuYWJsZWRSYW5nZVByb3BlcnR5OiB0aGlzLnJhbmdlUHJvcGVydHksXG4gICAgICBzb3VuZEdlbmVyYXRvcjogU2xpZGVyLkRFRkFVTFRfU09VTkRfR0VORVJBVE9SLFxuICAgICAgdmFsdWVDaGFuZ2VTb3VuZEdlbmVyYXRvck9wdGlvbnM6IHt9LFxuICAgICAgdm9pY2luZ09uRW5kUmVzcG9uc2U6IF8ubm9vcCxcblxuICAgICAgbGVmdFZpc3VhbE92ZXJmbG93OiAwLFxuICAgICAgcmlnaHRWaXN1YWxPdmVyZmxvdzogMCxcblxuICAgICAgLy8gcGhldC1pb1xuICAgICAgdGFuZGVtOiBUYW5kZW0uUkVRVUlSRUQsXG4gICAgICB0YW5kZW1OYW1lU3VmZml4OiAnVHJhY2tOb2RlJ1xuICAgIH0sIHByb3ZpZGVkT3B0aW9ucyApO1xuXG4gICAgLy8gSWYgbm8gc291bmQgZ2VuZXJhdG9yIHdhcyBwcm92aWRlZCwgY3JlYXRlIHRoZSBkZWZhdWx0LlxuICAgIGlmICggb3B0aW9ucy5zb3VuZEdlbmVyYXRvciA9PT0gU2xpZGVyLkRFRkFVTFRfU09VTkRfR0VORVJBVE9SICkge1xuICAgICAgLy8gTk9URTogV2UnbGwgd2FudCB0byB1cGRhdGUgVmFsdWVDaGFuZ2VTb3VuZFBsYXllciBmb3IgZHluYW1pYyByYW5nZXMgaWYgaXQncyB1c2VkIG1vcmUgZm9yIHRoYXRcbiAgICAgIG9wdGlvbnMuc291bmRHZW5lcmF0b3IgPSBuZXcgVmFsdWVDaGFuZ2VTb3VuZFBsYXllciggdGhpcy5yYW5nZVByb3BlcnR5LnZhbHVlLCBvcHRpb25zLnZhbHVlQ2hhbmdlU291bmRHZW5lcmF0b3JPcHRpb25zIHx8IHt9ICk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCBvcHRpb25zLnNvdW5kR2VuZXJhdG9yID09PSBudWxsICkge1xuICAgICAgb3B0aW9ucy5zb3VuZEdlbmVyYXRvciA9IFZhbHVlQ2hhbmdlU291bmRQbGF5ZXIuTk9fU09VTkQ7XG4gICAgfVxuXG4gICAgdGhpcy5sZWZ0VmlzdWFsT3ZlcmZsb3cgPSBvcHRpb25zLmxlZnRWaXN1YWxPdmVyZmxvdztcbiAgICB0aGlzLnJpZ2h0VmlzdWFsT3ZlcmZsb3cgPSBvcHRpb25zLnJpZ2h0VmlzdWFsT3ZlcmZsb3c7XG5cbiAgICB0aGlzLm1pbmltdW1TaXplID0gb3B0aW9ucy5zaXplO1xuICAgIHRoaXMubWluaW11bVdpZHRoID0gdGhpcy5taW5pbXVtU2l6ZS53aWR0aDtcbiAgICB0aGlzLmludGVybmFsV2lkdGhQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFsgdGhpcy5sb2NhbFByZWZlcnJlZFdpZHRoUHJvcGVydHkgXSwgbG9jYWxQcmVmZXJyZWRXaWR0aCA9PiB7XG4gICAgICAvLyBPdXIgcHJlZmVycmVkIHdpZHRoIHNob3VsZCBiZSBzdWJ0cmFjdGVkIG91dCBieSB0aGUgYW50aWNpcGF0ZWQgb3ZlcmZsb3csIHNvIHRoYXQgb3VyIHNpemUgY2FuIGJlIHNsaWdodGx5XG4gICAgICAvLyBzbWFsbGVyLlxuICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgIGxvY2FsUHJlZmVycmVkV2lkdGggPT09IG51bGxcbiAgICAgICAgICAgICAgID8gdGhpcy5taW5pbXVtU2l6ZS53aWR0aFxuICAgICAgICAgICAgICAgOiBNYXRoLm1heCggdGhpcy5taW5pbXVtU2l6ZS53aWR0aCwgbG9jYWxQcmVmZXJyZWRXaWR0aCApXG4gICAgICAgICAgICAgKSAtIG9wdGlvbnMubGVmdFZpc3VhbE92ZXJmbG93IC0gb3B0aW9ucy5yaWdodFZpc3VhbE92ZXJmbG93O1xuICAgIH0gKTtcbiAgICB0aGlzLnNpemVQcm9wZXJ0eSA9IG5ldyBEZXJpdmVkUHJvcGVydHkoIFtcbiAgICAgIHRoaXMuaW50ZXJuYWxXaWR0aFByb3BlcnR5XG4gICAgXSwgd2lkdGggPT4gbmV3IERpbWVuc2lvbjIoIHdpZHRoLCB0aGlzLm1pbmltdW1TaXplLmhlaWdodCApICk7XG5cbiAgICAvLyBOT1RFOiBTbGlkZXIgbmVlZHMgdG8gbWFrZSBhIGxvdCBvZiBhc3N1bXB0aW9ucyBhYm91dCBob3cgdGhpcyB3b3JrcyAoaW4gb3JkZXIgdG8gZmlndXJlIG91dCBwcm9wZXIgbGF5b3V0KS5cbiAgICAvLyBETyBOT1QgY2hhbmdlIHdpdGhvdXQgdGFraW5nIGEgQ0xPU0UgQ0xPU0UgbG9vayBhdCBTbGlkZXIncyBsYXlvdXQgY29kZS5cbiAgICB0aGlzLnZhbHVlVG9Qb3NpdGlvblByb3BlcnR5ID0gbmV3IERlcml2ZWRQcm9wZXJ0eSggWyB0aGlzLnJhbmdlUHJvcGVydHksIHRoaXMuaW50ZXJuYWxXaWR0aFByb3BlcnR5IF0sICggcmFuZ2UsIHdpZHRoICkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBMaW5lYXJGdW5jdGlvbiggcmFuZ2UubWluLCByYW5nZS5tYXgsIDAsIHdpZHRoLCB0cnVlIC8qIGNsYW1wICovICk7XG4gICAgfSApO1xuXG4gICAgLy8gY2xpY2sgaW4gdGhlIHRyYWNrIHRvIGNoYW5nZSB0aGUgdmFsdWUsIGNvbnRpbnVlIGRyYWdnaW5nIGlmIGRlc2lyZWRcbiAgICBjb25zdCBoYW5kbGVUcmFja0V2ZW50ID0gKCBldmVudDogU2NlbmVyeUV2ZW50LCB0cmFpbDogVHJhaWwgKSA9PiB7XG4gICAgICBjb25zdCBvbGRWYWx1ZSA9IHZhbHVlUHJvcGVydHkudmFsdWU7XG4gICAgICBjb25zdCB0cmFuc2Zvcm0gPSB0cmFpbC5zdWJ0cmFpbFRvKCB0aGlzICkuZ2V0VHJhbnNmb3JtKCk7XG4gICAgICBjb25zdCB4ID0gdHJhbnNmb3JtLmludmVyc2VQb3NpdGlvbjIoIGV2ZW50LnBvaW50ZXIucG9pbnQgKS54O1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZhbHVlVG9Qb3NpdGlvblByb3BlcnR5LnZhbHVlLmludmVyc2UoIHggKTtcbiAgICAgIGNvbnN0IHZhbHVlSW5SYW5nZSA9IG9wdGlvbnMuZW5hYmxlZFJhbmdlUHJvcGVydHkudmFsdWUuY29uc3RyYWluVmFsdWUoIHZhbHVlICk7XG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IG9wdGlvbnMuY29uc3RyYWluVmFsdWUoIHZhbHVlSW5SYW5nZSApO1xuICAgICAgdmFsdWVQcm9wZXJ0eS5zZXQoIG5ld1ZhbHVlICk7XG5cbiAgICAgIC8vIERvd24gZXZlbnRzIG9uIHRoZSB0cmFjayBjYW4gY2F1c2UgdmFsdWUgY2hhbmdlcy4gIElmIHRoYXQncyB3aGF0IGp1c3QgaGFwcGVuZWQsIHBsYXkgYSBzb3VuZC5cbiAgICAgIGlmICggZXZlbnQudHlwZSA9PT0gJ2Rvd24nICkge1xuICAgICAgICBvcHRpb25zLnNvdW5kR2VuZXJhdG9yIS5wbGF5U291bmRJZlRocmVzaG9sZFJlYWNoZWQoIG5ld1ZhbHVlLCBvbGRWYWx1ZSApO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmFkZENoaWxkKCB0cmFja05vZGUgKTtcblxuICAgIGxldCB2YWx1ZU9uU3RhcnQgPSB2YWx1ZVByb3BlcnR5LnZhbHVlO1xuICAgIHRoaXMuZHJhZ0xpc3RlbmVyID0gbmV3IERyYWdMaXN0ZW5lcigge1xuICAgICAgdGFuZGVtOiBvcHRpb25zLnRhbmRlbS5jcmVhdGVUYW5kZW0oICdkcmFnTGlzdGVuZXInICksXG5cbiAgICAgIHN0YXJ0OiAoIGV2ZW50LCBsaXN0ZW5lciApID0+IHtcbiAgICAgICAgb3B0aW9ucy5zdGFydERyYWcoIGV2ZW50ICk7XG4gICAgICAgIHZhbHVlT25TdGFydCA9IHZhbHVlUHJvcGVydHkudmFsdWU7XG4gICAgICAgIGhhbmRsZVRyYWNrRXZlbnQoIGV2ZW50LCBsaXN0ZW5lci5wcmVzc2VkVHJhaWwgKTtcbiAgICAgIH0sXG5cbiAgICAgIGRyYWc6ICggZXZlbnQsIGxpc3RlbmVyICkgPT4ge1xuICAgICAgICBvcHRpb25zLmRyYWcoIGV2ZW50ICk7XG5cbiAgICAgICAgLy8gUmV1c2UgdGhlIHNhbWUgaGFuZGxlVHJhY2tFdmVudCBidXQgbWFrZSBzdXJlIHRoZSBzdGFydGVkQ2FsbGJhY2tzIGNhbGwgaXMgbWFkZSBiZWZvcmUgdGhlIHZhbHVlIGNoYW5nZXNcbiAgICAgICAgaGFuZGxlVHJhY2tFdmVudCggZXZlbnQsIGxpc3RlbmVyLnByZXNzZWRUcmFpbCApO1xuICAgICAgfSxcblxuICAgICAgZW5kOiBldmVudCA9PiB7XG4gICAgICAgIG9wdGlvbnMuZW5kRHJhZyggZXZlbnQgKTtcbiAgICAgICAgb3B0aW9ucy52b2ljaW5nT25FbmRSZXNwb25zZSggdmFsdWVPblN0YXJ0ICk7XG4gICAgICB9XG4gICAgfSApO1xuICAgIHRyYWNrTm9kZS5hZGRJbnB1dExpc3RlbmVyKCB0aGlzLmRyYWdMaXN0ZW5lciApO1xuXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcblxuICAgIHRoaXMuZGlzcG9zZVNsaWRlclRyYWNrID0gKCkgPT4ge1xuICAgICAgdHJhY2tOb2RlLnJlbW92ZUlucHV0TGlzdGVuZXIoIHRoaXMuZHJhZ0xpc3RlbmVyICk7XG4gICAgICB0aGlzLmRyYWdMaXN0ZW5lci5kaXNwb3NlKCk7XG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBvdmVycmlkZSBkaXNwb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuZGlzcG9zZVNsaWRlclRyYWNrKCk7XG4gICAgc3VwZXIuZGlzcG9zZSgpO1xuICB9XG59XG5cbnN1bi5yZWdpc3RlciggJ1NsaWRlclRyYWNrJywgU2xpZGVyVHJhY2sgKTsiXSwibmFtZXMiOlsiRGVyaXZlZFByb3BlcnR5IiwiVGlueVByb3BlcnR5IiwiRGltZW5zaW9uMiIsIkxpbmVhckZ1bmN0aW9uIiwiUmFuZ2UiLCJvcHRpb25pemUiLCJEcmFnTGlzdGVuZXIiLCJOb2RlIiwiV2lkdGhTaXphYmxlIiwiVmFsdWVDaGFuZ2VTb3VuZFBsYXllciIsIlRhbmRlbSIsIlNsaWRlciIsInN1biIsIlNsaWRlclRyYWNrIiwiZGlzcG9zZSIsImRpc3Bvc2VTbGlkZXJUcmFjayIsInZhbHVlUHJvcGVydHkiLCJ0cmFja05vZGUiLCJyYW5nZSIsInByb3ZpZGVkT3B0aW9ucyIsInJhbmdlUHJvcGVydHkiLCJvcHRpb25zIiwic2l6ZSIsInN0YXJ0RHJhZyIsIl8iLCJub29wIiwiZHJhZyIsImVuZERyYWciLCJjb25zdHJhaW5WYWx1ZSIsImlkZW50aXR5IiwiZW5hYmxlZFJhbmdlUHJvcGVydHkiLCJzb3VuZEdlbmVyYXRvciIsIkRFRkFVTFRfU09VTkRfR0VORVJBVE9SIiwidmFsdWVDaGFuZ2VTb3VuZEdlbmVyYXRvck9wdGlvbnMiLCJ2b2ljaW5nT25FbmRSZXNwb25zZSIsImxlZnRWaXN1YWxPdmVyZmxvdyIsInJpZ2h0VmlzdWFsT3ZlcmZsb3ciLCJ0YW5kZW0iLCJSRVFVSVJFRCIsInRhbmRlbU5hbWVTdWZmaXgiLCJ2YWx1ZSIsIk5PX1NPVU5EIiwibWluaW11bVNpemUiLCJtaW5pbXVtV2lkdGgiLCJ3aWR0aCIsImludGVybmFsV2lkdGhQcm9wZXJ0eSIsImxvY2FsUHJlZmVycmVkV2lkdGhQcm9wZXJ0eSIsImxvY2FsUHJlZmVycmVkV2lkdGgiLCJNYXRoIiwibWF4Iiwic2l6ZVByb3BlcnR5IiwiaGVpZ2h0IiwidmFsdWVUb1Bvc2l0aW9uUHJvcGVydHkiLCJtaW4iLCJoYW5kbGVUcmFja0V2ZW50IiwiZXZlbnQiLCJ0cmFpbCIsIm9sZFZhbHVlIiwidHJhbnNmb3JtIiwic3VidHJhaWxUbyIsImdldFRyYW5zZm9ybSIsIngiLCJpbnZlcnNlUG9zaXRpb24yIiwicG9pbnRlciIsInBvaW50IiwiaW52ZXJzZSIsInZhbHVlSW5SYW5nZSIsIm5ld1ZhbHVlIiwic2V0IiwidHlwZSIsInBsYXlTb3VuZElmVGhyZXNob2xkUmVhY2hlZCIsImFkZENoaWxkIiwidmFsdWVPblN0YXJ0IiwiZHJhZ0xpc3RlbmVyIiwiY3JlYXRlVGFuZGVtIiwic3RhcnQiLCJsaXN0ZW5lciIsInByZXNzZWRUcmFpbCIsImVuZCIsImFkZElucHV0TGlzdGVuZXIiLCJtdXRhdGUiLCJyZW1vdmVJbnB1dExpc3RlbmVyIiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiJBQUFBLHNEQUFzRDtBQUV0RDs7Ozs7O0NBTUMsR0FFRCxPQUFPQSxxQkFB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