// Copyright 2024, University of Colorado Boulder
/**
 * A collection of fields that describes keys for a Hotkey. This includes a key that should be pressed to fire the
 * behavior, modifier keys that must be pressed in addition to the key, and ignored modifier keys that will not prevent
 * the hotkey from firing even if they are down.
 *
 * See the KeyDescriptorOptions for detailed information.
 *
 * @author Jesse Greenberg (PhET Interactive Simulations)
 */ import optionize from '../../../phet-core/js/optionize.js';
import { metaEnglishKeys, scenery } from '../imports.js';
const IGNORE_DELIMITER = '?';
let KeyDescriptor = class KeyDescriptor {
    /**
   * Returns a string representation of the hotkey in the format of "natural" english. Modifier keys first, followed
   * by the final key. For example, if the key is 't' and the modifier keys are 'shift', the string would be 'shift+t'.
   */ getHotkeyString() {
        return [
            ...this.modifierKeys,
            this.key
        ].join('+');
    }
    /**
   * Parses an input string to extract the main key and its associated modifier keys, while considering ignored
   * modifier keys based on the placement of the '?' delimiter.
   *
   * See KeyboardListener for a description of key and modifierKey behavior.
   *
   * The function handles the following cases:
   * 1. If a word is followed by '?', it is added to `ignoredModifierKeys`.
   * 2. If a word is preceded by '?', it indicates all other default modifier keys should be ignored,
   *    except the word itself, which is added to `modifierKeys`.
   *
   * keyStrokeToKeyDescriptor('r');
   * // Output: { key: 'r', modifierKeys: [], ignoredModifierKeys: [] }
   *
   * keyStrokeToKeyDescriptor('alt+r');
   * // Output: { key: 'r', modifierKeys: ['alt'], ignoredModifierKeys: [] }
   *
   * keyStrokeToKeyDescriptor('alt+j+r');
   * // Output: { key: 'r', modifierKeys: ['alt', 'j'], ignoredModifierKeys: [] }
   *
   * keyStrokeToKeyDescriptor('alt?+j+r');
   * // Output: { key: 'r', modifierKeys: ['j'], ignoredModifierKeys: ['alt'] }
   *
   * keyStrokeToKeyDescriptor('shift?+t');
   * // Output: { key: 't', modifierKeys: [], ignoredModifierKeys: ['shift'] }
   *
   * keyStrokeToKeyDescriptor('?shift+t');
   * // Output: { key: 't', modifierKeys: ['shift'], ignoredModifierKeys: ['alt', 'control', 'meta'] }
   *
   * keyStrokeToKeyDescriptor('?shift+t+j');
   * // Output: { key: 'j', modifierKeys: ['shift', 't'], ignoredModifierKeys: ['alt', 'control', 'meta'] }
   *
   */ static keyStrokeToKeyDescriptor(keyStroke) {
        const tokens = keyStroke.split('+');
        // assertions
        let foundIgnoreDelimiter = false;
        tokens.forEach((token)=>{
            // the ignore delimiter can only be used on default modifier keys
            if (token.length > 1 && token.includes(IGNORE_DELIMITER)) {
                assert && assert(!foundIgnoreDelimiter, 'There can only be one ignore delimiter');
                assert && assert(metaEnglishKeys.includes(token.replace(IGNORE_DELIMITER, '')), 'The ignore delimiter can only be used on default modifier keys');
                foundIgnoreDelimiter = true;
            }
        });
        const modifierKeys = [];
        const ignoredModifierKeys = [];
        tokens.forEach((token)=>{
            // Check if the token contains a question mark
            if (token.includes(IGNORE_DELIMITER)) {
                const strippedToken = token.replace(IGNORE_DELIMITER, '');
                if (token.startsWith(IGNORE_DELIMITER)) {
                    // Add all default modifiers except the current stripped token to the ignored keys
                    const otherModifiers = metaEnglishKeys.filter((mod)=>mod !== strippedToken);
                    ignoredModifierKeys.push(...otherModifiers);
                    // Include the stripped token as a regular modifier key
                    modifierKeys.push(strippedToken);
                } else {
                    // Add the stripped token to the ignored modifier keys
                    ignoredModifierKeys.push(strippedToken);
                }
            } else {
                // If there's no question mark, add the token to the modifier keys
                modifierKeys.push(token);
            }
        });
        // Assume the last token is the key
        const key = modifierKeys.pop();
        // Filter out ignored modifier keys from the modifier keys list
        const filteredModifierKeys = modifierKeys.filter((mod)=>!ignoredModifierKeys.includes(mod));
        return new KeyDescriptor({
            key: key,
            modifierKeys: filteredModifierKeys,
            ignoredModifierKeys: ignoredModifierKeys
        });
    }
    constructor(providedOptions){
        const options = optionize()({
            modifierKeys: [],
            ignoredModifierKeys: []
        }, providedOptions);
        this.key = options.key;
        this.modifierKeys = options.modifierKeys;
        this.ignoredModifierKeys = options.ignoredModifierKeys;
    }
};
export { KeyDescriptor as default };
scenery.register('KeyDescriptor', KeyDescriptor);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvaW5wdXQvS2V5RGVzY3JpcHRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAyNCwgVW5pdmVyc2l0eSBvZiBDb2xvcmFkbyBCb3VsZGVyXG5cbi8qKlxuICogQSBjb2xsZWN0aW9uIG9mIGZpZWxkcyB0aGF0IGRlc2NyaWJlcyBrZXlzIGZvciBhIEhvdGtleS4gVGhpcyBpbmNsdWRlcyBhIGtleSB0aGF0IHNob3VsZCBiZSBwcmVzc2VkIHRvIGZpcmUgdGhlXG4gKiBiZWhhdmlvciwgbW9kaWZpZXIga2V5cyB0aGF0IG11c3QgYmUgcHJlc3NlZCBpbiBhZGRpdGlvbiB0byB0aGUga2V5LCBhbmQgaWdub3JlZCBtb2RpZmllciBrZXlzIHRoYXQgd2lsbCBub3QgcHJldmVudFxuICogdGhlIGhvdGtleSBmcm9tIGZpcmluZyBldmVuIGlmIHRoZXkgYXJlIGRvd24uXG4gKlxuICogU2VlIHRoZSBLZXlEZXNjcmlwdG9yT3B0aW9ucyBmb3IgZGV0YWlsZWQgaW5mb3JtYXRpb24uXG4gKlxuICogQGF1dGhvciBKZXNzZSBHcmVlbmJlcmcgKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKi9cblxuaW1wb3J0IG9wdGlvbml6ZSBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvb3B0aW9uaXplLmpzJztcbmltcG9ydCB7IEVuZ2xpc2hLZXksIEVuZ2xpc2hLZXlTdHJpbmcsIEVuZ2xpc2hTdHJpbmdUb0NvZGVNYXAsIG1ldGFFbmdsaXNoS2V5cywgc2NlbmVyeSB9IGZyb20gJy4uL2ltcG9ydHMuanMnO1xuXG4vLyBOT1RFOiBUaGUgdHlwaW5nIGZvciBNb2RpZmllcktleSBhbmQgT25lS2V5U3Ryb2tlIGlzIGxpbWl0ZWQgVHlwZVNjcmlwdCwgdGhlcmUgaXMgYSBsaW1pdGF0aW9uIHRvIHRoZSBudW1iZXIgb2Zcbi8vICAgICAgIGVudHJpZXMgaW4gYSB1bmlvbiB0eXBlLiBJZiB0aGF0IGxpbWl0YXRpb24gaXMgbm90IGFjY2VwdGFibGUgcmVtb3ZlIHRoaXMgdHlwaW5nLiBPUiBtYXliZSBUeXBlU2NyaXB0IHdpbGxcbi8vICAgICAgIHNvbWVkYXkgc3VwcG9ydCByZWdleCBwYXR0ZXJucyBmb3IgYSB0eXBlLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy80MTE2MFxuLy8gSWYgd2UgcnVuIG91dCBvZiB1bmlvbiBzcGFjZSBmb3IgdGVtcGxhdGUgc3RyaW5ncywgY29uc2lkZXIgdGhlIGFib3ZlIGNvbW1lbnQgb3IgcmVtb3ZlIHNvbWUgZnJvbSB0aGUgdHlwZS5cbnR5cGUgTW9kaWZpZXJLZXkgPSAncScgfCAndycgfCAnZScgfCAncicgfCAndCcgfCAneScgfCAndScgfCAnaScgfCAnbycgfCAncCcgfCAnYScgfCAncycgfCAnZCcgfFxuICAnZicgfCAnZycgfCAnaCcgfCAnaicgfCAnaycgfCAnbCcgfCAneicgfCAneCcgfCAnYycgfFxuICAndicgfCAnYicgfCAnbicgfCAnbScgfCAnY3RybCcgfCAnYWx0JyB8ICdzaGlmdCcgfCAndGFiJyB8ICdtZXRhJztcblxuY29uc3QgSUdOT1JFX0RFTElNSVRFUiA9ICc/JztcbnR5cGUgSWdub3JlRGVsaW1pdGVyID0gdHlwZW9mIElHTk9SRV9ERUxJTUlURVI7XG5cbnR5cGUgSWdub3JlTW9kaWZpZXJLZXkgPSBgJHtNb2RpZmllcktleX0ke0lnbm9yZURlbGltaXRlcn1gO1xudHlwZSBJZ25vcmVPdGhlck1vZGlmaWVyS2V5cyA9IGAke0lnbm9yZURlbGltaXRlcn0ke01vZGlmaWVyS2V5fWA7XG5cbi8vIEFsbG93ZWQga2V5cyBhcmUgdGhlIGtleXMgb2YgdGhlIEVuZ2xpc2hTdHJpbmdUb0NvZGVNYXAuXG50eXBlIEFsbG93ZWRLZXlzID0ga2V5b2YgdHlwZW9mIEVuZ2xpc2hTdHJpbmdUb0NvZGVNYXA7XG5cbi8vIEFsbG93ZWQga2V5cyBhcyBhIHN0cmluZyAtIHRoZSBmb3JtYXQgdGhleSB3aWxsIGJlIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLlxuZXhwb3J0IHR5cGUgQWxsb3dlZEtleXNTdHJpbmcgPSBgJHtBbGxvd2VkS2V5c31gO1xuXG4vLyBBIGtleSBzdHJva2UgZW50cnkgaXMgYSBzaW5nbGUga2V5IG9yIGEga2V5IHdpdGggXCJpZ25vcmVcIiBtb2RpZmllcnMsIHNlZSBleGFtcGxlcyBhbmQga2V5U3Ryb2tlVG9LZXlEZXNjcmlwdG9yLlxuZXhwb3J0IHR5cGUgT25lS2V5U3Ryb2tlRW50cnkgPSBgJHtBbGxvd2VkS2V5c31gIHwgYCR7SWdub3JlTW9kaWZpZXJLZXl9KyR7RW5nbGlzaEtleX1gIHwgYCR7SWdub3JlT3RoZXJNb2RpZmllcktleXN9KyR7RW5nbGlzaEtleX1gO1xuXG5leHBvcnQgdHlwZSBPbmVLZXlTdHJva2UgPVxuICBgJHtBbGxvd2VkS2V5c31gIHwgLy8gZS5nLiAndCdcbiAgYCR7TW9kaWZpZXJLZXl9KyR7QWxsb3dlZEtleXN9YCB8IC8vIGUuZy4gJ3NoaWZ0K3QnXG4gIGAke01vZGlmaWVyS2V5fSske01vZGlmaWVyS2V5fSske0FsbG93ZWRLZXlzfWAgfCAvLyBlLmcuICdjdHJsK3NoaWZ0K3QnXG4gIGAke0lnbm9yZU1vZGlmaWVyS2V5fSske0FsbG93ZWRLZXlzfWAgfCAvLyBlLmcuICdzaGlmdD8rdCcgKHNoaWZ0IGFkZGVkIHRvIGlnbm9yZWRNb2RpZmllcktleXMpXG4gIGAke0lnbm9yZU1vZGlmaWVyS2V5fSske01vZGlmaWVyS2V5fSske0FsbG93ZWRLZXlzfWAgfCAvLyBlLmcuICdzaGlmdD8rY3RybCt0JyAoc2hpZnQgYWRkZWQgdG8gaWdub3JlZE1vZGlmaWVyS2V5cylcbiAgYCR7SWdub3JlT3RoZXJNb2RpZmllcktleXN9KyR7QWxsb3dlZEtleXN9YCB8IC8vIGUuZy4gJz9zaGlmdCt0JyAoc2hpZnQgaXMgYSBtb2RpZmllciBrZXkgYnV0IEFMTCBvdGhlciBkZWZhdWx0IG1vZGlmaWVyIGtleXMgYXJlIGlnbm9yZWQpXG4gIGAke0lnbm9yZU90aGVyTW9kaWZpZXJLZXlzfSske01vZGlmaWVyS2V5fSske0FsbG93ZWRLZXlzfWA7IC8vIGUuZy4gJz9zaGlmdCtqK3QnIChzaGlmdCBpcyBhIG1vZGlmaWVyIGtleSBidXQgQUxMIG90aGVyIGRlZmF1bHQgbW9kaWZpZXIga2V5cyBhcmUgaWdub3JlZClcbi8vIFRoZXNlIGNvbWJpbmF0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCBieSBUeXBlU2NyaXB0OiBcIlRTMjU5MDogRXhwcmVzc2lvbiBwcm9kdWNlcyBhIHVuaW9uIHR5cGUgdGhhdCBpcyB0b28gY29tcGxleCB0b1xuLy8gcmVwcmVzZW50LlwiIFNlZSBhYm92ZSBub3RlIGFuZCBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzQxMTYwI2lzc3VlY29tbWVudC0xMjg3MjcxMTMyLlxuLy8gYCR7QWxsb3dlZEtleXN9KyR7QWxsb3dlZEtleXN9KyR7QWxsb3dlZEtleXN9KyR7QWxsb3dlZEtleXN9YDtcbi8vIHR5cGUgS2V5Q29tYmluYXRpb25zID0gYCR7T25lS2V5U3Ryb2tlfWAgfCBgJHtPbmVLZXlTdHJva2V9LCR7T25lS2V5U3Ryb2tlfWA7XG5cbmV4cG9ydCB0eXBlIEtleURlc2NyaXB0b3JPcHRpb25zID0ge1xuXG4gIC8vIFRoZSBrZXkgdGhhdCBzaG91bGQgYmUgcHJlc3NlZCB0byB0cmlnZ2VyIHRoZSBob3RrZXkgKGluIGZpcmVPbkRvd246dHJ1ZSBtb2RlKSBvciByZWxlYXNlZCB0byB0cmlnZ2VyIHRoZSBob3RrZXlcbiAgLy8gKGluIGZpcmVPbkRvd246ZmFsc2UgbW9kZSkuXG4gIGtleTogQWxsb3dlZEtleXNTdHJpbmc7XG5cbiAgLy8gQSBzZXQgb2YgbW9kaWZpZXIga2V5cyB0aGF0OlxuICAvL1xuICAvLyAxLiBOZWVkIHRvIGJlIHByZXNzZWQgYmVmb3JlIHRoZSBtYWluIGtleSBiZWZvcmUgdGhpcyBob3RrZXkgaXMgY29uc2lkZXJlZCBwcmVzc2VkLlxuICAvLyAyLiBNdXN0IE5PVCBiZSBwcmVzc2VkIGZvciBvdGhlciBob3RrZXlzIHRvIGJlIGFjdGl2YXRlZCB3aGVuIHRoaXMgaG90a2V5IGlzIHByZXNlbnQuXG4gIC8vXG4gIC8vIEEgSG90a2V5IHdpbGwgYWxzbyBub3QgYWN0aXZhdGUgaWYgdGhlIHN0YW5kYXJkIG1vZGlmaWVyIGtleXMgKGN0cmwvYWx0L21ldGEvc2hpZnQpIGFyZSBwcmVzc2VkLCB1bmxlc3MgdGhleVxuICAvLyBhcmUgZXhwbGljaXRseSBpbmNsdWRlZCBpbiB0aGUgbW9kaWZpZXJLZXlzIGFycmF5LlxuICAvL1xuICAvLyBOT1RFOiBUaGlzIGlzIGEgZ2VuZXJhbGl6YXRpb24gb2YgdGhlIG5vcm1hbCBjb25jZXB0IG9mIFwibW9kaWZpZXIga2V5XCJcbiAgLy8gKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL01vZGlmaWVyX2tleSkuIEl0IGlzIGEgUGhFVC1zcGVjaWZpYyBjb25jZXB0IHRoYXQgYWxsb3dzIG90aGVyIG5vbi1zdGFuZGFyZFxuICAvLyBtb2RpZmllciBrZXlzIHRvIGJlIHVzZWQgYXMgbW9kaWZpZXJzLiBUaGUgc3RhbmRhcmQgbW9kaWZpZXIga2V5cyAoY3RybC9hbHQvbWV0YS9zaGlmdCkgYXJlIGF1dG9tYXRpY2FsbHkgaGFuZGxlZFxuICAvLyBieSB0aGUgaG90a2V5IHN5c3RlbSwgYnV0IHRoaXMgY2FuIGV4cGFuZCB0aGUgc2V0IG9mIG1vZGlmaWVyIGtleXMgdGhhdCBjYW4gYmUgdXNlZC4gV2hlbiBhIG1vZGlmaWVyIGtleSBpcyBhZGRlZCxcbiAgLy8gcHJlc3NpbmcgaXQgd2lsbCBwcmV2ZW50IGFueSBvdGhlciBIb3RrZXlzIGZyb20gYmVjb21pbmcgYWN0aXZlLiBUaGlzIGlzIGhvdyB0aGUgdHlwaWNhbCBtb2RpZmllciBrZXlzIGJlaGF2ZSBhbmRcbiAgLy8gc28gdGhhdCBpcyBrZXB0IGNvbnNpc3RlbnQgZm9yIFBoRVQtc3BlY2lmaWMgbW9kaWZpZXIga2V5cy5cbiAgLy9cbiAgLy8gTm90ZSB0aGF0IHRoZSByZWxlYXNlIG9mIGEgbW9kaWZpZXIga2V5IG1heSBcImFjdGl2YXRlXCIgdGhlIGhvdGtleSBmb3IgXCJmaXJlLW9uLWhvbGRcIiwgYnV0IG5vdCBmb3IgXCJmaXJlLW9uLWRvd25cIi5cbiAgbW9kaWZpZXJLZXlzPzogQWxsb3dlZEtleXNTdHJpbmdbXTtcblxuICAvLyBBIHNldCBvZiBtb2RpZmllciBrZXlzIHRoYXQgY2FuIGJlIGRvd24gYW5kIHRoZSBob3RrZXkgd2lsbCBzdGlsbCBmaXJlLiBFc3NlbnRpYWxseSBpZ25vcmluZyB0aGUgbW9kaWZpZXJcbiAgLy8ga2V5IGJlaGF2aW9yIGZvciB0aGlzIGtleS5cbiAgaWdub3JlZE1vZGlmaWVyS2V5cz86IEFsbG93ZWRLZXlzU3RyaW5nW107XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlEZXNjcmlwdG9yIHtcbiAgcHVibGljIHJlYWRvbmx5IGtleTogQWxsb3dlZEtleXNTdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBtb2RpZmllcktleXM6IEFsbG93ZWRLZXlzU3RyaW5nW107XG4gIHB1YmxpYyByZWFkb25seSBpZ25vcmVkTW9kaWZpZXJLZXlzOiBBbGxvd2VkS2V5c1N0cmluZ1tdO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvciggcHJvdmlkZWRPcHRpb25zPzogS2V5RGVzY3JpcHRvck9wdGlvbnMgKSB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IG9wdGlvbml6ZTxLZXlEZXNjcmlwdG9yT3B0aW9ucz4oKSgge1xuICAgICAgbW9kaWZpZXJLZXlzOiBbXSxcbiAgICAgIGlnbm9yZWRNb2RpZmllcktleXM6IFtdXG4gICAgfSwgcHJvdmlkZWRPcHRpb25zICk7XG5cbiAgICB0aGlzLmtleSA9IG9wdGlvbnMua2V5O1xuICAgIHRoaXMubW9kaWZpZXJLZXlzID0gb3B0aW9ucy5tb2RpZmllcktleXM7XG4gICAgdGhpcy5pZ25vcmVkTW9kaWZpZXJLZXlzID0gb3B0aW9ucy5pZ25vcmVkTW9kaWZpZXJLZXlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGhvdGtleSBpbiB0aGUgZm9ybWF0IG9mIFwibmF0dXJhbFwiIGVuZ2xpc2guIE1vZGlmaWVyIGtleXMgZmlyc3QsIGZvbGxvd2VkXG4gICAqIGJ5IHRoZSBmaW5hbCBrZXkuIEZvciBleGFtcGxlLCBpZiB0aGUga2V5IGlzICd0JyBhbmQgdGhlIG1vZGlmaWVyIGtleXMgYXJlICdzaGlmdCcsIHRoZSBzdHJpbmcgd291bGQgYmUgJ3NoaWZ0K3QnLlxuICAgKi9cbiAgcHVibGljIGdldEhvdGtleVN0cmluZygpOiBPbmVLZXlTdHJva2VbbnVtYmVyXSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIC4uLnRoaXMubW9kaWZpZXJLZXlzLFxuICAgICAgdGhpcy5rZXlcbiAgICBdLmpvaW4oICcrJyApO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlcyBhbiBpbnB1dCBzdHJpbmcgdG8gZXh0cmFjdCB0aGUgbWFpbiBrZXkgYW5kIGl0cyBhc3NvY2lhdGVkIG1vZGlmaWVyIGtleXMsIHdoaWxlIGNvbnNpZGVyaW5nIGlnbm9yZWRcbiAgICogbW9kaWZpZXIga2V5cyBiYXNlZCBvbiB0aGUgcGxhY2VtZW50IG9mIHRoZSAnPycgZGVsaW1pdGVyLlxuICAgKlxuICAgKiBTZWUgS2V5Ym9hcmRMaXN0ZW5lciBmb3IgYSBkZXNjcmlwdGlvbiBvZiBrZXkgYW5kIG1vZGlmaWVyS2V5IGJlaGF2aW9yLlxuICAgKlxuICAgKiBUaGUgZnVuY3Rpb24gaGFuZGxlcyB0aGUgZm9sbG93aW5nIGNhc2VzOlxuICAgKiAxLiBJZiBhIHdvcmQgaXMgZm9sbG93ZWQgYnkgJz8nLCBpdCBpcyBhZGRlZCB0byBgaWdub3JlZE1vZGlmaWVyS2V5c2AuXG4gICAqIDIuIElmIGEgd29yZCBpcyBwcmVjZWRlZCBieSAnPycsIGl0IGluZGljYXRlcyBhbGwgb3RoZXIgZGVmYXVsdCBtb2RpZmllciBrZXlzIHNob3VsZCBiZSBpZ25vcmVkLFxuICAgKiAgICBleGNlcHQgdGhlIHdvcmQgaXRzZWxmLCB3aGljaCBpcyBhZGRlZCB0byBgbW9kaWZpZXJLZXlzYC5cbiAgICpcbiAgICoga2V5U3Ryb2tlVG9LZXlEZXNjcmlwdG9yKCdyJyk7XG4gICAqIC8vIE91dHB1dDogeyBrZXk6ICdyJywgbW9kaWZpZXJLZXlzOiBbXSwgaWdub3JlZE1vZGlmaWVyS2V5czogW10gfVxuICAgKlxuICAgKiBrZXlTdHJva2VUb0tleURlc2NyaXB0b3IoJ2FsdCtyJyk7XG4gICAqIC8vIE91dHB1dDogeyBrZXk6ICdyJywgbW9kaWZpZXJLZXlzOiBbJ2FsdCddLCBpZ25vcmVkTW9kaWZpZXJLZXlzOiBbXSB9XG4gICAqXG4gICAqIGtleVN0cm9rZVRvS2V5RGVzY3JpcHRvcignYWx0K2orcicpO1xuICAgKiAvLyBPdXRwdXQ6IHsga2V5OiAncicsIG1vZGlmaWVyS2V5czogWydhbHQnLCAnaiddLCBpZ25vcmVkTW9kaWZpZXJLZXlzOiBbXSB9XG4gICAqXG4gICAqIGtleVN0cm9rZVRvS2V5RGVzY3JpcHRvcignYWx0PytqK3InKTtcbiAgICogLy8gT3V0cHV0OiB7IGtleTogJ3InLCBtb2RpZmllcktleXM6IFsnaiddLCBpZ25vcmVkTW9kaWZpZXJLZXlzOiBbJ2FsdCddIH1cbiAgICpcbiAgICoga2V5U3Ryb2tlVG9LZXlEZXNjcmlwdG9yKCdzaGlmdD8rdCcpO1xuICAgKiAvLyBPdXRwdXQ6IHsga2V5OiAndCcsIG1vZGlmaWVyS2V5czogW10sIGlnbm9yZWRNb2RpZmllcktleXM6IFsnc2hpZnQnXSB9XG4gICAqXG4gICAqIGtleVN0cm9rZVRvS2V5RGVzY3JpcHRvcignP3NoaWZ0K3QnKTtcbiAgICogLy8gT3V0cHV0OiB7IGtleTogJ3QnLCBtb2RpZmllcktleXM6IFsnc2hpZnQnXSwgaWdub3JlZE1vZGlmaWVyS2V5czogWydhbHQnLCAnY29udHJvbCcsICdtZXRhJ10gfVxuICAgKlxuICAgKiBrZXlTdHJva2VUb0tleURlc2NyaXB0b3IoJz9zaGlmdCt0K2onKTtcbiAgICogLy8gT3V0cHV0OiB7IGtleTogJ2onLCBtb2RpZmllcktleXM6IFsnc2hpZnQnLCAndCddLCBpZ25vcmVkTW9kaWZpZXJLZXlzOiBbJ2FsdCcsICdjb250cm9sJywgJ21ldGEnXSB9XG4gICAqXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGtleVN0cm9rZVRvS2V5RGVzY3JpcHRvcigga2V5U3Ryb2tlOiBPbmVLZXlTdHJva2UgKTogS2V5RGVzY3JpcHRvciB7XG5cbiAgICBjb25zdCB0b2tlbnMgPSBrZXlTdHJva2Uuc3BsaXQoICcrJyApIGFzIE9uZUtleVN0cm9rZUVudHJ5W107XG5cbiAgICAvLyBhc3NlcnRpb25zXG4gICAgbGV0IGZvdW5kSWdub3JlRGVsaW1pdGVyID0gZmFsc2U7XG4gICAgdG9rZW5zLmZvckVhY2goIHRva2VuID0+IHtcblxuICAgICAgLy8gdGhlIGlnbm9yZSBkZWxpbWl0ZXIgY2FuIG9ubHkgYmUgdXNlZCBvbiBkZWZhdWx0IG1vZGlmaWVyIGtleXNcbiAgICAgIGlmICggdG9rZW4ubGVuZ3RoID4gMSAmJiB0b2tlbi5pbmNsdWRlcyggSUdOT1JFX0RFTElNSVRFUiApICkge1xuICAgICAgICBhc3NlcnQgJiYgYXNzZXJ0KCAhZm91bmRJZ25vcmVEZWxpbWl0ZXIsICdUaGVyZSBjYW4gb25seSBiZSBvbmUgaWdub3JlIGRlbGltaXRlcicgKTtcbiAgICAgICAgYXNzZXJ0ICYmIGFzc2VydCggbWV0YUVuZ2xpc2hLZXlzLmluY2x1ZGVzKCB0b2tlbi5yZXBsYWNlKCBJR05PUkVfREVMSU1JVEVSLCAnJyApIGFzIEVuZ2xpc2hLZXlTdHJpbmcgKSwgJ1RoZSBpZ25vcmUgZGVsaW1pdGVyIGNhbiBvbmx5IGJlIHVzZWQgb24gZGVmYXVsdCBtb2RpZmllciBrZXlzJyApO1xuICAgICAgICBmb3VuZElnbm9yZURlbGltaXRlciA9IHRydWU7XG4gICAgICB9XG4gICAgfSApO1xuXG4gICAgY29uc3QgbW9kaWZpZXJLZXlzOiBBbGxvd2VkS2V5c1N0cmluZ1tdID0gW107XG4gICAgY29uc3QgaWdub3JlZE1vZGlmaWVyS2V5czogQWxsb3dlZEtleXNTdHJpbmdbXSA9IFtdO1xuXG4gICAgdG9rZW5zLmZvckVhY2goIHRva2VuID0+IHtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRva2VuIGNvbnRhaW5zIGEgcXVlc3Rpb24gbWFya1xuICAgICAgaWYgKCB0b2tlbi5pbmNsdWRlcyggSUdOT1JFX0RFTElNSVRFUiApICkge1xuICAgICAgICBjb25zdCBzdHJpcHBlZFRva2VuID0gdG9rZW4ucmVwbGFjZSggSUdOT1JFX0RFTElNSVRFUiwgJycgKTtcblxuICAgICAgICBpZiAoIHRva2VuLnN0YXJ0c1dpdGgoIElHTk9SRV9ERUxJTUlURVIgKSApIHtcblxuICAgICAgICAgIC8vIEFkZCBhbGwgZGVmYXVsdCBtb2RpZmllcnMgZXhjZXB0IHRoZSBjdXJyZW50IHN0cmlwcGVkIHRva2VuIHRvIHRoZSBpZ25vcmVkIGtleXNcbiAgICAgICAgICBjb25zdCBvdGhlck1vZGlmaWVycyA9IG1ldGFFbmdsaXNoS2V5cy5maWx0ZXIoIG1vZCA9PiBtb2QgIT09IHN0cmlwcGVkVG9rZW4gKTtcbiAgICAgICAgICBpZ25vcmVkTW9kaWZpZXJLZXlzLnB1c2goIC4uLm90aGVyTW9kaWZpZXJzICk7XG5cbiAgICAgICAgICAvLyBJbmNsdWRlIHRoZSBzdHJpcHBlZCB0b2tlbiBhcyBhIHJlZ3VsYXIgbW9kaWZpZXIga2V5XG4gICAgICAgICAgbW9kaWZpZXJLZXlzLnB1c2goIHN0cmlwcGVkVG9rZW4gYXMgQWxsb3dlZEtleXNTdHJpbmcgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcblxuICAgICAgICAgIC8vIEFkZCB0aGUgc3RyaXBwZWQgdG9rZW4gdG8gdGhlIGlnbm9yZWQgbW9kaWZpZXIga2V5c1xuICAgICAgICAgIGlnbm9yZWRNb2RpZmllcktleXMucHVzaCggc3RyaXBwZWRUb2tlbiBhcyBBbGxvd2VkS2V5c1N0cmluZyApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcblxuICAgICAgICAvLyBJZiB0aGVyZSdzIG5vIHF1ZXN0aW9uIG1hcmssIGFkZCB0aGUgdG9rZW4gdG8gdGhlIG1vZGlmaWVyIGtleXNcbiAgICAgICAgbW9kaWZpZXJLZXlzLnB1c2goIHRva2VuIGFzIEFsbG93ZWRLZXlzU3RyaW5nICk7XG4gICAgICB9XG4gICAgfSApO1xuXG4gICAgLy8gQXNzdW1lIHRoZSBsYXN0IHRva2VuIGlzIHRoZSBrZXlcbiAgICBjb25zdCBrZXkgPSBtb2RpZmllcktleXMucG9wKCkhO1xuXG4gICAgLy8gRmlsdGVyIG91dCBpZ25vcmVkIG1vZGlmaWVyIGtleXMgZnJvbSB0aGUgbW9kaWZpZXIga2V5cyBsaXN0XG4gICAgY29uc3QgZmlsdGVyZWRNb2RpZmllcktleXMgPSBtb2RpZmllcktleXMuZmlsdGVyKCBtb2QgPT4gIWlnbm9yZWRNb2RpZmllcktleXMuaW5jbHVkZXMoIG1vZCApICk7XG5cbiAgICByZXR1cm4gbmV3IEtleURlc2NyaXB0b3IoIHtcbiAgICAgIGtleToga2V5LFxuICAgICAgbW9kaWZpZXJLZXlzOiBmaWx0ZXJlZE1vZGlmaWVyS2V5cyxcbiAgICAgIGlnbm9yZWRNb2RpZmllcktleXM6IGlnbm9yZWRNb2RpZmllcktleXNcbiAgICB9ICk7XG4gIH1cbn1cblxuc2NlbmVyeS5yZWdpc3RlciggJ0tleURlc2NyaXB0b3InLCBLZXlEZXNjcmlwdG9yICk7Il0sIm5hbWVzIjpbIm9wdGlvbml6ZSIsIm1ldGFFbmdsaXNoS2V5cyIsInNjZW5lcnkiLCJJR05PUkVfREVMSU1JVEVSIiwiS2V5RGVzY3JpcHRvciIsImdldEhvdGtleVN0cmluZyIsIm1vZGlmaWVyS2V5cyIsImtleSIsImpvaW4iLCJrZXlTdHJva2VUb0tleURlc2NyaXB0b3IiLCJrZXlTdHJva2UiLCJ0b2tlbnMiLCJzcGxpdCIsImZvdW5kSWdub3JlRGVsaW1pdGVyIiwiZm9yRWFjaCIsInRva2VuIiwibGVuZ3RoIiwiaW5jbHVkZXMiLCJhc3NlcnQiLCJyZXBsYWNlIiwiaWdub3JlZE1vZGlmaWVyS2V5cyIsInN0cmlwcGVkVG9rZW4iLCJzdGFydHNXaXRoIiwib3RoZXJNb2RpZmllcnMiLCJmaWx0ZXIiLCJtb2QiLCJwdXNoIiwicG9wIiwiZmlsdGVyZWRNb2RpZmllcktleXMiLCJwcm92aWRlZE9wdGlvbnMiLCJvcHRpb25zIiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDtBQUVqRDs7Ozs7Ozs7Q0FRQyxHQUVELE9BQU9BLGVBQWUscUNBQXFDO0FBQzNELFNBQStEQyxlQUFlLEVBQUVDLE9BQU8sUUFBUSxnQkFBZ0I7QUFVL0csTUFBTUMsbUJBQW1CO0FBeURWLElBQUEsQUFBTUMsZ0JBQU4sTUFBTUE7SUFnQm5COzs7R0FHQyxHQUNELEFBQU9DLGtCQUF3QztRQUM3QyxPQUFPO2VBQ0YsSUFBSSxDQUFDQyxZQUFZO1lBQ3BCLElBQUksQ0FBQ0MsR0FBRztTQUNULENBQUNDLElBQUksQ0FBRTtJQUNWO0lBRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0NDLEdBQ0QsT0FBY0MseUJBQTBCQyxTQUF1QixFQUFrQjtRQUUvRSxNQUFNQyxTQUFTRCxVQUFVRSxLQUFLLENBQUU7UUFFaEMsYUFBYTtRQUNiLElBQUlDLHVCQUF1QjtRQUMzQkYsT0FBT0csT0FBTyxDQUFFQyxDQUFBQTtZQUVkLGlFQUFpRTtZQUNqRSxJQUFLQSxNQUFNQyxNQUFNLEdBQUcsS0FBS0QsTUFBTUUsUUFBUSxDQUFFZCxtQkFBcUI7Z0JBQzVEZSxVQUFVQSxPQUFRLENBQUNMLHNCQUFzQjtnQkFDekNLLFVBQVVBLE9BQVFqQixnQkFBZ0JnQixRQUFRLENBQUVGLE1BQU1JLE9BQU8sQ0FBRWhCLGtCQUFrQixNQUE0QjtnQkFDekdVLHVCQUF1QjtZQUN6QjtRQUNGO1FBRUEsTUFBTVAsZUFBb0MsRUFBRTtRQUM1QyxNQUFNYyxzQkFBMkMsRUFBRTtRQUVuRFQsT0FBT0csT0FBTyxDQUFFQyxDQUFBQTtZQUVkLDhDQUE4QztZQUM5QyxJQUFLQSxNQUFNRSxRQUFRLENBQUVkLG1CQUFxQjtnQkFDeEMsTUFBTWtCLGdCQUFnQk4sTUFBTUksT0FBTyxDQUFFaEIsa0JBQWtCO2dCQUV2RCxJQUFLWSxNQUFNTyxVQUFVLENBQUVuQixtQkFBcUI7b0JBRTFDLGtGQUFrRjtvQkFDbEYsTUFBTW9CLGlCQUFpQnRCLGdCQUFnQnVCLE1BQU0sQ0FBRUMsQ0FBQUEsTUFBT0EsUUFBUUo7b0JBQzlERCxvQkFBb0JNLElBQUksSUFBS0g7b0JBRTdCLHVEQUF1RDtvQkFDdkRqQixhQUFhb0IsSUFBSSxDQUFFTDtnQkFDckIsT0FDSztvQkFFSCxzREFBc0Q7b0JBQ3RERCxvQkFBb0JNLElBQUksQ0FBRUw7Z0JBQzVCO1lBQ0YsT0FDSztnQkFFSCxrRUFBa0U7Z0JBQ2xFZixhQUFhb0IsSUFBSSxDQUFFWDtZQUNyQjtRQUNGO1FBRUEsbUNBQW1DO1FBQ25DLE1BQU1SLE1BQU1ELGFBQWFxQixHQUFHO1FBRTVCLCtEQUErRDtRQUMvRCxNQUFNQyx1QkFBdUJ0QixhQUFha0IsTUFBTSxDQUFFQyxDQUFBQSxNQUFPLENBQUNMLG9CQUFvQkgsUUFBUSxDQUFFUTtRQUV4RixPQUFPLElBQUlyQixjQUFlO1lBQ3hCRyxLQUFLQTtZQUNMRCxjQUFjc0I7WUFDZFIscUJBQXFCQTtRQUN2QjtJQUNGO0lBakhBLFlBQW9CUyxlQUFzQyxDQUFHO1FBQzNELE1BQU1DLFVBQVU5QixZQUFtQztZQUNqRE0sY0FBYyxFQUFFO1lBQ2hCYyxxQkFBcUIsRUFBRTtRQUN6QixHQUFHUztRQUVILElBQUksQ0FBQ3RCLEdBQUcsR0FBR3VCLFFBQVF2QixHQUFHO1FBQ3RCLElBQUksQ0FBQ0QsWUFBWSxHQUFHd0IsUUFBUXhCLFlBQVk7UUFDeEMsSUFBSSxDQUFDYyxtQkFBbUIsR0FBR1UsUUFBUVYsbUJBQW1CO0lBQ3hEO0FBeUdGO0FBdkhBLFNBQXFCaEIsMkJBdUhwQjtBQUVERixRQUFRNkIsUUFBUSxDQUFFLGlCQUFpQjNCIn0=