// Copyright 2017-2024, University of Colorado Boulder
/**
 * Collection of utility constants and functions for managing keyboard input. Constants are values of Event.code, as
 * well as helper functions and collections.
 *
 * @author Jesse Greenberg
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */ import validate from '../../../axon/js/validate.js';
import { scenery } from '../imports.js';
const KEY_RIGHT_ARROW = 'ArrowRight';
const KEY_LEFT_ARROW = 'ArrowLeft';
const KEY_UP_ARROW = 'ArrowUp';
const KEY_DOWN_ARROW = 'ArrowDown';
const KEY_SHIFT_RIGHT = 'ShiftRight';
const KEY_SHIFT_LEFT = 'ShiftLeft';
const KEY_CONTROL_LEFT = 'ControlLeft';
const KEY_CONTROL_RIGHT = 'ControlRight';
const KEY_ALT_LEFT = 'AltLeft';
const KEY_ALT_RIGHT = 'AltRight';
const KEY_META_LEFT = 'MetaLeft';
const KEY_META_RIGHT = 'MetaRight';
const KEY_META_LEFT_FIREFOX = 'OSLeft'; // FF specific codes for meta keys
const KEY_META_RIGHT_FIREFOX = 'OSRight';
const KEY_W = 'KeyW';
const KEY_A = 'KeyA';
const KEY_S = 'KeyS';
const KEY_D = 'KeyD';
const KEY_0 = 'Digit0';
const KEY_1 = 'Digit1';
const KEY_2 = 'Digit2';
const KEY_3 = 'Digit3';
const KEY_4 = 'Digit4';
const KEY_5 = 'Digit5';
const KEY_6 = 'Digit6';
const KEY_7 = 'Digit7';
const KEY_8 = 'Digit8';
const KEY_9 = 'Digit9';
// These are `KeyboardEvent.key` values! The difference is necessary because KeyboardEvent.code distinguishes between
// left and right, but we often need to watch for both at the same time.
const KEY_ALT = 'Alt';
const KEY_SHIFT = 'Shift';
const KEY_CONTROL = 'Control';
const ARROW_KEYS = [
    KEY_RIGHT_ARROW,
    KEY_LEFT_ARROW,
    KEY_UP_ARROW,
    KEY_DOWN_ARROW
];
const WASD_KEYS = [
    KEY_W,
    KEY_S,
    KEY_A,
    KEY_D
];
const NUMBER_KEYS = [
    KEY_0,
    KEY_1,
    KEY_2,
    KEY_3,
    KEY_4,
    KEY_5,
    KEY_6,
    KEY_7,
    KEY_8,
    KEY_9
];
const SHIFT_KEYS = [
    KEY_SHIFT_LEFT,
    KEY_SHIFT_RIGHT
];
const CONTROL_KEYS = [
    KEY_CONTROL_LEFT,
    KEY_CONTROL_RIGHT
];
const ALT_KEYS = [
    KEY_ALT_LEFT,
    KEY_ALT_RIGHT
];
const META_KEYS = [
    KEY_META_LEFT,
    KEY_META_RIGHT,
    KEY_META_LEFT_FIREFOX,
    KEY_META_RIGHT_FIREFOX
];
// These are KeyboardEvent.key values, excluding left/right KeyboardEvent.codes
const MODIFIER_KEYS = [
    KEY_ALT,
    KEY_CONTROL,
    KEY_SHIFT
];
// These are KeyboardEvent.code values for modifier keys
const MODIFIER_KEY_CODES = [
    KEY_ALT_LEFT,
    KEY_ALT_RIGHT,
    KEY_CONTROL_LEFT,
    KEY_CONTROL_RIGHT,
    KEY_SHIFT_LEFT,
    KEY_SHIFT_RIGHT,
    KEY_META_LEFT,
    KEY_META_RIGHT,
    KEY_META_LEFT_FIREFOX,
    KEY_META_RIGHT_FIREFOX
];
const DOM_EVENT_VALIDATOR = {
    valueType: Event
};
const ALL_KEY_CODES = [];
/**
 * @extends {Object}
 * @type {{KEY_A: string, KEY_C: string, KEY_DOWN_ARROW: string, KEY_DELETE: string, KEY_B: string, KEY_E: string, KEY_D: string, KEY_G: string, KEY_F: string, KEY_I: string, KEY_H: string, KEY_K: string, KEY_RIGHT_ARROW: string, KEY_J: string, isArrowKey(Event): boolean, KEY_M: string, KEY_L: string, KEY_O: string, KEY_N: string, KEY_Q: string, KEY_P: string, KEY_S: string, KEY_BACKSPACE: string, KEY_R: string, KEY_U: string, KEY_MINUS: string, KEY_T: string, isMovementKey(Event): boolean, KEY_W: string, KEY_V: string, CONTROL_KEYS: (string)[], KEY_Y: string, KEY_X: string, getNumberFromCode(Event): (number|null), isAltKey(KeyboardEvent): *, KEY_Z: string, ARROW_KEYS: (string)[], KEY_SHIFT_LEFT: string, KEY_HOME: string, KEY_ESCAPE: string, isShiftKey(KeyboardEvent): *, KEY_ALT_LEFT: string, KEY_LEFT_ARROW: string, KEY_TAB: string, isAnyKeyEvent(x:Event, y:Array<string>): boolean, getEventCode(Event): (string|null), KEY_EQUALS: string, KEY_PAGE_UP: string, KEY_ALT_RIGHT: string, isWASDKey(Event): boolean, ALT_KEYS: (string)[], KEY_PAGE_DOWN: string, isNumberKey(Event): boolean, SHIFT_KEYS: (string)[], KEY_PLUS: string, WASD_KEYS: (string)[], isControlKey(KeyboardEvent): *, KEY_SHIFT_RIGHT: string, isRangeKey(Event): boolean, KEY_CONTROL_RIGHT: string, KEY_ENTER: string, isKeyEvent(Event, string): boolean, KEY_UP_ARROW: string, KEY_1: string, KEY_0: string, KEY_CONTROL_LEFT: string, KEY_3: string, KEY_2: string, KEY_5: string, KEY_4: string, KEY_7: string, KEY_6: string, KEY_9: string, MOVEMENT_KEYS: (string)[], KEY_8: string, KEY_SPACE: string, KEY_END: string}}
 */ const KeyboardUtils = {
    KEY_SPACE: 'Space',
    KEY_ENTER: 'Enter',
    KEY_TAB: 'Tab',
    KEY_RIGHT_ARROW: KEY_RIGHT_ARROW,
    KEY_LEFT_ARROW: KEY_LEFT_ARROW,
    KEY_UP_ARROW: KEY_UP_ARROW,
    KEY_DOWN_ARROW: KEY_DOWN_ARROW,
    KEY_SHIFT_LEFT: KEY_SHIFT_LEFT,
    KEY_SHIFT_RIGHT: KEY_SHIFT_RIGHT,
    KEY_ALT_LEFT: KEY_ALT_LEFT,
    KEY_ALT_RIGHT: KEY_ALT_RIGHT,
    KEY_CONTROL_LEFT: KEY_CONTROL_LEFT,
    KEY_CONTROL_RIGHT: KEY_CONTROL_RIGHT,
    KEY_META_LEFT: KEY_META_LEFT,
    KEY_META_RIGHT: KEY_META_RIGHT,
    KEY_META_LEFT_FIREFOX: KEY_META_LEFT_FIREFOX,
    KEY_META_RIGHT_FIREFOX: KEY_META_RIGHT_FIREFOX,
    KEY_SHIFT: KEY_SHIFT,
    KEY_ALT: KEY_ALT,
    KEY_CONTROL: KEY_CONTROL,
    KEY_ESCAPE: 'Escape',
    KEY_DELETE: 'Delete',
    KEY_BACKSPACE: 'Backspace',
    KEY_PAGE_UP: 'PageUp',
    KEY_PAGE_DOWN: 'PageDown',
    KEY_END: 'End',
    KEY_HOME: 'Home',
    KEY_0: KEY_0,
    KEY_1: KEY_1,
    KEY_2: KEY_2,
    KEY_3: KEY_3,
    KEY_4: KEY_4,
    KEY_5: KEY_5,
    KEY_6: KEY_6,
    KEY_7: KEY_7,
    KEY_8: KEY_8,
    KEY_9: KEY_9,
    KEY_NUMPAD_0: 'Numpad0',
    KEY_NUMPAD_1: 'Numpad1',
    KEY_NUMPAD_2: 'Numpad2',
    KEY_NUMPAD_3: 'Numpad3',
    KEY_NUMPAD_4: 'Numpad4',
    KEY_NUMPAD_5: 'Numpad5',
    KEY_NUMPAD_6: 'Numpad6',
    KEY_NUMPAD_7: 'Numpad7',
    KEY_NUMPAD_8: 'Numpad8',
    KEY_NUMPAD_9: 'Numpad9',
    KEY_NUMPAD_DECIMAL: 'NumpadDecimal',
    KEY_NUMPAD_PLUS: 'NumpadAdd',
    KEY_NUMPAD_MINUS: 'NumpadSubtract',
    KEY_A: 'KeyA',
    KEY_B: 'KeyB',
    KEY_C: 'KeyC',
    KEY_D: 'KeyD',
    KEY_E: 'KeyE',
    KEY_F: 'KeyF',
    KEY_G: 'KeyG',
    KEY_H: 'KeyH',
    KEY_I: 'KeyI',
    KEY_J: 'KeyJ',
    KEY_K: 'KeyK',
    KEY_L: 'KeyL',
    KEY_M: 'KeyM',
    KEY_N: 'KeyN',
    KEY_O: 'KeyO',
    KEY_P: 'KeyP',
    KEY_Q: 'KeyQ',
    KEY_R: 'KeyR',
    KEY_S: 'KeyS',
    KEY_T: 'KeyT',
    KEY_U: 'KeyU',
    KEY_V: 'KeyV',
    KEY_W: 'KeyW',
    KEY_X: 'KeyX',
    KEY_Y: 'KeyY',
    KEY_Z: 'KeyZ',
    // "Equals" and "Plus" share the same event.code, check for distinction with shift modifier key
    KEY_EQUALS: 'Equal',
    KEY_PLUS: 'Equal',
    KEY_MINUS: 'Minus',
    KEY_PERIOD: 'Period',
    ARROW_KEYS: ARROW_KEYS,
    WASD_KEYS: WASD_KEYS,
    MOVEMENT_KEYS: ARROW_KEYS.concat(WASD_KEYS),
    SHIFT_KEYS: SHIFT_KEYS,
    CONTROL_KEYS: CONTROL_KEYS,
    ALT_KEYS: ALT_KEYS,
    META_KEYS: META_KEYS,
    // The collection of modifier key codes
    MODIFIER_KEY_CODES: MODIFIER_KEY_CODES,
    // Maps a KeyboardEvent.key to the left/right pair of KeyboardEvent.code for modifier keys
    MODIFIER_KEY_TO_CODE_MAP: new Map([
        [
            KEY_ALT,
            ALT_KEYS
        ],
        [
            KEY_SHIFT,
            SHIFT_KEYS
        ],
        [
            KEY_CONTROL,
            CONTROL_KEYS
        ]
    ]),
    /**
   * Returns whether the key corresponds to pressing an arrow key
   */ isArrowKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, ARROW_KEYS);
    },
    /**
   * Returns true if key is one of keys used for range inputs
   */ isRangeKey (domEvent) {
        return KeyboardUtils.isArrowKey(domEvent) || KeyboardUtils.isAnyKeyEvent(domEvent, [
            KeyboardUtils.KEY_PAGE_UP,
            KeyboardUtils.KEY_PAGE_DOWN,
            KeyboardUtils.KEY_HOME,
            KeyboardUtils.KEY_END
        ]);
    },
    /**
   * Returns whether or not the key corresponds to pressing a number key
   */ isNumberKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, NUMBER_KEYS);
    },
    /**
   * For number keys, return the number of the key, or null if not a number
   */ getNumberFromCode (domEvent) {
        if (KeyboardUtils.isNumberKey(domEvent) && domEvent instanceof KeyboardEvent) {
            return Number(domEvent.code.replace('Digit', ''));
        }
        return null;
    },
    /**
   * Event.code distinguishes between left and right shift keys. If all you care about is the presence
   * of a shift key you can use this.
   */ isShiftKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, SHIFT_KEYS);
    },
    /**
   * Event.code distinguishes between left and right alt keys. If all you care about is the presence
   * of the alt key you can use this.
   */ isAltKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, ALT_KEYS);
    },
    /**
   * Event.code distinguishes between left and right control keys. If all you care about is the presence
   * of a control key you can use this.
   */ isControlKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, CONTROL_KEYS);
    },
    /**
   * Event.code distinguishes between left and right alt keys. If all you care about is the presence
   * of the meta key you can use this.
   */ isMetaKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, META_KEYS);
    },
    /**
   * Returns whether or not the key corresponds to one of the WASD movement keys.
   */ isWASDKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, WASD_KEYS);
    },
    /**
   * Returns true if the key indicates a 'movement' key in keyboard dragging
   */ isMovementKey (domEvent) {
        return KeyboardUtils.isAnyKeyEvent(domEvent, KeyboardUtils.MOVEMENT_KEYS);
    },
    /**
   * If the domEvent corresponds to any of the provided keys in the list.
   */ isAnyKeyEvent (domEvent, keyboardUtilsKeys) {
        validate(domEvent, DOM_EVENT_VALIDATOR);
        const code = KeyboardUtils.getEventCode(domEvent);
        return code ? keyboardUtilsKeys.includes(code) : false;
    },
    /**
   * Whether the event was of the provided KeyboardUtils string.
   */ isKeyEvent (domEvent, keyboardUtilsKey) {
        return KeyboardUtils.getEventCode(domEvent) === keyboardUtilsKey;
    },
    /**
   * Returns a string with the event.code that can be used to determine the keyboard keys of a KeyboardEvent object.
   * Otherwise, returns null if there is no code on the event. An example usage might look like
   *
   *  const key = KeyboardUtils.getEventCode( domEvent );
   *  if ( key === KeyboardUtils.KEY_A ) {
   *    // You pressed the A key!
   *  }
   *
   * @returns - null if there is no `code` property on the provided Event.
   */ getEventCode (domEvent) {
        let eventCode = null;
        if (domEvent instanceof KeyboardEvent && domEvent.code) {
            eventCode = domEvent.code;
            // For Numpad keys, the DomEvent.code does not match the equivalent "normal" keyboard key, but the DomEvent.key
            // will match the code of the "normal" key. In those cases (home/page up/page down/end) use the key as the code.
            if (eventCode.startsWith('Numpad') && ALL_KEY_CODES.includes(domEvent.key)) {
                eventCode = domEvent.key;
            }
        }
        return eventCode;
    },
    /**
   * Returns true when if the provided string is a KeyboardEvent.key for a modifier key. Note that is KeyboardEvent.key
   * **NOT** KeyboardEvent.code. KeyboardEvent.code does not distinguish between left and right modifier keys so we
   * have some special behavior when we detect a modifier key (left or right) is pressed.
   * @param key
   */ isModifierKey (key) {
        return MODIFIER_KEYS.includes(key);
    },
    ALL_KEYS: ALL_KEY_CODES
};
for(const keyKey in KeyboardUtils){
    // @ts-expect-error No functions or key-groups allowed
    if (KeyboardUtils.hasOwnProperty(keyKey) && typeof KeyboardUtils[keyKey] === 'string') {
        // @ts-expect-error
        ALL_KEY_CODES.push(KeyboardUtils[keyKey]);
    }
}
scenery.register('KeyboardUtils', KeyboardUtils);
export default KeyboardUtils;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvYWNjZXNzaWJpbGl0eS9LZXlib2FyZFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE3LTIwMjQsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxuXG4vKipcbiAqIENvbGxlY3Rpb24gb2YgdXRpbGl0eSBjb25zdGFudHMgYW5kIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcga2V5Ym9hcmQgaW5wdXQuIENvbnN0YW50cyBhcmUgdmFsdWVzIG9mIEV2ZW50LmNvZGUsIGFzXG4gKiB3ZWxsIGFzIGhlbHBlciBmdW5jdGlvbnMgYW5kIGNvbGxlY3Rpb25zLlxuICpcbiAqIEBhdXRob3IgSmVzc2UgR3JlZW5iZXJnXG4gKiBAYXV0aG9yIE1pY2hhZWwgS2F1em1hbm4gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXG4gKi9cblxuaW1wb3J0IHZhbGlkYXRlIGZyb20gJy4uLy4uLy4uL2F4b24vanMvdmFsaWRhdGUuanMnO1xuaW1wb3J0IHsgc2NlbmVyeSB9IGZyb20gJy4uL2ltcG9ydHMuanMnO1xuXG5jb25zdCBLRVlfUklHSFRfQVJST1cgPSAnQXJyb3dSaWdodCc7XG5jb25zdCBLRVlfTEVGVF9BUlJPVyA9ICdBcnJvd0xlZnQnO1xuY29uc3QgS0VZX1VQX0FSUk9XID0gJ0Fycm93VXAnO1xuY29uc3QgS0VZX0RPV05fQVJST1cgPSAnQXJyb3dEb3duJztcbmNvbnN0IEtFWV9TSElGVF9SSUdIVCA9ICdTaGlmdFJpZ2h0JztcbmNvbnN0IEtFWV9TSElGVF9MRUZUID0gJ1NoaWZ0TGVmdCc7XG5jb25zdCBLRVlfQ09OVFJPTF9MRUZUID0gJ0NvbnRyb2xMZWZ0JztcbmNvbnN0IEtFWV9DT05UUk9MX1JJR0hUID0gJ0NvbnRyb2xSaWdodCc7XG5jb25zdCBLRVlfQUxUX0xFRlQgPSAnQWx0TGVmdCc7XG5jb25zdCBLRVlfQUxUX1JJR0hUID0gJ0FsdFJpZ2h0JztcbmNvbnN0IEtFWV9NRVRBX0xFRlQgPSAnTWV0YUxlZnQnO1xuY29uc3QgS0VZX01FVEFfUklHSFQgPSAnTWV0YVJpZ2h0JztcbmNvbnN0IEtFWV9NRVRBX0xFRlRfRklSRUZPWCA9ICdPU0xlZnQnOyAvLyBGRiBzcGVjaWZpYyBjb2RlcyBmb3IgbWV0YSBrZXlzXG5jb25zdCBLRVlfTUVUQV9SSUdIVF9GSVJFRk9YID0gJ09TUmlnaHQnO1xuY29uc3QgS0VZX1cgPSAnS2V5Vyc7XG5jb25zdCBLRVlfQSA9ICdLZXlBJztcbmNvbnN0IEtFWV9TID0gJ0tleVMnO1xuY29uc3QgS0VZX0QgPSAnS2V5RCc7XG5jb25zdCBLRVlfMCA9ICdEaWdpdDAnO1xuY29uc3QgS0VZXzEgPSAnRGlnaXQxJztcbmNvbnN0IEtFWV8yID0gJ0RpZ2l0Mic7XG5jb25zdCBLRVlfMyA9ICdEaWdpdDMnO1xuY29uc3QgS0VZXzQgPSAnRGlnaXQ0JztcbmNvbnN0IEtFWV81ID0gJ0RpZ2l0NSc7XG5jb25zdCBLRVlfNiA9ICdEaWdpdDYnO1xuY29uc3QgS0VZXzcgPSAnRGlnaXQ3JztcbmNvbnN0IEtFWV84ID0gJ0RpZ2l0OCc7XG5jb25zdCBLRVlfOSA9ICdEaWdpdDknO1xuXG4vLyBUaGVzZSBhcmUgYEtleWJvYXJkRXZlbnQua2V5YCB2YWx1ZXMhIFRoZSBkaWZmZXJlbmNlIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIEtleWJvYXJkRXZlbnQuY29kZSBkaXN0aW5ndWlzaGVzIGJldHdlZW5cbi8vIGxlZnQgYW5kIHJpZ2h0LCBidXQgd2Ugb2Z0ZW4gbmVlZCB0byB3YXRjaCBmb3IgYm90aCBhdCB0aGUgc2FtZSB0aW1lLlxuY29uc3QgS0VZX0FMVCA9ICdBbHQnO1xuY29uc3QgS0VZX1NISUZUID0gJ1NoaWZ0JztcbmNvbnN0IEtFWV9DT05UUk9MID0gJ0NvbnRyb2wnO1xuXG5jb25zdCBBUlJPV19LRVlTID0gWyBLRVlfUklHSFRfQVJST1csIEtFWV9MRUZUX0FSUk9XLCBLRVlfVVBfQVJST1csIEtFWV9ET1dOX0FSUk9XIF07XG5jb25zdCBXQVNEX0tFWVMgPSBbIEtFWV9XLCBLRVlfUywgS0VZX0EsIEtFWV9EIF07XG5jb25zdCBOVU1CRVJfS0VZUyA9IFsgS0VZXzAsIEtFWV8xLCBLRVlfMiwgS0VZXzMsIEtFWV80LCBLRVlfNSwgS0VZXzYsIEtFWV83LCBLRVlfOCwgS0VZXzkgXTtcbmNvbnN0IFNISUZUX0tFWVMgPSBbIEtFWV9TSElGVF9MRUZULCBLRVlfU0hJRlRfUklHSFQgXTtcbmNvbnN0IENPTlRST0xfS0VZUyA9IFsgS0VZX0NPTlRST0xfTEVGVCwgS0VZX0NPTlRST0xfUklHSFQgXTtcbmNvbnN0IEFMVF9LRVlTID0gWyBLRVlfQUxUX0xFRlQsIEtFWV9BTFRfUklHSFQgXTtcbmNvbnN0IE1FVEFfS0VZUyA9IFsgS0VZX01FVEFfTEVGVCwgS0VZX01FVEFfUklHSFQsIEtFWV9NRVRBX0xFRlRfRklSRUZPWCwgS0VZX01FVEFfUklHSFRfRklSRUZPWCBdO1xuXG4vLyBUaGVzZSBhcmUgS2V5Ym9hcmRFdmVudC5rZXkgdmFsdWVzLCBleGNsdWRpbmcgbGVmdC9yaWdodCBLZXlib2FyZEV2ZW50LmNvZGVzXG5jb25zdCBNT0RJRklFUl9LRVlTID0gWyBLRVlfQUxULCBLRVlfQ09OVFJPTCwgS0VZX1NISUZUIF07XG5cbi8vIFRoZXNlIGFyZSBLZXlib2FyZEV2ZW50LmNvZGUgdmFsdWVzIGZvciBtb2RpZmllciBrZXlzXG5jb25zdCBNT0RJRklFUl9LRVlfQ09ERVMgPSBbIEtFWV9BTFRfTEVGVCwgS0VZX0FMVF9SSUdIVCwgS0VZX0NPTlRST0xfTEVGVCwgS0VZX0NPTlRST0xfUklHSFQsIEtFWV9TSElGVF9MRUZULCBLRVlfU0hJRlRfUklHSFQsIEtFWV9NRVRBX0xFRlQsIEtFWV9NRVRBX1JJR0hULCBLRVlfTUVUQV9MRUZUX0ZJUkVGT1gsIEtFWV9NRVRBX1JJR0hUX0ZJUkVGT1ggXTtcblxuY29uc3QgRE9NX0VWRU5UX1ZBTElEQVRPUiA9IHsgdmFsdWVUeXBlOiBFdmVudCB9O1xuY29uc3QgQUxMX0tFWV9DT0RFUzogc3RyaW5nW10gPSBbXTtcblxuLyoqXG4gKiBAZXh0ZW5kcyB7T2JqZWN0fVxuICogQHR5cGUge3tLRVlfQTogc3RyaW5nLCBLRVlfQzogc3RyaW5nLCBLRVlfRE9XTl9BUlJPVzogc3RyaW5nLCBLRVlfREVMRVRFOiBzdHJpbmcsIEtFWV9COiBzdHJpbmcsIEtFWV9FOiBzdHJpbmcsIEtFWV9EOiBzdHJpbmcsIEtFWV9HOiBzdHJpbmcsIEtFWV9GOiBzdHJpbmcsIEtFWV9JOiBzdHJpbmcsIEtFWV9IOiBzdHJpbmcsIEtFWV9LOiBzdHJpbmcsIEtFWV9SSUdIVF9BUlJPVzogc3RyaW5nLCBLRVlfSjogc3RyaW5nLCBpc0Fycm93S2V5KEV2ZW50KTogYm9vbGVhbiwgS0VZX006IHN0cmluZywgS0VZX0w6IHN0cmluZywgS0VZX086IHN0cmluZywgS0VZX046IHN0cmluZywgS0VZX1E6IHN0cmluZywgS0VZX1A6IHN0cmluZywgS0VZX1M6IHN0cmluZywgS0VZX0JBQ0tTUEFDRTogc3RyaW5nLCBLRVlfUjogc3RyaW5nLCBLRVlfVTogc3RyaW5nLCBLRVlfTUlOVVM6IHN0cmluZywgS0VZX1Q6IHN0cmluZywgaXNNb3ZlbWVudEtleShFdmVudCk6IGJvb2xlYW4sIEtFWV9XOiBzdHJpbmcsIEtFWV9WOiBzdHJpbmcsIENPTlRST0xfS0VZUzogKHN0cmluZylbXSwgS0VZX1k6IHN0cmluZywgS0VZX1g6IHN0cmluZywgZ2V0TnVtYmVyRnJvbUNvZGUoRXZlbnQpOiAobnVtYmVyfG51bGwpLCBpc0FsdEtleShLZXlib2FyZEV2ZW50KTogKiwgS0VZX1o6IHN0cmluZywgQVJST1dfS0VZUzogKHN0cmluZylbXSwgS0VZX1NISUZUX0xFRlQ6IHN0cmluZywgS0VZX0hPTUU6IHN0cmluZywgS0VZX0VTQ0FQRTogc3RyaW5nLCBpc1NoaWZ0S2V5KEtleWJvYXJkRXZlbnQpOiAqLCBLRVlfQUxUX0xFRlQ6IHN0cmluZywgS0VZX0xFRlRfQVJST1c6IHN0cmluZywgS0VZX1RBQjogc3RyaW5nLCBpc0FueUtleUV2ZW50KHg6RXZlbnQsIHk6QXJyYXk8c3RyaW5nPik6IGJvb2xlYW4sIGdldEV2ZW50Q29kZShFdmVudCk6IChzdHJpbmd8bnVsbCksIEtFWV9FUVVBTFM6IHN0cmluZywgS0VZX1BBR0VfVVA6IHN0cmluZywgS0VZX0FMVF9SSUdIVDogc3RyaW5nLCBpc1dBU0RLZXkoRXZlbnQpOiBib29sZWFuLCBBTFRfS0VZUzogKHN0cmluZylbXSwgS0VZX1BBR0VfRE9XTjogc3RyaW5nLCBpc051bWJlcktleShFdmVudCk6IGJvb2xlYW4sIFNISUZUX0tFWVM6IChzdHJpbmcpW10sIEtFWV9QTFVTOiBzdHJpbmcsIFdBU0RfS0VZUzogKHN0cmluZylbXSwgaXNDb250cm9sS2V5KEtleWJvYXJkRXZlbnQpOiAqLCBLRVlfU0hJRlRfUklHSFQ6IHN0cmluZywgaXNSYW5nZUtleShFdmVudCk6IGJvb2xlYW4sIEtFWV9DT05UUk9MX1JJR0hUOiBzdHJpbmcsIEtFWV9FTlRFUjogc3RyaW5nLCBpc0tleUV2ZW50KEV2ZW50LCBzdHJpbmcpOiBib29sZWFuLCBLRVlfVVBfQVJST1c6IHN0cmluZywgS0VZXzE6IHN0cmluZywgS0VZXzA6IHN0cmluZywgS0VZX0NPTlRST0xfTEVGVDogc3RyaW5nLCBLRVlfMzogc3RyaW5nLCBLRVlfMjogc3RyaW5nLCBLRVlfNTogc3RyaW5nLCBLRVlfNDogc3RyaW5nLCBLRVlfNzogc3RyaW5nLCBLRVlfNjogc3RyaW5nLCBLRVlfOTogc3RyaW5nLCBNT1ZFTUVOVF9LRVlTOiAoc3RyaW5nKVtdLCBLRVlfODogc3RyaW5nLCBLRVlfU1BBQ0U6IHN0cmluZywgS0VZX0VORDogc3RyaW5nfX1cbiAqL1xuY29uc3QgS2V5Ym9hcmRVdGlscyA9IHtcbiAgS0VZX1NQQUNFOiAnU3BhY2UnLFxuICBLRVlfRU5URVI6ICdFbnRlcicsXG4gIEtFWV9UQUI6ICdUYWInLFxuICBLRVlfUklHSFRfQVJST1c6IEtFWV9SSUdIVF9BUlJPVyxcbiAgS0VZX0xFRlRfQVJST1c6IEtFWV9MRUZUX0FSUk9XLFxuICBLRVlfVVBfQVJST1c6IEtFWV9VUF9BUlJPVyxcbiAgS0VZX0RPV05fQVJST1c6IEtFWV9ET1dOX0FSUk9XLFxuICBLRVlfU0hJRlRfTEVGVDogS0VZX1NISUZUX0xFRlQsXG4gIEtFWV9TSElGVF9SSUdIVDogS0VZX1NISUZUX1JJR0hULFxuICBLRVlfQUxUX0xFRlQ6IEtFWV9BTFRfTEVGVCxcbiAgS0VZX0FMVF9SSUdIVDogS0VZX0FMVF9SSUdIVCxcbiAgS0VZX0NPTlRST0xfTEVGVDogS0VZX0NPTlRST0xfTEVGVCxcbiAgS0VZX0NPTlRST0xfUklHSFQ6IEtFWV9DT05UUk9MX1JJR0hULFxuICBLRVlfTUVUQV9MRUZUOiBLRVlfTUVUQV9MRUZULFxuICBLRVlfTUVUQV9SSUdIVDogS0VZX01FVEFfUklHSFQsXG4gIEtFWV9NRVRBX0xFRlRfRklSRUZPWDogS0VZX01FVEFfTEVGVF9GSVJFRk9YLFxuICBLRVlfTUVUQV9SSUdIVF9GSVJFRk9YOiBLRVlfTUVUQV9SSUdIVF9GSVJFRk9YLFxuICBLRVlfU0hJRlQ6IEtFWV9TSElGVCxcbiAgS0VZX0FMVDogS0VZX0FMVCxcbiAgS0VZX0NPTlRST0w6IEtFWV9DT05UUk9MLFxuICBLRVlfRVNDQVBFOiAnRXNjYXBlJyxcbiAgS0VZX0RFTEVURTogJ0RlbGV0ZScsXG4gIEtFWV9CQUNLU1BBQ0U6ICdCYWNrc3BhY2UnLFxuICBLRVlfUEFHRV9VUDogJ1BhZ2VVcCcsXG4gIEtFWV9QQUdFX0RPV046ICdQYWdlRG93bicsXG4gIEtFWV9FTkQ6ICdFbmQnLFxuICBLRVlfSE9NRTogJ0hvbWUnLFxuICBLRVlfMDogS0VZXzAsXG4gIEtFWV8xOiBLRVlfMSxcbiAgS0VZXzI6IEtFWV8yLFxuICBLRVlfMzogS0VZXzMsXG4gIEtFWV80OiBLRVlfNCxcbiAgS0VZXzU6IEtFWV81LFxuICBLRVlfNjogS0VZXzYsXG4gIEtFWV83OiBLRVlfNyxcbiAgS0VZXzg6IEtFWV84LFxuICBLRVlfOTogS0VZXzksXG4gIEtFWV9OVU1QQURfMDogJ051bXBhZDAnLFxuICBLRVlfTlVNUEFEXzE6ICdOdW1wYWQxJyxcbiAgS0VZX05VTVBBRF8yOiAnTnVtcGFkMicsXG4gIEtFWV9OVU1QQURfMzogJ051bXBhZDMnLFxuICBLRVlfTlVNUEFEXzQ6ICdOdW1wYWQ0JyxcbiAgS0VZX05VTVBBRF81OiAnTnVtcGFkNScsXG4gIEtFWV9OVU1QQURfNjogJ051bXBhZDYnLFxuICBLRVlfTlVNUEFEXzc6ICdOdW1wYWQ3JyxcbiAgS0VZX05VTVBBRF84OiAnTnVtcGFkOCcsXG4gIEtFWV9OVU1QQURfOTogJ051bXBhZDknLFxuICBLRVlfTlVNUEFEX0RFQ0lNQUw6ICdOdW1wYWREZWNpbWFsJyxcbiAgS0VZX05VTVBBRF9QTFVTOiAnTnVtcGFkQWRkJyxcbiAgS0VZX05VTVBBRF9NSU5VUzogJ051bXBhZFN1YnRyYWN0JyxcbiAgS0VZX0E6ICdLZXlBJyxcbiAgS0VZX0I6ICdLZXlCJyxcbiAgS0VZX0M6ICdLZXlDJyxcbiAgS0VZX0Q6ICdLZXlEJyxcbiAgS0VZX0U6ICdLZXlFJyxcbiAgS0VZX0Y6ICdLZXlGJyxcbiAgS0VZX0c6ICdLZXlHJyxcbiAgS0VZX0g6ICdLZXlIJyxcbiAgS0VZX0k6ICdLZXlJJyxcbiAgS0VZX0o6ICdLZXlKJyxcbiAgS0VZX0s6ICdLZXlLJyxcbiAgS0VZX0w6ICdLZXlMJyxcbiAgS0VZX006ICdLZXlNJyxcbiAgS0VZX046ICdLZXlOJyxcbiAgS0VZX086ICdLZXlPJyxcbiAgS0VZX1A6ICdLZXlQJyxcbiAgS0VZX1E6ICdLZXlRJyxcbiAgS0VZX1I6ICdLZXlSJyxcbiAgS0VZX1M6ICdLZXlTJyxcbiAgS0VZX1Q6ICdLZXlUJyxcbiAgS0VZX1U6ICdLZXlVJyxcbiAgS0VZX1Y6ICdLZXlWJyxcbiAgS0VZX1c6ICdLZXlXJyxcbiAgS0VZX1g6ICdLZXlYJyxcbiAgS0VZX1k6ICdLZXlZJyxcbiAgS0VZX1o6ICdLZXlaJyxcblxuICAvLyBcIkVxdWFsc1wiIGFuZCBcIlBsdXNcIiBzaGFyZSB0aGUgc2FtZSBldmVudC5jb2RlLCBjaGVjayBmb3IgZGlzdGluY3Rpb24gd2l0aCBzaGlmdCBtb2RpZmllciBrZXlcbiAgS0VZX0VRVUFMUzogJ0VxdWFsJyxcbiAgS0VZX1BMVVM6ICdFcXVhbCcsXG4gIEtFWV9NSU5VUzogJ01pbnVzJyxcbiAgS0VZX1BFUklPRDogJ1BlcmlvZCcsXG5cbiAgQVJST1dfS0VZUzogQVJST1dfS0VZUyxcbiAgV0FTRF9LRVlTOiBXQVNEX0tFWVMsXG4gIE1PVkVNRU5UX0tFWVM6IEFSUk9XX0tFWVMuY29uY2F0KCBXQVNEX0tFWVMgKSxcbiAgU0hJRlRfS0VZUzogU0hJRlRfS0VZUyxcbiAgQ09OVFJPTF9LRVlTOiBDT05UUk9MX0tFWVMsXG4gIEFMVF9LRVlTOiBBTFRfS0VZUyxcbiAgTUVUQV9LRVlTOiBNRVRBX0tFWVMsXG5cbiAgLy8gVGhlIGNvbGxlY3Rpb24gb2YgbW9kaWZpZXIga2V5IGNvZGVzXG4gIE1PRElGSUVSX0tFWV9DT0RFUzogTU9ESUZJRVJfS0VZX0NPREVTLFxuXG4gIC8vIE1hcHMgYSBLZXlib2FyZEV2ZW50LmtleSB0byB0aGUgbGVmdC9yaWdodCBwYWlyIG9mIEtleWJvYXJkRXZlbnQuY29kZSBmb3IgbW9kaWZpZXIga2V5c1xuICBNT0RJRklFUl9LRVlfVE9fQ09ERV9NQVA6IG5ldyBNYXAoIFtcbiAgICBbIEtFWV9BTFQsIEFMVF9LRVlTIF0sXG4gICAgWyBLRVlfU0hJRlQsIFNISUZUX0tFWVMgXSxcbiAgICBbIEtFWV9DT05UUk9MLCBDT05UUk9MX0tFWVMgXVxuICBdICksXG5cblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBrZXkgY29ycmVzcG9uZHMgdG8gcHJlc3NpbmcgYW4gYXJyb3cga2V5XG4gICAqL1xuICBpc0Fycm93S2V5KCBkb21FdmVudDogRXZlbnQgfCBudWxsICk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBLZXlib2FyZFV0aWxzLmlzQW55S2V5RXZlbnQoIGRvbUV2ZW50LCBBUlJPV19LRVlTICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSBpZiBrZXkgaXMgb25lIG9mIGtleXMgdXNlZCBmb3IgcmFuZ2UgaW5wdXRzXG4gICAqL1xuICBpc1JhbmdlS2V5KCBkb21FdmVudDogRXZlbnQgfCBudWxsICk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBLZXlib2FyZFV0aWxzLmlzQXJyb3dLZXkoIGRvbUV2ZW50ICkgfHxcbiAgICAgICAgICAgS2V5Ym9hcmRVdGlscy5pc0FueUtleUV2ZW50KCBkb21FdmVudCwgW1xuICAgICAgICAgICAgIEtleWJvYXJkVXRpbHMuS0VZX1BBR0VfVVAsXG4gICAgICAgICAgICAgS2V5Ym9hcmRVdGlscy5LRVlfUEFHRV9ET1dOLFxuICAgICAgICAgICAgIEtleWJvYXJkVXRpbHMuS0VZX0hPTUUsXG4gICAgICAgICAgICAgS2V5Ym9hcmRVdGlscy5LRVlfRU5EXG4gICAgICAgICAgIF0gKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUga2V5IGNvcnJlc3BvbmRzIHRvIHByZXNzaW5nIGEgbnVtYmVyIGtleVxuICAgKi9cbiAgaXNOdW1iZXJLZXkoIGRvbUV2ZW50OiBFdmVudCB8IG51bGwgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEtleWJvYXJkVXRpbHMuaXNBbnlLZXlFdmVudCggZG9tRXZlbnQsIE5VTUJFUl9LRVlTICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEZvciBudW1iZXIga2V5cywgcmV0dXJuIHRoZSBudW1iZXIgb2YgdGhlIGtleSwgb3IgbnVsbCBpZiBub3QgYSBudW1iZXJcbiAgICovXG4gIGdldE51bWJlckZyb21Db2RlKCBkb21FdmVudDogRXZlbnQgfCBudWxsICk6IG51bGwgfCBudW1iZXIge1xuICAgIGlmICggS2V5Ym9hcmRVdGlscy5pc051bWJlcktleSggZG9tRXZlbnQgKSAmJiBkb21FdmVudCBpbnN0YW5jZW9mIEtleWJvYXJkRXZlbnQgKSB7XG4gICAgICByZXR1cm4gTnVtYmVyKCBkb21FdmVudC5jb2RlLnJlcGxhY2UoICdEaWdpdCcsICcnICkgKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50LmNvZGUgZGlzdGluZ3Vpc2hlcyBiZXR3ZWVuIGxlZnQgYW5kIHJpZ2h0IHNoaWZ0IGtleXMuIElmIGFsbCB5b3UgY2FyZSBhYm91dCBpcyB0aGUgcHJlc2VuY2VcbiAgICogb2YgYSBzaGlmdCBrZXkgeW91IGNhbiB1c2UgdGhpcy5cbiAgICovXG4gIGlzU2hpZnRLZXkoIGRvbUV2ZW50OiBFdmVudCB8IG51bGwgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEtleWJvYXJkVXRpbHMuaXNBbnlLZXlFdmVudCggZG9tRXZlbnQsIFNISUZUX0tFWVMgKTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQuY29kZSBkaXN0aW5ndWlzaGVzIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQgYWx0IGtleXMuIElmIGFsbCB5b3UgY2FyZSBhYm91dCBpcyB0aGUgcHJlc2VuY2VcbiAgICogb2YgdGhlIGFsdCBrZXkgeW91IGNhbiB1c2UgdGhpcy5cbiAgICovXG4gIGlzQWx0S2V5KCBkb21FdmVudDogRXZlbnQgfCBudWxsICk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBLZXlib2FyZFV0aWxzLmlzQW55S2V5RXZlbnQoIGRvbUV2ZW50LCBBTFRfS0VZUyApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudC5jb2RlIGRpc3Rpbmd1aXNoZXMgYmV0d2VlbiBsZWZ0IGFuZCByaWdodCBjb250cm9sIGtleXMuIElmIGFsbCB5b3UgY2FyZSBhYm91dCBpcyB0aGUgcHJlc2VuY2VcbiAgICogb2YgYSBjb250cm9sIGtleSB5b3UgY2FuIHVzZSB0aGlzLlxuICAgKi9cbiAgaXNDb250cm9sS2V5KCBkb21FdmVudDogRXZlbnQgfCBudWxsICk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBLZXlib2FyZFV0aWxzLmlzQW55S2V5RXZlbnQoIGRvbUV2ZW50LCBDT05UUk9MX0tFWVMgKTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQuY29kZSBkaXN0aW5ndWlzaGVzIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQgYWx0IGtleXMuIElmIGFsbCB5b3UgY2FyZSBhYm91dCBpcyB0aGUgcHJlc2VuY2VcbiAgICogb2YgdGhlIG1ldGEga2V5IHlvdSBjYW4gdXNlIHRoaXMuXG4gICAqL1xuICBpc01ldGFLZXkoIGRvbUV2ZW50OiBFdmVudCB8IG51bGwgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEtleWJvYXJkVXRpbHMuaXNBbnlLZXlFdmVudCggZG9tRXZlbnQsIE1FVEFfS0VZUyApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBrZXkgY29ycmVzcG9uZHMgdG8gb25lIG9mIHRoZSBXQVNEIG1vdmVtZW50IGtleXMuXG4gICAqL1xuICBpc1dBU0RLZXkoIGRvbUV2ZW50OiBFdmVudCB8IG51bGwgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIEtleWJvYXJkVXRpbHMuaXNBbnlLZXlFdmVudCggZG9tRXZlbnQsIFdBU0RfS0VZUyApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGtleSBpbmRpY2F0ZXMgYSAnbW92ZW1lbnQnIGtleSBpbiBrZXlib2FyZCBkcmFnZ2luZ1xuICAgKi9cbiAgaXNNb3ZlbWVudEtleSggZG9tRXZlbnQ6IEV2ZW50IHwgbnVsbCApOiBib29sZWFuIHtcbiAgICByZXR1cm4gS2V5Ym9hcmRVdGlscy5pc0FueUtleUV2ZW50KCBkb21FdmVudCwgS2V5Ym9hcmRVdGlscy5NT1ZFTUVOVF9LRVlTICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIElmIHRoZSBkb21FdmVudCBjb3JyZXNwb25kcyB0byBhbnkgb2YgdGhlIHByb3ZpZGVkIGtleXMgaW4gdGhlIGxpc3QuXG4gICAqL1xuICBpc0FueUtleUV2ZW50KCBkb21FdmVudDogRXZlbnQgfCBudWxsLCBrZXlib2FyZFV0aWxzS2V5czogc3RyaW5nW10gKTogYm9vbGVhbiB7XG4gICAgdmFsaWRhdGUoIGRvbUV2ZW50LCBET01fRVZFTlRfVkFMSURBVE9SICk7XG4gICAgY29uc3QgY29kZSA9IEtleWJvYXJkVXRpbHMuZ2V0RXZlbnRDb2RlKCBkb21FdmVudCApO1xuICAgIHJldHVybiBjb2RlID8ga2V5Ym9hcmRVdGlsc0tleXMuaW5jbHVkZXMoIGNvZGUgKSA6IGZhbHNlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBldmVudCB3YXMgb2YgdGhlIHByb3ZpZGVkIEtleWJvYXJkVXRpbHMgc3RyaW5nLlxuICAgKi9cbiAgaXNLZXlFdmVudCggZG9tRXZlbnQ6IEV2ZW50IHwgbnVsbCwga2V5Ym9hcmRVdGlsc0tleTogc3RyaW5nICk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBLZXlib2FyZFV0aWxzLmdldEV2ZW50Q29kZSggZG9tRXZlbnQgKSA9PT0ga2V5Ym9hcmRVdGlsc0tleTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJucyBhIHN0cmluZyB3aXRoIHRoZSBldmVudC5jb2RlIHRoYXQgY2FuIGJlIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBrZXlib2FyZCBrZXlzIG9mIGEgS2V5Ym9hcmRFdmVudCBvYmplY3QuXG4gICAqIE90aGVyd2lzZSwgcmV0dXJucyBudWxsIGlmIHRoZXJlIGlzIG5vIGNvZGUgb24gdGhlIGV2ZW50LiBBbiBleGFtcGxlIHVzYWdlIG1pZ2h0IGxvb2sgbGlrZVxuICAgKlxuICAgKiAgY29uc3Qga2V5ID0gS2V5Ym9hcmRVdGlscy5nZXRFdmVudENvZGUoIGRvbUV2ZW50ICk7XG4gICAqICBpZiAoIGtleSA9PT0gS2V5Ym9hcmRVdGlscy5LRVlfQSApIHtcbiAgICogICAgLy8gWW91IHByZXNzZWQgdGhlIEEga2V5IVxuICAgKiAgfVxuICAgKlxuICAgKiBAcmV0dXJucyAtIG51bGwgaWYgdGhlcmUgaXMgbm8gYGNvZGVgIHByb3BlcnR5IG9uIHRoZSBwcm92aWRlZCBFdmVudC5cbiAgICovXG4gIGdldEV2ZW50Q29kZSggZG9tRXZlbnQ6IEV2ZW50IHwgbnVsbCApOiBzdHJpbmcgfCBudWxsIHtcbiAgICBsZXQgZXZlbnRDb2RlID0gbnVsbDtcbiAgICBpZiAoIGRvbUV2ZW50IGluc3RhbmNlb2YgS2V5Ym9hcmRFdmVudCAmJiBkb21FdmVudC5jb2RlICkge1xuICAgICAgZXZlbnRDb2RlID0gZG9tRXZlbnQuY29kZTtcblxuICAgICAgLy8gRm9yIE51bXBhZCBrZXlzLCB0aGUgRG9tRXZlbnQuY29kZSBkb2VzIG5vdCBtYXRjaCB0aGUgZXF1aXZhbGVudCBcIm5vcm1hbFwiIGtleWJvYXJkIGtleSwgYnV0IHRoZSBEb21FdmVudC5rZXlcbiAgICAgIC8vIHdpbGwgbWF0Y2ggdGhlIGNvZGUgb2YgdGhlIFwibm9ybWFsXCIga2V5LiBJbiB0aG9zZSBjYXNlcyAoaG9tZS9wYWdlIHVwL3BhZ2UgZG93bi9lbmQpIHVzZSB0aGUga2V5IGFzIHRoZSBjb2RlLlxuICAgICAgaWYgKCBldmVudENvZGUuc3RhcnRzV2l0aCggJ051bXBhZCcgKSAmJiBBTExfS0VZX0NPREVTLmluY2x1ZGVzKCBkb21FdmVudC5rZXkgKSApIHtcbiAgICAgICAgZXZlbnRDb2RlID0gZG9tRXZlbnQua2V5O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBldmVudENvZGU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdHJ1ZSB3aGVuIGlmIHRoZSBwcm92aWRlZCBzdHJpbmcgaXMgYSBLZXlib2FyZEV2ZW50LmtleSBmb3IgYSBtb2RpZmllciBrZXkuIE5vdGUgdGhhdCBpcyBLZXlib2FyZEV2ZW50LmtleVxuICAgKiAqKk5PVCoqIEtleWJvYXJkRXZlbnQuY29kZS4gS2V5Ym9hcmRFdmVudC5jb2RlIGRvZXMgbm90IGRpc3Rpbmd1aXNoIGJldHdlZW4gbGVmdCBhbmQgcmlnaHQgbW9kaWZpZXIga2V5cyBzbyB3ZVxuICAgKiBoYXZlIHNvbWUgc3BlY2lhbCBiZWhhdmlvciB3aGVuIHdlIGRldGVjdCBhIG1vZGlmaWVyIGtleSAobGVmdCBvciByaWdodCkgaXMgcHJlc3NlZC5cbiAgICogQHBhcmFtIGtleVxuICAgKi9cbiAgaXNNb2RpZmllcktleSgga2V5OiBzdHJpbmcgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIE1PRElGSUVSX0tFWVMuaW5jbHVkZXMoIGtleSApO1xuICB9LFxuXG4gIEFMTF9LRVlTOiBBTExfS0VZX0NPREVTXG59O1xuXG5mb3IgKCBjb25zdCBrZXlLZXkgaW4gS2V5Ym9hcmRVdGlscyApIHtcblxuICAvLyBAdHMtZXhwZWN0LWVycm9yIE5vIGZ1bmN0aW9ucyBvciBrZXktZ3JvdXBzIGFsbG93ZWRcbiAgaWYgKCBLZXlib2FyZFV0aWxzLmhhc093blByb3BlcnR5KCBrZXlLZXkgKSAmJiB0eXBlb2YgS2V5Ym9hcmRVdGlsc1sga2V5S2V5IF0gPT09ICdzdHJpbmcnICkge1xuXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgIEFMTF9LRVlfQ09ERVMucHVzaCggS2V5Ym9hcmRVdGlsc1sga2V5S2V5IF0gKTtcbiAgfVxufVxuXG5zY2VuZXJ5LnJlZ2lzdGVyKCAnS2V5Ym9hcmRVdGlscycsIEtleWJvYXJkVXRpbHMgKTtcblxuZXhwb3J0IGRlZmF1bHQgS2V5Ym9hcmRVdGlsczsiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJzY2VuZXJ5IiwiS0VZX1JJR0hUX0FSUk9XIiwiS0VZX0xFRlRfQVJST1ciLCJLRVlfVVBfQVJST1ciLCJLRVlfRE9XTl9BUlJPVyIsIktFWV9TSElGVF9SSUdIVCIsIktFWV9TSElGVF9MRUZUIiwiS0VZX0NPTlRST0xfTEVGVCIsIktFWV9DT05UUk9MX1JJR0hUIiwiS0VZX0FMVF9MRUZUIiwiS0VZX0FMVF9SSUdIVCIsIktFWV9NRVRBX0xFRlQiLCJLRVlfTUVUQV9SSUdIVCIsIktFWV9NRVRBX0xFRlRfRklSRUZPWCIsIktFWV9NRVRBX1JJR0hUX0ZJUkVGT1giLCJLRVlfVyIsIktFWV9BIiwiS0VZX1MiLCJLRVlfRCIsIktFWV8wIiwiS0VZXzEiLCJLRVlfMiIsIktFWV8zIiwiS0VZXzQiLCJLRVlfNSIsIktFWV82IiwiS0VZXzciLCJLRVlfOCIsIktFWV85IiwiS0VZX0FMVCIsIktFWV9TSElGVCIsIktFWV9DT05UUk9MIiwiQVJST1dfS0VZUyIsIldBU0RfS0VZUyIsIk5VTUJFUl9LRVlTIiwiU0hJRlRfS0VZUyIsIkNPTlRST0xfS0VZUyIsIkFMVF9LRVlTIiwiTUVUQV9LRVlTIiwiTU9ESUZJRVJfS0VZUyIsIk1PRElGSUVSX0tFWV9DT0RFUyIsIkRPTV9FVkVOVF9WQUxJREFUT1IiLCJ2YWx1ZVR5cGUiLCJFdmVudCIsIkFMTF9LRVlfQ09ERVMiLCJLZXlib2FyZFV0aWxzIiwiS0VZX1NQQUNFIiwiS0VZX0VOVEVSIiwiS0VZX1RBQiIsIktFWV9FU0NBUEUiLCJLRVlfREVMRVRFIiwiS0VZX0JBQ0tTUEFDRSIsIktFWV9QQUdFX1VQIiwiS0VZX1BBR0VfRE9XTiIsIktFWV9FTkQiLCJLRVlfSE9NRSIsIktFWV9OVU1QQURfMCIsIktFWV9OVU1QQURfMSIsIktFWV9OVU1QQURfMiIsIktFWV9OVU1QQURfMyIsIktFWV9OVU1QQURfNCIsIktFWV9OVU1QQURfNSIsIktFWV9OVU1QQURfNiIsIktFWV9OVU1QQURfNyIsIktFWV9OVU1QQURfOCIsIktFWV9OVU1QQURfOSIsIktFWV9OVU1QQURfREVDSU1BTCIsIktFWV9OVU1QQURfUExVUyIsIktFWV9OVU1QQURfTUlOVVMiLCJLRVlfQiIsIktFWV9DIiwiS0VZX0UiLCJLRVlfRiIsIktFWV9HIiwiS0VZX0giLCJLRVlfSSIsIktFWV9KIiwiS0VZX0siLCJLRVlfTCIsIktFWV9NIiwiS0VZX04iLCJLRVlfTyIsIktFWV9QIiwiS0VZX1EiLCJLRVlfUiIsIktFWV9UIiwiS0VZX1UiLCJLRVlfViIsIktFWV9YIiwiS0VZX1kiLCJLRVlfWiIsIktFWV9FUVVBTFMiLCJLRVlfUExVUyIsIktFWV9NSU5VUyIsIktFWV9QRVJJT0QiLCJNT1ZFTUVOVF9LRVlTIiwiY29uY2F0IiwiTU9ESUZJRVJfS0VZX1RPX0NPREVfTUFQIiwiTWFwIiwiaXNBcnJvd0tleSIsImRvbUV2ZW50IiwiaXNBbnlLZXlFdmVudCIsImlzUmFuZ2VLZXkiLCJpc051bWJlcktleSIsImdldE51bWJlckZyb21Db2RlIiwiS2V5Ym9hcmRFdmVudCIsIk51bWJlciIsImNvZGUiLCJyZXBsYWNlIiwiaXNTaGlmdEtleSIsImlzQWx0S2V5IiwiaXNDb250cm9sS2V5IiwiaXNNZXRhS2V5IiwiaXNXQVNES2V5IiwiaXNNb3ZlbWVudEtleSIsImtleWJvYXJkVXRpbHNLZXlzIiwiZ2V0RXZlbnRDb2RlIiwiaW5jbHVkZXMiLCJpc0tleUV2ZW50Iiwia2V5Ym9hcmRVdGlsc0tleSIsImV2ZW50Q29kZSIsInN0YXJ0c1dpdGgiLCJrZXkiLCJpc01vZGlmaWVyS2V5IiwiQUxMX0tFWVMiLCJrZXlLZXkiLCJoYXNPd25Qcm9wZXJ0eSIsInB1c2giLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7Ozs7Q0FNQyxHQUVELE9BQU9BLGNBQWMsK0JBQStCO0FBQ3BELFNBQVNDLE9BQU8sUUFBUSxnQkFBZ0I7QUFFeEMsTUFBTUMsa0JBQWtCO0FBQ3hCLE1BQU1DLGlCQUFpQjtBQUN2QixNQUFNQyxlQUFlO0FBQ3JCLE1BQU1DLGlCQUFpQjtBQUN2QixNQUFNQyxrQkFBa0I7QUFDeEIsTUFBTUMsaUJBQWlCO0FBQ3ZCLE1BQU1DLG1CQUFtQjtBQUN6QixNQUFNQyxvQkFBb0I7QUFDMUIsTUFBTUMsZUFBZTtBQUNyQixNQUFNQyxnQkFBZ0I7QUFDdEIsTUFBTUMsZ0JBQWdCO0FBQ3RCLE1BQU1DLGlCQUFpQjtBQUN2QixNQUFNQyx3QkFBd0IsVUFBVSxrQ0FBa0M7QUFDMUUsTUFBTUMseUJBQXlCO0FBQy9CLE1BQU1DLFFBQVE7QUFDZCxNQUFNQyxRQUFRO0FBQ2QsTUFBTUMsUUFBUTtBQUNkLE1BQU1DLFFBQVE7QUFDZCxNQUFNQyxRQUFRO0FBQ2QsTUFBTUMsUUFBUTtBQUNkLE1BQU1DLFFBQVE7QUFDZCxNQUFNQyxRQUFRO0FBQ2QsTUFBTUMs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