// Copyright 2019-2024, University of Colorado Boulder
/**
 * Represents a single instance on the screen of a given Sprite object. It can have its own transformation matrix, and
 * is set up as a lightweight container of information, for high-performance usage (with pooling).
 *
 * Its individual parameters should generally be mutated directly by the client.
 *
 * @author Jonathan Olson <jonathan.olson@colorado.edu>
 */ import Matrix3 from '../../../dot/js/Matrix3.js';
import Vector2 from '../../../dot/js/Vector2.js';
import { Shape } from '../../../kite/js/imports.js';
import Enumeration from '../../../phet-core/js/Enumeration.js';
import EnumerationValue from '../../../phet-core/js/EnumerationValue.js';
import Pool from '../../../phet-core/js/Pool.js';
import { scenery } from '../imports.js';
const scratchVector = new Vector2(0, 0);
const scratchMatrix = Matrix3.IDENTITY.copy();
export class SpriteInstanceTransformType extends EnumerationValue {
}
SpriteInstanceTransformType.TRANSLATION = new SpriteInstanceTransformType();
SpriteInstanceTransformType.TRANSLATION_AND_SCALE = new SpriteInstanceTransformType();
SpriteInstanceTransformType.TRANSLATION_AND_ROTATION = new SpriteInstanceTransformType();
SpriteInstanceTransformType.AFFINE = new SpriteInstanceTransformType();
SpriteInstanceTransformType.enumeration = new Enumeration(SpriteInstanceTransformType, {
    phetioDocumentation: 'Defines the available transform type for a SpriteInstance'
});
let SpriteInstance = class SpriteInstance {
    /**
   * For pooling. Please use SpriteInstance.pool.fetch() to grab a copy
   */ initialize() {
        // We need an empty initialization method here, so that we can grab dirty versions and use them for higher
        // performance.
        return this;
    }
    /**
   * Returns a Shape that represents the hit-testable area of this SpriteInstance.
   */ getShape() {
        if (this.sprite) {
            return this.sprite.getShape().transformed(this.matrix);
        } else {
            return new Shape();
        }
    }
    /**
   * Returns whether a given point is considered "inside" the SpriteInstance
   */ containsPoint(point) {
        if (!this.sprite) {
            return false;
        }
        const position = scratchVector.set(point);
        if (this.transformType === SpriteInstanceTransformType.AFFINE) {
            scratchMatrix.set(this.matrix).invert().multiplyVector2(position);
        } else {
            position.x -= this.matrix.m02();
            position.y -= this.matrix.m12();
            if (this.transformType === SpriteInstanceTransformType.TRANSLATION_AND_SCALE) {
                position.x /= this.matrix.m00();
                position.y /= this.matrix.m11();
            } else if (this.transformType === SpriteInstanceTransformType.TRANSLATION_AND_ROTATION) {
                position.rotate(-this.matrix.rotation);
            }
        }
        return this.sprite.containsPoint(position);
    }
    freeToPool() {
        SpriteInstance.pool.freeToPool(this);
    }
    constructor(){
        this.sprite = null;
        this.matrix = new Matrix3().setToAffine(1, 0, 0, 0, 1, 0); // initialized to trigger the affine flag
        this.transformType = SpriteInstanceTransformType.TRANSLATION;
        this.alpha = 1;
    }
};
SpriteInstance.pool = new Pool(SpriteInstance, {
    maxSize: 1000
});
export { SpriteInstance as default };
scenery.register('SpriteInstance', SpriteInstance);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NjZW5lcnkvanMvdXRpbC9TcHJpdGVJbnN0YW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOS0yMDI0LCBVbml2ZXJzaXR5IG9mIENvbG9yYWRvIEJvdWxkZXJcblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgc2luZ2xlIGluc3RhbmNlIG9uIHRoZSBzY3JlZW4gb2YgYSBnaXZlbiBTcHJpdGUgb2JqZWN0LiBJdCBjYW4gaGF2ZSBpdHMgb3duIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCwgYW5kXG4gKiBpcyBzZXQgdXAgYXMgYSBsaWdodHdlaWdodCBjb250YWluZXIgb2YgaW5mb3JtYXRpb24sIGZvciBoaWdoLXBlcmZvcm1hbmNlIHVzYWdlICh3aXRoIHBvb2xpbmcpLlxuICpcbiAqIEl0cyBpbmRpdmlkdWFsIHBhcmFtZXRlcnMgc2hvdWxkIGdlbmVyYWxseSBiZSBtdXRhdGVkIGRpcmVjdGx5IGJ5IHRoZSBjbGllbnQuXG4gKlxuICogQGF1dGhvciBKb25hdGhhbiBPbHNvbiA8am9uYXRoYW4ub2xzb25AY29sb3JhZG8uZWR1PlxuICovXG5cbmltcG9ydCBNYXRyaXgzIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9NYXRyaXgzLmpzJztcbmltcG9ydCBWZWN0b3IyIGZyb20gJy4uLy4uLy4uL2RvdC9qcy9WZWN0b3IyLmpzJztcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcbmltcG9ydCBFbnVtZXJhdGlvbiBmcm9tICcuLi8uLi8uLi9waGV0LWNvcmUvanMvRW51bWVyYXRpb24uanMnO1xuaW1wb3J0IEVudW1lcmF0aW9uVmFsdWUgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL0VudW1lcmF0aW9uVmFsdWUuanMnO1xuaW1wb3J0IFBvb2wgZnJvbSAnLi4vLi4vLi4vcGhldC1jb3JlL2pzL1Bvb2wuanMnO1xuaW1wb3J0IHsgc2NlbmVyeSwgU3ByaXRlIH0gZnJvbSAnLi4vaW1wb3J0cy5qcyc7XG5cbmNvbnN0IHNjcmF0Y2hWZWN0b3IgPSBuZXcgVmVjdG9yMiggMCwgMCApO1xuY29uc3Qgc2NyYXRjaE1hdHJpeCA9IE1hdHJpeDMuSURFTlRJVFkuY29weSgpO1xuXG5leHBvcnQgY2xhc3MgU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlIGV4dGVuZHMgRW51bWVyYXRpb25WYWx1ZSB7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVFJBTlNMQVRJT04gPSBuZXcgU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlKCk7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgVFJBTlNMQVRJT05fQU5EX1NDQUxFID0gbmV3IFNwcml0ZUluc3RhbmNlVHJhbnNmb3JtVHlwZSgpO1xuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IFRSQU5TTEFUSU9OX0FORF9ST1RBVElPTiA9IG5ldyBTcHJpdGVJbnN0YW5jZVRyYW5zZm9ybVR5cGUoKTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBBRkZJTkUgPSBuZXcgU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlKCk7XG5cbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBlbnVtZXJhdGlvbiA9IG5ldyBFbnVtZXJhdGlvbiggU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlLCB7XG4gICAgcGhldGlvRG9jdW1lbnRhdGlvbjogJ0RlZmluZXMgdGhlIGF2YWlsYWJsZSB0cmFuc2Zvcm0gdHlwZSBmb3IgYSBTcHJpdGVJbnN0YW5jZSdcbiAgfSApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTcHJpdGVJbnN0YW5jZSB7XG5cbiAgLy8gVGhpcyBzaG91bGQgYmUgc2V0IHRvIGEgYFNwcml0ZWAgb2JqZWN0IHdoaWNoIGlzIHRoZSBzcHJpdGUgdGhhdCBzaG91bGQgYmUgZGlzcGxheWVkLlxuICAvLyBUaGlzIGZpZWxkIGlzIGV4cGVjdGVkIHRvIGJlIHNldCBieSB0aGUgY2xpZW50IHdoZW5ldmVyIGl0IG5lZWRzIHRvIGNoYW5nZS5cbiAgcHVibGljIHNwcml0ZTogU3ByaXRlIHwgbnVsbDtcblxuICAvLyBQbGVhc2UganVzdCBtdXRhdGUgdGhlIGdpdmVuIE1hdHJpeDMgZm9yIHBlcmZvcm1hbmNlLiBJZiB0aGUgbWF0cml4IHJlcHJlc2VudHMgc29tZXRoaW5nXG4gIC8vIG90aGVyIHRoYW4ganVzdCBhIHRyYW5zbGF0aW9uLCBwbGVhc2UgdXBkYXRlIHRoZSBgdHJhbnNmb3JtVHlwZWAgdG8gdGhlIHR5cGUgdGhhdCByZXByZXNlbnRzIHRoZSBwb3NzaWJsZVxuICAvLyB2YWx1ZXMuXG4gIHB1YmxpYyBtYXRyaXg6IE1hdHJpeDM7XG5cbiAgcHVibGljIHRyYW5zZm9ybVR5cGU6IFNwcml0ZUluc3RhbmNlVHJhbnNmb3JtVHlwZTtcblxuICAvLyBUaGUgZ2VuZXJhbCBvcGFjaXR5L2FscGhhIG9mIHRoZSBkaXNwbGF5ZWQgc3ByaXRlIChzZWUgTm9kZSdzIG9wYWNpdHkpXG4gIHB1YmxpYyBhbHBoYTogbnVtYmVyO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcblxuICAgIHRoaXMuc3ByaXRlID0gbnVsbDtcbiAgICB0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuc2V0VG9BZmZpbmUoIDEsIDAsIDAsIDAsIDEsIDAgKTsgLy8gaW5pdGlhbGl6ZWQgdG8gdHJpZ2dlciB0aGUgYWZmaW5lIGZsYWdcbiAgICB0aGlzLnRyYW5zZm9ybVR5cGUgPSBTcHJpdGVJbnN0YW5jZVRyYW5zZm9ybVR5cGUuVFJBTlNMQVRJT047XG5cbiAgICB0aGlzLmFscGhhID0gMTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3IgcG9vbGluZy4gUGxlYXNlIHVzZSBTcHJpdGVJbnN0YW5jZS5wb29sLmZldGNoKCkgdG8gZ3JhYiBhIGNvcHlcbiAgICovXG4gIHB1YmxpYyBpbml0aWFsaXplKCk6IHRoaXMge1xuICAgIC8vIFdlIG5lZWQgYW4gZW1wdHkgaW5pdGlhbGl6YXRpb24gbWV0aG9kIGhlcmUsIHNvIHRoYXQgd2UgY2FuIGdyYWIgZGlydHkgdmVyc2lvbnMgYW5kIHVzZSB0aGVtIGZvciBoaWdoZXJcbiAgICAvLyBwZXJmb3JtYW5jZS5cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBTaGFwZSB0aGF0IHJlcHJlc2VudHMgdGhlIGhpdC10ZXN0YWJsZSBhcmVhIG9mIHRoaXMgU3ByaXRlSW5zdGFuY2UuXG4gICAqL1xuICBwdWJsaWMgZ2V0U2hhcGUoKTogU2hhcGUge1xuICAgIGlmICggdGhpcy5zcHJpdGUgKSB7XG4gICAgICByZXR1cm4gdGhpcy5zcHJpdGUuZ2V0U2hhcGUoKS50cmFuc2Zvcm1lZCggdGhpcy5tYXRyaXggKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IFNoYXBlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2hldGhlciBhIGdpdmVuIHBvaW50IGlzIGNvbnNpZGVyZWQgXCJpbnNpZGVcIiB0aGUgU3ByaXRlSW5zdGFuY2VcbiAgICovXG4gIHB1YmxpYyBjb250YWluc1BvaW50KCBwb2ludDogVmVjdG9yMiApOiBib29sZWFuIHtcbiAgICBpZiAoICF0aGlzLnNwcml0ZSApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBwb3NpdGlvbiA9IHNjcmF0Y2hWZWN0b3Iuc2V0KCBwb2ludCApO1xuXG4gICAgaWYgKCB0aGlzLnRyYW5zZm9ybVR5cGUgPT09IFNwcml0ZUluc3RhbmNlVHJhbnNmb3JtVHlwZS5BRkZJTkUgKSB7XG4gICAgICBzY3JhdGNoTWF0cml4LnNldCggdGhpcy5tYXRyaXggKS5pbnZlcnQoKS5tdWx0aXBseVZlY3RvcjIoIHBvc2l0aW9uICk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcG9zaXRpb24ueCAtPSB0aGlzLm1hdHJpeC5tMDIoKTtcbiAgICAgIHBvc2l0aW9uLnkgLT0gdGhpcy5tYXRyaXgubTEyKCk7XG5cbiAgICAgIGlmICggdGhpcy50cmFuc2Zvcm1UeXBlID09PSBTcHJpdGVJbnN0YW5jZVRyYW5zZm9ybVR5cGUuVFJBTlNMQVRJT05fQU5EX1NDQUxFICkge1xuICAgICAgICBwb3NpdGlvbi54IC89IHRoaXMubWF0cml4Lm0wMCgpO1xuICAgICAgICBwb3NpdGlvbi55IC89IHRoaXMubWF0cml4Lm0xMSgpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoIHRoaXMudHJhbnNmb3JtVHlwZSA9PT0gU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlLlRSQU5TTEFUSU9OX0FORF9ST1RBVElPTiApIHtcbiAgICAgICAgcG9zaXRpb24ucm90YXRlKCAtdGhpcy5tYXRyaXgucm90YXRpb24gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zcHJpdGUuY29udGFpbnNQb2ludCggcG9zaXRpb24gKTtcbiAgfVxuXG4gIHB1YmxpYyBmcmVlVG9Qb29sKCk6IHZvaWQge1xuICAgIFNwcml0ZUluc3RhbmNlLnBvb2wuZnJlZVRvUG9vbCggdGhpcyApO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBwb29sID0gbmV3IFBvb2woIFNwcml0ZUluc3RhbmNlLCB7XG4gICAgbWF4U2l6ZTogMTAwMFxuICB9ICk7XG59XG5cbnNjZW5lcnkucmVnaXN0ZXIoICdTcHJpdGVJbnN0YW5jZScsIFNwcml0ZUluc3RhbmNlICk7Il0sIm5hbWVzIjpbIk1hdHJpeDMiLCJWZWN0b3IyIiwiU2hhcGUiLCJFbnVtZXJhdGlvbiIsIkVudW1lcmF0aW9uVmFsdWUiLCJQb29sIiwic2NlbmVyeSIsInNjcmF0Y2hWZWN0b3IiLCJzY3JhdGNoTWF0cml4IiwiSURFTlRJVFkiLCJjb3B5IiwiU3ByaXRlSW5zdGFuY2VUcmFuc2Zvcm1UeXBlIiwiVFJBTlNMQVRJT04iLCJUUkFOU0xBVElPTl9BTkRfU0NBTEUiLCJUUkFOU0xBVElPTl9BTkRfUk9UQVRJT04iLCJBRkZJTkUiLCJlbnVtZXJhdGlvbiIsInBoZXRpb0RvY3VtZW50YXRpb24iLCJTcHJpdGVJbnN0YW5jZSIsImluaXRpYWxpemUiLCJnZXRTaGFwZSIsInNwcml0ZSIsInRyYW5zZm9ybWVkIiwibWF0cml4IiwiY29udGFpbnNQb2ludCIsInBvaW50IiwicG9zaXRpb24iLCJzZXQiLCJ0cmFuc2Zvcm1UeXBlIiwiaW52ZXJ0IiwibXVsdGlwbHlWZWN0b3IyIiwieCIsIm0wMiIsInkiLCJtMTIiLCJtMDAiLCJtMTEiLCJyb3RhdGUiLCJyb3RhdGlvbiIsImZyZWVUb1Bvb2wiLCJwb29sIiwic2V0VG9BZmZpbmUiLCJhbHBoYSIsIm1heFNpemUiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkFBQUEsc0RBQXNEO0FBRXREOzs7Ozs7O0NBT0MsR0FFRCxPQUFPQSxhQUFhLDZCQUE2QjtBQUNqRCxPQUFPQyxhQUFhLDZCQUE2QjtBQUNqRCxTQUFTQyxLQUFLLFFBQVEsOEJBQThCO0FBQ3BELE9BQU9DLGlCQUFpQix1Q0FBdUM7QUFDL0QsT0FBT0Msc0JBQXNCLDRDQUE0QztBQUN6RSxPQUFPQyxVQUFVLGdDQUFnQztBQUNqRCxTQUFTQyxPQUFPLFFBQWdCLGdCQUFnQjtBQUVoRCxNQUFNQyxnQkFBZ0IsSUFBSU4sUUFBUyxHQUFHO0FBQ3RDLE1BQU1PLGdCQUFnQlIsUUFBUVMsUUFBUSxDQUFDQyxJQUFJO0FBRTNDLE9BQU8sTUFBTUMsb0NBQW9DUDtBQVNqRDtBQVRhTyw0QkFDWUMsY0FBYyxJQUFJRDtBQUQ5QkEsNEJBRVlFLHdCQUF3QixJQUFJRjtBQUZ4Q0EsNEJBR1lHLDJCQUEyQixJQUFJSDtBQUgzQ0EsNEJBSVlJLFNBQVMsSUFBSUo7QUFKekJBLDRCQU1ZSyxjQUFjLElBQUliLFlBQWFRLDZCQUE2QjtJQUNqRk0scUJBQXFCO0FBQ3ZCO0FBR2EsSUFBQSxBQUFNQyxpQkFBTixNQUFNQTtJQXlCbkI7O0dBRUMsR0FDRCxBQUFPQyxhQUFtQjtRQUN4QiwwR0FBMEc7UUFDMUcsZUFBZTtRQUVmLE9BQU8sSUFBSTtJQUNiO0lBRUE7O0dBRUMsR0FDRCxBQUFPQyxXQUFrQjtRQUN2QixJQUFLLElBQUksQ0FBQ0MsTUFBTSxFQUFHO1lBQ2pCLE9BQU8sSUFBSSxDQUFDQSxNQUFNLENBQUNELFFBQVEsR0FBR0UsV0FBVyxDQUFFLElBQUksQ0FBQ0MsTUFBTTtRQUN4RCxPQUNLO1lBQ0gsT0FBTyxJQUFJckI7UUFDYjtJQUNGO0lBRUE7O0dBRUMsR0FDRCxBQUFPc0IsY0FBZUMsS0FBYyxFQUFZO1FBQzlDLElBQUssQ0FBQyxJQUFJLENBQUNKLE1BQU0sRUFBRztZQUNsQixPQUFPO1FBQ1Q7UUFFQSxNQUFNSyxXQUFXbkIsY0FBY29CLEdBQUcsQ0FBRUY7UUFFcEMsSUFBSyxJQUFJLENBQUNHLGFBQWEsS0FBS2pCLDRCQUE0QkksTUFBTSxFQUFHO1lBQy9EUCxjQUFjbUIsR0FBRyxDQUFFLElBQUksQ0FBQ0osTUFBTSxFQUFHTSxNQUFNLEdBQUdDLGVBQWUsQ0FBRUo7UUFDN0QsT0FDSztZQUNIQSxTQUFTSyxDQUFDLElBQUksSUFBSSxDQUFDUixNQUFNLENBQUNTLEdBQUc7WUFDN0JOLFNBQVNPLENBQUMsSUFBSSxJQUFJLENBQUNWLE1BQU0sQ0FBQ1csR0FBRztZQUU3QixJQUFLLElBQUksQ0FBQ04sYUFBYSxLQUFLakIsNEJBQTRCRSxxQkFBcUIsRUFBRztnQkFDOUVhLFNBQVNLLENBQUMsSUFBSSxJQUFJLENBQUNSLE1BQU0sQ0FBQ1ksR0FBRztnQkFDN0JULFNBQVNPLENBQUMsSUFBSSxJQUFJLENBQUNWLE1BQU0sQ0FBQ2EsR0FBRztZQUMvQixPQUNLLElBQUssSUFBSSxDQUFDUixhQUFhLEtBQUtqQiw0QkFBNEJHLHdCQUF3QixFQUFHO2dCQUN0RlksU0FBU1csTUFBTSxDQUFFLENBQUMsSUFBSSxDQUFDZCxNQUFNLENBQUNlLFFBQVE7WUFDeEM7UUFDRjtRQUVBLE9BQU8sSUFBSSxDQUFDakIsTUFBTSxDQUFDRyxhQUFhLENBQUVFO0lBQ3BDO0lBRU9hLGFBQW1CO1FBQ3hCckIsZUFBZXNCLElBQUksQ0FBQ0QsVUFBVSxDQUFFLElBQUk7SUFDdEM7SUE5REEsYUFBcUI7UUFFbkIsSUFBSSxDQUFDbEIsTUFBTSxHQUFHO1FBQ2QsSUFBSSxDQUFDRSxNQUFNLEdBQUcsSUFBSXZCLFVBQVV5QyxXQUFXLENBQUUsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLElBQUsseUNBQXlDO1FBQ3RHLElBQUksQ0FBQ2IsYUFBYSxHQUFHakIsNEJBQTRCQyxXQUFXO1FBRTVELElBQUksQ0FBQzhCLEtBQUssR0FBRztJQUNmO0FBNERGO0FBbkZxQnhCLGVBZ0ZJc0IsT0FBTyxJQUFJbkMsS0FBTWEsZ0JBQWdCO0lBQ3REeUIsU0FBUztBQUNYO0FBbEZGLFNBQXFCekIsNEJBbUZwQjtBQUVEWixRQUFRc0MsUUFBUSxDQUFFLGtCQUFrQjFCIn0=